(()=>{var KQ=Object.create;var S1=Object.defineProperty;var YQ=Object.getOwnPropertyDescriptor;var JQ=Object.getOwnPropertyNames;var QQ=Object.getPrototypeOf,eee=Object.prototype.hasOwnProperty;var P=(a,i)=>()=>(i||a((i={exports:{}}).exports,i),i.exports),tee=(a,i)=>{for(var l in i)S1(a,l,{get:i[l],enumerable:!0})},ree=(a,i,l,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of JQ(i))!eee.call(a,c)&&c!==l&&S1(a,c,{get:()=>i[c],enumerable:!(o=YQ(i,c))||o.enumerable});return a};var rn=(a,i,l)=>(l=a!=null?KQ(QQ(a)):{},ree(i||!a||!a.__esModule?S1(l,"default",{value:a,enumerable:!0}):l,a));var It=P((I1,GC)=>{"use strict";var cp=function(a){return a&&a.Math===Math&&a};GC.exports=cp(typeof globalThis=="object"&&globalThis)||cp(typeof window=="object"&&window)||cp(typeof self=="object"&&self)||cp(typeof globalThis=="object"&&globalThis)||cp(typeof I1=="object"&&I1)||function(){return this}()||Function("return this")()});var ct=P((n5e,WC)=>{"use strict";WC.exports=function(a){try{return!!a()}catch{return!0}}});var Vt=P((o5e,ZC)=>{"use strict";var iee=ct();ZC.exports=!iee(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})});var nh=P((a5e,HC)=>{"use strict";var nee=ct();HC.exports=!nee(function(){var a=(function(){}).bind();return typeof a!="function"||a.hasOwnProperty("prototype")})});var rr=P((s5e,XC)=>{"use strict";var oee=nh(),Py=Function.prototype.call;XC.exports=oee?Py.bind(Py):function(){return Py.apply(Py,arguments)}});var hp=P(JC=>{"use strict";var KC={}.propertyIsEnumerable,YC=Object.getOwnPropertyDescriptor,aee=YC&&!KC.call({1:2},1);JC.f=aee?function(i){var l=YC(this,i);return!!l&&l.enumerable}:KC});var Hn=P((u5e,QC)=>{"use strict";QC.exports=function(a,i){return{enumerable:!(a&1),configurable:!(a&2),writable:!(a&4),value:i}}});var pt=P((c5e,rP)=>{"use strict";var eP=nh(),tP=Function.prototype,A1=tP.call,see=eP&&tP.bind.bind(A1,A1);rP.exports=eP?see:function(a){return function(){return A1.apply(a,arguments)}}});var Gi=P((h5e,nP)=>{"use strict";var iP=pt(),lee=iP({}.toString),uee=iP("".slice);nP.exports=function(a){return uee(lee(a),8,-1)}});var wu=P((f5e,oP)=>{"use strict";var cee=pt(),hee=ct(),fee=Gi(),O1=Object,dee=cee("".split);oP.exports=hee(function(){return!O1("z").propertyIsEnumerable(0)})?function(a){return fee(a)==="String"?dee(a,""):O1(a)}:O1});var fn=P((d5e,aP)=>{"use strict";aP.exports=function(a){return a==null}});var ei=P((p5e,sP)=>{"use strict";var pee=fn(),mee=TypeError;sP.exports=function(a){if(pee(a))throw new mee("Can't call method on "+a);return a}});var qi=P((m5e,lP)=>{"use strict";var _ee=wu(),yee=ei();lP.exports=function(a){return _ee(yee(a))}});var _r=P((_5e,uP)=>{"use strict";var C1=typeof document=="object"&&document.all;uP.exports=typeof C1>"u"&&C1!==void 0?function(a){return typeof a=="function"||a===C1}:function(a){return typeof a=="function"}});var ur=P((y5e,cP)=>{"use strict";var gee=_r();cP.exports=function(a){return typeof a=="object"?a!==null:gee(a)}});var Wr=P((g5e,hP)=>{"use strict";var P1=It(),vee=_r(),xee=function(a){return vee(a)?a:void 0};hP.exports=function(a,i){return arguments.length<2?xee(P1[a]):P1[a]&&P1[a][i]}});var Mn=P((v5e,fP)=>{"use strict";var bee=pt();fP.exports=bee({}.isPrototypeOf)});var ya=P((x5e,dP)=>{"use strict";dP.exports=typeof navigator<"u"&&String(navigator.userAgent)||""});var ga=P((b5e,vP)=>{"use strict";var gP=It(),M1=ya(),pP=gP.process,mP=gP.Deno,_P=pP&&pP.versions||mP&&mP.version,yP=_P&&_P.v8,Go,My;yP&&(Go=yP.split("."),My=Go[0]>0&&Go[0]<4?1:+(Go[0]+Go[1]));!My&&M1&&(Go=M1.match(/Edge\/(\d+)/),(!Go||Go[1]>=74)&&(Go=M1.match(/Chrome\/(\d+)/),Go&&(My=+Go[1])));vP.exports=My});var Tu=P((w5e,bP)=>{"use strict";var xP=ga(),wee=ct(),Tee=It(),Eee=Tee.String;bP.exports=!!Object.getOwnPropertySymbols&&!wee(function(){var a=Symbol("symbol detection");return!Eee(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&xP&&xP<41})});var q1=P((T5e,wP)=>{"use strict";var See=Tu();wP.exports=See&&!Symbol.sham&&typeof Symbol.iterator=="symbol"});var rl=P((E5e,TP)=>{"use strict";var Iee=Wr(),Aee=_r(),Oee=Mn(),Cee=q1(),Pee=Object;TP.exports=Cee?function(a){return typeof a=="symbol"}:function(a){var i=Iee("Symbol");return Aee(i)&&Oee(i.prototype,Pee(a))}});var il=P((S5e,EP)=>{"use strict";var Mee=String;EP.exports=function(a){try{return Mee(a)}catch{return"Object"}}});var ti=P((I5e,SP)=>{"use strict";var qee=_r(),Ree=il(),Dee=TypeError;SP.exports=function(a){if(qee(a))return a;throw new Dee(Ree(a)+" is not a function")}});var va=P((A5e,IP)=>{"use strict";var Lee=ti(),kee=fn();IP.exports=function(a,i){var l=a[i];return kee(l)?void 0:Lee(l)}});var k1=P((O5e,AP)=>{"use strict";var R1=rr(),D1=_r(),L1=ur(),Bee=TypeError;AP.exports=function(a,i){var l,o;if(i==="string"&&D1(l=a.toString)&&!L1(o=R1(l,a))||D1(l=a.valueOf)&&!L1(o=R1(l,a))||i!=="string"&&D1(l=a.toString)&&!L1(o=R1(l,a)))return o;throw new Bee("Can't convert object to primitive value")}});var fi=P((C5e,OP)=>{"use strict";OP.exports=!1});var qy=P((P5e,PP)=>{"use strict";var CP=It(),zee=Object.defineProperty;PP.exports=function(a,i){try{zee(CP,a,{value:i,configurable:!0,writable:!0})}catch{CP[a]=i}return i}});var Ry=P((M5e,RP)=>{"use strict";var Fee=fi(),Nee=It(),Uee=qy(),MP="__core-js_shared__",qP=RP.exports=Nee[MP]||Uee(MP,{});(qP.versions||(qP.versions=[])).push({version:"3.36.0",mode:Fee?"pure":"global",copyright:"\xA9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.0/LICENSE",source:"https://github.com/zloirock/core-js"})});var Eu=P((q5e,LP)=>{"use strict";var DP=Ry();LP.exports=function(a,i){return DP[a]||(DP[a]=i||{})}});var Rr=P((R5e,kP)=>{"use strict";var jee=ei(),Vee=Object;kP.exports=function(a){return Vee(jee(a))}});var yr=P((D5e,BP)=>{"use strict";var $ee=pt(),Gee=Rr(),Wee=$ee({}.hasOwnProperty);BP.exports=Object.hasOwn||function(i,l){return Wee(Gee(i),l)}});var Su=P((L5e,zP)=>{"use strict";var Zee=pt(),Hee=0,Xee=Math.random(),Kee=Zee(1 .toString);zP.exports=function(a){return"Symbol("+(a===void 0?"":a)+")_"+Kee(++Hee+Xee,36)}});var pr=P((k5e,NP)=>{"use strict";var Yee=It(),Jee=Eu(),FP=yr(),Qee=Su(),ete=Tu(),tte=q1(),oh=Yee.Symbol,B1=Jee("wks"),rte=tte?oh.for||oh:oh&&oh.withoutSetter||Qee;NP.exports=function(a){return FP(B1,a)||(B1[a]=ete&&FP(oh,a)?oh[a]:rte("Symbol."+a)),B1[a]}});var fp=P((B5e,VP)=>{"use strict";var ite=rr(),UP=ur(),jP=rl(),nte=va(),ote=k1(),ate=pr(),ste=TypeError,lte=ate("toPrimitive");VP.exports=function(a,i){if(!UP(a)||jP(a))return a;var l=nte(a,lte),o;if(l){if(i===void 0&&(i="default"),o=ite(l,a,i),!UP(o)||jP(o))return o;throw new ste("Can't convert object to primitive value")}return i===void 0&&(i="number"),ote(a,i)}});var rs=P((z5e,$P)=>{"use strict";var ute=fp(),cte=rl();$P.exports=function(a){var i=ute(a,"string");return cte(i)?i:i+""}});var dp=P((F5e,WP)=>{"use strict";var hte=It(),GP=ur(),z1=hte.document,fte=GP(z1)&&GP(z1.createElement);WP.exports=function(a){return fte?z1.createElement(a):{}}});var F1=P((N5e,ZP)=>{"use strict";var dte=Vt(),pte=ct(),mte=dp();ZP.exports=!dte&&!pte(function(){return Object.defineProperty(mte("div"),"a",{get:function(){return 7}}).a!==7})});var nn=P(XP=>{"use strict";var _te=Vt(),yte=rr(),gte=hp(),vte=Hn(),xte=qi(),bte=rs(),wte=yr(),Tte=F1(),HP=Object.getOwnPropertyDescriptor;XP.f=_te?HP:function(i,l){if(i=xte(i),l=bte(l),Tte)try{return HP(i,l)}catch{}if(wte(i,l))return vte(!yte(gte.f,i,l),i[l])}});var N1=P((j5e,KP)=>{"use strict";var Ete=Vt(),Ste=ct();KP.exports=Ete&&Ste(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})});var ir=P((V5e,YP)=>{"use strict";var Ite=ur(),Ate=String,Ote=TypeError;YP.exports=function(a){if(Ite(a))return a;throw new Ote(Ate(a)+" is not an object")}});var ri=P(QP=>{"use strict";var Cte=Vt(),Pte=F1(),Mte=N1(),Dy=ir(),JP=rs(),qte=TypeError,U1=Object.defineProperty,Rte=Object.getOwnPropertyDescriptor,j1="enumerable",V1="configurable",$1="writable";QP.f=Cte?Mte?function(i,l,o){if(Dy(i),l=JP(l),Dy(o),typeof i=="function"&&l==="prototype"&&"value"in o&&$1 in o&&!o[$1]){var c=Rte(i,l);c&&c[$1]&&(i[l]=o.value,o={configurable:V1 in o?o[V1]:c[V1],enumerable:j1 in o?o[j1]:c[j1],writable:!1})}return U1(i,l,o)}:U1:function(i,l,o){if(Dy(i),l=JP(l),Dy(o),Pte)try{return U1(i,l,o)}catch{}if("get"in o||"set"in o)throw new qte("Accessors not supported");return"value"in o&&(i[l]=o.value),i}});var on=P((G5e,eM)=>{"use strict";var Dte=Vt(),Lte=ri(),kte=Hn();eM.exports=Dte?function(a,i,l){return Lte.f(a,i,kte(1,l))}:function(a,i,l){return a[i]=l,a}});var Iu=P((W5e,rM)=>{"use strict";var G1=Vt(),Bte=yr(),tM=Function.prototype,zte=G1&&Object.getOwnPropertyDescriptor,W1=Bte(tM,"name"),Fte=W1&&(function(){}).name==="something",Nte=W1&&(!G1||G1&&zte(tM,"name").configurable);rM.exports={EXISTS:W1,PROPER:Fte,CONFIGURABLE:Nte}});var Ly=P((Z5e,iM)=>{"use strict";var Ute=pt(),jte=_r(),Z1=Ry(),Vte=Ute(Function.toString);jte(Z1.inspectSource)||(Z1.inspectSource=function(a){return Vte(a)});iM.exports=Z1.inspectSource});var H1=P((H5e,oM)=>{"use strict";var $te=It(),Gte=_r(),nM=$te.WeakMap;oM.exports=Gte(nM)&&/native code/.test(String(nM))});var pp=P((X5e,sM)=>{"use strict";var Wte=Eu(),Zte=Su(),aM=Wte("keys");sM.exports=function(a){return aM[a]||(aM[a]=Zte(a))}});var ah=P((K5e,lM)=>{"use strict";lM.exports={}});var Ai=P((Y5e,hM)=>{"use strict";var Hte=H1(),cM=It(),Xte=ur(),Kte=on(),X1=yr(),K1=Ry(),Yte=pp(),Jte=ah(),uM="Object already initialized",Y1=cM.TypeError,Qte=cM.WeakMap,ky,mp,By,ere=function(a){return By(a)?mp(a):ky(a,{})},tre=function(a){return function(i){var l;if(!Xte(i)||(l=mp(i)).type!==a)throw new Y1("Incompatible receiver, "+a+" required");return l}};Hte||K1.state?(Wo=K1.state||(K1.state=new Qte),Wo.get=Wo.get,Wo.has=Wo.has,Wo.set=Wo.set,ky=function(a,i){if(Wo.has(a))throw new Y1(uM);return i.facade=a,Wo.set(a,i),i},mp=function(a){return Wo.get(a)||{}},By=function(a){return Wo.has(a)}):(Au=Yte("state"),Jte[Au]=!0,ky=function(a,i){if(X1(a,Au))throw new Y1(uM);return i.facade=a,Kte(a,Au,i),i},mp=function(a){return X1(a,Au)?a[Au]:{}},By=function(a){return X1(a,Au)});var Wo,Au;hM.exports={set:ky,get:mp,has:By,enforce:ere,getterFor:tre}});var Ny=P((J5e,pM)=>{"use strict";var Q1=pt(),rre=ct(),ire=_r(),zy=yr(),J1=Vt(),nre=Iu().CONFIGURABLE,ore=Ly(),dM=Ai(),are=dM.enforce,sre=dM.get,fM=String,Fy=Object.defineProperty,lre=Q1("".slice),ure=Q1("".replace),cre=Q1([].join),hre=J1&&!rre(function(){return Fy(function(){},"length",{value:8}).length!==8}),fre=String(String).split("String"),dre=pM.exports=function(a,i,l){lre(fM(i),0,7)==="Symbol("&&(i="["+ure(fM(i),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),l&&l.getter&&(i="get "+i),l&&l.setter&&(i="set "+i),(!zy(a,"name")||nre&&a.name!==i)&&(J1?Fy(a,"name",{value:i,configurable:!0}):a.name=i),hre&&l&&zy(l,"arity")&&a.length!==l.arity&&Fy(a,"length",{value:l.arity});try{l&&zy(l,"constructor")&&l.constructor?J1&&Fy(a,"prototype",{writable:!1}):a.prototype&&(a.prototype=void 0)}catch{}var o=are(a);return zy(o,"source")||(o.source=cre(fre,typeof i=="string"?i:"")),a};Function.prototype.toString=dre(function(){return ire(this)&&sre(this).source||ore(this)},"toString")});var Kr=P((Q5e,mM)=>{"use strict";var pre=_r(),mre=ri(),_re=Ny(),yre=qy();mM.exports=function(a,i,l,o){o||(o={});var c=o.enumerable,t=o.name!==void 0?o.name:i;if(pre(l)&&_re(l,t,o),o.global)c?a[i]=l:yre(i,l);else{try{o.unsafe?a[i]&&(c=!0):delete a[i]}catch{}c?a[i]=l:mre.f(a,i,{value:l,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return a}});var eb=P((e6e,_M)=>{"use strict";var gre=Math.ceil,vre=Math.floor;_M.exports=Math.trunc||function(i){var l=+i;return(l>0?vre:gre)(l)}});var _i=P((t6e,yM)=>{"use strict";var xre=eb();yM.exports=function(a){var i=+a;return i!==i||i===0?0:xre(i)}});var xa=P((r6e,gM)=>{"use strict";var bre=_i(),wre=Math.max,Tre=Math.min;gM.exports=function(a,i){var l=bre(a);return l<0?wre(l+i,0):Tre(l,i)}});var qn=P((i6e,vM)=>{"use strict";var Ere=_i(),Sre=Math.min;vM.exports=function(a){var i=Ere(a);return i>0?Sre(i,9007199254740991):0}});var Br=P((n6e,xM)=>{"use strict";var Ire=qn();xM.exports=function(a){return Ire(a.length)}});var sh=P((o6e,wM)=>{"use strict";var Are=qi(),Ore=xa(),Cre=Br(),bM=function(a){return function(i,l,o){var c=Are(i),t=Cre(c);if(t===0)return!a&&-1;var v=Ore(o,t),S;if(a&&l!==l){for(;t>v;)if(S=c[v++],S!==S)return!0}else for(;t>v;v++)if((a||v in c)&&c[v]===l)return a||v||0;return!a&&-1}};wM.exports={includes:bM(!0),indexOf:bM(!1)}});var rb=P((a6e,EM)=>{"use strict";var Pre=pt(),tb=yr(),Mre=qi(),qre=sh().indexOf,Rre=ah(),TM=Pre([].push);EM.exports=function(a,i){var l=Mre(a),o=0,c=[],t;for(t in l)!tb(Rre,t)&&tb(l,t)&&TM(c,t);for(;i.length>o;)tb(l,t=i[o++])&&(~qre(c,t)||TM(c,t));return c}});var Uy=P((s6e,SM)=>{"use strict";SM.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]});var nl=P(IM=>{"use strict";var Dre=rb(),Lre=Uy(),kre=Lre.concat("length","prototype");IM.f=Object.getOwnPropertyNames||function(i){return Dre(i,kre)}});var _p=P(AM=>{"use strict";AM.f=Object.getOwnPropertySymbols});var jy=P((c6e,OM)=>{"use strict";var Bre=Wr(),zre=pt(),Fre=nl(),Nre=_p(),Ure=ir(),jre=zre([].concat);OM.exports=Bre("Reflect","ownKeys")||function(i){var l=Fre.f(Ure(i)),o=Nre.f;return o?jre(l,o(i)):l}});var lh=P((h6e,PM)=>{"use strict";var CM=yr(),Vre=jy(),$re=nn(),Gre=ri();PM.exports=function(a,i,l){for(var o=Vre(i),c=Gre.f,t=$re.f,v=0;v<o.length;v++){var S=o[v];!CM(a,S)&&!(l&&CM(l,S))&&c(a,S,t(i,S))}}});var uh=P((f6e,MM)=>{"use strict";var Wre=ct(),Zre=_r(),Hre=/#|\.prototype\./,yp=function(a,i){var l=Kre[Xre(a)];return l===Jre?!0:l===Yre?!1:Zre(i)?Wre(i):!!i},Xre=yp.normalize=function(a){return String(a).replace(Hre,".").toLowerCase()},Kre=yp.data={},Yre=yp.NATIVE="N",Jre=yp.POLYFILL="P";MM.exports=yp});var ge=P((d6e,qM)=>{"use strict";var Vy=It(),Qre=nn().f,eie=on(),tie=Kr(),rie=qy(),iie=lh(),nie=uh();qM.exports=function(a,i){var l=a.target,o=a.global,c=a.stat,t,v,S,C,D,z;if(o?v=Vy:c?v=Vy[l]||rie(l,{}):v=Vy[l]&&Vy[l].prototype,v)for(S in i){if(D=i[S],a.dontCallGetSet?(z=Qre(v,S),C=z&&z.value):C=v[S],t=nie(o?S:l+(c?".":"#")+S,a.forced),!t&&C!==void 0){if(typeof D==typeof C)continue;iie(D,C)}(a.sham||C&&C.sham)&&eie(D,"sham",!0),tie(v,S,D,a)}}});var $y=P((p6e,DM)=>{"use strict";var oie=pr(),aie=oie("toStringTag"),RM={};RM[aie]="z";DM.exports=String(RM)==="[object z]"});var Zo=P((m6e,LM)=>{"use strict";var sie=$y(),lie=_r(),Gy=Gi(),uie=pr(),cie=uie("toStringTag"),hie=Object,fie=Gy(function(){return arguments}())==="Arguments",die=function(a,i){try{return a[i]}catch{}};LM.exports=sie?Gy:function(a){var i,l,o;return a===void 0?"Undefined":a===null?"Null":typeof(l=die(i=hie(a),cie))=="string"?l:fie?Gy(i):(o=Gy(i))==="Object"&&lie(i.callee)?"Arguments":o}});var Qt=P((_6e,kM)=>{"use strict";var pie=Zo(),mie=String;kM.exports=function(a){if(pie(a)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return mie(a)}});var ch=P((y6e,BM)=>{"use strict";var _ie=rb(),yie=Uy();BM.exports=Object.keys||function(i){return _ie(i,yie)}});var Wy=P(zM=>{"use strict";var gie=Vt(),vie=N1(),xie=ri(),bie=ir(),wie=qi(),Tie=ch();zM.f=gie&&!vie?Object.defineProperties:function(i,l){bie(i);for(var o=wie(l),c=Tie(l),t=c.length,v=0,S;t>v;)xie.f(i,S=c[v++],o[S]);return i}});var ib=P((v6e,FM)=>{"use strict";var Eie=Wr();FM.exports=Eie("document","documentElement")});var Rn=P((x6e,WM)=>{"use strict";var Sie=ir(),Iie=Wy(),NM=Uy(),Aie=ah(),Oie=ib(),Cie=dp(),Pie=pp(),UM=">",jM="<",ob="prototype",ab="script",$M=Pie("IE_PROTO"),nb=function(){},GM=function(a){return jM+ab+UM+a+jM+"/"+ab+UM},VM=function(a){a.write(GM("")),a.close();var i=a.parentWindow.Object;return a=null,i},Mie=function(){var a=Cie("iframe"),i="java"+ab+":",l;return a.style.display="none",Oie.appendChild(a),a.src=String(i),l=a.contentWindow.document,l.open(),l.write(GM("document.F=Object")),l.close(),l.F},Zy,Hy=function(){try{Zy=new ActiveXObject("htmlfile")}catch{}Hy=typeof document<"u"?document.domain&&Zy?VM(Zy):Mie():VM(Zy);for(var a=NM.length;a--;)delete Hy[ob][NM[a]];return Hy()};Aie[$M]=!0;WM.exports=Object.create||function(i,l){var o;return i!==null?(nb[ob]=Sie(i),o=new nb,nb[ob]=null,o[$M]=i):o=Hy(),l===void 0?o:Iie.f(o,l)}});var co=P((b6e,ZM)=>{"use strict";var qie=pt();ZM.exports=qie([].slice)});var Xy=P((w6e,KM)=>{"use strict";var Rie=Gi(),Die=qi(),HM=nl().f,Lie=co(),XM=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],kie=function(a){try{return HM(a)}catch{return Lie(XM)}};KM.exports.f=function(i){return XM&&Rie(i)==="Window"?kie(i):HM(Die(i))}});var Ri=P((T6e,JM)=>{"use strict";var YM=Ny(),Bie=ri();JM.exports=function(a,i,l){return l.get&&YM(l.get,i,{getter:!0}),l.set&&YM(l.set,i,{setter:!0}),Bie.f(a,i,l)}});var sb=P(QM=>{"use strict";var zie=pr();QM.f=zie});var Ky=P((S6e,eq)=>{"use strict";var Fie=It();eq.exports=Fie});var dn=P((I6e,rq)=>{"use strict";var tq=Ky(),Nie=yr(),Uie=sb(),jie=ri().f;rq.exports=function(a){var i=tq.Symbol||(tq.Symbol={});Nie(i,a)||jie(i,a,{value:Uie.f(a)})}});var lb=P((A6e,iq)=>{"use strict";var Vie=rr(),$ie=Wr(),Gie=pr(),Wie=Kr();iq.exports=function(){var a=$ie("Symbol"),i=a&&a.prototype,l=i&&i.valueOf,o=Gie("toPrimitive");i&&!i[o]&&Wie(i,o,function(c){return Vie(l,this)},{arity:1})}});var pn=P((O6e,oq)=>{"use strict";var Zie=ri().f,Hie=yr(),Xie=pr(),nq=Xie("toStringTag");oq.exports=function(a,i,l){a&&!l&&(a=a.prototype),a&&!Hie(a,nq)&&Zie(a,nq,{configurable:!0,value:i})}});var ol=P((C6e,aq)=>{"use strict";var Kie=Gi(),Yie=pt();aq.exports=function(a){if(Kie(a)==="Function")return Yie(a)}});var ho=P((P6e,lq)=>{"use strict";var sq=ol(),Jie=ti(),Qie=nh(),ene=sq(sq.bind);lq.exports=function(a,i){return Jie(a),i===void 0?a:Qie?ene(a,i):function(){return a.apply(i,arguments)}}});var is=P((M6e,uq)=>{"use strict";var tne=Gi();uq.exports=Array.isArray||function(i){return tne(i)==="Array"}});var Ou=P((q6e,pq)=>{"use strict";var rne=pt(),ine=ct(),cq=_r(),nne=Zo(),one=Wr(),ane=Ly(),hq=function(){},fq=one("Reflect","construct"),ub=/^\s*(?:class|function)\b/,sne=rne(ub.exec),lne=!ub.test(hq),gp=function(i){if(!cq(i))return!1;try{return fq(hq,[],i),!0}catch{return!1}},dq=function(i){if(!cq(i))return!1;switch(nne(i)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return lne||!!sne(ub,ane(i))}catch{return!0}};dq.sham=!0;pq.exports=!fq||ine(function(){var a;return gp(gp.call)||!gp(Object)||!gp(function(){a=!0})||a})?dq:gp});var gq=P((R6e,yq)=>{"use strict";var mq=is(),une=Ou(),cne=ur(),hne=pr(),fne=hne("species"),_q=Array;yq.exports=function(a){var i;return mq(a)&&(i=a.constructor,une(i)&&(i===_q||mq(i.prototype))?i=void 0:cne(i)&&(i=i[fne],i===null&&(i=void 0))),i===void 0?_q:i}});var hh=P((D6e,vq)=>{"use strict";var dne=gq();vq.exports=function(a,i){return new(dne(a))(i===0?0:i)}});var Fi=P((L6e,bq)=>{"use strict";var pne=ho(),mne=pt(),_ne=wu(),yne=Rr(),gne=Br(),vne=hh(),xq=mne([].push),al=function(a){var i=a===1,l=a===2,o=a===3,c=a===4,t=a===6,v=a===7,S=a===5||t;return function(C,D,z,B){for(var ne=yne(C),pe=_ne(ne),$e=gne(pe),Ae=pne(D,z),ke=0,Ge=B||vne,tt=i?Ge(C,$e):l||v?Ge(C,0):void 0,mt,Mt;$e>ke;ke++)if((S||ke in pe)&&(mt=pe[ke],Mt=Ae(mt,ke,ne),a))if(i)tt[ke]=Mt;else if(Mt)switch(a){case 3:return!0;case 5:return mt;case 6:return ke;case 2:xq(tt,mt)}else switch(a){case 4:return!1;case 7:xq(tt,mt)}return t?-1:o||c?c:tt}};bq.exports={forEach:al(0),map:al(1),filter:al(2),some:al(3),every:al(4),find:al(5),findIndex:al(6),filterReject:al(7)}});var zq=P(()=>{"use strict";var Yy=ge(),bp=It(),gb=rr(),xne=pt(),bne=fi(),fh=Vt(),dh=Tu(),wne=ct(),Ni=yr(),Tne=Mn(),db=ir(),Jy=qi(),vb=rs(),Ene=Qt(),pb=Hn(),ph=Rn(),Eq=ch(),Sne=nl(),Sq=Xy(),Ine=_p(),Iq=nn(),Aq=ri(),Ane=Wy(),Oq=hp(),cb=Kr(),One=Ri(),xb=Eu(),Cne=pp(),Cq=ah(),wq=Su(),Pne=pr(),Mne=sb(),qne=dn(),Rne=lb(),Dne=pn(),Pq=Ai(),Qy=Fi().forEach,Dn=Cne("hidden"),eg="Symbol",xp="prototype",Lne=Pq.set,Tq=Pq.getterFor(eg),fo=Object[xp],Cu=bp.Symbol,vp=Cu&&Cu[xp],kne=bp.RangeError,Bne=bp.TypeError,hb=bp.QObject,Mq=Iq.f,Pu=Aq.f,qq=Sq.f,zne=Oq.f,Rq=xne([].push),ns=xb("symbols"),wp=xb("op-symbols"),Fne=xb("wks"),mb=!hb||!hb[xp]||!hb[xp].findChild,Dq=function(a,i,l){var o=Mq(fo,i);o&&delete fo[i],Pu(a,i,l),o&&a!==fo&&Pu(fo,i,o)},_b=fh&&wne(function(){return ph(Pu({},"a",{get:function(){return Pu(this,"a",{value:7}).a}})).a!==7})?Dq:Pu,fb=function(a,i){var l=ns[a]=ph(vp);return Lne(l,{type:eg,tag:a,description:i}),fh||(l.description=i),l},tg=function(i,l,o){i===fo&&tg(wp,l,o),db(i);var c=vb(l);return db(o),Ni(ns,c)?(o.enumerable?(Ni(i,Dn)&&i[Dn][c]&&(i[Dn][c]=!1),o=ph(o,{enumerable:pb(0,!1)})):(Ni(i,Dn)||Pu(i,Dn,pb(1,ph(null))),i[Dn][c]=!0),_b(i,c,o)):Pu(i,c,o)},bb=function(i,l){db(i);var o=Jy(l),c=Eq(o).concat(Bq(o));return Qy(c,function(t){(!fh||gb(yb,o,t))&&tg(i,t,o[t])}),i},Nne=function(i,l){return l===void 0?ph(i):bb(ph(i),l)},yb=function(i){var l=vb(i),o=gb(zne,this,l);return this===fo&&Ni(ns,l)&&!Ni(wp,l)?!1:o||!Ni(this,l)||!Ni(ns,l)||Ni(this,Dn)&&this[Dn][l]?o:!0},Lq=function(i,l){var o=Jy(i),c=vb(l);if(!(o===fo&&Ni(ns,c)&&!Ni(wp,c))){var t=Mq(o,c);return t&&Ni(ns,c)&&!(Ni(o,Dn)&&o[Dn][c])&&(t.enumerable=!0),t}},kq=function(i){var l=qq(Jy(i)),o=[];return Qy(l,function(c){!Ni(ns,c)&&!Ni(Cq,c)&&Rq(o,c)}),o},Bq=function(a){var i=a===fo,l=qq(i?wp:Jy(a)),o=[];return Qy(l,function(c){Ni(ns,c)&&(!i||Ni(fo,c))&&Rq(o,ns[c])}),o};dh||(Cu=function(){if(Tne(vp,this))throw new Bne("Symbol is not a constructor");var i=!arguments.length||arguments[0]===void 0?void 0:Ene(arguments[0]),l=wq(i),o=function(c){var t=this===void 0?bp:this;t===fo&&gb(o,wp,c),Ni(t,Dn)&&Ni(t[Dn],l)&&(t[Dn][l]=!1);var v=pb(1,c);try{_b(t,l,v)}catch(S){if(!(S instanceof kne))throw S;Dq(t,l,v)}};return fh&&mb&&_b(fo,l,{configurable:!0,set:o}),fb(l,i)},vp=Cu[xp],cb(vp,"toString",function(){return Tq(this).tag}),cb(Cu,"withoutSetter",function(a){return fb(wq(a),a)}),Oq.f=yb,Aq.f=tg,Ane.f=bb,Iq.f=Lq,Sne.f=Sq.f=kq,Ine.f=Bq,Mne.f=function(a){return fb(Pne(a),a)},fh&&(One(vp,"description",{configurable:!0,get:function(){return Tq(this).description}}),bne||cb(fo,"propertyIsEnumerable",yb,{unsafe:!0})));Yy({global:!0,constructor:!0,wrap:!0,forced:!dh,sham:!dh},{Symbol:Cu});Qy(Eq(Fne),function(a){qne(a)});Yy({target:eg,stat:!0,forced:!dh},{useSetter:function(){mb=!0},useSimple:function(){mb=!1}});Yy({target:"Object",stat:!0,forced:!dh,sham:!fh},{create:Nne,defineProperty:tg,defineProperties:bb,getOwnPropertyDescriptor:Lq});Yy({target:"Object",stat:!0,forced:!dh},{getOwnPropertyNames:kq});Rne();Dne(Cu,eg);Cq[Dn]=!0});var wb=P((z6e,Fq)=>{"use strict";var Une=Tu();Fq.exports=Une&&!!Symbol.for&&!!Symbol.keyFor});var Uq=P(()=>{"use strict";var jne=ge(),Vne=Wr(),$ne=yr(),Gne=Qt(),Nq=Eu(),Wne=wb(),Tb=Nq("string-to-symbol-registry"),Zne=Nq("symbol-to-string-registry");jne({target:"Symbol",stat:!0,forced:!Wne},{for:function(a){var i=Gne(a);if($ne(Tb,i))return Tb[i];var l=Vne("Symbol")(i);return Tb[i]=l,Zne[l]=i,l}})});var Vq=P(()=>{"use strict";var Hne=ge(),Xne=yr(),Kne=rl(),Yne=il(),Jne=Eu(),Qne=wb(),jq=Jne("symbol-to-string-registry");Hne({target:"Symbol",stat:!0,forced:!Qne},{keyFor:function(i){if(!Kne(i))throw new TypeError(Yne(i)+" is not a symbol");if(Xne(jq,i))return jq[i]}})});var po=P((V6e,Zq)=>{"use strict";var eoe=nh(),Wq=Function.prototype,$q=Wq.apply,Gq=Wq.call;Zq.exports=typeof Reflect=="object"&&Reflect.apply||(eoe?Gq.bind($q):function(){return Gq.apply($q,arguments)})});var Jq=P(($6e,Yq)=>{"use strict";var toe=pt(),Hq=is(),roe=_r(),Xq=Gi(),ioe=Qt(),Kq=toe([].push);Yq.exports=function(a){if(roe(a))return a;if(Hq(a)){for(var i=a.length,l=[],o=0;o<i;o++){var c=a[o];typeof c=="string"?Kq(l,c):(typeof c=="number"||Xq(c)==="Number"||Xq(c)==="String")&&Kq(l,ioe(c))}var t=l.length,v=!0;return function(S,C){if(v)return v=!1,C;if(Hq(this))return C;for(var D=0;D<t;D++)if(l[D]===S)return C}}}});var Eb=P(()=>{"use strict";var noe=ge(),aR=Wr(),sR=po(),ooe=rr(),Tp=pt(),lR=ct(),Qq=_r(),eR=rl(),uR=co(),aoe=Jq(),soe=Tu(),loe=String,sl=aR("JSON","stringify"),rg=Tp(/./.exec),tR=Tp("".charAt),uoe=Tp("".charCodeAt),coe=Tp("".replace),hoe=Tp(1 .toString),foe=/[\uD800-\uDFFF]/g,rR=/^[\uD800-\uDBFF]$/,iR=/^[\uDC00-\uDFFF]$/,nR=!soe||lR(function(){var a=aR("Symbol")("stringify detection");return sl([a])!=="[null]"||sl({a})!=="{}"||sl(Object(a))!=="{}"}),oR=lR(function(){return sl("\uDF06\uD834")!=='"\\udf06\\ud834"'||sl("\uDEAD")!=='"\\udead"'}),doe=function(a,i){var l=uR(arguments),o=aoe(i);if(!(!Qq(o)&&(a===void 0||eR(a))))return l[1]=function(c,t){if(Qq(o)&&(t=ooe(o,this,loe(c),t)),!eR(t))return t},sR(sl,null,l)},poe=function(a,i,l){var o=tR(l,i-1),c=tR(l,i+1);return rg(rR,a)&&!rg(iR,c)||rg(iR,a)&&!rg(rR,o)?"\\u"+hoe(uoe(a,0),16):a};sl&&noe({target:"JSON",stat:!0,arity:3,forced:nR||oR},{stringify:function(i,l,o){var c=uR(arguments),t=sR(nR?doe:sl,null,c);return oR&&typeof t=="string"?coe(t,foe,poe):t}})});var hR=P(()=>{"use strict";var moe=ge(),_oe=Tu(),yoe=ct(),cR=_p(),goe=Rr(),voe=!_oe||yoe(function(){cR.f(1)});moe({target:"Object",stat:!0,forced:voe},{getOwnPropertySymbols:function(i){var l=cR.f;return l?l(goe(i)):[]}})});var fR=P(()=>{"use strict";zq();Uq();Vq();Eb();hR()});var vR=P(()=>{"use strict";var xoe=ge(),boe=Vt(),woe=It(),ig=pt(),Toe=yr(),Eoe=_r(),Soe=Mn(),Ioe=Qt(),Aoe=Ri(),Ooe=lh(),os=woe.Symbol,Mu=os&&os.prototype;boe&&Eoe(os)&&(!("description"in Mu)||os().description!==void 0)&&(Sb={},Ep=function(){var i=arguments.length<1||arguments[0]===void 0?void 0:Ioe(arguments[0]),l=Soe(Mu,this)?new os(i):i===void 0?os():os(i);return i===""&&(Sb[l]=!0),l},Ooe(Ep,os),Ep.prototype=Mu,Mu.constructor=Ep,dR=String(os("description detection"))==="Symbol(description detection)",pR=ig(Mu.valueOf),mR=ig(Mu.toString),_R=/^Symbol\((.*)\)[^)]+$/,yR=ig("".replace),gR=ig("".slice),Aoe(Mu,"description",{configurable:!0,get:function(){var i=pR(this);if(Toe(Sb,i))return"";var l=mR(i),o=dR?gR(l,7,-1):yR(l,_R,"$1");return o===""?void 0:o}}),xoe({global:!0,constructor:!0,forced:!0},{Symbol:Ep}));var Sb,Ep,dR,pR,mR,_R,yR,gR});var xR=P(()=>{"use strict";var Coe=dn();Coe("asyncIterator")});var bR=P(()=>{"use strict";var Poe=dn();Poe("hasInstance")});var wR=P(()=>{"use strict";var Moe=dn();Moe("isConcatSpreadable")});var TR=P(()=>{"use strict";var qoe=dn();qoe("iterator")});var ER=P(()=>{"use strict";var Roe=dn();Roe("match")});var SR=P(()=>{"use strict";var Doe=dn();Doe("matchAll")});var IR=P(()=>{"use strict";var Loe=dn();Loe("replace")});var AR=P(()=>{"use strict";var koe=dn();koe("search")});var OR=P(()=>{"use strict";var Boe=dn();Boe("species")});var CR=P(()=>{"use strict";var zoe=dn();zoe("split")});var PR=P(()=>{"use strict";var Foe=dn(),Noe=lb();Foe("toPrimitive");Noe()});var MR=P(()=>{"use strict";var Uoe=Wr(),joe=dn(),Voe=pn();joe("toStringTag");Voe(Uoe("Symbol"),"Symbol")});var qR=P(()=>{"use strict";var $oe=dn();$oe("unscopables")});var ng=P((Sje,RR)=>{"use strict";var Goe=pt(),Woe=ti();RR.exports=function(a,i,l){try{return Goe(Woe(Object.getOwnPropertyDescriptor(a,i)[l]))}catch{}}});var Ib=P((Ije,DR)=>{"use strict";var Zoe=ur();DR.exports=function(a){return Zoe(a)||a===null}});var Ab=P((Aje,LR)=>{"use strict";var Hoe=Ib(),Xoe=String,Koe=TypeError;LR.exports=function(a){if(Hoe(a))return a;throw new Koe("Can't set "+Xoe(a)+" as a prototype")}});var Ho=P((Oje,kR)=>{"use strict";var Yoe=ng(),Joe=ir(),Qoe=Ab();kR.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var a=!1,i={},l;try{l=Yoe(Object.prototype,"__proto__","set"),l(i,[]),a=i instanceof Array}catch{}return function(c,t){return Joe(c),Qoe(t),a?l(c,t):c.__proto__=t,c}}():void 0)});var Ob=P((Cje,BR)=>{"use strict";var eae=ri().f;BR.exports=function(a,i,l){l in a||eae(a,l,{configurable:!0,get:function(){return i[l]},set:function(o){i[l]=o}})}});var ll=P((Pje,FR)=>{"use strict";var tae=_r(),rae=ur(),zR=Ho();FR.exports=function(a,i,l){var o,c;return zR&&tae(o=i.constructor)&&o!==l&&rae(c=o.prototype)&&c!==l.prototype&&zR(a,c),a}});var mh=P((Mje,NR)=>{"use strict";var iae=Qt();NR.exports=function(a,i){return a===void 0?arguments.length<2?"":i:iae(a)}});var Cb=P((qje,UR)=>{"use strict";var nae=ur(),oae=on();UR.exports=function(a,i){nae(i)&&"cause"in i&&oae(a,"cause",i.cause)}});var og=P((Rje,$R)=>{"use strict";var aae=pt(),jR=Error,sae=aae("".replace),lae=function(a){return String(new jR(a).stack)}("zxcasd"),VR=/\n\s*at [^:]*:[^\n]*/,uae=VR.test(lae);$R.exports=function(a,i){if(uae&&typeof a=="string"&&!jR.prepareStackTrace)for(;i--;)a=sae(a,VR,"");return a}});var Pb=P((Dje,GR)=>{"use strict";var cae=ct(),hae=Hn();GR.exports=!cae(function(){var a=new Error("a");return"stack"in a?(Object.defineProperty(a,"stack",hae(1,7)),a.stack!==7):!0})});var Mb=P((Lje,ZR)=>{"use strict";var fae=on(),dae=og(),pae=Pb(),WR=Error.captureStackTrace;ZR.exports=function(a,i,l,o){pae&&(WR?WR(a,i):fae(a,"stack",dae(l,o)))}});var qb=P((kje,eD)=>{"use strict";var HR=Wr(),mae=yr(),XR=on(),_ae=Mn(),KR=Ho(),YR=lh(),JR=Ob(),yae=ll(),gae=mh(),vae=Cb(),xae=Mb(),bae=Vt(),QR=fi();eD.exports=function(a,i,l,o){var c="stackTraceLimit",t=o?2:1,v=a.split("."),S=v[v.length-1],C=HR.apply(null,v);if(C){var D=C.prototype;if(!QR&&mae(D,"cause")&&delete D.cause,!l)return C;var z=HR("Error"),B=i(function(ne,pe){var $e=gae(o?pe:ne,void 0),Ae=o?new C(ne):new C;return $e!==void 0&&XR(Ae,"message",$e),xae(Ae,B,Ae.stack,2),this&&_ae(D,this)&&yae(Ae,this,B),arguments.length>t&&vae(Ae,arguments[t]),Ae});if(B.prototype=D,S!=="Error"?KR?KR(B,z):YR(B,z,{name:!0}):bae&&c in C&&(JR(B,C,c),JR(B,C,"prepareStackTrace")),YR(B,C),!QR)try{D.name!==S&&XR(D,"name",S),D.constructor=B}catch{}return B}}});var nD=P(()=>{"use strict";var rD=ge(),wae=It(),ba=po(),iD=qb(),Rb="WebAssembly",tD=wae[Rb],ag=new Error("e",{cause:7}).cause!==7,qu=function(a,i){var l={};l[a]=iD(a,i,ag),rD({global:!0,constructor:!0,arity:1,forced:ag},l)},Db=function(a,i){if(tD&&tD[a]){var l={};l[a]=iD(Rb+"."+a,i,ag),rD({target:Rb,stat:!0,constructor:!0,arity:1,forced:ag},l)}};qu("Error",function(a){return function(l){return ba(a,this,arguments)}});qu("EvalError",function(a){return function(l){return ba(a,this,arguments)}});qu("RangeError",function(a){return function(l){return ba(a,this,arguments)}});qu("ReferenceError",function(a){return function(l){return ba(a,this,arguments)}});qu("SyntaxError",function(a){return function(l){return ba(a,this,arguments)}});qu("TypeError",function(a){return function(l){return ba(a,this,arguments)}});qu("URIError",function(a){return function(l){return ba(a,this,arguments)}});Db("CompileError",function(a){return function(l){return ba(a,this,arguments)}});Db("LinkError",function(a){return function(l){return ba(a,this,arguments)}});Db("RuntimeError",function(a){return function(l){return ba(a,this,arguments)}})});var Lb=P((Fje,aD)=>{"use strict";var Tae=Vt(),Eae=ct(),Sae=ir(),oD=mh(),sg=Error.prototype.toString,Iae=Eae(function(){if(Tae){var a=Object.create(Object.defineProperty({},"name",{get:function(){return this===a}}));if(sg.call(a)!=="true")return!0}return sg.call({message:1,name:2})!=="2: 1"||sg.call({})!=="Error"});aD.exports=Iae?function(){var i=Sae(this),l=oD(i.name,"Error"),o=oD(i.message);return l?o?l+": "+o:l:o}:sg});var uD=P(()=>{"use strict";var Aae=Kr(),sD=Lb(),lD=Error.prototype;lD.toString!==sD&&Aae(lD,"toString",sD)});var lg=P((jje,cD)=>{"use strict";var Oae=ct();cD.exports=!Oae(function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype})});var Xn=P((Vje,fD)=>{"use strict";var Cae=yr(),Pae=_r(),Mae=Rr(),qae=pp(),Rae=lg(),hD=qae("IE_PROTO"),kb=Object,Dae=kb.prototype;fD.exports=Rae?kb.getPrototypeOf:function(a){var i=Mae(a);if(Cae(i,hD))return i[hD];var l=i.constructor;return Pae(l)&&i instanceof l?l.prototype:i instanceof kb?Dae:null}});var _h=P(($je,dD)=>{"use strict";dD.exports={}});var ug=P((Gje,pD)=>{"use strict";var Lae=pr(),kae=_h(),Bae=Lae("iterator"),zae=Array.prototype;pD.exports=function(a){return a!==void 0&&(kae.Array===a||zae[Bae]===a)}});var yh=P((Wje,_D)=>{"use strict";var Fae=Zo(),mD=va(),Nae=fn(),Uae=_h(),jae=pr(),Vae=jae("iterator");_D.exports=function(a){if(!Nae(a))return mD(a,Vae)||mD(a,"@@iterator")||Uae[Fae(a)]}});var Sp=P((Zje,yD)=>{"use strict";var $ae=rr(),Gae=ti(),Wae=ir(),Zae=il(),Hae=yh(),Xae=TypeError;yD.exports=function(a,i){var l=arguments.length<2?Hae(a):i;if(Gae(l))return Wae($ae(l,a));throw new Xae(Zae(a)+" is not iterable")}});var Bb=P((Hje,vD)=>{"use strict";var Kae=rr(),gD=ir(),Yae=va();vD.exports=function(a,i,l){var o,c;gD(a);try{if(o=Yae(a,"return"),!o){if(i==="throw")throw l;return l}o=Kae(o,a)}catch(t){c=!0,o=t}if(i==="throw")throw l;if(c)throw o;return gD(o),l}});var Kn=P((Xje,TD)=>{"use strict";var Jae=ho(),Qae=rr(),ese=ir(),tse=il(),rse=ug(),ise=Br(),xD=Mn(),nse=Sp(),ose=yh(),bD=Bb(),ase=TypeError,cg=function(a,i){this.stopped=a,this.result=i},wD=cg.prototype;TD.exports=function(a,i,l){var o=l&&l.that,c=!!(l&&l.AS_ENTRIES),t=!!(l&&l.IS_RECORD),v=!!(l&&l.IS_ITERATOR),S=!!(l&&l.INTERRUPTED),C=Jae(i,o),D,z,B,ne,pe,$e,Ae,ke=function(tt){return D&&bD(D,"normal",tt),new cg(!0,tt)},Ge=function(tt){return c?(ese(tt),S?C(tt[0],tt[1],ke):C(tt[0],tt[1])):S?C(tt,ke):C(tt)};if(t)D=a.iterator;else if(v)D=a;else{if(z=ose(a),!z)throw new ase(tse(a)+" is not iterable");if(rse(z)){for(B=0,ne=ise(a);ne>B;B++)if(pe=Ge(a[B]),pe&&xD(wD,pe))return pe;return new cg(!1)}D=nse(a,z)}for($e=t?a.next:D.next;!(Ae=Qae($e,D)).done;){try{pe=Ge(Ae.value)}catch(tt){bD(D,"throw",tt)}if(typeof pe=="object"&&pe&&xD(wD,pe))return pe}return new cg(!1)}});var SD=P(()=>{"use strict";var sse=ge(),lse=Mn(),use=Xn(),hg=Ho(),cse=lh(),ED=Rn(),zb=on(),Fb=Hn(),hse=Cb(),fse=Mb(),dse=Kn(),pse=mh(),mse=pr(),_se=mse("toStringTag"),fg=Error,yse=[].push,gh=function(i,l){var o=lse(Nb,this),c;hg?c=hg(new fg,o?use(this):Nb):(c=o?this:ED(Nb),zb(c,_se,"Error")),l!==void 0&&zb(c,"message",pse(l)),fse(c,gh,c.stack,1),arguments.length>2&&hse(c,arguments[2]);var t=[];return dse(i,yse,{that:t}),zb(c,"errors",t),c};hg?hg(gh,fg):cse(gh,fg,{name:!0});var Nb=gh.prototype=ED(fg.prototype,{constructor:Fb(1,gh),message:Fb(1,""),name:Fb(1,"AggregateError")});sse({global:!0,constructor:!0,arity:2},{AggregateError:gh})});var ID=P(()=>{"use strict";SD()});var PD=P(()=>{"use strict";var gse=ge(),vse=Wr(),xse=po(),AD=ct(),bse=qb(),Ub="AggregateError",OD=vse(Ub),CD=!AD(function(){return OD([1]).errors[0]!==1})&&AD(function(){return OD([1],Ub,{cause:7}).cause!==7});gse({global:!0,constructor:!0,arity:2,forced:CD},{AggregateError:bse(Ub,function(a){return function(l,o){return xse(a,this,arguments)}},CD,!0)})});var mn=P((rVe,MD)=>{"use strict";var wse=pr(),Tse=Rn(),Ese=ri().f,jb=wse("unscopables"),Vb=Array.prototype;Vb[jb]===void 0&&Ese(Vb,jb,{configurable:!0,value:Tse(null)});MD.exports=function(a){Vb[jb][a]=!0}});var qD=P(()=>{"use strict";var Sse=ge(),Ise=Rr(),Ase=Br(),Ose=_i(),Cse=mn();Sse({target:"Array",proto:!0},{at:function(i){var l=Ise(this),o=Ase(l),c=Ose(i),t=c>=0?c:o+c;return t<0||t>=o?void 0:l[t]}});Cse("at")});var Ru=P((oVe,RD)=>{"use strict";var Pse=TypeError,Mse=9007199254740991;RD.exports=function(a){if(a>Mse)throw Pse("Maximum allowed index exceeded");return a}});var as=P((aVe,DD)=>{"use strict";var qse=Vt(),Rse=ri(),Dse=Hn();DD.exports=function(a,i,l){qse?Rse.f(a,i,Dse(0,l)):a[i]=l}});var vh=P((sVe,LD)=>{"use strict";var Lse=ct(),kse=pr(),Bse=ga(),zse=kse("species");LD.exports=function(a){return Bse>=51||!Lse(function(){var i=[],l=i.constructor={};return l[zse]=function(){return{foo:1}},i[a](Boolean).foo!==1})}});var FD=P(()=>{"use strict";var Fse=ge(),Nse=ct(),Use=is(),jse=ur(),Vse=Rr(),$se=Br(),kD=Ru(),BD=as(),Gse=hh(),Wse=vh(),Zse=pr(),Hse=ga(),zD=Zse("isConcatSpreadable"),Xse=Hse>=51||!Nse(function(){var a=[];return a[zD]=!1,a.concat()[0]!==a}),Kse=function(a){if(!jse(a))return!1;var i=a[zD];return i!==void 0?!!i:Use(a)},Yse=!Xse||!Wse("concat");Fse({target:"Array",proto:!0,arity:1,forced:Yse},{concat:function(i){var l=Vse(this),o=Gse(l,0),c=0,t,v,S,C,D;for(t=-1,S=arguments.length;t<S;t++)if(D=t===-1?l:arguments[t],Kse(D))for(C=$se(D),kD(c+C),v=0;v<C;v++,c++)v in D&&BD(o,c,D[v]);else kD(c+1),BD(o,c++,D);return o.length=c,o}})});var Ip=P((cVe,UD)=>{"use strict";var ND=il(),Jse=TypeError;UD.exports=function(a,i){if(!delete a[i])throw new Jse("Cannot delete property "+ND(i)+" of "+ND(a))}});var Gb=P((hVe,jD)=>{"use strict";var Qse=Rr(),$b=xa(),ele=Br(),tle=Ip(),rle=Math.min;jD.exports=[].copyWithin||function(i,l){var o=Qse(this),c=ele(o),t=$b(i,c),v=$b(l,c),S=arguments.length>2?arguments[2]:void 0,C=rle((S===void 0?c:$b(S,c))-v,c-t),D=1;for(v<t&&t<v+C&&(D=-1,v+=C-1,t+=C-1);C-- >0;)v in o?o[t]=o[v]:tle(o,t),t+=D,v+=D;return o}});var VD=P(()=>{"use strict";var ile=ge(),nle=Gb(),ole=mn();ile({target:"Array",proto:!0},{copyWithin:nle});ole("copyWithin")});var wa=P((pVe,$D)=>{"use strict";var ale=ct();$D.exports=function(a,i){var l=[][a];return!!l&&ale(function(){l.call(null,i||function(){return 1},1)})}});var GD=P(()=>{"use strict";var sle=ge(),lle=Fi().every,ule=wa(),cle=ule("every");sle({target:"Array",proto:!0,forced:!cle},{every:function(i){return lle(this,i,arguments.length>1?arguments[1]:void 0)}})});var dg=P((yVe,ZD)=>{"use strict";var hle=Rr(),WD=xa(),fle=Br();ZD.exports=function(i){for(var l=hle(this),o=fle(l),c=arguments.length,t=WD(c>1?arguments[1]:void 0,o),v=c>2?arguments[2]:void 0,S=v===void 0?o:WD(v,o);S>t;)l[t++]=i;return l}});var HD=P(()=>{"use strict";var dle=ge(),ple=dg(),mle=mn();dle({target:"Array",proto:!0},{fill:ple});mle("fill")});var XD=P(()=>{"use strict";var _le=ge(),yle=Fi().filter,gle=vh(),vle=gle("filter");_le({target:"Array",proto:!0,forced:!vle},{filter:function(i){return yle(this,i,arguments.length>1?arguments[1]:void 0)}})});var YD=P(()=>{"use strict";var xle=ge(),ble=Fi().find,wle=mn(),Wb="find",KD=!0;Wb in[]&&Array(1)[Wb](function(){KD=!1});xle({target:"Array",proto:!0,forced:KD},{find:function(i){return ble(this,i,arguments.length>1?arguments[1]:void 0)}});wle(Wb)});var QD=P(()=>{"use strict";var Tle=ge(),Ele=Fi().findIndex,Sle=mn(),Zb="findIndex",JD=!0;Zb in[]&&Array(1)[Zb](function(){JD=!1});Tle({target:"Array",proto:!0,forced:JD},{findIndex:function(i){return Ele(this,i,arguments.length>1?arguments[1]:void 0)}});Sle(Zb)});var Ap=P((IVe,tL)=>{"use strict";var Ile=ho(),Ale=wu(),Ole=Rr(),Cle=Br(),eL=function(a){var i=a===1;return function(l,o,c){for(var t=Ole(l),v=Ale(t),S=Cle(v),C=Ile(o,c),D,z;S-- >0;)if(D=v[S],z=C(D,S,t),z)switch(a){case 0:return D;case 1:return S}return i?-1:void 0}};tL.exports={findLast:eL(0),findLastIndex:eL(1)}});var rL=P(()=>{"use strict";var Ple=ge(),Mle=Ap().findLast,qle=mn();Ple({target:"Array",proto:!0},{findLast:function(i){return Mle(this,i,arguments.length>1?arguments[1]:void 0)}});qle("findLast")});var iL=P(()=>{"use strict";var Rle=ge(),Dle=Ap().findLastIndex,Lle=mn();Rle({target:"Array",proto:!0},{findLastIndex:function(i){return Dle(this,i,arguments.length>1?arguments[1]:void 0)}});Lle("findLastIndex")});var Hb=P((MVe,oL)=>{"use strict";var kle=is(),Ble=Br(),zle=Ru(),Fle=ho(),nL=function(a,i,l,o,c,t,v,S){for(var C=c,D=0,z=v?Fle(v,S):!1,B,ne;D<o;)D in l&&(B=z?z(l[D],D,i):l[D],t>0&&kle(B)?(ne=Ble(B),C=nL(a,i,B,ne,C,t-1)-1):(zle(C+1),a[C]=B),C++),D++;return C};oL.exports=nL});var aL=P(()=>{"use strict";var Nle=ge(),Ule=Hb(),jle=Rr(),Vle=Br(),$le=_i(),Gle=hh();Nle({target:"Array",proto:!0},{flat:function(){var i=arguments.length?arguments[0]:void 0,l=jle(this),o=Vle(l),c=Gle(l,0);return c.length=Ule(c,l,l,o,0,i===void 0?1:$le(i)),c}})});var sL=P(()=>{"use strict";var Wle=ge(),Zle=Hb(),Hle=ti(),Xle=Rr(),Kle=Br(),Yle=hh();Wle({target:"Array",proto:!0},{flatMap:function(i){var l=Xle(this),o=Kle(l),c;return Hle(i),c=Yle(l,0),c.length=Zle(c,l,l,o,0,1,i,arguments.length>1?arguments[1]:void 0),c}})});var Xb=P((kVe,lL)=>{"use strict";var Jle=Fi().forEach,Qle=wa(),eue=Qle("forEach");lL.exports=eue?[].forEach:function(i){return Jle(this,i,arguments.length>1?arguments[1]:void 0)}});var cL=P(()=>{"use strict";var tue=ge(),uL=Xb();tue({target:"Array",proto:!0,forced:[].forEach!==uL},{forEach:uL})});var fL=P((FVe,hL)=>{"use strict";var rue=ir(),iue=Bb();hL.exports=function(a,i,l,o){try{return o?i(rue(l)[0],l[1]):i(l)}catch(c){iue(a,"throw",c)}}});var Kb=P((NVe,mL)=>{"use strict";var nue=ho(),oue=rr(),aue=Rr(),sue=fL(),lue=ug(),uue=Ou(),cue=Br(),dL=as(),hue=Sp(),fue=yh(),pL=Array;mL.exports=function(i){var l=aue(i),o=uue(this),c=arguments.length,t=c>1?arguments[1]:void 0,v=t!==void 0;v&&(t=nue(t,c>2?arguments[2]:void 0));var S=fue(l),C=0,D,z,B,ne,pe,$e;if(S&&!(this===pL&&lue(S)))for(ne=hue(l,S),pe=ne.next,z=o?new this:[];!(B=oue(pe,ne)).done;C++)$e=v?sue(ne,t,[B.value,C],!0):B.value,dL(z,C,$e);else for(D=cue(l),z=o?new this(D):pL(D);D>C;C++)$e=v?t(l[C],C):l[C],dL(z,C,$e);return z.length=C,z}});var Op=P((UVe,vL)=>{"use strict";var due=pr(),yL=due("iterator"),gL=!1;try{_L=0,Yb={next:function(){return{done:!!_L++}},return:function(){gL=!0}},Yb[yL]=function(){return this},Array.from(Yb,function(){throw 2})}catch{}var _L,Yb;vL.exports=function(a,i){try{if(!i&&!gL)return!1}catch{return!1}var l=!1;try{var o={};o[yL]=function(){return{next:function(){return{done:l=!0}}}},a(o)}catch{}return l}});var xL=P(()=>{"use strict";var pue=ge(),mue=Kb(),_ue=Op(),yue=!_ue(function(a){Array.from(a)});pue({target:"Array",stat:!0,forced:yue},{from:mue})});var bL=P(()=>{"use strict";var gue=ge(),vue=sh().includes,xue=ct(),bue=mn(),wue=xue(function(){return!Array(1).includes()});gue({target:"Array",proto:!0,forced:wue},{includes:function(i){return vue(this,i,arguments.length>1?arguments[1]:void 0)}});bue("includes")});var TL=P(()=>{"use strict";var Tue=ge(),Eue=ol(),Sue=sh().indexOf,Iue=wa(),Jb=Eue([].indexOf),wL=!!Jb&&1/Jb([1],1,-0)<0,Aue=wL||!Iue("indexOf");Tue({target:"Array",proto:!0,forced:Aue},{indexOf:function(i){var l=arguments.length>1?arguments[1]:void 0;return wL?Jb(this,i,l)||0:Sue(this,i,l)}})});var EL=P(()=>{"use strict";var Oue=ge(),Cue=is();Oue({target:"Array",stat:!0},{isArray:Cue})});var rw=P((KVe,AL)=>{"use strict";var Pue=ct(),Mue=_r(),que=ur(),Rue=Rn(),SL=Xn(),Due=Kr(),Lue=pr(),kue=fi(),tw=Lue("iterator"),IL=!1,ss,Qb,ew;[].keys&&(ew=[].keys(),"next"in ew?(Qb=SL(SL(ew)),Qb!==Object.prototype&&(ss=Qb)):IL=!0);var Bue=!que(ss)||Pue(function(){var a={};return ss[tw].call(a)!==a});Bue?ss={}:kue&&(ss=Rue(ss));Mue(ss[tw])||Due(ss,tw,function(){return this});AL.exports={IteratorPrototype:ss,BUGGY_SAFARI_ITERATORS:IL}});var pg=P((YVe,OL)=>{"use strict";var zue=rw().IteratorPrototype,Fue=Rn(),Nue=Hn(),Uue=pn(),jue=_h(),Vue=function(){return this};OL.exports=function(a,i,l,o){var c=i+" Iterator";return a.prototype=Fue(zue,{next:Nue(+!o,l)}),Uue(a,c,!1,!0),jue[c]=Vue,a}});var yg=P((JVe,zL)=>{"use strict";var $ue=ge(),Gue=rr(),mg=fi(),kL=Iu(),Wue=_r(),Zue=pg(),CL=Xn(),PL=Ho(),Hue=pn(),Xue=on(),iw=Kr(),Kue=pr(),ML=_h(),BL=rw(),Yue=kL.PROPER,Jue=kL.CONFIGURABLE,qL=BL.IteratorPrototype,_g=BL.BUGGY_SAFARI_ITERATORS,Cp=Kue("iterator"),RL="keys",Pp="values",DL="entries",LL=function(){return this};zL.exports=function(a,i,l,o,c,t,v){Zue(l,i,o);var S=function(Ge){if(Ge===c&&ne)return ne;if(!_g&&Ge&&Ge in z)return z[Ge];switch(Ge){case RL:return function(){return new l(this,Ge)};case Pp:return function(){return new l(this,Ge)};case DL:return function(){return new l(this,Ge)}}return function(){return new l(this)}},C=i+" Iterator",D=!1,z=a.prototype,B=z[Cp]||z["@@iterator"]||c&&z[c],ne=!_g&&B||S(c),pe=i==="Array"&&z.entries||B,$e,Ae,ke;if(pe&&($e=CL(pe.call(new a)),$e!==Object.prototype&&$e.next&&(!mg&&CL($e)!==qL&&(PL?PL($e,qL):Wue($e[Cp])||iw($e,Cp,LL)),Hue($e,C,!0,!0),mg&&(ML[C]=LL))),Yue&&c===Pp&&B&&B.name!==Pp&&(!mg&&Jue?Xue(z,"name",Pp):(D=!0,ne=function(){return Gue(B,this)})),c)if(Ae={values:S(Pp),keys:t?ne:S(RL),entries:S(DL)},v)for(ke in Ae)(_g||D||!(ke in z))&&iw(z,ke,Ae[ke]);else $ue({target:i,proto:!0,forced:_g||D},Ae);return(!mg||v)&&z[Cp]!==ne&&iw(z,Cp,ne,{name:c}),ML[i]=ne,Ae}});var xh=P((QVe,FL)=>{"use strict";FL.exports=function(a,i){return{value:a,done:i}}});var Mp=P((e8e,$L)=>{"use strict";var Que=qi(),nw=mn(),NL=_h(),jL=Ai(),ece=ri().f,tce=yg(),gg=xh(),rce=fi(),ice=Vt(),VL="Array Iterator",nce=jL.set,oce=jL.getterFor(VL);$L.exports=tce(Array,"Array",function(a,i){nce(this,{type:VL,target:Que(a),index:0,kind:i})},function(){var a=oce(this),i=a.target,l=a.index++;if(!i||l>=i.length)return a.target=void 0,gg(void 0,!0);switch(a.kind){case"keys":return gg(l,!1);case"values":return gg(i[l],!1)}return gg([l,i[l]],!1)},"values");var UL=NL.Arguments=NL.Array;nw("keys");nw("values");nw("entries");if(!rce&&ice&&UL.name!=="values")try{ece(UL,"name",{value:"values"})}catch{}});var GL=P(()=>{"use strict";var ace=ge(),sce=pt(),lce=wu(),uce=qi(),cce=wa(),hce=sce([].join),fce=lce!==Object,dce=fce||!cce("join",",");ace({target:"Array",proto:!0,forced:dce},{join:function(i){return hce(uce(this),i===void 0?",":i)}})});var aw=P((i8e,ZL)=>{"use strict";var pce=po(),mce=qi(),_ce=_i(),yce=Br(),gce=wa(),vce=Math.min,ow=[].lastIndexOf,WL=!!ow&&1/[1].lastIndexOf(1,-0)<0,xce=gce("lastIndexOf"),bce=WL||!xce;ZL.exports=bce?function(i){if(WL)return pce(ow,this,arguments)||0;var l=mce(this),o=yce(l);if(o===0)return-1;var c=o-1;for(arguments.length>1&&(c=vce(c,_ce(arguments[1]))),c<0&&(c=o+c);c>=0;c--)if(c in l&&l[c]===i)return c||0;return-1}:ow});var XL=P(()=>{"use strict";var wce=ge(),HL=aw();wce({target:"Array",proto:!0,forced:HL!==[].lastIndexOf},{lastIndexOf:HL})});var KL=P(()=>{"use strict";var Tce=ge(),Ece=Fi().map,Sce=vh(),Ice=Sce("map");Tce({target:"Array",proto:!0,forced:!Ice},{map:function(i){return Ece(this,i,arguments.length>1?arguments[1]:void 0)}})});var JL=P(()=>{"use strict";var Ace=ge(),Oce=ct(),Cce=Ou(),Pce=as(),YL=Array,Mce=Oce(function(){function a(){}return!(YL.of.call(a)instanceof a)});Ace({target:"Array",stat:!0,forced:Mce},{of:function(){for(var i=0,l=arguments.length,o=new(Cce(this)?this:YL)(l);l>i;)Pce(o,i,arguments[i++]);return o.length=l,o}})});var vg=P((c8e,QL)=>{"use strict";var qce=Vt(),Rce=is(),Dce=TypeError,Lce=Object.getOwnPropertyDescriptor,kce=qce&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(a){return a instanceof TypeError}}();QL.exports=kce?function(a,i){if(Rce(a)&&!Lce(a,"length").writable)throw new Dce("Cannot set read only .length");return a.length=i}:function(a,i){return a.length=i}});var ek=P(()=>{"use strict";var Bce=ge(),zce=Rr(),Fce=Br(),Nce=vg(),Uce=Ru(),jce=ct(),Vce=jce(function(){return[].push.call({length:4294967296},1)!==4294967297}),$ce=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(a){return a instanceof TypeError}},Gce=Vce||!$ce();Bce({target:"Array",proto:!0,arity:1,forced:Gce},{push:function(i){var l=zce(this),o=Fce(l),c=arguments.length;Uce(o+c);for(var t=0;t<c;t++)l[o]=arguments[t],o++;return Nce(l,o),o}})});var qp=P((d8e,nk)=>{"use strict";var Wce=ti(),Zce=Rr(),Hce=wu(),Xce=Br(),tk=TypeError,rk="Reduce of empty array with no initial value",ik=function(a){return function(i,l,o,c){var t=Zce(i),v=Hce(t),S=Xce(t);if(Wce(l),S===0&&o<2)throw new tk(rk);var C=a?S-1:0,D=a?-1:1;if(o<2)for(;;){if(C in v){c=v[C],C+=D;break}if(C+=D,a?C<0:S<=C)throw new tk(rk)}for(;a?C>=0:S>C;C+=D)C in v&&(c=l(c,v[C],C,t));return c}};nk.exports={left:ik(!1),right:ik(!0)}});var ls=P((p8e,ok)=>{"use strict";var Kce=It(),Yce=Gi();ok.exports=Yce(Kce.process)==="process"});var sk=P(()=>{"use strict";var Jce=ge(),Qce=qp().left,ehe=wa(),ak=ga(),the=ls(),rhe=!the&&ak>79&&ak<83,ihe=rhe||!ehe("reduce");Jce({target:"Array",proto:!0,forced:ihe},{reduce:function(i){var l=arguments.length;return Qce(this,i,l,l>1?arguments[1]:void 0)}})});var uk=P(()=>{"use strict";var nhe=ge(),ohe=qp().right,ahe=wa(),lk=ga(),she=ls(),lhe=!she&&lk>79&&lk<83,uhe=lhe||!ahe("reduceRight");nhe({target:"Array",proto:!0,forced:uhe},{reduceRight:function(i){return ohe(this,i,arguments.length,arguments.length>1?arguments[1]:void 0)}})});var hk=P(()=>{"use strict";var che=ge(),hhe=pt(),fhe=is(),dhe=hhe([].reverse),ck=[1,2];che({target:"Array",proto:!0,forced:String(ck)===String(ck.reverse())},{reverse:function(){return fhe(this)&&(this.length=this.length),dhe(this)}})});var pk=P(()=>{"use strict";var phe=ge(),fk=is(),mhe=Ou(),_he=ur(),dk=xa(),yhe=Br(),ghe=qi(),vhe=as(),xhe=pr(),bhe=vh(),whe=co(),The=bhe("slice"),Ehe=xhe("species"),sw=Array,She=Math.max;phe({target:"Array",proto:!0,forced:!The},{slice:function(i,l){var o=ghe(this),c=yhe(o),t=dk(i,c),v=dk(l===void 0?c:l,c),S,C,D;if(fk(o)&&(S=o.constructor,mhe(S)&&(S===sw||fk(S.prototype))?S=void 0:_he(S)&&(S=S[Ehe],S===null&&(S=void 0)),S===sw||S===void 0))return whe(o,t,v);for(C=new(S===void 0?sw:S)(She(v-t,0)),D=0;t<v;t++,D++)t in o&&vhe(C,D,o[t]);return C.length=D,C}})});var mk=P(()=>{"use strict";var Ihe=ge(),Ahe=Fi().some,Ohe=wa(),Che=Ohe("some");Ihe({target:"Array",proto:!0,forced:!Che},{some:function(i){return Ahe(this,i,arguments.length>1?arguments[1]:void 0)}})});var xg=P((S8e,yk)=>{"use strict";var _k=co(),Phe=Math.floor,lw=function(a,i){var l=a.length;if(l<8)for(var o=1,c,t;o<l;){for(t=o,c=a[o];t&&i(a[t-1],c)>0;)a[t]=a[--t];t!==o++&&(a[t]=c)}else for(var v=Phe(l/2),S=lw(_k(a,0,v),i),C=lw(_k(a,v),i),D=S.length,z=C.length,B=0,ne=0;B<D||ne<z;)a[B+ne]=B<D&&ne<z?i(S[B],C[ne])<=0?S[B++]:C[ne++]:B<D?S[B++]:C[ne++];return a};yk.exports=lw});var uw=P((I8e,vk)=>{"use strict";var Mhe=ya(),gk=Mhe.match(/firefox\/(\d+)/i);vk.exports=!!gk&&+gk[1]});var cw=P((A8e,xk)=>{"use strict";var qhe=ya();xk.exports=/MSIE|Trident/.test(qhe)});var bg=P((O8e,wk)=>{"use strict";var Rhe=ya(),bk=Rhe.match(/AppleWebKit\/(\d+)\./);wk.exports=!!bk&&+bk[1]});var Mk=P(()=>{"use strict";var Dhe=ge(),Ck=pt(),Lhe=ti(),khe=Rr(),Tk=Br(),Bhe=Ip(),Ek=Qt(),hw=ct(),zhe=xg(),Fhe=wa(),Sk=uw(),Nhe=cw(),Ik=ga(),Ak=bg(),ul=[],Ok=Ck(ul.sort),Uhe=Ck(ul.push),jhe=hw(function(){ul.sort(void 0)}),Vhe=hw(function(){ul.sort(null)}),$he=Fhe("sort"),Pk=!hw(function(){if(Ik)return Ik<70;if(!(Sk&&Sk>3)){if(Nhe)return!0;if(Ak)return Ak<603;var a="",i,l,o,c;for(i=65;i<76;i++){switch(l=String.fromCharCode(i),i){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(c=0;c<47;c++)ul.push({k:l+c,v:o})}for(ul.sort(function(t,v){return v.v-t.v}),c=0;c<ul.length;c++)l=ul[c].k.charAt(0),a.charAt(a.length-1)!==l&&(a+=l);return a!=="DGBEFHACIJK"}}),Ghe=jhe||!Vhe||!$he||!Pk,Whe=function(a){return function(i,l){return l===void 0?-1:i===void 0?1:a!==void 0?+a(i,l)||0:Ek(i)>Ek(l)?1:-1}};Dhe({target:"Array",proto:!0,forced:Ghe},{sort:function(i){i!==void 0&&Lhe(i);var l=khe(this);if(Pk)return i===void 0?Ok(l):Ok(l,i);var o=[],c=Tk(l),t,v;for(v=0;v<c;v++)v in l&&Uhe(o,l[v]);for(zhe(o,Whe(i)),t=Tk(o),v=0;v<t;)l[v]=o[v++];for(;v<c;)Bhe(l,v++);return l}})});var Du=P((M8e,Rk)=>{"use strict";var Zhe=Wr(),Hhe=Ri(),Xhe=pr(),Khe=Vt(),qk=Xhe("species");Rk.exports=function(a){var i=Zhe(a);Khe&&i&&!i[qk]&&Hhe(i,qk,{configurable:!0,get:function(){return this}})}});var Dk=P(()=>{"use strict";var Yhe=Du();Yhe("Array")});var Lk=P(()=>{"use strict";var Jhe=ge(),Qhe=Rr(),efe=xa(),tfe=_i(),rfe=Br(),ife=vg(),nfe=Ru(),ofe=hh(),afe=as(),fw=Ip(),sfe=vh(),lfe=sfe("splice"),ufe=Math.max,cfe=Math.min;Jhe({target:"Array",proto:!0,forced:!lfe},{splice:function(i,l){var o=Qhe(this),c=rfe(o),t=efe(i,c),v=arguments.length,S,C,D,z,B,ne;for(v===0?S=C=0:v===1?(S=0,C=c-t):(S=v-2,C=cfe(ufe(tfe(l),0),c-t)),nfe(c+S-C),D=ofe(o,C),z=0;z<C;z++)B=t+z,B in o&&afe(D,z,o[B]);if(D.length=C,S<C){for(z=t;z<c-C;z++)B=z+C,ne=z+S,B in o?o[ne]=o[B]:fw(o,ne);for(z=c;z>c-C+S;z--)fw(o,z-1)}else if(S>C)for(z=c-C;z>t;z--)B=z+C-1,ne=z+S-1,B in o?o[ne]=o[B]:fw(o,ne);for(z=0;z<S;z++)o[z+t]=arguments[z+2];return ife(o,c-C+S),D}})});var dw=P((k8e,kk)=>{"use strict";var hfe=Br();kk.exports=function(a,i){for(var l=hfe(a),o=new i(l),c=0;c<l;c++)o[c]=a[l-c-1];return o}});var Bk=P(()=>{"use strict";var ffe=ge(),dfe=dw(),pfe=qi(),mfe=mn(),_fe=Array;ffe({target:"Array",proto:!0},{toReversed:function(){return dfe(pfe(this),_fe)}});mfe("toReversed")});var Rp=P((F8e,zk)=>{"use strict";var yfe=Br();zk.exports=function(a,i,l){for(var o=0,c=arguments.length>2?l:yfe(i),t=new a(c);c>o;)t[o]=i[o++];return t}});var Nk=P((N8e,Fk)=>{"use strict";var gfe=It();Fk.exports=function(a,i){var l=gfe[a],o=l&&l.prototype;return o&&o[i]}});var Uk=P(()=>{"use strict";var vfe=ge(),xfe=pt(),bfe=ti(),wfe=qi(),Tfe=Rp(),Efe=Nk(),Sfe=mn(),Ife=Array,Afe=xfe(Efe("Array","sort"));vfe({target:"Array",proto:!0},{toSorted:function(i){i!==void 0&&bfe(i);var l=wfe(this),o=Tfe(Ife,l);return Afe(o,i)}});Sfe("toSorted")});var jk=P(()=>{"use strict";var Ofe=ge(),Cfe=mn(),Pfe=Ru(),Mfe=Br(),qfe=xa(),Rfe=qi(),Dfe=_i(),Lfe=Array,kfe=Math.max,Bfe=Math.min;Ofe({target:"Array",proto:!0},{toSpliced:function(i,l){var o=Rfe(this),c=Mfe(o),t=qfe(i,c),v=arguments.length,S=0,C,D,z,B;for(v===0?C=D=0:v===1?(C=0,D=c-t):(C=v-2,D=Bfe(kfe(Dfe(l),0),c-t)),z=Pfe(c+C-D),B=Lfe(z);S<t;S++)B[S]=o[S];for(;S<t+C;S++)B[S]=arguments[S-t+2];for(;S<z;S++)B[S]=o[S+D-C];return B}});Cfe("toSpliced")});var Vk=P(()=>{"use strict";var zfe=mn();zfe("flat")});var $k=P(()=>{"use strict";var Ffe=mn();Ffe("flatMap")});var Gk=P(()=>{"use strict";var Nfe=ge(),Ufe=Rr(),jfe=Br(),Vfe=vg(),$fe=Ip(),Gfe=Ru(),Wfe=[].unshift(0)!==1,Zfe=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(a){return a instanceof TypeError}},Hfe=Wfe||!Zfe();Nfe({target:"Array",proto:!0,arity:1,forced:Hfe},{unshift:function(i){var l=Ufe(this),o=jfe(l),c=arguments.length;if(c){Gfe(o+c);for(var t=o;t--;){var v=t+c;t in l?l[v]=l[t]:$fe(l,v)}for(var S=0;S<c;S++)l[S]=arguments[S]}return Vfe(l,o+c)}})});var pw=P((Y8e,Wk)=>{"use strict";var Xfe=Br(),Kfe=_i(),Yfe=RangeError;Wk.exports=function(a,i,l,o){var c=Xfe(a),t=Kfe(l),v=t<0?c+t:t;if(v>=c||v<0)throw new Yfe("Incorrect index");for(var S=new i(c),C=0;C<c;C++)S[C]=C===v?o:a[C];return S}});var Zk=P(()=>{"use strict";var Jfe=ge(),Qfe=pw(),ede=qi(),tde=Array;Jfe({target:"Array",proto:!0},{with:function(a,i){return Qfe(ede(this),tde,a,i)}})});var wg=P((e$e,Hk)=>{"use strict";Hk.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"});var bh=P((t$e,Xk)=>{"use strict";var rde=Kr();Xk.exports=function(a,i,l){for(var o in i)rde(a,o,i[o],l);return a}});var Xo=P((r$e,Kk)=>{"use strict";var ide=Mn(),nde=TypeError;Kk.exports=function(a,i){if(ide(i,a))return a;throw new nde("Incorrect invocation")}});var Tg=P((i$e,Yk)=>{"use strict";var ode=_i(),ade=qn(),sde=RangeError;Yk.exports=function(a){if(a===void 0)return 0;var i=ode(a),l=ade(i);if(i!==l)throw new sde("Wrong length or index");return l}});var Eg=P((n$e,Jk)=>{"use strict";Jk.exports=Math.sign||function(i){var l=+i;return l===0||l!==l?l:l<0?-1:1}});var rB=P((o$e,tB)=>{"use strict";var lde=Eg(),ude=Math.abs,eB=2220446049250313e-31,Qk=1/eB,cde=function(a){return a+Qk-Qk};tB.exports=function(a,i,l,o){var c=+a,t=ude(c),v=lde(c);if(t<o)return v*cde(t/o/i)*o*i;var S=(1+i/eB)*t,C=S-(S-t);return C>l||C!==C?v*(1/0):v*C}});var mw=P((a$e,iB)=>{"use strict";var hde=rB(),fde=11920928955078125e-23,dde=34028234663852886e22,pde=11754943508222875e-54;iB.exports=Math.fround||function(i){return hde(i,fde,dde,pde)}});var oB=P((s$e,nB)=>{"use strict";var mde=Array,_de=Math.abs,us=Math.pow,yde=Math.floor,gde=Math.log,vde=Math.LN2,xde=function(a,i,l){var o=mde(l),c=l*8-i-1,t=(1<<c)-1,v=t>>1,S=i===23?us(2,-24)-us(2,-77):0,C=a<0||a===0&&1/a<0?1:0,D=0,z,B,ne;for(a=_de(a),a!==a||a===1/0?(B=a!==a?1:0,z=t):(z=yde(gde(a)/vde),ne=us(2,-z),a*ne<1&&(z--,ne*=2),z+v>=1?a+=S/ne:a+=S*us(2,1-v),a*ne>=2&&(z++,ne/=2),z+v>=t?(B=0,z=t):z+v>=1?(B=(a*ne-1)*us(2,i),z+=v):(B=a*us(2,v-1)*us(2,i),z=0));i>=8;)o[D++]=B&255,B/=256,i-=8;for(z=z<<i|B,c+=i;c>0;)o[D++]=z&255,z/=256,c-=8;return o[--D]|=C*128,o},bde=function(a,i){var l=a.length,o=l*8-i-1,c=(1<<o)-1,t=c>>1,v=o-7,S=l-1,C=a[S--],D=C&127,z;for(C>>=7;v>0;)D=D*256+a[S--],v-=8;for(z=D&(1<<-v)-1,D>>=-v,v+=i;v>0;)z=z*256+a[S--],v-=8;if(D===0)D=1-t;else{if(D===c)return z?NaN:C?-1/0:1/0;z+=us(2,i),D-=t}return(C?-1:1)*z*us(2,D-i)};nB.exports={pack:xde,unpack:bde}});var kp=P((l$e,wB)=>{"use strict";var Cg=It(),xw=pt(),_w=Vt(),wde=wg(),yB=Iu(),Tde=on(),Ede=Ri(),aB=bh(),yw=ct(),Sg=Xo(),Sde=_i(),Ide=qn(),Ag=Tg(),Ade=mw(),gB=oB(),Ode=Xn(),sB=Ho(),Cde=dg(),Pde=co(),Mde=ll(),qde=lh(),vB=pn(),bw=Ai(),Rde=yB.PROPER,lB=yB.CONFIGURABLE,Th="ArrayBuffer",Pg="DataView",Eh="prototype",Dde="Wrong length",xB="Wrong index",uB=bw.getterFor(Th),Lp=bw.getterFor(Pg),cB=bw.set,Ko=Cg[Th],Yn=Ko,wh=Yn&&Yn[Eh],Ta=Cg[Pg],Lu=Ta&&Ta[Eh],hB=Object.prototype,Lde=Cg.Array,Og=Cg.RangeError,kde=xw(Cde),Bde=xw([].reverse),bB=gB.pack,fB=gB.unpack,dB=function(a){return[a&255]},pB=function(a){return[a&255,a>>8&255]},mB=function(a){return[a&255,a>>8&255,a>>16&255,a>>24&255]},_B=function(a){return a[3]<<24|a[2]<<16|a[1]<<8|a[0]},zde=function(a){return bB(Ade(a),23,4)},Fde=function(a){return bB(a,52,8)},Ig=function(a,i,l){Ede(a[Eh],i,{configurable:!0,get:function(){return l(this)[i]}})},cl=function(a,i,l,o){var c=Lp(a),t=Ag(l),v=!!o;if(t+i>c.byteLength)throw new Og(xB);var S=c.bytes,C=t+c.byteOffset,D=Pde(S,C,C+i);return v?D:Bde(D)},hl=function(a,i,l,o,c,t){var v=Lp(a),S=Ag(l),C=o(+c),D=!!t;if(S+i>v.byteLength)throw new Og(xB);for(var z=v.bytes,B=S+v.byteOffset,ne=0;ne<i;ne++)z[B+ne]=C[D?ne:i-ne-1]};wde?(gw=Rde&&Ko.name!==Th,!yw(function(){Ko(1)})||!yw(function(){new Ko(-1)})||yw(function(){return new Ko,new Ko(1.5),new Ko(NaN),Ko.length!==1||gw&&!lB})?(Yn=function(i){return Sg(this,wh),Mde(new Ko(Ag(i)),this,Yn)},Yn[Eh]=wh,wh.constructor=Yn,qde(Yn,Ko)):gw&&lB&&Tde(Ko,"name",Th),sB&&Ode(Lu)!==hB&&sB(Lu,hB),Dp=new Ta(new Yn(2)),vw=xw(Lu.setInt8),Dp.setInt8(0,2147483648),Dp.setInt8(1,2147483649),(Dp.getInt8(0)||!Dp.getInt8(1))&&aB(Lu,{setInt8:function(i,l){vw(this,i,l<<24>>24)},setUint8:function(i,l){vw(this,i,l<<24>>24)}},{unsafe:!0})):(Yn=function(i){Sg(this,wh);var l=Ag(i);cB(this,{type:Th,bytes:kde(Lde(l),0),byteLength:l}),_w||(this.byteLength=l,this.detached=!1)},wh=Yn[Eh],Ta=function(i,l,o){Sg(this,Lu),Sg(i,wh);var c=uB(i),t=c.byteLength,v=Sde(l);if(v<0||v>t)throw new Og("Wrong offset");if(o=o===void 0?t-v:Ide(o),v+o>t)throw new Og(Dde);cB(this,{type:Pg,buffer:i,byteLength:o,byteOffset:v,bytes:c.bytes}),_w||(this.buffer=i,this.byteLength=o,this.byteOffset=v)},Lu=Ta[Eh],_w&&(Ig(Yn,"byteLength",uB),Ig(Ta,"buffer",Lp),Ig(Ta,"byteLength",Lp),Ig(Ta,"byteOffset",Lp)),aB(Lu,{getInt8:function(i){return cl(this,1,i)[0]<<24>>24},getUint8:function(i){return cl(this,1,i)[0]},getInt16:function(i){var l=cl(this,2,i,arguments.length>1?arguments[1]:!1);return(l[1]<<8|l[0])<<16>>16},getUint16:function(i){var l=cl(this,2,i,arguments.length>1?arguments[1]:!1);return l[1]<<8|l[0]},getInt32:function(i){return _B(cl(this,4,i,arguments.length>1?arguments[1]:!1))},getUint32:function(i){return _B(cl(this,4,i,arguments.length>1?arguments[1]:!1))>>>0},getFloat32:function(i){return fB(cl(this,4,i,arguments.length>1?arguments[1]:!1),23)},getFloat64:function(i){return fB(cl(this,8,i,arguments.length>1?arguments[1]:!1),52)},setInt8:function(i,l){hl(this,1,i,dB,l)},setUint8:function(i,l){hl(this,1,i,dB,l)},setInt16:function(i,l){hl(this,2,i,pB,l,arguments.length>2?arguments[2]:!1)},setUint16:function(i,l){hl(this,2,i,pB,l,arguments.length>2?arguments[2]:!1)},setInt32:function(i,l){hl(this,4,i,mB,l,arguments.length>2?arguments[2]:!1)},setUint32:function(i,l){hl(this,4,i,mB,l,arguments.length>2?arguments[2]:!1)},setFloat32:function(i,l){hl(this,4,i,zde,l,arguments.length>2?arguments[2]:!1)},setFloat64:function(i,l){hl(this,8,i,Fde,l,arguments.length>2?arguments[2]:!1)}}));var gw,Dp,vw;vB(Yn,Th);vB(Ta,Pg);wB.exports={ArrayBuffer:Yn,DataView:Ta}});var EB=P(()=>{"use strict";var Nde=ge(),Ude=It(),jde=kp(),Vde=Du(),ww="ArrayBuffer",TB=jde[ww],$de=Ude[ww];Nde({global:!0,constructor:!0,forced:$de!==TB},{ArrayBuffer:TB});Vde(ww)});var cr=P((h$e,DB)=>{"use strict";var Gde=wg(),Iw=Vt(),_n=It(),OB=_r(),Rg=ur(),dl=yr(),Aw=Zo(),Wde=il(),Zde=on(),Tw=Kr(),Hde=Ri(),Xde=Mn(),Dg=Xn(),Ih=Ho(),Kde=pr(),Yde=Su(),CB=Ai(),PB=CB.enforce,Jde=CB.get,Mg=_n.Int8Array,Ew=Mg&&Mg.prototype,SB=_n.Uint8ClampedArray,IB=SB&&SB.prototype,Ea=Mg&&Dg(Mg),Yo=Ew&&Dg(Ew),Qde=Object.prototype,Ow=_n.TypeError,AB=Kde("toStringTag"),Sw=Yde("TYPED_ARRAY_TAG"),qg="TypedArrayConstructor",cs=Gde&&!!Ih&&Aw(_n.opera)!=="Opera",MB=!1,Ln,fl,Sh,hs={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Cw={BigInt64Array:8,BigUint64Array:8},epe=function(i){if(!Rg(i))return!1;var l=Aw(i);return l==="DataView"||dl(hs,l)||dl(Cw,l)},qB=function(a){var i=Dg(a);if(Rg(i)){var l=Jde(i);return l&&dl(l,qg)?l[qg]:qB(i)}},RB=function(a){if(!Rg(a))return!1;var i=Aw(a);return dl(hs,i)||dl(Cw,i)},tpe=function(a){if(RB(a))return a;throw new Ow("Target is not a typed array")},rpe=function(a){if(OB(a)&&(!Ih||Xde(Ea,a)))return a;throw new Ow(Wde(a)+" is not a typed array constructor")},ipe=function(a,i,l,o){if(Iw){if(l)for(var c in hs){var t=_n[c];if(t&&dl(t.prototype,a))try{delete t.prototype[a]}catch{try{t.prototype[a]=i}catch{}}}(!Yo[a]||l)&&Tw(Yo,a,l?i:cs&&Ew[a]||i,o)}},npe=function(a,i,l){var o,c;if(Iw){if(Ih){if(l){for(o in hs)if(c=_n[o],c&&dl(c,a))try{delete c[a]}catch{}}if(!Ea[a]||l)try{return Tw(Ea,a,l?i:cs&&Ea[a]||i)}catch{}else return}for(o in hs)c=_n[o],c&&(!c[a]||l)&&Tw(c,a,i)}};for(Ln in hs)fl=_n[Ln],Sh=fl&&fl.prototype,Sh?PB(Sh)[qg]=fl:cs=!1;for(Ln in Cw)fl=_n[Ln],Sh=fl&&fl.prototype,Sh&&(PB(Sh)[qg]=fl);if((!cs||!OB(Ea)||Ea===Function.prototype)&&(Ea=function(){throw new Ow("Incorrect invocation")},cs))for(Ln in hs)_n[Ln]&&Ih(_n[Ln],Ea);if((!cs||!Yo||Yo===Qde)&&(Yo=Ea.prototype,cs))for(Ln in hs)_n[Ln]&&Ih(_n[Ln].prototype,Yo);cs&&Dg(IB)!==Yo&&Ih(IB,Yo);if(Iw&&!dl(Yo,AB)){MB=!0,Hde(Yo,AB,{configurable:!0,get:function(){return Rg(this)?this[Sw]:void 0}});for(Ln in hs)_n[Ln]&&Zde(_n[Ln],Sw,Ln)}DB.exports={NATIVE_ARRAY_BUFFER_VIEWS:cs,TYPED_ARRAY_TAG:MB&&Sw,aTypedArray:tpe,aTypedArrayConstructor:rpe,exportTypedArrayMethod:ipe,exportTypedArrayStaticMethod:npe,getTypedArrayConstructor:qB,isView:epe,isTypedArray:RB,TypedArray:Ea,TypedArrayPrototype:Yo}});var kB=P(()=>{"use strict";var ope=ge(),LB=cr(),ape=LB.NATIVE_ARRAY_BUFFER_VIEWS;ope({target:"ArrayBuffer",stat:!0,forced:!ape},{isView:LB.isView})});var Lg=P((p$e,BB)=>{"use strict";var spe=Ou(),lpe=il(),upe=TypeError;BB.exports=function(a){if(spe(a))return a;throw new upe(lpe(a)+" is not a constructor")}});var ku=P((m$e,FB)=>{"use strict";var zB=ir(),cpe=Lg(),hpe=fn(),fpe=pr(),dpe=fpe("species");FB.exports=function(a,i){var l=zB(a).constructor,o;return l===void 0||hpe(o=zB(l)[dpe])?i:cpe(o)}});var GB=P(()=>{"use strict";var ppe=ge(),Mw=ol(),mpe=ct(),VB=kp(),NB=ir(),UB=xa(),_pe=qn(),ype=ku(),qw=VB.ArrayBuffer,Pw=VB.DataView,$B=Pw.prototype,jB=Mw(qw.prototype.slice),gpe=Mw($B.getUint8),vpe=Mw($B.setUint8),xpe=mpe(function(){return!new qw(2).slice(1,void 0).byteLength});ppe({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:xpe},{slice:function(i,l){if(jB&&l===void 0)return jB(NB(this),i);for(var o=NB(this).byteLength,c=UB(i,o),t=UB(l===void 0?o:l,o),v=new(ype(this,qw))(_pe(t-c)),S=new Pw(this),C=new Pw(v),D=0;c<t;)vpe(C,D++,gpe(S,c++));return v}})});var WB=P(()=>{"use strict";var bpe=ge(),wpe=kp(),Tpe=wg();bpe({global:!0,constructor:!0,forced:!Tpe},{DataView:wpe.DataView})});var ZB=P(()=>{"use strict";WB()});var Rw=P((w$e,HB)=>{"use strict";var Epe=ng(),Spe=Gi(),Ipe=TypeError;HB.exports=Epe(ArrayBuffer.prototype,"byteLength","get")||function(a){if(Spe(a)!=="ArrayBuffer")throw new Ipe("ArrayBuffer expected");return a.byteLength}});var Dw=P((T$e,XB)=>{"use strict";var Ape=pt(),Ope=Rw(),Cpe=Ape(ArrayBuffer.prototype.slice);XB.exports=function(a){if(Ope(a)!==0)return!1;try{return Cpe(a,0,0),!1}catch{return!0}}});var YB=P(()=>{"use strict";var Ppe=Vt(),Mpe=Ri(),qpe=Dw(),KB=ArrayBuffer.prototype;Ppe&&!("detached"in KB)&&Mpe(KB,"detached",{configurable:!0,get:function(){return qpe(this)}})});var Lw=P((I$e,JB)=>{"use strict";var Rpe=ls();JB.exports=function(a){try{if(Rpe)return Function('return require("'+a+'")')()}catch{}}});var kg=P((A$e,QB)=>{"use strict";QB.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"});var kw=P((O$e,e3)=>{"use strict";var Dpe=kg(),Lpe=ls();e3.exports=!Dpe&&!Lpe&&typeof window=="object"&&typeof document=="object"});var Bg=P((C$e,r3)=>{"use strict";var kpe=It(),Bpe=ct(),Bw=ga(),zpe=kw(),Fpe=kg(),Npe=ls(),t3=kpe.structuredClone;r3.exports=!!t3&&!Bpe(function(){if(Fpe&&Bw>92||Npe&&Bw>94||zpe&&Bw>97)return!1;var a=new ArrayBuffer(8),i=t3(a,{transfer:[a]});return a.byteLength!==0||i.byteLength!==8})});var jw=P((P$e,o3)=>{"use strict";var Uw=It(),Upe=Lw(),jpe=Bg(),Vpe=Uw.structuredClone,i3=Uw.ArrayBuffer,zg=Uw.MessageChannel,Nw=!1,zw,n3,Fg,Fw;if(jpe)Nw=function(a){Vpe(a,{transfer:[a]})};else if(i3)try{zg||(zw=Upe("worker_threads"),zw&&(zg=zw.MessageChannel)),zg&&(n3=new zg,Fg=new i3(2),Fw=function(a){n3.port1.postMessage(null,[a])},Fg.byteLength===2&&(Fw(Fg),Fg.byteLength===0&&(Nw=Fw)))}catch{}o3.exports=Nw});var Zw=P((M$e,f3)=>{"use strict";var Ng=It(),Gw=pt(),u3=ng(),$pe=Tg(),Gpe=Dw(),Wpe=Rw(),a3=jw(),Vw=Bg(),Zpe=Ng.structuredClone,c3=Ng.ArrayBuffer,$w=Ng.DataView,Hpe=Ng.TypeError,Xpe=Math.min,Ww=c3.prototype,h3=$w.prototype,Kpe=Gw(Ww.slice),s3=u3(Ww,"resizable","get"),l3=u3(Ww,"maxByteLength","get"),Ype=Gw(h3.getInt8),Jpe=Gw(h3.setInt8);f3.exports=(Vw||a3)&&function(a,i,l){var o=Wpe(a),c=i===void 0?o:$pe(i),t=!s3||!s3(a),v;if(Gpe(a))throw new Hpe("ArrayBuffer is detached");if(Vw&&(a=Zpe(a,{transfer:[a]}),o===c&&(l||t)))return a;if(o>=c&&(!l||t))v=Kpe(a,0,c);else{var S=l&&!t&&l3?{maxByteLength:l3(a)}:void 0;v=new c3(c,S);for(var C=new $w(a),D=new $w(v),z=Xpe(c,o),B=0;B<z;B++)Jpe(D,B,Ype(C,B))}return Vw||a3(a),v}});var p3=P(()=>{"use strict";var Qpe=ge(),d3=Zw();d3&&Qpe({target:"ArrayBuffer",proto:!0},{transfer:function(){return d3(this,arguments.length?arguments[0]:void 0,!0)}})});var _3=P(()=>{"use strict";var eme=ge(),m3=Zw();m3&&eme({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return m3(this,arguments.length?arguments[0]:void 0,!1)}})});var y3=P(()=>{"use strict";var tme=ge(),rme=pt(),ime=ct(),nme=ime(function(){return new Date(16e11).getYear()!==120}),ome=rme(Date.prototype.getFullYear);tme({target:"Date",proto:!0,forced:nme},{getYear:function(){return ome(this)-1900}})});var v3=P(()=>{"use strict";var ame=ge(),sme=pt(),g3=Date,lme=sme(g3.prototype.getTime);ame({target:"Date",stat:!0},{now:function(){return lme(new g3)}})});var w3=P(()=>{"use strict";var ume=ge(),x3=pt(),cme=_i(),b3=Date.prototype,hme=x3(b3.getTime),fme=x3(b3.setFullYear);ume({target:"Date",proto:!0},{setYear:function(i){hme(this);var l=cme(i),o=l>=0&&l<=99?l+1900:l;return fme(this,o)}})});var T3=P(()=>{"use strict";var dme=ge();dme({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString})});var Bp=P(($$e,E3)=>{"use strict";var pme=_i(),mme=Qt(),_me=ei(),yme=RangeError;E3.exports=function(i){var l=mme(_me(this)),o="",c=pme(i);if(c<0||c===1/0)throw new yme("Wrong number of repetitions");for(;c>0;(c>>>=1)&&(l+=l))c&1&&(o+=l);return o}});var Ug=P((G$e,O3)=>{"use strict";var A3=pt(),gme=qn(),S3=Qt(),vme=Bp(),xme=ei(),bme=A3(vme),wme=A3("".slice),Tme=Math.ceil,I3=function(a){return function(i,l,o){var c=S3(xme(i)),t=gme(l),v=c.length,S=o===void 0?" ":S3(o),C,D;return t<=v||S===""?c:(C=t-v,D=bme(S,Tme(C/S.length)),D.length>C&&(D=wme(D,0,C)),a?c+D:D+c)}};O3.exports={start:I3(!1),end:I3(!0)}});var M3=P((W$e,P3)=>{"use strict";var pl=pt(),C3=ct(),Bu=Ug().start,Eme=RangeError,Sme=isFinite,Ime=Math.abs,fs=Date.prototype,Hw=fs.toISOString,Ame=pl(fs.getTime),Ome=pl(fs.getUTCDate),Cme=pl(fs.getUTCFullYear),Pme=pl(fs.getUTCHours),Mme=pl(fs.getUTCMilliseconds),qme=pl(fs.getUTCMinutes),Rme=pl(fs.getUTCMonth),Dme=pl(fs.getUTCSeconds);P3.exports=C3(function(){return Hw.call(new Date(-5e13-1))!=="0385-07-25T07:06:39.999Z"})||!C3(function(){Hw.call(new Date(NaN))})?function(){if(!Sme(Ame(this)))throw new Eme("Invalid time value");var i=this,l=Cme(i),o=Mme(i),c=l<0?"-":l>9999?"+":"";return c+Bu(Ime(l),c?6:4,0)+"-"+Bu(Rme(i)+1,2,0)+"-"+Bu(Ome(i),2,0)+"T"+Bu(Pme(i),2,0)+":"+Bu(qme(i),2,0)+":"+Bu(Dme(i),2,0)+"."+Bu(o,3,0)+"Z"}:Hw});var R3=P(()=>{"use strict";var Lme=ge(),q3=M3();Lme({target:"Date",proto:!0,forced:Date.prototype.toISOString!==q3},{toISOString:q3})});var D3=P(()=>{"use strict";var kme=ge(),Bme=ct(),zme=Rr(),Fme=fp(),Nme=Bme(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});kme({target:"Date",proto:!0,arity:1,forced:Nme},{toJSON:function(i){var l=zme(this),o=Fme(l,"number");return typeof o=="number"&&!isFinite(o)?null:l.toISOString()}})});var k3=P((Y$e,L3)=>{"use strict";var Ume=ir(),jme=k1(),Vme=TypeError;L3.exports=function(a){if(Ume(this),a==="string"||a==="default")a="string";else if(a!=="number")throw new Vme("Incorrect hint");return jme(this,a)}});var F3=P(()=>{"use strict";var $me=yr(),Gme=Kr(),Wme=k3(),Zme=pr(),B3=Zme("toPrimitive"),z3=Date.prototype;$me(z3,B3)||Gme(z3,B3,Wme)});var V3=P(()=>{"use strict";var U3=pt(),Hme=Kr(),Xw=Date.prototype,N3="Invalid Date",j3="toString",Xme=U3(Xw[j3]),Kme=U3(Xw.getTime);String(new Date(NaN))!==N3&&Hme(Xw,j3,function(){var i=Kme(this);return i===i?Xme(this):N3})});var G3=P(()=>{"use strict";var Yme=ge(),zp=pt(),Jme=Qt(),Qme=zp("".charAt),e_e=zp("".charCodeAt),t_e=zp(/./.exec),r_e=zp(1 .toString),i_e=zp("".toUpperCase),n_e=/[\w*+\-./@]/,$3=function(a,i){for(var l=r_e(a,16);l.length<i;)l="0"+l;return l};Yme({global:!0},{escape:function(i){for(var l=Jme(i),o="",c=l.length,t=0,v,S;t<c;)v=Qme(l,t++),t_e(n_e,v)?o+=v:(S=e_e(v,0),S<256?o+="%"+$3(S,2):o+="%u"+i_e($3(S,4)));return o}})});var Yw=P((nGe,X3)=>{"use strict";var Z3=pt(),o_e=ti(),a_e=ur(),s_e=yr(),W3=co(),l_e=nh(),H3=Function,u_e=Z3([].concat),c_e=Z3([].join),Kw={},h_e=function(a,i,l){if(!s_e(Kw,i)){for(var o=[],c=0;c<i;c++)o[c]="a["+c+"]";Kw[i]=H3("C,a","return new C("+c_e(o,",")+")")}return Kw[i](a,l)};X3.exports=l_e?H3.bind:function(i){var l=o_e(this),o=l.prototype,c=W3(arguments,1),t=function(){var S=u_e(c,W3(arguments));return this instanceof t?h_e(l,S.length,S):l.apply(i,S)};return a_e(o)&&(t.prototype=o),t}});var Y3=P(()=>{"use strict";var f_e=ge(),K3=Yw();f_e({target:"Function",proto:!0,forced:Function.bind!==K3},{bind:K3})});var ez=P(()=>{"use strict";var d_e=_r(),J3=ur(),p_e=ri(),m_e=Mn(),__e=pr(),y_e=Ny(),Jw=__e("hasInstance"),Q3=Function.prototype;Jw in Q3||p_e.f(Q3,Jw,{value:y_e(function(a){if(!d_e(this)||!J3(a))return!1;var i=this.prototype;return J3(i)?m_e(i,a):a instanceof this},Jw)})});var nz=P(()=>{"use strict";var g_e=Vt(),v_e=Iu().EXISTS,tz=pt(),x_e=Ri(),rz=Function.prototype,b_e=tz(rz.toString),iz=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,w_e=tz(iz.exec),T_e="name";g_e&&!v_e&&x_e(rz,T_e,{configurable:!0,get:function(){try{return w_e(iz,b_e(this))[1]}catch{return""}}})});var oz=P(()=>{"use strict";var E_e=ge(),Qw=It();E_e({global:!0,forced:Qw.globalThis!==Qw},{globalThis:Qw})});var az=P(()=>{"use strict";var S_e=It(),I_e=pn();I_e(S_e.JSON,"JSON",!0)});var jg=P((mGe,sz)=>{"use strict";var A_e=ct();sz.exports=A_e(function(){if(typeof ArrayBuffer=="function"){var a=new ArrayBuffer(8);Object.isExtensible(a)&&Object.defineProperty(a,"a",{value:8})}})});var $g=P((_Ge,uz)=>{"use strict";var O_e=ct(),C_e=ur(),P_e=Gi(),lz=jg(),Vg=Object.isExtensible,M_e=O_e(function(){Vg(1)});uz.exports=M_e||lz?function(i){return!C_e(i)||lz&&P_e(i)==="ArrayBuffer"?!1:Vg?Vg(i):!0}:Vg});var zu=P((yGe,cz)=>{"use strict";var q_e=ct();cz.exports=!q_e(function(){return Object.isExtensible(Object.preventExtensions({}))})});var ml=P((gGe,dz)=>{"use strict";var R_e=ge(),D_e=pt(),L_e=ah(),k_e=ur(),eT=yr(),B_e=ri().f,hz=nl(),z_e=Xy(),tT=$g(),F_e=Su(),N_e=zu(),fz=!1,ds=F_e("meta"),U_e=0,rT=function(a){B_e(a,ds,{value:{objectID:"O"+U_e++,weakData:{}}})},j_e=function(a,i){if(!k_e(a))return typeof a=="symbol"?a:(typeof a=="string"?"S":"P")+a;if(!eT(a,ds)){if(!tT(a))return"F";if(!i)return"E";rT(a)}return a[ds].objectID},V_e=function(a,i){if(!eT(a,ds)){if(!tT(a))return!0;if(!i)return!1;rT(a)}return a[ds].weakData},$_e=function(a){return N_e&&fz&&tT(a)&&!eT(a,ds)&&rT(a),a},G_e=function(){W_e.enable=function(){},fz=!0;var a=hz.f,i=D_e([].splice),l={};l[ds]=1,a(l).length&&(hz.f=function(o){for(var c=a(o),t=0,v=c.length;t<v;t++)if(c[t]===ds){i(c,t,1);break}return c},R_e({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:z_e.f}))},W_e=dz.exports={enable:G_e,fastKey:j_e,getWeakData:V_e,onFreeze:$_e};L_e[ds]=!0});var Fp=P((vGe,mz)=>{"use strict";var Z_e=ge(),H_e=It(),X_e=pt(),pz=uh(),K_e=Kr(),Y_e=ml(),J_e=Kn(),Q_e=Xo(),eye=_r(),tye=fn(),iT=ur(),nT=ct(),rye=Op(),iye=pn(),nye=ll();mz.exports=function(a,i,l){var o=a.indexOf("Map")!==-1,c=a.indexOf("Weak")!==-1,t=o?"set":"add",v=H_e[a],S=v&&v.prototype,C=v,D={},z=function(Ge){var tt=X_e(S[Ge]);K_e(S,Ge,Ge==="add"?function(Mt){return tt(this,Mt===0?0:Mt),this}:Ge==="delete"?function(mt){return c&&!iT(mt)?!1:tt(this,mt===0?0:mt)}:Ge==="get"?function(Mt){return c&&!iT(Mt)?void 0:tt(this,Mt===0?0:Mt)}:Ge==="has"?function(Mt){return c&&!iT(Mt)?!1:tt(this,Mt===0?0:Mt)}:function(Mt,Kt){return tt(this,Mt===0?0:Mt,Kt),this})},B=pz(a,!eye(v)||!(c||S.forEach&&!nT(function(){new v().entries().next()})));if(B)C=l.getConstructor(i,a,o,t),Y_e.enable();else if(pz(a,!0)){var ne=new C,pe=ne[t](c?{}:-0,1)!==ne,$e=nT(function(){ne.has(1)}),Ae=rye(function(Ge){new v(Ge)}),ke=!c&&nT(function(){for(var Ge=new v,tt=5;tt--;)Ge[t](tt,tt);return!Ge.has(-0)});Ae||(C=i(function(Ge,tt){Q_e(Ge,S);var mt=nye(new v,Ge,C);return tye(tt)||J_e(tt,mt[t],{that:mt,AS_ENTRIES:o}),mt}),C.prototype=S,S.constructor=C),($e||ke)&&(z("delete"),z("has"),o&&z("get")),(ke||pe)&&z(t),c&&S.clear&&delete S.clear}return D[a]=C,Z_e({global:!0,constructor:!0,forced:C!==v},D),iye(C,a),c||l.setStrong(C,a,o),C}});var aT=P((xGe,bz)=>{"use strict";var _z=Rn(),oye=Ri(),yz=bh(),aye=ho(),sye=Xo(),lye=fn(),uye=Kn(),cye=yg(),Gg=xh(),hye=Du(),Np=Vt(),gz=ml().fastKey,xz=Ai(),vz=xz.set,oT=xz.getterFor;bz.exports={getConstructor:function(a,i,l,o){var c=a(function(D,z){sye(D,t),vz(D,{type:i,index:_z(null),first:void 0,last:void 0,size:0}),Np||(D.size=0),lye(z)||uye(z,D[o],{that:D,AS_ENTRIES:l})}),t=c.prototype,v=oT(i),S=function(D,z,B){var ne=v(D),pe=C(D,z),$e,Ae;return pe?pe.value=B:(ne.last=pe={index:Ae=gz(z,!0),key:z,value:B,previous:$e=ne.last,next:void 0,removed:!1},ne.first||(ne.first=pe),$e&&($e.next=pe),Np?ne.size++:D.size++,Ae!=="F"&&(ne.index[Ae]=pe)),D},C=function(D,z){var B=v(D),ne=gz(z),pe;if(ne!=="F")return B.index[ne];for(pe=B.first;pe;pe=pe.next)if(pe.key===z)return pe};return yz(t,{clear:function(){for(var z=this,B=v(z),ne=B.first;ne;)ne.removed=!0,ne.previous&&(ne.previous=ne.previous.next=void 0),ne=ne.next;B.first=B.last=void 0,B.index=_z(null),Np?B.size=0:z.size=0},delete:function(D){var z=this,B=v(z),ne=C(z,D);if(ne){var pe=ne.next,$e=ne.previous;delete B.index[ne.index],ne.removed=!0,$e&&($e.next=pe),pe&&(pe.previous=$e),B.first===ne&&(B.first=pe),B.last===ne&&(B.last=$e),Np?B.size--:z.size--}return!!ne},forEach:function(z){for(var B=v(this),ne=aye(z,arguments.length>1?arguments[1]:void 0),pe;pe=pe?pe.next:B.first;)for(ne(pe.value,pe.key,this);pe&&pe.removed;)pe=pe.previous},has:function(z){return!!C(this,z)}}),yz(t,l?{get:function(z){var B=C(this,z);return B&&B.value},set:function(z,B){return S(this,z===0?0:z,B)}}:{add:function(z){return S(this,z=z===0?0:z,z)}}),Np&&oye(t,"size",{configurable:!0,get:function(){return v(this).size}}),c},setStrong:function(a,i,l){var o=i+" Iterator",c=oT(i),t=oT(o);cye(a,i,function(v,S){vz(this,{type:o,target:v,state:c(v),kind:S,last:void 0})},function(){for(var v=t(this),S=v.kind,C=v.last;C&&C.removed;)C=C.previous;return!v.target||!(v.last=C=C?C.next:v.state.first)?(v.target=void 0,Gg(void 0,!0)):Gg(S==="keys"?C.key:S==="values"?C.value:[C.key,C.value],!1)},l?"entries":"values",!l,!0),hye(i)}}});var wz=P(()=>{"use strict";var fye=Fp(),dye=aT();fye("Map",function(a){return function(){return a(this,arguments.length?arguments[0]:void 0)}},dye)});var Tz=P(()=>{"use strict";wz()});var sT=P((SGe,Ez)=>{"use strict";var Wg=pt(),Up=Map.prototype;Ez.exports={Map,set:Wg(Up.set),get:Wg(Up.get),has:Wg(Up.has),remove:Wg(Up.delete),proto:Up}});var Sz=P(()=>{"use strict";var pye=ge(),mye=pt(),_ye=ti(),yye=ei(),gye=Kn(),Zg=sT(),vye=fi(),xye=Zg.Map,bye=Zg.has,wye=Zg.get,Tye=Zg.set,Eye=mye([].push);pye({target:"Map",stat:!0,forced:vye},{groupBy:function(i,l){yye(i),_ye(l);var o=new xye,c=0;return gye(i,function(t){var v=l(t,c++);bye(o,v)?Eye(wye(o,v),t):Tye(o,v,[t])}),o}})});var lT=P((OGe,Iz)=>{"use strict";var Sye=Math.log;Iz.exports=Math.log1p||function(i){var l=+i;return l>-1e-8&&l<1e-8?l-l*l/2:Sye(1+l)}});var Oz=P(()=>{"use strict";var Iye=ge(),Aye=lT(),uT=Math.acosh,Oye=Math.log,Az=Math.sqrt,Cye=Math.LN2,Pye=!uT||Math.floor(uT(Number.MAX_VALUE))!==710||uT(1/0)!==1/0;Iye({target:"Math",stat:!0,forced:Pye},{acosh:function(i){var l=+i;return l<1?NaN:l>9490626562425156e-8?Oye(l)+Cye:Aye(l-1+Az(l-1)*Az(l+1))}})});var Mz=P(()=>{"use strict";var Mye=ge(),Cz=Math.asinh,qye=Math.log,Rye=Math.sqrt;function Pz(a){var i=+a;return!isFinite(i)||i===0?i:i<0?-Pz(-i):qye(i+Rye(i*i+1))}var Dye=!(Cz&&1/Cz(0)>0);Mye({target:"Math",stat:!0,forced:Dye},{asinh:Pz})});var Rz=P(()=>{"use strict";var Lye=ge(),qz=Math.atanh,kye=Math.log,Bye=!(qz&&1/qz(-0)<0);Lye({target:"Math",stat:!0,forced:Bye},{atanh:function(i){var l=+i;return l===0?l:kye((1+l)/(1-l))/2}})});var Dz=P(()=>{"use strict";var zye=ge(),Fye=Eg(),Nye=Math.abs,Uye=Math.pow;zye({target:"Math",stat:!0},{cbrt:function(i){var l=+i;return Fye(l)*Uye(Nye(l),1/3)}})});var Lz=P(()=>{"use strict";var jye=ge(),Vye=Math.floor,$ye=Math.log,Gye=Math.LOG2E;jye({target:"Math",stat:!0},{clz32:function(i){var l=i>>>0;return l?31-Vye($ye(l+.5)*Gye):32}})});var Vp=P((FGe,kz)=>{"use strict";var jp=Math.expm1,Wye=Math.exp;kz.exports=!jp||jp(10)>22025.465794806718||jp(10)<22025.465794806718||jp(-2e-17)!==-2e-17?function(i){var l=+i;return l===0?l:l>-1e-6&&l<1e-6?l+l*l/2:Wye(l)-1}:jp});var zz=P(()=>{"use strict";var Zye=ge(),Hye=Vp(),Bz=Math.cosh,Xye=Math.abs,cT=Math.E,Kye=!Bz||Bz(710)===1/0;Zye({target:"Math",stat:!0,forced:Kye},{cosh:function(i){var l=Hye(Xye(i)-1)+1;return(l+1/(l*cT*cT))*(cT/2)}})});var Nz=P(()=>{"use strict";var Yye=ge(),Fz=Vp();Yye({target:"Math",stat:!0,forced:Fz!==Math.expm1},{expm1:Fz})});var Uz=P(()=>{"use strict";var Jye=ge(),Qye=mw();Jye({target:"Math",stat:!0},{fround:Qye})});var Vz=P(()=>{"use strict";var ege=ge(),jz=Math.hypot,tge=Math.abs,rge=Math.sqrt,ige=!!jz&&jz(1/0,NaN)!==1/0;ege({target:"Math",stat:!0,arity:2,forced:ige},{hypot:function(i,l){for(var o=0,c=0,t=arguments.length,v=0,S,C;c<t;)S=tge(arguments[c++]),v<S?(C=v/S,o=o*C*C+1,v=S):S>0?(C=S/v,o+=C*C):o+=S;return v===1/0?1/0:v*rge(o)}})});var Gz=P(()=>{"use strict";var nge=ge(),oge=ct(),$z=Math.imul,age=oge(function(){return $z(4294967295,5)!==-5||$z.length!==2});nge({target:"Math",stat:!0,forced:age},{imul:function(i,l){var o=65535,c=+i,t=+l,v=o&c,S=o&t;return 0|v*S+((o&c>>>16)*S+v*(o&t>>>16)<<16>>>0)}})});var hT=P((KGe,Wz)=>{"use strict";var sge=Math.log,lge=Math.LOG10E;Wz.exports=Math.log10||function(i){return sge(i)*lge}});var Zz=P(()=>{"use strict";var uge=ge(),cge=hT();uge({target:"Math",stat:!0},{log10:cge})});var Hz=P(()=>{"use strict";var hge=ge(),fge=lT();hge({target:"Math",stat:!0},{log1p:fge})});var Xz=P(()=>{"use strict";var dge=ge(),pge=Math.log,mge=Math.LN2;dge({target:"Math",stat:!0},{log2:function(i){return pge(i)/mge}})});var Kz=P(()=>{"use strict";var _ge=ge(),yge=Eg();_ge({target:"Math",stat:!0},{sign:yge})});var Qz=P(()=>{"use strict";var gge=ge(),vge=ct(),Yz=Vp(),xge=Math.abs,Jz=Math.exp,bge=Math.E,wge=vge(function(){return Math.sinh(-2e-17)!==-2e-17});gge({target:"Math",stat:!0,forced:wge},{sinh:function(i){var l=+i;return xge(l)<1?(Yz(l)-Yz(-l))/2:(Jz(l-1)-Jz(-l-1))*(bge/2)}})});var rF=P(()=>{"use strict";var Tge=ge(),eF=Vp(),tF=Math.exp;Tge({target:"Math",stat:!0},{tanh:function(i){var l=+i,o=eF(l),c=eF(-l);return o===1/0?1:c===1/0?-1:(o-c)/(tF(l)+tF(-l))}})});var iF=P(()=>{"use strict";var Ege=pn();Ege(Math,"Math",!0)});var nF=P(()=>{"use strict";var Sge=ge(),Ige=eb();Sge({target:"Math",stat:!0},{trunc:Ige})});var $p=P((dWe,oF)=>{"use strict";var Age=pt();oF.exports=Age(1 .valueOf)});var Gp=P((pWe,aF)=>{"use strict";aF.exports=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`});var Fu=P((mWe,lF)=>{"use strict";var Oge=pt(),Cge=ei(),Pge=Qt(),dT=Gp(),sF=Oge("".replace),Mge=RegExp("^["+dT+"]+"),qge=RegExp("(^|[^"+dT+"])["+dT+"]+$"),fT=function(a){return function(i){var l=Pge(Cge(i));return a&1&&(l=sF(l,Mge,"")),a&2&&(l=sF(l,qge,"$1")),l}};lF.exports={start:fT(1),end:fT(2),trim:fT(3)}});var mF=P(()=>{"use strict";var Rge=ge(),pT=fi(),Dge=Vt(),hF=It(),mT=Ky(),fF=pt(),Lge=uh(),uF=yr(),kge=ll(),Bge=Mn(),zge=rl(),dF=fp(),Fge=ct(),Nge=nl().f,Uge=nn().f,jge=ri().f,Vge=$p(),$ge=Fu().trim,Wp="Number",Ah=hF[Wp],cF=mT[Wp],_T=Ah.prototype,Gge=hF.TypeError,Wge=fF("".slice),Hg=fF("".charCodeAt),Zge=function(a){var i=dF(a,"number");return typeof i=="bigint"?i:Hge(i)},Hge=function(a){var i=dF(a,"number"),l,o,c,t,v,S,C,D;if(zge(i))throw new Gge("Cannot convert a Symbol value to a number");if(typeof i=="string"&&i.length>2){if(i=$ge(i),l=Hg(i,0),l===43||l===45){if(o=Hg(i,2),o===88||o===120)return NaN}else if(l===48){switch(Hg(i,1)){case 66:case 98:c=2,t=49;break;case 79:case 111:c=8,t=55;break;default:return+i}for(v=Wge(i,2),S=v.length,C=0;C<S;C++)if(D=Hg(v,C),D<48||D>t)return NaN;return parseInt(v,c)}}return+i},yT=Lge(Wp,!Ah(" 0o1")||!Ah("0b1")||Ah("+0x1")),Xge=function(a){return Bge(_T,a)&&Fge(function(){Vge(a)})},Xg=function(i){var l=arguments.length<1?0:Ah(Zge(i));return Xge(this)?kge(Object(l),this,Xg):l};Xg.prototype=_T;yT&&!pT&&(_T.constructor=Xg);Rge({global:!0,constructor:!0,wrap:!0,forced:yT},{Number:Xg});var pF=function(a,i){for(var l=Dge?Nge(i):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),o=0,c;l.length>o;o++)uF(i,c=l[o])&&!uF(a,c)&&jge(a,c,Uge(i,c))};pT&&cF&&pF(mT[Wp],cF);(yT||pT)&&pF(mT[Wp],Ah)});var _F=P(()=>{"use strict";var Kge=ge();Kge({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)})});var gF=P((xWe,yF)=>{"use strict";var Yge=It(),Jge=Yge.isFinite;yF.exports=Number.isFinite||function(i){return typeof i=="number"&&Jge(i)}});var vF=P(()=>{"use strict";var Qge=ge(),eve=gF();Qge({target:"Number",stat:!0},{isFinite:eve})});var Kg=P((TWe,xF)=>{"use strict";var tve=ur(),rve=Math.floor;xF.exports=Number.isInteger||function(i){return!tve(i)&&isFinite(i)&&rve(i)===i}});var bF=P(()=>{"use strict";var ive=ge(),nve=Kg();ive({target:"Number",stat:!0},{isInteger:nve})});var wF=P(()=>{"use strict";var ove=ge();ove({target:"Number",stat:!0},{isNaN:function(i){return i!==i}})});var TF=P(()=>{"use strict";var ave=ge(),sve=Kg(),lve=Math.abs;ave({target:"Number",stat:!0},{isSafeInteger:function(i){return sve(i)&&lve(i)<=9007199254740991}})});var EF=P(()=>{"use strict";var uve=ge();uve({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991})});var SF=P(()=>{"use strict";var cve=ge();cve({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991})});var gT=P((DWe,CF)=>{"use strict";var OF=It(),hve=ct(),fve=pt(),dve=Qt(),pve=Fu().trim,mve=Gp(),_ve=fve("".charAt),Yg=OF.parseFloat,IF=OF.Symbol,AF=IF&&IF.iterator,yve=1/Yg(mve+"-0")!==-1/0||AF&&!hve(function(){Yg(Object(AF))});CF.exports=yve?function(i){var l=pve(dve(i)),o=Yg(l);return o===0&&_ve(l,0)==="-"?-0:o}:Yg});var MF=P(()=>{"use strict";var gve=ge(),PF=gT();gve({target:"Number",stat:!0,forced:Number.parseFloat!==PF},{parseFloat:PF})});var vT=P((BWe,BF)=>{"use strict";var LF=It(),vve=ct(),xve=pt(),bve=Qt(),wve=Fu().trim,qF=Gp(),Zp=LF.parseInt,RF=LF.Symbol,DF=RF&&RF.iterator,kF=/^[+-]?0x/i,Tve=xve(kF.exec),Eve=Zp(qF+"08")!==8||Zp(qF+"0x16")!==22||DF&&!vve(function(){Zp(Object(DF))});BF.exports=Eve?function(i,l){var o=wve(bve(i));return Zp(o,l>>>0||(Tve(kF,o)?16:10))}:Zp});var FF=P(()=>{"use strict";var Sve=ge(),zF=vT();Sve({target:"Number",stat:!0,forced:Number.parseInt!==zF},{parseInt:zF})});var $F=P(()=>{"use strict";var Ive=ge(),bT=pt(),Ave=_i(),Ove=$p(),Cve=Bp(),Pve=hT(),xT=ct(),Mve=RangeError,NF=String,qve=isFinite,Rve=Math.abs,Dve=Math.floor,UF=Math.pow,Lve=Math.round,Sa=bT(1 .toExponential),kve=bT(Cve),jF=bT("".slice),VF=Sa(-69e-12,4)==="-6.9000e-11"&&Sa(1.255,2)==="1.25e+0"&&Sa(12345,3)==="1.235e+4"&&Sa(25,0)==="3e+1",Bve=function(){return xT(function(){Sa(1,1/0)})&&xT(function(){Sa(1,-1/0)})},zve=function(){return!xT(function(){Sa(1/0,1/0),Sa(NaN,1/0)})},Fve=!VF||!Bve()||!zve();Ive({target:"Number",proto:!0,forced:Fve},{toExponential:function(i){var l=Ove(this);if(i===void 0)return Sa(l);var o=Ave(i);if(!qve(l))return String(l);if(o<0||o>20)throw new Mve("Incorrect fraction digits");if(VF)return Sa(l,o);var c="",t="",v=0,S="",C="";if(l<0&&(c="-",l=-l),l===0)v=0,t=kve("0",o+1);else{var D=Pve(l);v=Dve(D);var z=0,B=UF(10,v-o);z=Lve(l/B),2*l>=(2*z+1)*B&&(z+=1),z>=UF(10,o+1)&&(z/=10,v+=1),t=NF(z)}return o!==0&&(t=jF(t,0,1)+"."+jF(t,1)),v===0?(S="+",C="0"):(S=v>0?"+":"-",C=NF(Rve(v))),t+="e"+S+C,c+t}})});var KF=P(()=>{"use strict";var Nve=ge(),ET=pt(),Uve=_i(),jve=$p(),Vve=Bp(),GF=ct(),$ve=RangeError,HF=String,XF=Math.floor,TT=ET(Vve),WF=ET("".slice),Hp=ET(1 .toFixed),Ch=function(a,i,l){return i===0?l:i%2===1?Ch(a,i-1,l*a):Ch(a*a,i/2,l)},Gve=function(a){for(var i=0,l=a;l>=4096;)i+=12,l/=4096;for(;l>=2;)i+=1,l/=2;return i},Oh=function(a,i,l){for(var o=-1,c=l;++o<6;)c+=i*a[o],a[o]=c%1e7,c=XF(c/1e7)},wT=function(a,i){for(var l=6,o=0;--l>=0;)o+=a[l],a[l]=XF(o/i),o=o%i*1e7},ZF=function(a){for(var i=6,l="";--i>=0;)if(l!==""||i===0||a[i]!==0){var o=HF(a[i]);l=l===""?o:l+TT("0",7-o.length)+o}return l},Wve=GF(function(){return Hp(8e-5,3)!=="0.000"||Hp(.9,0)!=="1"||Hp(1.255,2)!=="1.25"||Hp(0xde0b6b3a7640080,0)!=="1000000000000000128"})||!GF(function(){Hp({})});Nve({target:"Number",proto:!0,forced:Wve},{toFixed:function(i){var l=jve(this),o=Uve(i),c=[0,0,0,0,0,0],t="",v="0",S,C,D,z;if(o<0||o>20)throw new $ve("Incorrect fraction digits");if(l!==l)return"NaN";if(l<=-1e21||l>=1e21)return HF(l);if(l<0&&(t="-",l=-l),l>1e-21)if(S=Gve(l*Ch(2,69,1))-69,C=S<0?l*Ch(2,-S,1):l/Ch(2,S,1),C*=4503599627370496,S=52-S,S>0){for(Oh(c,0,C),D=o;D>=7;)Oh(c,1e7,0),D-=7;for(Oh(c,Ch(10,D,1),0),D=S-1;D>=23;)wT(c,1<<23),D-=23;wT(c,1<<D),Oh(c,1,1),wT(c,2),v=ZF(c)}else Oh(c,0,C),Oh(c,1<<-S,0),v=ZF(c)+TT("0",o);return o>0?(z=v.length,v=t+(z<=o?"0."+TT("0",o-z)+v:WF(v,0,z-o)+"."+WF(v,z-o))):v=t+v,v}})});var QF=P(()=>{"use strict";var Zve=ge(),Hve=pt(),YF=ct(),JF=$p(),Jg=Hve(1 .toPrecision),Xve=YF(function(){return Jg(1,void 0)!=="1"})||!YF(function(){Jg({})});Zve({target:"Number",proto:!0,forced:Xve},{toPrecision:function(i){return i===void 0?Jg(JF(this)):Jg(JF(this),i)}})});var IT=P((WWe,rN)=>{"use strict";var eN=Vt(),Kve=pt(),Yve=rr(),Jve=ct(),ST=ch(),Qve=_p(),e0e=hp(),t0e=Rr(),r0e=wu(),Ph=Object.assign,tN=Object.defineProperty,i0e=Kve([].concat);rN.exports=!Ph||Jve(function(){if(eN&&Ph({b:1},Ph(tN({},"a",{enumerable:!0,get:function(){tN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var a={},i={},l=Symbol("assign detection"),o="abcdefghijklmnopqrst";return a[l]=7,o.split("").forEach(function(c){i[c]=c}),Ph({},a)[l]!==7||ST(Ph({},i)).join("")!==o})?function(i,l){for(var o=t0e(i),c=arguments.length,t=1,v=Qve.f,S=e0e.f;c>t;)for(var C=r0e(arguments[t++]),D=v?i0e(ST(C),v(C)):ST(C),z=D.length,B=0,ne;z>B;)ne=D[B++],(!eN||Yve(S,C,ne))&&(o[ne]=C[ne]);return o}:Ph});var nN=P(()=>{"use strict";var n0e=ge(),iN=IT();n0e({target:"Object",stat:!0,arity:2,forced:Object.assign!==iN},{assign:iN})});var oN=P(()=>{"use strict";var o0e=ge(),a0e=Vt(),s0e=Rn();o0e({target:"Object",stat:!0,sham:!a0e},{create:s0e})});var Xp=P((YWe,sN)=>{"use strict";var l0e=fi(),u0e=It(),c0e=ct(),aN=bg();sN.exports=l0e||!c0e(function(){if(!(aN&&aN<535)){var a=Math.random();__defineSetter__.call(null,a,function(){}),delete u0e[a]}})});var lN=P(()=>{"use strict";var h0e=ge(),f0e=Vt(),d0e=Xp(),p0e=ti(),m0e=Rr(),_0e=ri();f0e&&h0e({target:"Object",proto:!0,forced:d0e},{__defineGetter__:function(i,l){_0e.f(m0e(this),i,{get:p0e(l),enumerable:!0,configurable:!0})}})});var cN=P(()=>{"use strict";var y0e=ge(),g0e=Vt(),uN=Wy().f;y0e({target:"Object",stat:!0,forced:Object.defineProperties!==uN,sham:!g0e},{defineProperties:uN})});var fN=P(()=>{"use strict";var v0e=ge(),x0e=Vt(),hN=ri().f;v0e({target:"Object",stat:!0,forced:Object.defineProperty!==hN,sham:!x0e},{defineProperty:hN})});var dN=P(()=>{"use strict";var b0e=ge(),w0e=Vt(),T0e=Xp(),E0e=ti(),S0e=Rr(),I0e=ri();w0e&&b0e({target:"Object",proto:!0,forced:T0e},{__defineSetter__:function(i,l){I0e.f(S0e(this),i,{set:E0e(l),enumerable:!0,configurable:!0})}})});var AT=P((a7e,gN)=>{"use strict";var mN=Vt(),A0e=ct(),_N=pt(),O0e=Xn(),C0e=ch(),P0e=qi(),M0e=hp().f,yN=_N(M0e),q0e=_N([].push),R0e=mN&&A0e(function(){var a=Object.create(null);return a[2]=2,!yN(a,2)}),pN=function(a){return function(i){for(var l=P0e(i),o=C0e(l),c=R0e&&O0e(l)===null,t=o.length,v=0,S=[],C;t>v;)C=o[v++],(!mN||(c?C in l:yN(l,C)))&&q0e(S,a?[C,l[C]]:l[C]);return S}};gN.exports={entries:pN(!0),values:pN(!1)}});var vN=P(()=>{"use strict";var D0e=ge(),L0e=AT().entries;D0e({target:"Object",stat:!0},{entries:function(i){return L0e(i)}})});var xN=P(()=>{"use strict";var k0e=ge(),B0e=zu(),z0e=ct(),F0e=ur(),N0e=ml().onFreeze,OT=Object.freeze,U0e=z0e(function(){OT(1)});k0e({target:"Object",stat:!0,forced:U0e,sham:!B0e},{freeze:function(i){return OT&&F0e(i)?OT(N0e(i)):i}})});var bN=P(()=>{"use strict";var j0e=ge(),V0e=Kn(),$0e=as();j0e({target:"Object",stat:!0},{fromEntries:function(i){var l={};return V0e(i,function(o,c){$0e(l,o,c)},{AS_ENTRIES:!0}),l}})});var EN=P(()=>{"use strict";var G0e=ge(),W0e=ct(),Z0e=qi(),wN=nn().f,TN=Vt(),H0e=!TN||W0e(function(){wN(1)});G0e({target:"Object",stat:!0,forced:H0e,sham:!TN},{getOwnPropertyDescriptor:function(i,l){return wN(Z0e(i),l)}})});var SN=P(()=>{"use strict";var X0e=ge(),K0e=Vt(),Y0e=jy(),J0e=qi(),Q0e=nn(),exe=as();X0e({target:"Object",stat:!0,sham:!K0e},{getOwnPropertyDescriptors:function(i){for(var l=J0e(i),o=Q0e.f,c=Y0e(l),t={},v=0,S,C;c.length>v;)C=o(l,S=c[v++]),C!==void 0&&exe(t,S,C);return t}})});var IN=P(()=>{"use strict";var txe=ge(),rxe=ct(),ixe=Xy().f,nxe=rxe(function(){return!Object.getOwnPropertyNames(1)});txe({target:"Object",stat:!0,forced:nxe},{getOwnPropertyNames:ixe})});var ON=P(()=>{"use strict";var oxe=ge(),axe=ct(),sxe=Rr(),AN=Xn(),lxe=lg(),uxe=axe(function(){AN(1)});oxe({target:"Object",stat:!0,forced:uxe,sham:!lxe},{getPrototypeOf:function(i){return AN(sxe(i))}})});var CN=P(()=>{"use strict";var cxe=ge(),hxe=Wr(),fxe=pt(),dxe=ti(),pxe=ei(),mxe=rs(),_xe=Kn(),yxe=hxe("Object","create"),gxe=fxe([].push);cxe({target:"Object",stat:!0},{groupBy:function(i,l){pxe(i),dxe(l);var o=yxe(null),c=0;return _xe(i,function(t){var v=mxe(l(t,c++));v in o?gxe(o[v],t):o[v]=[t]}),o}})});var PN=P(()=>{"use strict";var vxe=ge(),xxe=yr();vxe({target:"Object",stat:!0},{hasOwn:xxe})});var CT=P((S7e,MN)=>{"use strict";MN.exports=Object.is||function(i,l){return i===l?i!==0||1/i===1/l:i!==i&&l!==l}});var qN=P(()=>{"use strict";var bxe=ge(),wxe=CT();bxe({target:"Object",stat:!0},{is:wxe})});var DN=P(()=>{"use strict";var Txe=ge(),RN=$g();Txe({target:"Object",stat:!0,forced:Object.isExtensible!==RN},{isExtensible:RN})});var kN=P(()=>{"use strict";var Exe=ge(),Sxe=ct(),Ixe=ur(),Axe=Gi(),LN=jg(),PT=Object.isFrozen,Oxe=LN||Sxe(function(){PT(1)});Exe({target:"Object",stat:!0,forced:Oxe},{isFrozen:function(i){return!Ixe(i)||LN&&Axe(i)==="ArrayBuffer"?!0:PT?PT(i):!1}})});var zN=P(()=>{"use strict";var Cxe=ge(),Pxe=ct(),Mxe=ur(),qxe=Gi(),BN=jg(),MT=Object.isSealed,Rxe=BN||Pxe(function(){MT(1)});Cxe({target:"Object",stat:!0,forced:Rxe},{isSealed:function(i){return!Mxe(i)||BN&&qxe(i)==="ArrayBuffer"?!0:MT?MT(i):!1}})});var NN=P(()=>{"use strict";var Dxe=ge(),Lxe=Rr(),FN=ch(),kxe=ct(),Bxe=kxe(function(){FN(1)});Dxe({target:"Object",stat:!0,forced:Bxe},{keys:function(i){return FN(Lxe(i))}})});var UN=P(()=>{"use strict";var zxe=ge(),Fxe=Vt(),Nxe=Xp(),Uxe=Rr(),jxe=rs(),Vxe=Xn(),$xe=nn().f;Fxe&&zxe({target:"Object",proto:!0,forced:Nxe},{__lookupGetter__:function(i){var l=Uxe(this),o=jxe(i),c;do if(c=$xe(l,o))return c.get;while(l=Vxe(l))}})});var jN=P(()=>{"use strict";var Gxe=ge(),Wxe=Vt(),Zxe=Xp(),Hxe=Rr(),Xxe=rs(),Kxe=Xn(),Yxe=nn().f;Wxe&&Gxe({target:"Object",proto:!0,forced:Zxe},{__lookupSetter__:function(i){var l=Hxe(this),o=Xxe(i),c;do if(c=Yxe(l,o))return c.set;while(l=Kxe(l))}})});var VN=P(()=>{"use strict";var Jxe=ge(),Qxe=ur(),e1e=ml().onFreeze,t1e=zu(),r1e=ct(),qT=Object.preventExtensions,i1e=r1e(function(){qT(1)});Jxe({target:"Object",stat:!0,forced:i1e,sham:!t1e},{preventExtensions:function(i){return qT&&Qxe(i)?qT(e1e(i)):i}})});var HN=P(()=>{"use strict";var n1e=Vt(),o1e=Ri(),a1e=ur(),s1e=Ib(),l1e=Rr(),u1e=ei(),$N=Object.getPrototypeOf,GN=Object.setPrototypeOf,WN=Object.prototype,ZN="__proto__";if(n1e&&$N&&GN&&!(ZN in WN))try{o1e(WN,ZN,{configurable:!0,get:function(){return $N(l1e(this))},set:function(i){var l=u1e(this);s1e(i)&&a1e(l)&&GN(l,i)}})}catch{}});var XN=P(()=>{"use strict";var c1e=ge(),h1e=ur(),f1e=ml().onFreeze,d1e=zu(),p1e=ct(),RT=Object.seal,m1e=p1e(function(){RT(1)});c1e({target:"Object",stat:!0,forced:m1e,sham:!d1e},{seal:function(i){return RT&&h1e(i)?RT(f1e(i)):i}})});var KN=P(()=>{"use strict";var _1e=ge(),y1e=Ho();_1e({target:"Object",stat:!0},{setPrototypeOf:y1e})});var JN=P((H7e,YN)=>{"use strict";var g1e=$y(),v1e=Zo();YN.exports=g1e?{}.toString:function(){return"[object "+v1e(this)+"]"}});var QN=P(()=>{"use strict";var x1e=$y(),b1e=Kr(),w1e=JN();x1e||b1e(Object.prototype,"toString",w1e,{unsafe:!0})});var eU=P(()=>{"use strict";var T1e=ge(),E1e=AT().values;T1e({target:"Object",stat:!0},{values:function(i){return E1e(i)}})});var rU=P(()=>{"use strict";var S1e=ge(),tU=gT();S1e({global:!0,forced:parseFloat!==tU},{parseFloat:tU})});var nU=P(()=>{"use strict";var I1e=ge(),iU=vT();I1e({global:!0,forced:parseInt!==iU},{parseInt:iU})});var mo=P((iZe,oU)=>{"use strict";var A1e=TypeError;oU.exports=function(a,i){if(a<i)throw new A1e("Not enough arguments");return a}});var DT=P((nZe,aU)=>{"use strict";var O1e=ya();aU.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(O1e)});var Jp=P((oZe,mU)=>{"use strict";var Jn=It(),C1e=po(),P1e=ho(),sU=_r(),M1e=yr(),pU=ct(),lU=ib(),q1e=co(),uU=dp(),R1e=mo(),D1e=DT(),L1e=ls(),NT=Jn.setImmediate,UT=Jn.clearImmediate,k1e=Jn.process,LT=Jn.Dispatch,B1e=Jn.Function,cU=Jn.MessageChannel,z1e=Jn.String,kT=0,Kp={},hU="onreadystatechange",Yp,Nu,BT,zT;pU(function(){Yp=Jn.location});var jT=function(a){if(M1e(Kp,a)){var i=Kp[a];delete Kp[a],i()}},FT=function(a){return function(){jT(a)}},fU=function(a){jT(a.data)},dU=function(a){Jn.postMessage(z1e(a),Yp.protocol+"//"+Yp.host)};(!NT||!UT)&&(NT=function(i){R1e(arguments.length,1);var l=sU(i)?i:B1e(i),o=q1e(arguments,1);return Kp[++kT]=function(){C1e(l,void 0,o)},Nu(kT),kT},UT=function(i){delete Kp[i]},L1e?Nu=function(a){k1e.nextTick(FT(a))}:LT&&LT.now?Nu=function(a){LT.now(FT(a))}:cU&&!D1e?(BT=new cU,zT=BT.port2,BT.port1.onmessage=fU,Nu=P1e(zT.postMessage,zT)):Jn.addEventListener&&sU(Jn.postMessage)&&!Jn.importScripts&&Yp&&Yp.protocol!=="file:"&&!pU(dU)?(Nu=dU,Jn.addEventListener("message",fU,!1)):hU in uU("script")?Nu=function(a){lU.appendChild(uU("script"))[hU]=function(){lU.removeChild(this),jT(a)}}:Nu=function(a){setTimeout(FT(a),0)});mU.exports={set:NT,clear:UT}});var VT=P((aZe,yU)=>{"use strict";var _U=It(),F1e=Vt(),N1e=Object.getOwnPropertyDescriptor;yU.exports=function(a){if(!F1e)return _U[a];var i=N1e(_U,a);return i&&i.value}});var $T=P((sZe,vU)=>{"use strict";var gU=function(){this.head=null,this.tail=null};gU.prototype={add:function(a){var i={item:a,next:null},l=this.tail;l?l.next=i:this.head=i,this.tail=i},get:function(){var a=this.head;if(a){var i=this.head=a.next;return i===null&&(this.tail=null),a.item}}};vU.exports=gU});var bU=P((lZe,xU)=>{"use strict";var U1e=ya();xU.exports=/ipad|iphone|ipod/i.test(U1e)&&typeof Pebble<"u"});var TU=P((uZe,wU)=>{"use strict";var j1e=ya();wU.exports=/web0s(?!.*chrome)/i.test(j1e)});var KT=P((cZe,CU)=>{"use strict";var qh=It(),V1e=VT(),EU=ho(),GT=Jp().set,$1e=$T(),G1e=DT(),W1e=bU(),Z1e=TU(),WT=ls(),SU=qh.MutationObserver||qh.WebKitMutationObserver,IU=qh.document,AU=qh.process,Qg=qh.Promise,XT=V1e("queueMicrotask"),Mh,ZT,HT,ev,OU;XT||(Qp=new $1e,em=function(){var a,i;for(WT&&(a=AU.domain)&&a.exit();i=Qp.get();)try{i()}catch(l){throw Qp.head&&Mh(),l}a&&a.enter()},!G1e&&!WT&&!Z1e&&SU&&IU?(ZT=!0,HT=IU.createTextNode(""),new SU(em).observe(HT,{characterData:!0}),Mh=function(){HT.data=ZT=!ZT}):!W1e&&Qg&&Qg.resolve?(ev=Qg.resolve(void 0),ev.constructor=Qg,OU=EU(ev.then,ev),Mh=function(){OU(em)}):WT?Mh=function(){AU.nextTick(em)}:(GT=EU(GT,qh),Mh=function(){GT(em)}),XT=function(a){Qp.head||Mh(),Qp.add(a)});var Qp,em;CU.exports=XT});var MU=P((hZe,PU)=>{"use strict";PU.exports=function(a,i){try{arguments.length===1?console.error(a):console.error(a,i)}catch{}}});var Rh=P((fZe,qU)=>{"use strict";qU.exports=function(a){try{return{error:!1,value:a()}}catch(i){return{error:!0,value:i}}}});var Uu=P((dZe,RU)=>{"use strict";var H1e=It();RU.exports=H1e.Promise});var Dh=P((pZe,kU)=>{"use strict";var X1e=It(),tm=Uu(),K1e=_r(),Y1e=uh(),J1e=Ly(),Q1e=pr(),ebe=kw(),tbe=kg(),rbe=fi(),YT=ga(),DU=tm&&tm.prototype,ibe=Q1e("species"),JT=!1,LU=K1e(X1e.PromiseRejectionEvent),nbe=Y1e("Promise",function(){var a=J1e(tm),i=a!==String(tm);if(!i&&YT===66||rbe&&!(DU.catch&&DU.finally))return!0;if(!YT||YT<51||!/native code/.test(a)){var l=new tm(function(t){t(1)}),o=function(t){t(function(){},function(){})},c=l.constructor={};if(c[ibe]=o,JT=l.then(function(){})instanceof o,!JT)return!0}return!i&&(ebe||tbe)&&!LU});kU.exports={CONSTRUCTOR:nbe,REJECTION_EVENT:LU,SUBCLASSING:JT}});var ps=P((mZe,zU)=>{"use strict";var BU=ti(),obe=TypeError,abe=function(a){var i,l;this.promise=new a(function(o,c){if(i!==void 0||l!==void 0)throw new obe("Bad Promise constructor");i=o,l=c}),this.resolve=BU(i),this.reject=BU(l)};zU.exports.f=function(a){return new abe(a)}});var i4=P(()=>{"use strict";var sbe=ge(),lbe=fi(),nv=ls(),_l=It(),zh=rr(),FU=Kr(),NU=Ho(),ube=pn(),cbe=Du(),hbe=ti(),iv=_r(),fbe=ur(),dbe=Xo(),pbe=ku(),GU=Jp().set,iE=KT(),mbe=MU(),_be=Rh(),ybe=$T(),WU=Ai(),ov=Uu(),nE=Dh(),ZU=ps(),av="Promise",HU=nE.CONSTRUCTOR,gbe=nE.REJECTION_EVENT,vbe=nE.SUBCLASSING,QT=WU.getterFor(av),xbe=WU.set,Lh=ov&&ov.prototype,ju=ov,tv=Lh,XU=_l.TypeError,eE=_l.document,oE=_l.process,tE=ZU.f,bbe=tE,wbe=!!(eE&&eE.createEvent&&_l.dispatchEvent),KU="unhandledrejection",Tbe="rejectionhandled",UU=0,YU=1,Ebe=2,aE=1,JU=2,rv,jU,Sbe,VU,QU=function(a){var i;return fbe(a)&&iv(i=a.then)?i:!1},e4=function(a,i){var l=i.value,o=i.state===YU,c=o?a.ok:a.fail,t=a.resolve,v=a.reject,S=a.domain,C,D,z;try{c?(o||(i.rejection===JU&&Abe(i),i.rejection=aE),c===!0?C=l:(S&&S.enter(),C=c(l),S&&(S.exit(),z=!0)),C===a.promise?v(new XU("Promise-chain cycle")):(D=QU(C))?zh(D,C,t,v):t(C)):v(l)}catch(B){S&&!z&&S.exit(),v(B)}},t4=function(a,i){a.notified||(a.notified=!0,iE(function(){for(var l=a.reactions,o;o=l.get();)e4(o,a);a.notified=!1,i&&!a.rejection&&Ibe(a)}))},r4=function(a,i,l){var o,c;wbe?(o=eE.createEvent("Event"),o.promise=i,o.reason=l,o.initEvent(a,!1,!0),_l.dispatchEvent(o)):o={promise:i,reason:l},!gbe&&(c=_l["on"+a])?c(o):a===KU&&mbe("Unhandled promise rejection",l)},Ibe=function(a){zh(GU,_l,function(){var i=a.facade,l=a.value,o=$U(a),c;if(o&&(c=_be(function(){nv?oE.emit("unhandledRejection",l,i):r4(KU,i,l)}),a.rejection=nv||$U(a)?JU:aE,c.error))throw c.value})},$U=function(a){return a.rejection!==aE&&!a.parent},Abe=function(a){zh(GU,_l,function(){var i=a.facade;nv?oE.emit("rejectionHandled",i):r4(Tbe,i,a.value)})},kh=function(a,i,l){return function(o){a(i,o,l)}},Bh=function(a,i,l){a.done||(a.done=!0,l&&(a=l),a.value=i,a.state=Ebe,t4(a,!0))},rE=function(a,i,l){if(!a.done){a.done=!0,l&&(a=l);try{if(a.facade===i)throw new XU("Promise can't be resolved itself");var o=QU(i);o?iE(function(){var c={done:!1};try{zh(o,i,kh(rE,c,a),kh(Bh,c,a))}catch(t){Bh(c,t,a)}}):(a.value=i,a.state=YU,t4(a,!1))}catch(c){Bh({done:!1},c,a)}}};if(HU&&(ju=function(i){dbe(this,tv),hbe(i),zh(rv,this);var l=QT(this);try{i(kh(rE,l),kh(Bh,l))}catch(o){Bh(l,o)}},tv=ju.prototype,rv=function(i){xbe(this,{type:av,done:!1,notified:!1,parent:!1,reactions:new ybe,rejection:!1,state:UU,value:void 0})},rv.prototype=FU(tv,"then",function(i,l){var o=QT(this),c=tE(pbe(this,ju));return o.parent=!0,c.ok=iv(i)?i:!0,c.fail=iv(l)&&l,c.domain=nv?oE.domain:void 0,o.state===UU?o.reactions.add(c):iE(function(){e4(c,o)}),c.promise}),jU=function(){var a=new rv,i=QT(a);this.promise=a,this.resolve=kh(rE,i),this.reject=kh(Bh,i)},ZU.f=tE=function(a){return a===ju||a===Sbe?new jU(a):bbe(a)},!lbe&&iv(ov)&&Lh!==Object.prototype)){VU=Lh.then,vbe||FU(Lh,"then",function(i,l){var o=this;return new ju(function(c,t){zh(VU,o,c,t)}).then(i,l)},{unsafe:!0});try{delete Lh.constructor}catch{}NU&&NU(Lh,tv)}sbe({global:!0,constructor:!0,wrap:!0,forced:HU},{Promise:ju});ube(ju,av,!1,!0);cbe(av)});var rm=P((gZe,n4)=>{"use strict";var Obe=Uu(),Cbe=Op(),Pbe=Dh().CONSTRUCTOR;n4.exports=Pbe||!Cbe(function(a){Obe.all(a).then(void 0,function(){})})});var o4=P(()=>{"use strict";var Mbe=ge(),qbe=rr(),Rbe=ti(),Dbe=ps(),Lbe=Rh(),kbe=Kn(),Bbe=rm();Mbe({target:"Promise",stat:!0,forced:Bbe},{all:function(i){var l=this,o=Dbe.f(l),c=o.resolve,t=o.reject,v=Lbe(function(){var S=Rbe(l.resolve),C=[],D=0,z=1;kbe(i,function(B){var ne=D++,pe=!1;z++,qbe(S,l,B).then(function($e){pe||(pe=!0,C[ne]=$e,--z||c(C))},t)}),--z||c(C)});return v.error&&t(v.value),o.promise}})});var s4=P(()=>{"use strict";var zbe=ge(),Fbe=fi(),Nbe=Dh().CONSTRUCTOR,lE=Uu(),Ube=Wr(),jbe=_r(),Vbe=Kr(),a4=lE&&lE.prototype;zbe({target:"Promise",proto:!0,forced:Nbe,real:!0},{catch:function(a){return this.then(void 0,a)}});!Fbe&&jbe(lE)&&(sE=Ube("Promise").prototype.catch,a4.catch!==sE&&Vbe(a4,"catch",sE,{unsafe:!0}));var sE});var l4=P(()=>{"use strict";var $be=ge(),Gbe=rr(),Wbe=ti(),Zbe=ps(),Hbe=Rh(),Xbe=Kn(),Kbe=rm();$be({target:"Promise",stat:!0,forced:Kbe},{race:function(i){var l=this,o=Zbe.f(l),c=o.reject,t=Hbe(function(){var v=Wbe(l.resolve);Xbe(i,function(S){Gbe(v,l,S).then(o.resolve,c)})});return t.error&&c(t.value),o.promise}})});var u4=P(()=>{"use strict";var Ybe=ge(),Jbe=ps(),Qbe=Dh().CONSTRUCTOR;Ybe({target:"Promise",stat:!0,forced:Qbe},{reject:function(i){var l=Jbe.f(this),o=l.reject;return o(i),l.promise}})});var uE=P((AZe,c4)=>{"use strict";var ewe=ir(),twe=ur(),rwe=ps();c4.exports=function(a,i){if(ewe(a),twe(i)&&i.constructor===a)return i;var l=rwe.f(a),o=l.resolve;return o(i),l.promise}});var d4=P(()=>{"use strict";var iwe=ge(),nwe=Wr(),h4=fi(),owe=Uu(),f4=Dh().CONSTRUCTOR,awe=uE(),swe=nwe("Promise"),lwe=h4&&!f4;iwe({target:"Promise",stat:!0,forced:h4||f4},{resolve:function(i){return awe(lwe&&this===swe?owe:this,i)}})});var p4=P(()=>{"use strict";i4();o4();s4();l4();u4();d4()});var m4=P(()=>{"use strict";var uwe=ge(),cwe=rr(),hwe=ti(),fwe=ps(),dwe=Rh(),pwe=Kn(),mwe=rm();uwe({target:"Promise",stat:!0,forced:mwe},{allSettled:function(i){var l=this,o=fwe.f(l),c=o.resolve,t=o.reject,v=dwe(function(){var S=hwe(l.resolve),C=[],D=0,z=1;pwe(i,function(B){var ne=D++,pe=!1;z++,cwe(S,l,B).then(function($e){pe||(pe=!0,C[ne]={status:"fulfilled",value:$e},--z||c(C))},function($e){pe||(pe=!0,C[ne]={status:"rejected",reason:$e},--z||c(C))})}),--z||c(C)});return v.error&&t(v.value),o.promise}})});var y4=P(()=>{"use strict";var _we=ge(),ywe=rr(),gwe=ti(),vwe=Wr(),xwe=ps(),bwe=Rh(),wwe=Kn(),Twe=rm(),_4="No one promise resolved";_we({target:"Promise",stat:!0,forced:Twe},{any:function(i){var l=this,o=vwe("AggregateError"),c=xwe.f(l),t=c.resolve,v=c.reject,S=bwe(function(){var C=gwe(l.resolve),D=[],z=0,B=1,ne=!1;wwe(i,function(pe){var $e=z++,Ae=!1;B++,ywe(C,l,pe).then(function(ke){Ae||ne||(ne=!0,t(ke))},function(ke){Ae||ne||(Ae=!0,D[$e]=ke,--B||v(new o(D,_4)))})}),--B||v(new o(D,_4))});return S.error&&v(S.value),c.promise}})});var b4=P(()=>{"use strict";var Ewe=ge(),Swe=fi(),sv=Uu(),Iwe=ct(),v4=Wr(),x4=_r(),Awe=ku(),g4=uE(),Owe=Kr(),hE=sv&&sv.prototype,Cwe=!!sv&&Iwe(function(){hE.finally.call({then:function(){}},function(){})});Ewe({target:"Promise",proto:!0,real:!0,forced:Cwe},{finally:function(a){var i=Awe(this,v4("Promise")),l=x4(a);return this.then(l?function(o){return g4(i,a()).then(function(){return o})}:a,l?function(o){return g4(i,a()).then(function(){throw o})}:a)}});!Swe&&x4(sv)&&(cE=v4("Promise").prototype.finally,hE.finally!==cE&&Owe(hE,"finally",cE,{unsafe:!0}));var cE});var w4=P(()=>{"use strict";var Pwe=ge(),Mwe=ps();Pwe({target:"Promise",stat:!0},{withResolvers:function(){var i=Mwe.f(this);return{promise:i.promise,resolve:i.resolve,reject:i.reject}}})});var T4=P(()=>{"use strict";var qwe=ge(),Rwe=po(),Dwe=ti(),Lwe=ir(),kwe=ct(),Bwe=!kwe(function(){Reflect.apply(function(){})});qwe({target:"Reflect",stat:!0,forced:Bwe},{apply:function(i,l,o){return Rwe(Dwe(i),l,Lwe(o))}})});var P4=P(()=>{"use strict";var zwe=ge(),Fwe=Wr(),fE=po(),Nwe=Yw(),E4=Lg(),Uwe=ir(),S4=ur(),jwe=Rn(),A4=ct(),dE=Fwe("Reflect","construct"),Vwe=Object.prototype,$we=[].push,O4=A4(function(){function a(){}return!(dE(function(){},[],a)instanceof a)}),C4=!A4(function(){dE(function(){})}),I4=O4||C4;zwe({target:"Reflect",stat:!0,forced:I4,sham:I4},{construct:function(i,l){E4(i),Uwe(l);var o=arguments.length<3?i:E4(arguments[2]);if(C4&&!O4)return dE(i,l,o);if(i===o){switch(l.length){case 0:return new i;case 1:return new i(l[0]);case 2:return new i(l[0],l[1]);case 3:return new i(l[0],l[1],l[2]);case 4:return new i(l[0],l[1],l[2],l[3])}var c=[null];return fE($we,c,l),new(fE(Nwe,i,c))}var t=o.prototype,v=jwe(S4(t)?t:Vwe),S=fE(i,v,l);return S4(S)?S:v}})});var R4=P(()=>{"use strict";var Gwe=ge(),Wwe=Vt(),M4=ir(),Zwe=rs(),q4=ri(),Hwe=ct(),Xwe=Hwe(function(){Reflect.defineProperty(q4.f({},1,{value:1}),1,{value:2})});Gwe({target:"Reflect",stat:!0,forced:Xwe,sham:!Wwe},{defineProperty:function(i,l,o){M4(i);var c=Zwe(l);M4(o);try{return q4.f(i,c,o),!0}catch{return!1}}})});var D4=P(()=>{"use strict";var Kwe=ge(),Ywe=ir(),Jwe=nn().f;Kwe({target:"Reflect",stat:!0},{deleteProperty:function(i,l){var o=Jwe(Ywe(i),l);return o&&!o.configurable?!1:delete i[l]}})});var pE=P((HZe,k4)=>{"use strict";var L4=yr();k4.exports=function(a){return a!==void 0&&(L4(a,"value")||L4(a,"writable"))}});var z4=P(()=>{"use strict";var Qwe=ge(),eTe=rr(),tTe=ur(),rTe=ir(),iTe=pE(),nTe=nn(),oTe=Xn();function B4(a,i){var l=arguments.length<3?a:arguments[2],o,c;if(rTe(a)===l)return a[i];if(o=nTe.f(a,i),o)return iTe(o)?o.value:o.get===void 0?void 0:eTe(o.get,l);if(tTe(c=oTe(a)))return B4(c,i,l)}Qwe({target:"Reflect",stat:!0},{get:B4})});var F4=P(()=>{"use strict";var aTe=ge(),sTe=Vt(),lTe=ir(),uTe=nn();aTe({target:"Reflect",stat:!0,sham:!sTe},{getOwnPropertyDescriptor:function(i,l){return uTe.f(lTe(i),l)}})});var N4=P(()=>{"use strict";var cTe=ge(),hTe=ir(),fTe=Xn(),dTe=lg();cTe({target:"Reflect",stat:!0,sham:!dTe},{getPrototypeOf:function(i){return fTe(hTe(i))}})});var U4=P(()=>{"use strict";var pTe=ge();pTe({target:"Reflect",stat:!0},{has:function(i,l){return l in i}})});var j4=P(()=>{"use strict";var mTe=ge(),_Te=ir(),yTe=$g();mTe({target:"Reflect",stat:!0},{isExtensible:function(i){return _Te(i),yTe(i)}})});var V4=P(()=>{"use strict";var gTe=ge(),vTe=jy();gTe({target:"Reflect",stat:!0},{ownKeys:vTe})});var $4=P(()=>{"use strict";var xTe=ge(),bTe=Wr(),wTe=ir(),TTe=zu();xTe({target:"Reflect",stat:!0,sham:!TTe},{preventExtensions:function(i){wTe(i);try{var l=bTe("Object","preventExtensions");return l&&l(i),!0}catch{return!1}}})});var X4=P(()=>{"use strict";var ETe=ge(),STe=rr(),ITe=ir(),G4=ur(),ATe=pE(),OTe=ct(),mE=ri(),W4=nn(),CTe=Xn(),Z4=Hn();function H4(a,i,l){var o=arguments.length<4?a:arguments[3],c=W4.f(ITe(a),i),t,v,S;if(!c){if(G4(v=CTe(a)))return H4(v,i,l,o);c=Z4(0)}if(ATe(c)){if(c.writable===!1||!G4(o))return!1;if(t=W4.f(o,i)){if(t.get||t.set||t.writable===!1)return!1;t.value=l,mE.f(o,i,t)}else mE.f(o,i,Z4(0,l))}else{if(S=c.set,S===void 0)return!1;STe(S,o,l)}return!0}var PTe=OTe(function(){var a=function(){},i=mE.f(new a,"a",{configurable:!0});return Reflect.set(a.prototype,"a",1,i)!==!1});ETe({target:"Reflect",stat:!0,forced:PTe},{set:H4})});var Y4=P(()=>{"use strict";var MTe=ge(),qTe=ir(),RTe=Ab(),K4=Ho();K4&&MTe({target:"Reflect",stat:!0},{setPrototypeOf:function(i,l){qTe(i),RTe(l);try{return K4(i,l),!0}catch{return!1}}})});var J4=P(()=>{"use strict";var DTe=ge(),LTe=It(),kTe=pn();DTe({global:!0},{Reflect:{}});kTe(LTe.Reflect,"Reflect",!0)});var im=P((mHe,Q4)=>{"use strict";var BTe=ur(),zTe=Gi(),FTe=pr(),NTe=FTe("match");Q4.exports=function(a){var i;return BTe(a)&&((i=a[NTe])!==void 0?!!i:zTe(a)==="RegExp")}});var lv=P((_He,e5)=>{"use strict";var UTe=ir();e5.exports=function(){var a=UTe(this),i="";return a.hasIndices&&(i+="d"),a.global&&(i+="g"),a.ignoreCase&&(i+="i"),a.multiline&&(i+="m"),a.dotAll&&(i+="s"),a.unicode&&(i+="u"),a.unicodeSets&&(i+="v"),a.sticky&&(i+="y"),i}});var Fh=P((yHe,r5)=>{"use strict";var jTe=rr(),VTe=yr(),$Te=Mn(),GTe=lv(),t5=RegExp.prototype;r5.exports=function(a){var i=a.flags;return i===void 0&&!("flags"in t5)&&!VTe(a,"flags")&&$Te(t5,a)?jTe(GTe,a):i}});var nm=P((gHe,i5)=>{"use strict";var _E=ct(),WTe=It(),yE=WTe.RegExp,gE=_E(function(){var a=yE("a","y");return a.lastIndex=2,a.exec("abcd")!==null}),ZTe=gE||_E(function(){return!yE("a","y").sticky}),HTe=gE||_E(function(){var a=yE("^r","gy");return a.lastIndex=2,a.exec("str")!==null});i5.exports={BROKEN_CARET:HTe,MISSED_STICKY:ZTe,UNSUPPORTED_Y:gE}});var uv=P((vHe,n5)=>{"use strict";var XTe=ct(),KTe=It(),YTe=KTe.RegExp;n5.exports=XTe(function(){var a=YTe(".","s");return!(a.dotAll&&a.test(`
`)&&a.flags==="s")})});var vE=P((xHe,o5)=>{"use strict";var JTe=ct(),QTe=It(),eEe=QTe.RegExp;o5.exports=JTe(function(){var a=eEe("(?<a>b)","g");return a.exec("b").groups.a!=="b"||"b".replace(a,"$<a>c")!=="bc"})});var p5=P(()=>{"use strict";var tEe=Vt(),TE=It(),om=pt(),rEe=uh(),iEe=ll(),nEe=on(),oEe=Rn(),aEe=nl().f,a5=Mn(),sEe=im(),s5=Qt(),lEe=Fh(),c5=nm(),uEe=Ob(),cEe=Kr(),hEe=ct(),fEe=yr(),dEe=Ai().enforce,pEe=Du(),mEe=pr(),h5=uv(),f5=vE(),_Ee=mEe("match"),gl=TE.RegExp,Nh=gl.prototype,yEe=TE.SyntaxError,gEe=om(Nh.exec),cv=om("".charAt),l5=om("".replace),u5=om("".indexOf),vEe=om("".slice),xEe=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Vu=/a/g,xE=/a/g,bEe=new gl(Vu)!==Vu,d5=c5.MISSED_STICKY,wEe=c5.UNSUPPORTED_Y,TEe=tEe&&(!bEe||d5||h5||f5||hEe(function(){return xE[_Ee]=!1,gl(Vu)!==Vu||gl(xE)===xE||String(gl(Vu,"i"))!=="/a/i"})),EEe=function(a){for(var i=a.length,l=0,o="",c=!1,t;l<=i;l++){if(t=cv(a,l),t==="\\"){o+=t+cv(a,++l);continue}!c&&t==="."?o+="[\\s\\S]":(t==="["?c=!0:t==="]"&&(c=!1),o+=t)}return o},SEe=function(a){for(var i=a.length,l=0,o="",c=[],t=oEe(null),v=!1,S=!1,C=0,D="",z;l<=i;l++){if(z=cv(a,l),z==="\\")z+=cv(a,++l);else if(z==="]")v=!1;else if(!v)switch(!0){case z==="[":v=!0;break;case z==="(":gEe(xEe,vEe(a,l+1))&&(l+=2,S=!0),o+=z,C++;continue;case(z===">"&&S):if(D===""||fEe(t,D))throw new yEe("Invalid capture group name");t[D]=!0,c[c.length]=[D,C],S=!1,D="";continue}S?D+=z:o+=z}return[o,c]};if(rEe("RegExp",TEe)){for(yl=function(i,l){var o=a5(Nh,this),c=sEe(i),t=l===void 0,v=[],S=i,C,D,z,B,ne,pe;if(!o&&c&&t&&i.constructor===yl)return i;if((c||a5(Nh,i))&&(i=i.source,t&&(l=lEe(S))),i=i===void 0?"":s5(i),l=l===void 0?"":s5(l),S=i,h5&&"dotAll"in Vu&&(D=!!l&&u5(l,"s")>-1,D&&(l=l5(l,/s/g,""))),C=l,d5&&"sticky"in Vu&&(z=!!l&&u5(l,"y")>-1,z&&wEe&&(l=l5(l,/y/g,""))),f5&&(B=SEe(i),i=B[0],v=B[1]),ne=iEe(gl(i,l),o?this:Nh,yl),(D||z||v.length)&&(pe=dEe(ne),D&&(pe.dotAll=!0,pe.raw=yl(EEe(i),C)),z&&(pe.sticky=!0),v.length&&(pe.groups=v)),i!==S)try{nEe(ne,"source",S===""?"(?:)":S)}catch{}return ne},bE=aEe(gl),wE=0;bE.length>wE;)uEe(yl,gl,bE[wE++]);Nh.constructor=yl,yl.prototype=Nh,cEe(TE,"RegExp",yl,{constructor:!0})}var yl,bE,wE;pEe("RegExp")});var _5=P(()=>{"use strict";var IEe=Vt(),AEe=uv(),OEe=Gi(),CEe=Ri(),PEe=Ai().get,m5=RegExp.prototype,MEe=TypeError;IEe&&AEe&&CEe(m5,"dotAll",{configurable:!0,get:function(){if(this!==m5){if(OEe(this)==="RegExp")return!!PEe(this).dotAll;throw new MEe("Incompatible receiver, RegExp required")}}})});var dv=P((SHe,g5)=>{"use strict";var Uh=rr(),fv=pt(),qEe=Qt(),REe=lv(),DEe=nm(),LEe=Eu(),kEe=Rn(),BEe=Ai().get,zEe=uv(),FEe=vE(),NEe=LEe("native-string-replace",String.prototype.replace),hv=RegExp.prototype.exec,SE=hv,UEe=fv("".charAt),jEe=fv("".indexOf),VEe=fv("".replace),EE=fv("".slice),IE=function(){var a=/a/,i=/b*/g;return Uh(hv,a,"a"),Uh(hv,i,"a"),a.lastIndex!==0||i.lastIndex!==0}(),y5=DEe.BROKEN_CARET,AE=/()??/.exec("")[1]!==void 0,$Ee=IE||AE||y5||zEe||FEe;$Ee&&(SE=function(i){var l=this,o=BEe(l),c=qEe(i),t=o.raw,v,S,C,D,z,B,ne;if(t)return t.lastIndex=l.lastIndex,v=Uh(SE,t,c),l.lastIndex=t.lastIndex,v;var pe=o.groups,$e=y5&&l.sticky,Ae=Uh(REe,l),ke=l.source,Ge=0,tt=c;if($e&&(Ae=VEe(Ae,"y",""),jEe(Ae,"g")===-1&&(Ae+="g"),tt=EE(c,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&UEe(c,l.lastIndex-1)!==`
`)&&(ke="(?: "+ke+")",tt=" "+tt,Ge++),S=new RegExp("^(?:"+ke+")",Ae)),AE&&(S=new RegExp("^"+ke+"$(?!\\s)",Ae)),IE&&(C=l.lastIndex),D=Uh(hv,$e?S:l,tt),$e?D?(D.input=EE(D.input,Ge),D[0]=EE(D[0],Ge),D.index=l.lastIndex,l.lastIndex+=D[0].length):l.lastIndex=0:IE&&D&&(l.lastIndex=l.global?D.index+D[0].length:C),AE&&D&&D.length>1&&Uh(NEe,D[0],S,function(){for(z=1;z<arguments.length-2;z++)arguments[z]===void 0&&(D[z]=void 0)}),D&&pe)for(D.groups=B=kEe(null),z=0;z<pe.length;z++)ne=pe[z],B[ne[0]]=D[ne[1]];return D});g5.exports=SE});var pv=P(()=>{"use strict";var GEe=ge(),v5=dv();GEe({target:"RegExp",proto:!0,forced:/./.exec!==v5},{exec:v5})});var w5=P(()=>{"use strict";var WEe=It(),ZEe=Vt(),HEe=Ri(),XEe=lv(),KEe=ct(),x5=WEe.RegExp,b5=x5.prototype,YEe=ZEe&&KEe(function(){var a=!0;try{x5(".","d")}catch{a=!1}var i={},l="",o=a?"dgimsy":"gimsy",c=function(C,D){Object.defineProperty(i,C,{get:function(){return l+=D,!0}})},t={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};a&&(t.hasIndices="d");for(var v in t)c(v,t[v]);var S=Object.getOwnPropertyDescriptor(b5,"flags").get.call(i);return S!==o||l!==o});YEe&&HEe(b5,"flags",{configurable:!0,get:XEe})});var E5=P(()=>{"use strict";var JEe=Vt(),QEe=nm().MISSED_STICKY,eSe=Gi(),tSe=Ri(),rSe=Ai().get,T5=RegExp.prototype,iSe=TypeError;JEe&&QEe&&tSe(T5,"sticky",{configurable:!0,get:function(){if(this!==T5){if(eSe(this)==="RegExp")return!!rSe(this).sticky;throw new iSe("Incompatible receiver, RegExp required")}}})});var A5=P(()=>{"use strict";pv();var nSe=ge(),S5=rr(),oSe=_r(),I5=ir(),aSe=Qt(),sSe=function(){var a=!1,i=/[ac]/;return i.exec=function(){return a=!0,/./.exec.apply(this,arguments)},i.test("abc")===!0&&a}(),lSe=/./.test;nSe({target:"RegExp",proto:!0,forced:!sSe},{test:function(a){var i=I5(this),l=aSe(a),o=i.exec;if(!oSe(o))return S5(lSe,i,l);var c=S5(o,i,l);return c===null?!1:(I5(c),!0)}})});var M5=P(()=>{"use strict";var uSe=Iu().PROPER,cSe=Kr(),hSe=ir(),O5=Qt(),fSe=ct(),dSe=Fh(),OE="toString",C5=RegExp.prototype,P5=C5[OE],pSe=fSe(function(){return P5.call({source:"a",flags:"b"})!=="/a/b"}),mSe=uSe&&P5.name!==OE;(pSe||mSe)&&cSe(C5,OE,function(){var i=hSe(this),l=O5(i.source),o=O5(dSe(i));return"/"+l+"/"+o},{unsafe:!0})});var q5=P(()=>{"use strict";var _Se=Fp(),ySe=aT();_Se("Set",function(a){return function(){return a(this,arguments.length?arguments[0]:void 0)}},ySe)});var R5=P(()=>{"use strict";q5()});var D5=P(()=>{"use strict";var gSe=ge(),vSe=pt(),xSe=ei(),bSe=_i(),wSe=Qt(),TSe=ct(),ESe=vSe("".charAt),SSe=TSe(function(){return"\u{20BB7}".at(-2)!=="\uD842"});gSe({target:"String",proto:!0,forced:SSe},{at:function(i){var l=wSe(xSe(this)),o=l.length,c=bSe(i),t=c>=0?c:o+c;return t<0||t>=o?void 0:ESe(l,t)}})});var am=P((jHe,B5)=>{"use strict";var CE=pt(),ISe=_i(),ASe=Qt(),OSe=ei(),CSe=CE("".charAt),L5=CE("".charCodeAt),PSe=CE("".slice),k5=function(a){return function(i,l){var o=ASe(OSe(i)),c=ISe(l),t=o.length,v,S;return c<0||c>=t?a?"":void 0:(v=L5(o,c),v<55296||v>56319||c+1===t||(S=L5(o,c+1))<56320||S>57343?a?CSe(o,c):v:a?PSe(o,c,c+2):(v-55296<<10)+(S-56320)+65536)}};B5.exports={codeAt:k5(!1),charAt:k5(!0)}});var z5=P(()=>{"use strict";var MSe=ge(),qSe=am().codeAt;MSe({target:"String",proto:!0},{codePointAt:function(i){return qSe(this,i)}})});var mv=P((GHe,F5)=>{"use strict";var RSe=im(),DSe=TypeError;F5.exports=function(a){if(RSe(a))throw new DSe("The method doesn't accept regular expressions");return a}});var _v=P((WHe,N5)=>{"use strict";var LSe=pr(),kSe=LSe("match");N5.exports=function(a){var i=/./;try{"/./"[a](i)}catch{try{return i[kSe]=!1,"/./"[a](i)}catch{}}return!1}});var V5=P(()=>{"use strict";var BSe=ge(),zSe=ol(),FSe=nn().f,NSe=qn(),U5=Qt(),USe=mv(),jSe=ei(),VSe=_v(),$Se=fi(),GSe=zSe("".slice),WSe=Math.min,j5=VSe("endsWith"),ZSe=!$Se&&!j5&&!!function(){var a=FSe(String.prototype,"endsWith");return a&&!a.writable}();BSe({target:"String",proto:!0,forced:!ZSe&&!j5},{endsWith:function(i){var l=U5(jSe(this));USe(i);var o=arguments.length>1?arguments[1]:void 0,c=l.length,t=o===void 0?c:WSe(NSe(o),c),v=U5(i);return GSe(l,t-v.length,t)===v}})});var W5=P(()=>{"use strict";var HSe=ge(),XSe=pt(),KSe=xa(),YSe=RangeError,$5=String.fromCharCode,G5=String.fromCodePoint,JSe=XSe([].join),QSe=!!G5&&G5.length!==1;HSe({target:"String",stat:!0,arity:1,forced:QSe},{fromCodePoint:function(i){for(var l=[],o=arguments.length,c=0,t;o>c;){if(t=+arguments[c++],KSe(t,1114111)!==t)throw new YSe(t+" is not a valid code point");l[c]=t<65536?$5(t):$5(((t-=65536)>>10)+55296,t%1024+56320)}return JSe(l,"")}})});var H5=P(()=>{"use strict";var e2e=ge(),t2e=pt(),r2e=mv(),i2e=ei(),Z5=Qt(),n2e=_v(),o2e=t2e("".indexOf);e2e({target:"String",proto:!0,forced:!n2e("includes")},{includes:function(i){return!!~o2e(Z5(i2e(this)),Z5(r2e(i)),arguments.length>1?arguments[1]:void 0)}})});var K5=P(()=>{"use strict";var a2e=ge(),s2e=pt(),l2e=ei(),u2e=Qt(),X5=s2e("".charCodeAt);a2e({target:"String",proto:!0},{isWellFormed:function(){for(var i=u2e(l2e(this)),l=i.length,o=0;o<l;o++){var c=X5(i,o);if((c&63488)===55296&&(c>=56320||++o>=l||(X5(i,o)&64512)!==56320))return!1}return!0}})});var PE=P(()=>{"use strict";var c2e=am().charAt,h2e=Qt(),J5=Ai(),f2e=yg(),Y5=xh(),Q5="String Iterator",d2e=J5.set,p2e=J5.getterFor(Q5);f2e(String,"String",function(a){d2e(this,{type:Q5,string:h2e(a),index:0})},function(){var i=p2e(this),l=i.string,o=i.index,c;return o>=l.length?Y5(void 0,!0):(c=c2e(l,o),i.index+=c.length,Y5(c,!1))})});var sm=P((i9e,n6)=>{"use strict";pv();var e6=rr(),t6=Kr(),m2e=dv(),r6=ct(),i6=pr(),_2e=on(),y2e=i6("species"),ME=RegExp.prototype;n6.exports=function(a,i,l,o){var c=i6(a),t=!r6(function(){var D={};return D[c]=function(){return 7},""[a](D)!==7}),v=t&&!r6(function(){var D=!1,z=/a/;return a==="split"&&(z={},z.constructor={},z.constructor[y2e]=function(){return z},z.flags="",z[c]=/./[c]),z.exec=function(){return D=!0,null},z[c](""),!D});if(!t||!v||l){var S=/./[c],C=i(c,""[a],function(D,z,B,ne,pe){var $e=z.exec;return $e===m2e||$e===ME.exec?t&&!pe?{done:!0,value:e6(S,z,B,ne)}:{done:!0,value:e6(D,B,z,ne)}:{done:!1}});t6(String.prototype,a,C[0]),t6(ME,c,C[1])}o&&_2e(ME[c],"sham",!0)}});var lm=P((n9e,o6)=>{"use strict";var g2e=am().charAt;o6.exports=function(a,i,l){return i+(l?g2e(a,i).length:1)}});var jh=P((o9e,s6)=>{"use strict";var a6=rr(),v2e=ir(),x2e=_r(),b2e=Gi(),w2e=dv(),T2e=TypeError;s6.exports=function(a,i){var l=a.exec;if(x2e(l)){var o=a6(l,a,i);return o!==null&&v2e(o),o}if(b2e(a)==="RegExp")return a6(w2e,a,i);throw new T2e("RegExp#exec called on incompatible receiver")}});var u6=P(()=>{"use strict";var E2e=rr(),S2e=sm(),I2e=ir(),A2e=fn(),O2e=qn(),qE=Qt(),C2e=ei(),P2e=va(),M2e=lm(),l6=jh();S2e("match",function(a,i,l){return[function(c){var t=C2e(this),v=A2e(c)?void 0:P2e(c,a);return v?E2e(v,c,t):new RegExp(c)[a](qE(t))},function(o){var c=I2e(this),t=qE(o),v=l(i,c,t);if(v.done)return v.value;if(!c.global)return l6(c,t);var S=c.unicode;c.lastIndex=0;for(var C=[],D=0,z;(z=l6(c,t))!==null;){var B=qE(z[0]);C[D]=B,B===""&&(c.lastIndex=M2e(t,O2e(c.lastIndex),S)),D++}return D===0?null:C}]})});var v6=P(()=>{"use strict";var q2e=ge(),c6=rr(),d6=ol(),R2e=pg(),yv=xh(),h6=ei(),p6=qn(),um=Qt(),D2e=ir(),L2e=fn(),k2e=Gi(),B2e=im(),m6=Fh(),z2e=va(),F2e=Kr(),N2e=ct(),U2e=pr(),j2e=ku(),V2e=lm(),$2e=jh(),_6=Ai(),DE=fi(),gv=U2e("matchAll"),y6="RegExp String",g6=y6+" Iterator",G2e=_6.set,W2e=_6.getterFor(g6),f6=RegExp.prototype,Z2e=TypeError,LE=d6("".indexOf),vv=d6("".matchAll),RE=!!vv&&!N2e(function(){vv("a",/./)}),H2e=R2e(function(i,l,o,c){G2e(this,{type:g6,regexp:i,string:l,global:o,unicode:c,done:!1})},y6,function(){var i=W2e(this);if(i.done)return yv(void 0,!0);var l=i.regexp,o=i.string,c=$2e(l,o);return c===null?(i.done=!0,yv(void 0,!0)):i.global?(um(c[0])===""&&(l.lastIndex=V2e(o,p6(l.lastIndex),i.unicode)),yv(c,!1)):(i.done=!0,yv(c,!1))}),kE=function(a){var i=D2e(this),l=um(a),o=j2e(i,RegExp),c=um(m6(i)),t,v,S;return t=new o(o===RegExp?i.source:i,c),v=!!~LE(c,"g"),S=!!~LE(c,"u"),t.lastIndex=p6(i.lastIndex),new H2e(t,l,v,S)};q2e({target:"String",proto:!0,forced:RE},{matchAll:function(i){var l=h6(this),o,c,t,v;if(L2e(i)){if(RE)return vv(l,i)}else{if(B2e(i)&&(o=um(h6(m6(i))),!~LE(o,"g")))throw new Z2e("`.matchAll` does not allow non-global regexes");if(RE)return vv(l,i);if(t=z2e(i,gv),t===void 0&&DE&&k2e(i)==="RegExp"&&(t=kE),t)return c6(t,i,l)}return c=um(l),v=new RegExp(i,"g"),DE?c6(kE,v,c):v[gv](c)}});DE||gv in f6||F2e(f6,gv,kE)});var BE=P((c9e,x6)=>{"use strict";var X2e=ya();x6.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(X2e)});var b6=P(()=>{"use strict";var K2e=ge(),Y2e=Ug().end,J2e=BE();K2e({target:"String",proto:!0,forced:J2e},{padEnd:function(i){return Y2e(this,i,arguments.length>1?arguments[1]:void 0)}})});var w6=P(()=>{"use strict";var Q2e=ge(),eIe=Ug().start,tIe=BE();Q2e({target:"String",proto:!0,forced:tIe},{padStart:function(i){return eIe(this,i,arguments.length>1?arguments[1]:void 0)}})});var I6=P(()=>{"use strict";var rIe=ge(),S6=pt(),iIe=qi(),nIe=Rr(),T6=Qt(),oIe=Br(),E6=S6([].push),aIe=S6([].join);rIe({target:"String",stat:!0},{raw:function(i){var l=iIe(nIe(i).raw),o=oIe(l);if(!o)return"";for(var c=arguments.length,t=[],v=0;;){if(E6(t,T6(l[v++])),v===o)return aIe(t,"");v<c&&E6(t,T6(arguments[v]))}}})});var A6=P(()=>{"use strict";var sIe=ge(),lIe=Bp();sIe({target:"String",proto:!0},{repeat:lIe})});var UE=P((v9e,O6)=>{"use strict";var NE=pt(),uIe=Rr(),cIe=Math.floor,zE=NE("".charAt),hIe=NE("".replace),FE=NE("".slice),fIe=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,dIe=/\$([$&'`]|\d{1,2})/g;O6.exports=function(a,i,l,o,c,t){var v=l+a.length,S=o.length,C=dIe;return c!==void 0&&(c=uIe(c),C=fIe),hIe(t,C,function(D,z){var B;switch(zE(z,0)){case"$":return"$";case"&":return a;case"`":return FE(i,0,l);case"'":return FE(i,v);case"<":B=c[FE(z,1,-1)];break;default:var ne=+z;if(ne===0)return D;if(ne>S){var pe=cIe(ne/10);return pe===0?D:pe<=S?o[pe-1]===void 0?zE(z,1):o[pe-1]+zE(z,1):D}B=o[ne-1]}return B===void 0?"":B})}});var R6=P(()=>{"use strict";var pIe=po(),C6=rr(),xv=pt(),mIe=sm(),_Ie=ct(),yIe=ir(),gIe=_r(),vIe=fn(),xIe=_i(),bIe=qn(),Vh=Qt(),wIe=ei(),TIe=lm(),EIe=va(),SIe=UE(),IIe=jh(),AIe=pr(),VE=AIe("replace"),OIe=Math.max,CIe=Math.min,PIe=xv([].concat),jE=xv([].push),P6=xv("".indexOf),M6=xv("".slice),MIe=function(a){return a===void 0?a:String(a)},qIe=function(){return"a".replace(/./,"$0")==="$0"}(),q6=function(){return/./[VE]?/./[VE]("a","$0")==="":!1}(),RIe=!_Ie(function(){var a=/./;return a.exec=function(){var i=[];return i.groups={a:"7"},i},"".replace(a,"$<a>")!=="7"});mIe("replace",function(a,i,l){var o=q6?"$":"$0";return[function(t,v){var S=wIe(this),C=vIe(t)?void 0:EIe(t,VE);return C?C6(C,t,S,v):C6(i,Vh(S),t,v)},function(c,t){var v=yIe(this),S=Vh(c);if(typeof t=="string"&&P6(t,o)===-1&&P6(t,"$<")===-1){var C=l(i,v,S,t);if(C.done)return C.value}var D=gIe(t);D||(t=Vh(t));var z=v.global,B;z&&(B=v.unicode,v.lastIndex=0);for(var ne=[],pe;pe=IIe(v,S),!(pe===null||(jE(ne,pe),!z));){var $e=Vh(pe[0]);$e===""&&(v.lastIndex=TIe(S,bIe(v.lastIndex),B))}for(var Ae="",ke=0,Ge=0;Ge<ne.length;Ge++){pe=ne[Ge];for(var tt=Vh(pe[0]),mt=OIe(CIe(xIe(pe.index),S.length),0),Mt=[],Kt,At=1;At<pe.length;At++)jE(Mt,MIe(pe[At]));var Ve=pe.groups;if(D){var er=PIe([tt],Mt,mt,S);Ve!==void 0&&jE(er,Ve),Kt=Vh(pIe(t,void 0,er))}else Kt=SIe(tt,S,mt,Mt,Ve,t);mt>=ke&&(Ae+=M6(S,ke,mt)+Kt,ke=mt+tt.length)}return Ae+M6(S,ke)}]},!RIe||!qIe||q6)});var k6=P(()=>{"use strict";var DIe=ge(),LIe=rr(),GE=pt(),D6=ei(),kIe=_r(),BIe=fn(),zIe=im(),$h=Qt(),FIe=va(),NIe=Fh(),UIe=UE(),jIe=pr(),VIe=fi(),$Ie=jIe("replace"),GIe=TypeError,$E=GE("".indexOf),WIe=GE("".replace),L6=GE("".slice),ZIe=Math.max;DIe({target:"String",proto:!0},{replaceAll:function(i,l){var o=D6(this),c,t,v,S,C,D,z,B,ne,pe=0,$e=0,Ae="";if(!BIe(i)){if(c=zIe(i),c&&(t=$h(D6(NIe(i))),!~$E(t,"g")))throw new GIe("`.replaceAll` does not allow non-global regexes");if(v=FIe(i,$Ie),v)return LIe(v,i,o,l);if(VIe&&c)return WIe($h(o),i,l)}for(S=$h(o),C=$h(i),D=kIe(l),D||(l=$h(l)),z=C.length,B=ZIe(1,z),pe=$E(S,C);pe!==-1;)ne=D?$h(l(C,pe,S)):UIe(C,S,pe,[],void 0,l),Ae+=L6(S,$e,pe)+ne,$e=pe+z,pe=pe+B>S.length?-1:$E(S,C,pe+B);return $e<S.length&&(Ae+=L6(S,$e)),Ae}})});var F6=P(()=>{"use strict";var HIe=rr(),XIe=sm(),KIe=ir(),YIe=fn(),JIe=ei(),B6=CT(),z6=Qt(),QIe=va(),eAe=jh();XIe("search",function(a,i,l){return[function(c){var t=JIe(this),v=YIe(c)?void 0:QIe(c,a);return v?HIe(v,c,t):new RegExp(c)[a](z6(t))},function(o){var c=KIe(this),t=z6(o),v=l(i,c,t);if(v.done)return v.value;var S=c.lastIndex;B6(S,0)||(c.lastIndex=0);var C=eAe(c,t);return B6(c.lastIndex,S)||(c.lastIndex=S),C===null?-1:C.index}]})});var $6=P(()=>{"use strict";var WE=rr(),V6=pt(),tAe=sm(),rAe=ir(),iAe=fn(),nAe=ei(),oAe=ku(),aAe=lm(),sAe=qn(),N6=Qt(),lAe=va(),U6=jh(),uAe=nm(),cAe=ct(),Gh=uAe.UNSUPPORTED_Y,hAe=4294967295,fAe=Math.min,ZE=V6([].push),HE=V6("".slice),dAe=!cAe(function(){var a=/(?:)/,i=a.exec;a.exec=function(){return i.apply(this,arguments)};var l="ab".split(a);return l.length!==2||l[0]!=="a"||l[1]!=="b"}),j6="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;tAe("split",function(a,i,l){var o="0".split(void 0,0).length?function(c,t){return c===void 0&&t===0?[]:WE(i,this,c,t)}:i;return[function(t,v){var S=nAe(this),C=iAe(t)?void 0:lAe(t,a);return C?WE(C,t,S,v):WE(o,N6(S),t,v)},function(c,t){var v=rAe(this),S=N6(c);if(!j6){var C=l(o,v,S,t,o!==i);if(C.done)return C.value}var D=oAe(v,RegExp),z=v.unicode,B=(v.ignoreCase?"i":"")+(v.multiline?"m":"")+(v.unicode?"u":"")+(Gh?"g":"y"),ne=new D(Gh?"^(?:"+v.source+")":v,B),pe=t===void 0?hAe:t>>>0;if(pe===0)return[];if(S.length===0)return U6(ne,S)===null?[S]:[];for(var $e=0,Ae=0,ke=[];Ae<S.length;){ne.lastIndex=Gh?0:Ae;var Ge=U6(ne,Gh?HE(S,Ae):S),tt;if(Ge===null||(tt=fAe(sAe(ne.lastIndex+(Gh?Ae:0)),S.length))===$e)Ae=aAe(S,Ae,z);else{if(ZE(ke,HE(S,$e,Ae)),ke.length===pe)return ke;for(var mt=1;mt<=Ge.length-1;mt++)if(ZE(ke,Ge[mt]),ke.length===pe)return ke;Ae=$e=tt}}return ZE(ke,HE(S,$e)),ke}]},j6||!dAe,Gh)});var Z6=P(()=>{"use strict";var pAe=ge(),mAe=ol(),_Ae=nn().f,yAe=qn(),G6=Qt(),gAe=mv(),vAe=ei(),xAe=_v(),bAe=fi(),wAe=mAe("".slice),TAe=Math.min,W6=xAe("startsWith"),EAe=!bAe&&!W6&&!!function(){var a=_Ae(String.prototype,"startsWith");return a&&!a.writable}();pAe({target:"String",proto:!0,forced:!EAe&&!W6},{startsWith:function(i){var l=G6(vAe(this));gAe(i);var o=yAe(TAe(arguments.length>1?arguments[1]:void 0,l.length)),c=G6(i);return wAe(l,o,o+c.length)===c}})});var X6=P(()=>{"use strict";var SAe=ge(),IAe=pt(),AAe=ei(),H6=_i(),OAe=Qt(),CAe=IAe("".slice),PAe=Math.max,MAe=Math.min,qAe=!"".substr||"ab".substr(-1)!=="b";SAe({target:"String",proto:!0,forced:qAe},{substr:function(i,l){var o=OAe(AAe(this)),c=o.length,t=H6(i),v,S;return t===1/0&&(t=0),t<0&&(t=PAe(c+t,0)),v=l===void 0?c:H6(l),v<=0||v===1/0?"":(S=MAe(t+v,c),t>=S?"":CAe(o,t,S))}})});var Q6=P(()=>{"use strict";var RAe=ge(),J6=rr(),YE=pt(),DAe=ei(),LAe=Qt(),kAe=ct(),BAe=Array,XE=YE("".charAt),K6=YE("".charCodeAt),zAe=YE([].join),KE="".toWellFormed,FAe="\uFFFD",Y6=KE&&kAe(function(){return J6(KE,1)!=="1"});RAe({target:"String",proto:!0,forced:Y6},{toWellFormed:function(){var i=LAe(DAe(this));if(Y6)return J6(KE,i);for(var l=i.length,o=BAe(l),c=0;c<l;c++){var t=K6(i,c);(t&63488)!==55296?o[c]=XE(i,c):t>=56320||c+1>=l||(K6(i,c+1)&64512)!==56320?o[c]=FAe:(o[c]=XE(i,c),o[++c]=XE(i,c))}return zAe(o,"")}})});var bv=P((D9e,rj)=>{"use strict";var NAe=Iu().PROPER,UAe=ct(),ej=Gp(),tj="\u200B\x85\u180E";rj.exports=function(a){return UAe(function(){return!!ej[a]()||tj[a]()!==tj||NAe&&ej[a].name!==a})}});var ij=P(()=>{"use strict";var jAe=ge(),VAe=Fu().trim,$Ae=bv();jAe({target:"String",proto:!0,forced:$Ae("trim")},{trim:function(){return VAe(this)}})});var JE=P((B9e,nj)=>{"use strict";var GAe=Fu().end,WAe=bv();nj.exports=WAe("trimEnd")?function(){return GAe(this)}:"".trimEnd});var aj=P(()=>{"use strict";var ZAe=ge(),oj=JE();ZAe({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==oj},{trimRight:oj})});var lj=P(()=>{"use strict";aj();var HAe=ge(),sj=JE();HAe({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==sj},{trimEnd:sj})});var QE=P((j9e,uj)=>{"use strict";var XAe=Fu().start,KAe=bv();uj.exports=KAe("trimStart")?function(){return XAe(this)}:"".trimStart});var hj=P(()=>{"use strict";var YAe=ge(),cj=QE();YAe({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==cj},{trimLeft:cj})});var dj=P(()=>{"use strict";hj();var JAe=ge(),fj=QE();JAe({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==fj},{trimStart:fj})});var kn=P((Z9e,mj)=>{"use strict";var QAe=pt(),eOe=ei(),pj=Qt(),tOe=/"/g,rOe=QAe("".replace);mj.exports=function(a,i,l,o){var c=pj(eOe(a)),t="<"+i;return l!==""&&(t+=" "+l+'="'+rOe(pj(o),tOe,"&quot;")+'"'),t+">"+c+"</"+i+">"}});var Bn=P((H9e,_j)=>{"use strict";var iOe=ct();_j.exports=function(a){return iOe(function(){var i=""[a]('"');return i!==i.toLowerCase()||i.split('"').length>3})}});var yj=P(()=>{"use strict";var nOe=ge(),oOe=kn(),aOe=Bn();nOe({target:"String",proto:!0,forced:aOe("anchor")},{anchor:function(i){return oOe(this,"a","name",i)}})});var gj=P(()=>{"use strict";var sOe=ge(),lOe=kn(),uOe=Bn();sOe({target:"String",proto:!0,forced:uOe("big")},{big:function(){return lOe(this,"big","","")}})});var vj=P(()=>{"use strict";var cOe=ge(),hOe=kn(),fOe=Bn();cOe({target:"String",proto:!0,forced:fOe("blink")},{blink:function(){return hOe(this,"blink","","")}})});var xj=P(()=>{"use strict";var dOe=ge(),pOe=kn(),mOe=Bn();dOe({target:"String",proto:!0,forced:mOe("bold")},{bold:function(){return pOe(this,"b","","")}})});var bj=P(()=>{"use strict";var _Oe=ge(),yOe=kn(),gOe=Bn();_Oe({target:"String",proto:!0,forced:gOe("fixed")},{fixed:function(){return yOe(this,"tt","","")}})});var wj=P(()=>{"use strict";var vOe=ge(),xOe=kn(),bOe=Bn();vOe({target:"String",proto:!0,forced:bOe("fontcolor")},{fontcolor:function(i){return xOe(this,"font","color",i)}})});var Tj=P(()=>{"use strict";var wOe=ge(),TOe=kn(),EOe=Bn();wOe({target:"String",proto:!0,forced:EOe("fontsize")},{fontsize:function(i){return TOe(this,"font","size",i)}})});var Ej=P(()=>{"use strict";var SOe=ge(),IOe=kn(),AOe=Bn();SOe({target:"String",proto:!0,forced:AOe("italics")},{italics:function(){return IOe(this,"i","","")}})});var Sj=P(()=>{"use strict";var OOe=ge(),COe=kn(),POe=Bn();OOe({target:"String",proto:!0,forced:POe("link")},{link:function(i){return COe(this,"a","href",i)}})});var Ij=P(()=>{"use strict";var MOe=ge(),qOe=kn(),ROe=Bn();MOe({target:"String",proto:!0,forced:ROe("small")},{small:function(){return qOe(this,"small","","")}})});var Aj=P(()=>{"use strict";var DOe=ge(),LOe=kn(),kOe=Bn();DOe({target:"String",proto:!0,forced:kOe("strike")},{strike:function(){return LOe(this,"strike","","")}})});var Oj=P(()=>{"use strict";var BOe=ge(),zOe=kn(),FOe=Bn();BOe({target:"String",proto:!0,forced:FOe("sub")},{sub:function(){return zOe(this,"sub","","")}})});var Cj=P(()=>{"use strict";var NOe=ge(),UOe=kn(),jOe=Bn();NOe({target:"String",proto:!0,forced:jOe("sup")},{sup:function(){return UOe(this,"sup","","")}})});var wv=P((bXe,Mj)=>{"use strict";var Pj=It(),eS=ct(),VOe=Op(),$Oe=cr().NATIVE_ARRAY_BUFFER_VIEWS,GOe=Pj.ArrayBuffer,$u=Pj.Int8Array;Mj.exports=!$Oe||!eS(function(){$u(1)})||!eS(function(){new $u(-1)})||!VOe(function(a){new $u,new $u(null),new $u(1.5),new $u(a)},!0)||eS(function(){return new $u(new GOe(2),1,void 0).length!==1})});var Rj=P((wXe,qj)=>{"use strict";var WOe=_i(),ZOe=RangeError;qj.exports=function(a){var i=WOe(a);if(i<0)throw new ZOe("The argument can't be less than 0");return i}});var tS=P((TXe,Dj)=>{"use strict";var HOe=Rj(),XOe=RangeError;Dj.exports=function(a,i){var l=HOe(a);if(l%i)throw new XOe("Wrong offset");return l}});var kj=P((EXe,Lj)=>{"use strict";var KOe=Math.round;Lj.exports=function(a){var i=KOe(a);return i<0?0:i>255?255:i&255}});var rS=P((SXe,Bj)=>{"use strict";var YOe=Zo();Bj.exports=function(a){var i=YOe(a);return i==="BigInt64Array"||i==="BigUint64Array"}});var Tv=P((IXe,zj)=>{"use strict";var JOe=fp(),QOe=TypeError;zj.exports=function(a){var i=JOe(a,"number");if(typeof i=="number")throw new QOe("Can't convert number to bigint");return BigInt(i)}});var iS=P((AXe,Fj)=>{"use strict";var eCe=ho(),tCe=rr(),rCe=Lg(),iCe=Rr(),nCe=Br(),oCe=Sp(),aCe=yh(),sCe=ug(),lCe=rS(),uCe=cr().aTypedArrayConstructor,cCe=Tv();Fj.exports=function(i){var l=rCe(this),o=iCe(i),c=arguments.length,t=c>1?arguments[1]:void 0,v=t!==void 0,S=aCe(o),C,D,z,B,ne,pe,$e,Ae;if(S&&!sCe(S))for($e=oCe(o,S),Ae=$e.next,o=[];!(pe=tCe(Ae,$e)).done;)o.push(pe.value);for(v&&c>2&&(t=eCe(t,arguments[2])),D=nCe(o),z=new(uCe(l))(D),B=lCe(z),C=0;D>C;C++)ne=v?t(o[C],C):o[C],z[C]=B?cCe(ne):+ne;return z}});var Ia=P((OXe,cS)=>{"use strict";var Nj=ge(),Yj=It(),Uj=rr(),hCe=Vt(),fCe=wv(),dm=cr(),Jj=kp(),jj=Xo(),dCe=Hn(),cm=on(),pCe=Kg(),mCe=qn(),Vj=Tg(),nS=tS(),_Ce=kj(),Qj=rs(),hm=yr(),yCe=Zo(),sS=ur(),gCe=rl(),vCe=Rn(),xCe=Mn(),Ev=Ho(),bCe=nl().f,$j=iS(),wCe=Fi().forEach,TCe=Du(),ECe=Ri(),eV=ri(),tV=nn(),Gj=Rp(),hS=Ai(),SCe=ll(),lS=hS.get,ICe=hS.set,ACe=hS.enforce,rV=eV.f,OCe=tV.f,oS=Yj.RangeError,iV=Jj.ArrayBuffer,CCe=iV.prototype,PCe=Jj.DataView,Sv=dm.NATIVE_ARRAY_BUFFER_VIEWS,Wj=dm.TYPED_ARRAY_TAG,Zj=dm.TypedArray,fm=dm.TypedArrayPrototype,uS=dm.isTypedArray,Iv="BYTES_PER_ELEMENT",aS="Wrong length",Av=function(a,i){ECe(a,i,{configurable:!0,get:function(){return lS(this)[i]}})},Hj=function(a){var i;return xCe(CCe,a)||(i=yCe(a))==="ArrayBuffer"||i==="SharedArrayBuffer"},nV=function(a,i){return uS(a)&&!gCe(i)&&i in a&&pCe(+i)&&i>=0},Xj=function(i,l){return l=Qj(l),nV(i,l)?dCe(2,i[l]):OCe(i,l)},Kj=function(i,l,o){return l=Qj(l),nV(i,l)&&sS(o)&&hm(o,"value")&&!hm(o,"get")&&!hm(o,"set")&&!o.configurable&&(!hm(o,"writable")||o.writable)&&(!hm(o,"enumerable")||o.enumerable)?(i[l]=o.value,i):rV(i,l,o)};hCe?(Sv||(tV.f=Xj,eV.f=Kj,Av(fm,"buffer"),Av(fm,"byteOffset"),Av(fm,"byteLength"),Av(fm,"length")),Nj({target:"Object",stat:!0,forced:!Sv},{getOwnPropertyDescriptor:Xj,defineProperty:Kj}),cS.exports=function(a,i,l){var o=a.match(/\d+/)[0]/8,c=a+(l?"Clamped":"")+"Array",t="get"+a,v="set"+a,S=Yj[c],C=S,D=C&&C.prototype,z={},B=function(Ae,ke){var Ge=lS(Ae);return Ge.view[t](ke*o+Ge.byteOffset,!0)},ne=function(Ae,ke,Ge){var tt=lS(Ae);tt.view[v](ke*o+tt.byteOffset,l?_Ce(Ge):Ge,!0)},pe=function(Ae,ke){rV(Ae,ke,{get:function(){return B(this,ke)},set:function(Ge){return ne(this,ke,Ge)},enumerable:!0})};Sv?fCe&&(C=i(function(Ae,ke,Ge,tt){return jj(Ae,D),SCe(function(){return sS(ke)?Hj(ke)?tt!==void 0?new S(ke,nS(Ge,o),tt):Ge!==void 0?new S(ke,nS(Ge,o)):new S(ke):uS(ke)?Gj(C,ke):Uj($j,C,ke):new S(Vj(ke))}(),Ae,C)}),Ev&&Ev(C,Zj),wCe(bCe(S),function(Ae){Ae in C||cm(C,Ae,S[Ae])}),C.prototype=D):(C=i(function(Ae,ke,Ge,tt){jj(Ae,D);var mt=0,Mt=0,Kt,At,Ve;if(!sS(ke))Ve=Vj(ke),At=Ve*o,Kt=new iV(At);else if(Hj(ke)){Kt=ke,Mt=nS(Ge,o);var er=ke.byteLength;if(tt===void 0){if(er%o)throw new oS(aS);if(At=er-Mt,At<0)throw new oS(aS)}else if(At=mCe(tt)*o,At+Mt>er)throw new oS(aS);Ve=At/o}else return uS(ke)?Gj(C,ke):Uj($j,C,ke);for(ICe(Ae,{buffer:Kt,byteOffset:Mt,byteLength:At,length:Ve,view:new PCe(Kt)});mt<Ve;)pe(Ae,mt++)}),Ev&&Ev(C,Zj),D=C.prototype=vCe(fm)),D.constructor!==C&&cm(D,"constructor",C),ACe(D).TypedArrayConstructor=C,Wj&&cm(D,Wj,c);var $e=C!==S;z[c]=C,Nj({global:!0,constructor:!0,forced:$e,sham:!Sv},z),Iv in C||cm(C,Iv,o),Iv in D||cm(D,Iv,o),TCe(c)}):cS.exports=function(){}});var oV=P(()=>{"use strict";var MCe=Ia();MCe("Float32",function(a){return function(l,o,c){return a(this,l,o,c)}})});var aV=P(()=>{"use strict";var qCe=Ia();qCe("Float64",function(a){return function(l,o,c){return a(this,l,o,c)}})});var sV=P(()=>{"use strict";var RCe=Ia();RCe("Int8",function(a){return function(l,o,c){return a(this,l,o,c)}})});var lV=P(()=>{"use strict";var DCe=Ia();DCe("Int16",function(a){return function(l,o,c){return a(this,l,o,c)}})});var uV=P(()=>{"use strict";var LCe=Ia();LCe("Int32",function(a){return function(l,o,c){return a(this,l,o,c)}})});var cV=P(()=>{"use strict";var kCe=Ia();kCe("Uint8",function(a){return function(l,o,c){return a(this,l,o,c)}})});var hV=P(()=>{"use strict";var BCe=Ia();BCe("Uint8",function(a){return function(l,o,c){return a(this,l,o,c)}},!0)});var fV=P(()=>{"use strict";var zCe=Ia();zCe("Uint16",function(a){return function(l,o,c){return a(this,l,o,c)}})});var dV=P(()=>{"use strict";var FCe=Ia();FCe("Uint32",function(a){return function(l,o,c){return a(this,l,o,c)}})});var mV=P(()=>{"use strict";var pV=cr(),NCe=Br(),UCe=_i(),jCe=pV.aTypedArray,VCe=pV.exportTypedArrayMethod;VCe("at",function(i){var l=jCe(this),o=NCe(l),c=UCe(i),t=c>=0?c:o+c;return t<0||t>=o?void 0:l[t]})});var yV=P(()=>{"use strict";var $Ce=pt(),_V=cr(),GCe=Gb(),WCe=$Ce(GCe),ZCe=_V.aTypedArray,HCe=_V.exportTypedArrayMethod;HCe("copyWithin",function(i,l){return WCe(ZCe(this),i,l,arguments.length>2?arguments[2]:void 0)})});var vV=P(()=>{"use strict";var gV=cr(),XCe=Fi().every,KCe=gV.aTypedArray,YCe=gV.exportTypedArrayMethod;YCe("every",function(i){return XCe(KCe(this),i,arguments.length>1?arguments[1]:void 0)})});var bV=P(()=>{"use strict";var xV=cr(),JCe=dg(),QCe=Tv(),ePe=Zo(),tPe=rr(),rPe=pt(),iPe=ct(),nPe=xV.aTypedArray,oPe=xV.exportTypedArrayMethod,aPe=rPe("".slice),sPe=iPe(function(){var a=0;return new Int8Array(2).fill({valueOf:function(){return a++}}),a!==1});oPe("fill",function(i){var l=arguments.length;nPe(this);var o=aPe(ePe(this),0,3)==="Big"?QCe(i):+i;return tPe(JCe,this,o,l>1?arguments[1]:void 0,l>2?arguments[2]:void 0)},sPe)});var pm=P((tKe,TV)=>{"use strict";var wV=cr(),lPe=ku(),uPe=wV.aTypedArrayConstructor,cPe=wV.getTypedArrayConstructor;TV.exports=function(a){return uPe(lPe(a,cPe(a)))}});var SV=P((rKe,EV)=>{"use strict";var hPe=Rp(),fPe=pm();EV.exports=function(a,i){return hPe(fPe(a),i)}});var AV=P(()=>{"use strict";var IV=cr(),dPe=Fi().filter,pPe=SV(),mPe=IV.aTypedArray,_Pe=IV.exportTypedArrayMethod;_Pe("filter",function(i){var l=dPe(mPe(this),i,arguments.length>1?arguments[1]:void 0);return pPe(this,l)})});var CV=P(()=>{"use strict";var OV=cr(),yPe=Fi().find,gPe=OV.aTypedArray,vPe=OV.exportTypedArrayMethod;vPe("find",function(i){return yPe(gPe(this),i,arguments.length>1?arguments[1]:void 0)})});var MV=P(()=>{"use strict";var PV=cr(),xPe=Fi().findIndex,bPe=PV.aTypedArray,wPe=PV.exportTypedArrayMethod;wPe("findIndex",function(i){return xPe(bPe(this),i,arguments.length>1?arguments[1]:void 0)})});var RV=P(()=>{"use strict";var qV=cr(),TPe=Ap().findLast,EPe=qV.aTypedArray,SPe=qV.exportTypedArrayMethod;SPe("findLast",function(i){return TPe(EPe(this),i,arguments.length>1?arguments[1]:void 0)})});var LV=P(()=>{"use strict";var DV=cr(),IPe=Ap().findLastIndex,APe=DV.aTypedArray,OPe=DV.exportTypedArrayMethod;OPe("findLastIndex",function(i){return IPe(APe(this),i,arguments.length>1?arguments[1]:void 0)})});var BV=P(()=>{"use strict";var kV=cr(),CPe=Fi().forEach,PPe=kV.aTypedArray,MPe=kV.exportTypedArrayMethod;MPe("forEach",function(i){CPe(PPe(this),i,arguments.length>1?arguments[1]:void 0)})});var zV=P(()=>{"use strict";var qPe=wv(),RPe=cr().exportTypedArrayStaticMethod,DPe=iS();RPe("from",DPe,qPe)});var NV=P(()=>{"use strict";var FV=cr(),LPe=sh().includes,kPe=FV.aTypedArray,BPe=FV.exportTypedArrayMethod;BPe("includes",function(i){return LPe(kPe(this),i,arguments.length>1?arguments[1]:void 0)})});var jV=P(()=>{"use strict";var UV=cr(),zPe=sh().indexOf,FPe=UV.aTypedArray,NPe=UV.exportTypedArrayMethod;NPe("indexOf",function(i){return zPe(FPe(this),i,arguments.length>1?arguments[1]:void 0)})});var ZV=P(()=>{"use strict";var UPe=It(),jPe=ct(),fS=pt(),$V=cr(),dS=Mp(),VPe=pr(),pS=VPe("iterator"),VV=UPe.Uint8Array,$Pe=fS(dS.values),GPe=fS(dS.keys),WPe=fS(dS.entries),mS=$V.aTypedArray,Ov=$V.exportTypedArrayMethod,Wh=VV&&VV.prototype,Cv=!jPe(function(){Wh[pS].call([1])}),GV=!!Wh&&Wh.values&&Wh[pS]===Wh.values&&Wh.values.name==="values",WV=function(){return $Pe(mS(this))};Ov("entries",function(){return WPe(mS(this))},Cv);Ov("keys",function(){return GPe(mS(this))},Cv);Ov("values",WV,Cv||!GV,{name:"values"});Ov(pS,WV,Cv||!GV,{name:"values"})});var XV=P(()=>{"use strict";var HV=cr(),ZPe=pt(),HPe=HV.aTypedArray,XPe=HV.exportTypedArrayMethod,KPe=ZPe([].join);XPe("join",function(i){return KPe(HPe(this),i)})});var YV=P(()=>{"use strict";var KV=cr(),YPe=po(),JPe=aw(),QPe=KV.aTypedArray,eMe=KV.exportTypedArrayMethod;eMe("lastIndexOf",function(i){var l=arguments.length;return YPe(JPe,QPe(this),l>1?[i,arguments[1]]:[i])})});var QV=P(()=>{"use strict";var JV=cr(),tMe=Fi().map,rMe=pm(),iMe=JV.aTypedArray,nMe=JV.exportTypedArrayMethod;nMe("map",function(i){return tMe(iMe(this),i,arguments.length>1?arguments[1]:void 0,function(l,o){return new(rMe(l))(o)})})});var t8=P(()=>{"use strict";var e8=cr(),oMe=wv(),aMe=e8.aTypedArrayConstructor,sMe=e8.exportTypedArrayStaticMethod;sMe("of",function(){for(var i=0,l=arguments.length,o=new(aMe(this))(l);l>i;)o[i]=arguments[i++];return o},oMe)});var i8=P(()=>{"use strict";var r8=cr(),lMe=qp().left,uMe=r8.aTypedArray,cMe=r8.exportTypedArrayMethod;cMe("reduce",function(i){var l=arguments.length;return lMe(uMe(this),i,l,l>1?arguments[1]:void 0)})});var o8=P(()=>{"use strict";var n8=cr(),hMe=qp().right,fMe=n8.aTypedArray,dMe=n8.exportTypedArrayMethod;dMe("reduceRight",function(i){var l=arguments.length;return hMe(fMe(this),i,l,l>1?arguments[1]:void 0)})});var s8=P(()=>{"use strict";var a8=cr(),pMe=a8.aTypedArray,mMe=a8.exportTypedArrayMethod,_Me=Math.floor;mMe("reverse",function(){for(var i=this,l=pMe(i).length,o=_Me(l/2),c=0,t;c<o;)t=i[c],i[c++]=i[--l],i[l]=t;return i})});var d8=P(()=>{"use strict";var u8=It(),c8=rr(),gS=cr(),yMe=Br(),gMe=tS(),vMe=Rr(),h8=ct(),xMe=u8.RangeError,_S=u8.Int8Array,l8=_S&&_S.prototype,f8=l8&&l8.set,bMe=gS.aTypedArray,wMe=gS.exportTypedArrayMethod,yS=!h8(function(){var a=new Uint8ClampedArray(2);return c8(f8,a,{length:1,0:3},1),a[1]!==3}),TMe=yS&&gS.NATIVE_ARRAY_BUFFER_VIEWS&&h8(function(){var a=new _S(2);return a.set(1),a.set("2",1),a[0]!==0||a[1]!==2});wMe("set",function(i){bMe(this);var l=gMe(arguments.length>1?arguments[1]:void 0,1),o=vMe(i);if(yS)return c8(f8,this,o,l);var c=this.length,t=yMe(o),v=0;if(t+l>c)throw new xMe("Wrong length");for(;v<t;)this[l+v]=o[v++]},!yS||TMe)});var m8=P(()=>{"use strict";var p8=cr(),EMe=pm(),SMe=ct(),IMe=co(),AMe=p8.aTypedArray,OMe=p8.exportTypedArrayMethod,CMe=SMe(function(){new Int8Array(1).slice()});OMe("slice",function(i,l){for(var o=IMe(AMe(this),i,l),c=EMe(this),t=0,v=o.length,S=new c(v);v>t;)S[t]=o[t++];return S},CMe)});var y8=P(()=>{"use strict";var _8=cr(),PMe=Fi().some,MMe=_8.aTypedArray,qMe=_8.exportTypedArrayMethod;qMe("some",function(i){return PMe(MMe(this),i,arguments.length>1?arguments[1]:void 0)})});var T8=P(()=>{"use strict";var RMe=It(),DMe=ol(),vS=ct(),LMe=ti(),kMe=xg(),w8=cr(),g8=uw(),BMe=cw(),v8=ga(),x8=bg(),zMe=w8.aTypedArray,FMe=w8.exportTypedArrayMethod,mm=RMe.Uint16Array,Zh=mm&&DMe(mm.prototype.sort),NMe=!!Zh&&!(vS(function(){Zh(new mm(2),null)})&&vS(function(){Zh(new mm(2),{})})),b8=!!Zh&&!vS(function(){if(v8)return v8<74;if(g8)return g8<67;if(BMe)return!0;if(x8)return x8<602;var a=new mm(516),i=Array(516),l,o;for(l=0;l<516;l++)o=l%4,a[l]=515-l,i[l]=l-2*o+3;for(Zh(a,function(c,t){return(c/4|0)-(t/4|0)}),l=0;l<516;l++)if(a[l]!==i[l])return!0}),UMe=function(a){return function(i,l){return a!==void 0?+a(i,l)||0:l!==l?-1:i!==i?1:i===0&&l===0?1/i>0&&1/l<0?1:-1:i>l}};FMe("sort",function(i){return i!==void 0&&LMe(i),b8?Zh(this,i):kMe(zMe(this),UMe(i))},!b8||NMe)});var I8=P(()=>{"use strict";var S8=cr(),jMe=qn(),E8=xa(),VMe=pm(),$Me=S8.aTypedArray,GMe=S8.exportTypedArrayMethod;GMe("subarray",function(i,l){var o=$Me(this),c=o.length,t=E8(i,c),v=VMe(o);return new v(o.buffer,o.byteOffset+t*o.BYTES_PER_ELEMENT,jMe((l===void 0?c:E8(l,c))-t))})});var M8=P(()=>{"use strict";var WMe=It(),ZMe=po(),C8=cr(),xS=ct(),A8=co(),Pv=WMe.Int8Array,O8=C8.aTypedArray,HMe=C8.exportTypedArrayMethod,P8=[].toLocaleString,XMe=!!Pv&&xS(function(){P8.call(new Pv(1))}),KMe=xS(function(){return[1,2].toLocaleString()!==new Pv([1,2]).toLocaleString()})||!xS(function(){Pv.prototype.toLocaleString.call([1,2])});HMe("toLocaleString",function(){return ZMe(P8,XMe?A8(O8(this)):O8(this),A8(arguments))},KMe)});var q8=P(()=>{"use strict";var YMe=dw(),bS=cr(),JMe=bS.aTypedArray,QMe=bS.exportTypedArrayMethod,eqe=bS.getTypedArrayConstructor;QMe("toReversed",function(){return YMe(JMe(this),eqe(this))})});var R8=P(()=>{"use strict";var Mv=cr(),tqe=pt(),rqe=ti(),iqe=Rp(),nqe=Mv.aTypedArray,oqe=Mv.getTypedArrayConstructor,aqe=Mv.exportTypedArrayMethod,sqe=tqe(Mv.TypedArrayPrototype.sort);aqe("toSorted",function(i){i!==void 0&&rqe(i);var l=nqe(this),o=iqe(oqe(l),l);return sqe(o,i)})});var L8=P(()=>{"use strict";var lqe=cr().exportTypedArrayMethod,uqe=ct(),cqe=It(),hqe=pt(),D8=cqe.Uint8Array,fqe=D8&&D8.prototype||{},qv=[].toString,dqe=hqe([].join);uqe(function(){qv.call({})})&&(qv=function(){return dqe(this)});var pqe=fqe.toString!==qv;lqe("toString",qv,pqe)});var k8=P(()=>{"use strict";var mqe=pw(),wS=cr(),_qe=rS(),yqe=_i(),gqe=Tv(),vqe=wS.aTypedArray,xqe=wS.getTypedArrayConstructor,bqe=wS.exportTypedArrayMethod,wqe=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(a){return a===8}}();bqe("with",function(a,i){var l=vqe(this),o=yqe(a),c=_qe(l)?gqe(i):+i;return mqe(l,xqe(l),o,c)},!wqe)});var U8=P(()=>{"use strict";var Tqe=ge(),TS=pt(),Eqe=Qt(),B8=String.fromCharCode,z8=TS("".charAt),F8=TS(/./.exec),N8=TS("".slice),Sqe=/^[\da-f]{2}$/i,Iqe=/^[\da-f]{4}$/i;Tqe({global:!0},{unescape:function(i){for(var l=Eqe(i),o="",c=l.length,t=0,v,S;t<c;){if(v=z8(l,t++),v==="%"){if(z8(l,t)==="u"){if(S=N8(l,t+1,t+5),F8(Iqe,S)){o+=B8(parseInt(S,16)),t+=5;continue}}else if(S=N8(l,t,t+2),F8(Sqe,S)){o+=B8(parseInt(S,16)),t+=2;continue}}o+=v}return o}})});var IS=P((oYe,Z8)=>{"use strict";var Aqe=pt(),j8=bh(),Rv=ml().getWeakData,Oqe=Xo(),Cqe=ir(),Pqe=fn(),ES=ur(),Mqe=Kn(),$8=Fi(),V8=yr(),G8=Ai(),qqe=G8.set,Rqe=G8.getterFor,Dqe=$8.find,Lqe=$8.findIndex,kqe=Aqe([].splice),Bqe=0,Dv=function(a){return a.frozen||(a.frozen=new W8)},W8=function(){this.entries=[]},SS=function(a,i){return Dqe(a.entries,function(l){return l[0]===i})};W8.prototype={get:function(a){var i=SS(this,a);if(i)return i[1]},has:function(a){return!!SS(this,a)},set:function(a,i){var l=SS(this,a);l?l[1]=i:this.entries.push([a,i])},delete:function(a){var i=Lqe(this.entries,function(l){return l[0]===a});return~i&&kqe(this.entries,i,1),!!~i}};Z8.exports={getConstructor:function(a,i,l,o){var c=a(function(C,D){Oqe(C,t),qqe(C,{type:i,id:Bqe++,frozen:void 0}),Pqe(D)||Mqe(D,C[o],{that:C,AS_ENTRIES:l})}),t=c.prototype,v=Rqe(i),S=function(C,D,z){var B=v(C),ne=Rv(Cqe(D),!0);return ne===!0?Dv(B).set(D,z):ne[B.id]=z,C};return j8(t,{delete:function(C){var D=v(this);if(!ES(C))return!1;var z=Rv(C);return z===!0?Dv(D).delete(C):z&&V8(z,D.id)&&delete z[D.id]},has:function(D){var z=v(this);if(!ES(D))return!1;var B=Rv(D);return B===!0?Dv(z).has(D):B&&V8(B,z.id)}}),j8(t,l?{get:function(D){var z=v(this);if(ES(D)){var B=Rv(D);return B===!0?Dv(z).get(D):B?B[z.id]:void 0}},set:function(D,z){return S(this,D,z)}}:{add:function(D){return S(this,D,!0)}}),c}}});var t$=P(()=>{"use strict";var zqe=zu(),H8=It(),zv=pt(),X8=bh(),Fqe=ml(),Nqe=Fp(),K8=IS(),Lv=ur(),kv=Ai().enforce,Uqe=ct(),jqe=H1(),gm=Object,Vqe=Array.isArray,Bv=gm.isExtensible,Y8=gm.isFrozen,$qe=gm.isSealed,J8=gm.freeze,Gqe=gm.seal,Wqe=!H8.ActiveXObject&&"ActiveXObject"in H8,_m,Q8=function(a){return function(){return a(this,arguments.length?arguments[0]:void 0)}},e$=Nqe("WeakMap",Q8,K8),Hh=e$.prototype,Fv=zv(Hh.set),Zqe=function(){return zqe&&Uqe(function(){var a=J8([]);return Fv(new e$,a,1),!Y8(a)})};jqe&&(Wqe?(_m=K8.getConstructor(Q8,"WeakMap",!0),Fqe.enable(),AS=zv(Hh.delete),ym=zv(Hh.has),OS=zv(Hh.get),X8(Hh,{delete:function(a){if(Lv(a)&&!Bv(a)){var i=kv(this);return i.frozen||(i.frozen=new _m),AS(this,a)||i.frozen.delete(a)}return AS(this,a)},has:function(i){if(Lv(i)&&!Bv(i)){var l=kv(this);return l.frozen||(l.frozen=new _m),ym(this,i)||l.frozen.has(i)}return ym(this,i)},get:function(i){if(Lv(i)&&!Bv(i)){var l=kv(this);return l.frozen||(l.frozen=new _m),ym(this,i)?OS(this,i):l.frozen.get(i)}return OS(this,i)},set:function(i,l){if(Lv(i)&&!Bv(i)){var o=kv(this);o.frozen||(o.frozen=new _m),ym(this,i)?Fv(this,i,l):o.frozen.set(i,l)}else Fv(this,i,l);return this}})):Zqe()&&X8(Hh,{set:function(i,l){var o;return Vqe(i)&&(Y8(i)?o=J8:$qe(i)&&(o=Gqe)),Fv(this,i,l),o&&o(i),this}}));var AS,ym,OS});var r$=P(()=>{"use strict";t$()});var i$=P(()=>{"use strict";var Hqe=Fp(),Xqe=IS();Hqe("WeakSet",function(a){return function(){return a(this,arguments.length?arguments[0]:void 0)}},Xqe)});var n$=P(()=>{"use strict";i$()});var CS=P((pYe,u$)=>{"use strict";var l$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o$=l$+"+/",a$=l$+"-_",s$=function(a){for(var i={},l=0;l<64;l++)i[a.charAt(l)]=l;return i};u$.exports={i2c:o$,c2i:s$(o$),i2cUrl:a$,c2iUrl:s$(a$)}});var _$=P(()=>{"use strict";var Kqe=ge(),Yqe=It(),f$=Wr(),PS=pt(),Jqe=rr(),Nv=ct(),Qqe=Qt(),eRe=mo(),c$=CS().c2i,d$=/[^\d+/a-z]/i,tRe=/[\t\n\f\r ]+/g,rRe=/[=]{1,2}$/,Gu=f$("atob"),iRe=String.fromCharCode,nRe=PS("".charAt),h$=PS("".replace),oRe=PS(d$.exec),Xh=!!Gu&&!Nv(function(){return Gu("aGk=")!=="hi"}),p$=Xh&&Nv(function(){return Gu(" ")!==""}),m$=Xh&&!Nv(function(){Gu("a")}),aRe=Xh&&!Nv(function(){Gu()}),sRe=Xh&&Gu.length!==1,lRe=!Xh||p$||m$||aRe||sRe;Kqe({global:!0,bind:!0,enumerable:!0,forced:lRe},{atob:function(i){if(eRe(arguments.length,1),Xh&&!p$&&!m$)return Jqe(Gu,Yqe,i);var l=h$(Qqe(i),tRe,""),o="",c=0,t=0,v,S,C;if(l.length%4===0&&(l=h$(l,rRe,"")),v=l.length,v%4===1||oRe(d$,l))throw new(f$("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;c<v;)S=nRe(l,c++),C=t%4?C*64+c$[S]:c$[S],t++%4&&(o+=iRe(255&C>>(-2*t&6)));return o}})});var b$=P(()=>{"use strict";var uRe=ge(),cRe=It(),v$=Wr(),x$=pt(),hRe=rr(),MS=ct(),y$=Qt(),fRe=mo(),dRe=CS().i2c,Kh=v$("btoa"),g$=x$("".charAt),pRe=x$("".charCodeAt),vm=!!Kh&&!MS(function(){return Kh("hi")!=="aGk="}),mRe=vm&&!MS(function(){Kh()}),_Re=vm&&MS(function(){return Kh(null)!=="bnVsbA=="}),yRe=vm&&Kh.length!==1;uRe({global:!0,bind:!0,enumerable:!0,forced:!vm||mRe||_Re||yRe},{btoa:function(i){if(fRe(arguments.length,1),vm)return hRe(Kh,cRe,y$(i));for(var l=y$(i),o="",c=0,t=dRe,v,S;g$(l,c)||(t="=",c%1);){if(S=pRe(l,c+=3/4),S>255)throw new(v$("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");v=v<<8|S,o+=g$(t,63&v>>8-c%1*8)}return o}})});var qS=P((vYe,w$)=>{"use strict";w$.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}});var DS=P((xYe,E$)=>{"use strict";var gRe=dp(),RS=gRe("span").classList,T$=RS&&RS.constructor&&RS.constructor.prototype;E$.exports=T$===Object.prototype?void 0:T$});var O$=P(()=>{"use strict";var S$=It(),I$=qS(),vRe=DS(),LS=Xb(),xRe=on(),A$=function(a){if(a&&a.forEach!==LS)try{xRe(a,"forEach",LS)}catch{a.forEach=LS}};for(Uv in I$)I$[Uv]&&A$(S$[Uv]&&S$[Uv].prototype);var Uv;A$(vRe)});var R$=P(()=>{"use strict";var C$=It(),M$=qS(),bRe=DS(),xm=Mp(),P$=on(),wRe=pn(),TRe=pr(),kS=TRe("iterator"),BS=xm.values,q$=function(a,i){if(a){if(a[kS]!==BS)try{P$(a,kS,BS)}catch{a[kS]=BS}if(wRe(a,i,!0),M$[i]){for(var l in xm)if(a[l]!==xm[l])try{P$(a,l,xm[l])}catch{a[l]=xm[l]}}}};for(jv in M$)q$(C$[jv]&&C$[jv].prototype,jv);var jv;q$(bRe,"DOMTokenList")});var zS=P((SYe,D$)=>{"use strict";D$.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}});var G$=P(()=>{"use strict";var ERe=ge(),SRe=Lw(),Gv=Wr(),$S=ct(),IRe=Rn(),GS=Hn(),Wv=ri().f,ARe=Kr(),Vv=Ri(),$v=yr(),ORe=Xo(),CRe=ir(),B$=Lb(),L$=mh(),Yh=zS(),PRe=og(),z$=Ai(),WS=Vt(),F$=fi(),Jh="DOMException",VS="DATA_CLONE_ERR",Hv=Gv("Error"),ms=Gv(Jh)||function(){try{var a=Gv("MessageChannel")||SRe("worker_threads").MessageChannel;new a().port1.postMessage(new WeakMap)}catch(i){if(i.name===VS&&i.code===25)return i.constructor}}(),MRe=ms&&ms.prototype,N$=Hv.prototype,qRe=z$.set,RRe=z$.getterFor(Jh),DRe="stack"in new Hv(Jh),U$=function(a){return $v(Yh,a)&&Yh[a].m?Yh[a].c:0},ZS=function(){ORe(this,wm);var i=arguments.length,l=L$(i<1?void 0:arguments[0]),o=L$(i<2?void 0:arguments[1],"Error"),c=U$(o);if(qRe(this,{type:Jh,name:o,message:l,code:c}),WS||(this.name=o,this.message=l,this.code=c),DRe){var t=new Hv(l);t.name=Jh,Wv(this,"stack",GS(1,PRe(t.stack,1)))}},wm=ZS.prototype=IRe(N$),j$=function(a){return{enumerable:!0,configurable:!0,get:a}},FS=function(a){return j$(function(){return RRe(this)[a]})};WS&&(Vv(wm,"code",FS("code")),Vv(wm,"message",FS("message")),Vv(wm,"name",FS("name")));Wv(wm,"constructor",GS(1,ZS));var Xv=$S(function(){return!(new ms instanceof Hv)}),V$=Xv||$S(function(){return N$.toString!==B$||String(new ms(1,2))!=="2: 1"}),$$=Xv||$S(function(){return new ms(1,"DataCloneError").code!==25}),LRe=Xv||ms[VS]!==25||MRe[VS]!==25,k$=F$?V$||$$||LRe:Xv;ERe({global:!0,constructor:!0,forced:k$},{DOMException:k$?ZS:ms});var Tm=Gv(Jh),Zv=Tm.prototype;V$&&(F$||ms===Tm)&&ARe(Zv,"toString",B$);$$&&WS&&ms===Tm&&Vv(Zv,"code",j$(function(){return U$(CRe(this).name)}));for(NS in Yh)$v(Yh,NS)&&(US=Yh[NS],bm=US.s,jS=GS(6,US.c),$v(Tm,bm)||Wv(Tm,bm,jS),$v(Zv,bm)||Wv(Zv,bm,jS));var US,bm,jS,NS});var J$=P(()=>{"use strict";var kRe=ge(),BRe=It(),t2=Wr(),QS=Hn(),e2=ri().f,W$=yr(),zRe=Xo(),FRe=ll(),Z$=mh(),HS=zS(),NRe=og(),URe=Vt(),K$=fi(),Sm="DOMException",Y$=t2("Error"),Im=t2(Sm),r2=function(){zRe(this,jRe);var i=arguments.length,l=Z$(i<1?void 0:arguments[0]),o=Z$(i<2?void 0:arguments[1],"Error"),c=new Im(l,o),t=new Y$(l);return t.name=Sm,e2(c,"stack",QS(1,NRe(t.stack,1))),FRe(c,this,r2),c},jRe=r2.prototype=Im.prototype,VRe="stack"in new Y$(Sm),$Re="stack"in new Im(1,2),XS=Im&&URe&&Object.getOwnPropertyDescriptor(BRe,Sm),GRe=!!XS&&!(XS.writable&&XS.configurable),H$=VRe&&!GRe&&!$Re;kRe({global:!0,constructor:!0,forced:K$||H$},{DOMException:H$?r2:Im});var Em=t2(Sm),X$=Em.prototype;if(X$.constructor!==Em){K$||e2(X$,"constructor",QS(1,Em));for(KS in HS)W$(HS,KS)&&(YS=HS[KS],JS=YS.s,W$(Em,JS)||e2(Em,JS,QS(6,YS.c)))}var YS,JS,KS});var eG=P(()=>{"use strict";var WRe=Wr(),ZRe=pn(),Q$="DOMException";ZRe(WRe(Q$),Q$)});var rG=P(()=>{"use strict";var HRe=ge(),XRe=It(),tG=Jp().clear;HRe({global:!0,bind:!0,enumerable:!0,forced:XRe.clearImmediate!==tG},{clearImmediate:tG})});var nG=P((DYe,iG)=>{"use strict";iG.exports=typeof Bun=="function"&&Bun&&typeof Bun.version=="string"});var Kv=P((LYe,aG)=>{"use strict";var oG=It(),KRe=po(),YRe=_r(),JRe=nG(),QRe=ya(),eDe=co(),tDe=mo(),rDe=oG.Function,iDe=/MSIE .\./.test(QRe)||JRe&&function(){var a=oG.Bun.version.split(".");return a.length<3||a[0]==="0"&&(a[1]<3||a[1]==="3"&&a[2]==="0")}();aG.exports=function(a,i){var l=i?2:1;return iDe?function(o,c){var t=tDe(arguments.length,1)>l,v=YRe(o)?o:rDe(o),S=t?eDe(arguments,l):[],C=t?function(){KRe(v,this,S)}:v;return i?a(C,c):a(C)}:a}});var cG=P(()=>{"use strict";var nDe=ge(),uG=It(),sG=Jp().set,oDe=Kv(),lG=uG.setImmediate?oDe(sG,!1):sG;nDe({global:!0,bind:!0,enumerable:!0,forced:uG.setImmediate!==lG},{setImmediate:lG})});var hG=P(()=>{"use strict";rG();cG()});var fG=P(()=>{"use strict";var aDe=ge(),sDe=KT(),lDe=ti(),uDe=mo();aDe({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(i){uDe(arguments.length,1),sDe(lDe(i))}})});var pG=P(()=>{"use strict";var cDe=ge(),vl=It(),hDe=Ri(),fDe=Vt(),dDe=TypeError,pDe=Object.defineProperty,dG=vl.self!==vl;try{fDe?(Yv=Object.getOwnPropertyDescriptor(vl,"self"),(dG||!Yv||!Yv.get||!Yv.enumerable)&&hDe(vl,"self",{get:function(){return vl},set:function(i){if(this!==vl)throw new dDe("Illegal invocation");pDe(vl,"self",{value:i,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})):cDe({global:!0,simple:!0,forced:dG},{self:vl})}catch{}var Yv});var n2=P(($Ye,mG)=>{"use strict";var i2=pt(),Jv=Set.prototype;mG.exports={Set,add:i2(Jv.add),has:i2(Jv.has),remove:i2(Jv.delete),proto:Jv}});var yG=P((GYe,_G)=>{"use strict";var mDe=rr();_G.exports=function(a,i,l){for(var o=l?a:a.iterator,c=a.next,t,v;!(t=mDe(c,o)).done;)if(v=i(t.value),v!==void 0)return v}});var TG=P((WYe,wG)=>{"use strict";var gG=pt(),_De=yG(),vG=n2(),yDe=vG.Set,xG=vG.proto,gDe=gG(xG.forEach),bG=gG(xG.keys),vDe=bG(new yDe).next;wG.exports=function(a,i,l){return l?_De({iterator:bG(a),next:vDe},i):gDe(a,i)}});var DG=P(()=>{"use strict";var xDe=fi(),bDe=ge(),Zi=It(),Om=Wr(),Pm=pt(),c2=ct(),wDe=Su(),ef=_r(),TDe=Ou(),EDe=fn(),i0=ur(),SDe=rl(),IDe=Kn(),IG=ir(),t0=Zo(),ADe=yr(),ODe=as(),o2=on(),Qv=Br(),CDe=mo(),PDe=Fh(),n0=sT(),h2=n2(),MDe=TG(),EG=jw(),qDe=Pb(),f2=Bg(),Am=Zi.Object,RDe=Zi.Array,AG=Zi.Date,OG=Zi.Error,DDe=Zi.TypeError,LDe=Zi.PerformanceMark,Wu=Om("DOMException"),l2=n0.Map,d2=n0.has,CG=n0.get,r0=n0.set,PG=h2.Set,MG=h2.add,kDe=h2.has,BDe=Om("Object","keys"),zDe=Pm([].push),FDe=Pm((!0).valueOf),NDe=Pm(1 .valueOf),UDe=Pm("".valueOf),jDe=Pm(AG.prototype.getTime),u2=wDe("structuredClone"),Cm="DataCloneError",e0="Transferring",qG=function(a){return!c2(function(){var i=new Zi.Set([7]),l=a(i),o=a(Am(7));return l===i||!l.has(7)||!i0(o)||+o!=7})&&a},SG=function(a,i){return!c2(function(){var l=new i,o=a({a:l,b:l});return!(o&&o.a===o.b&&o.a instanceof i&&o.a.stack===l.stack)})},VDe=function(a){return!c2(function(){var i=a(new Zi.AggregateError([1],u2,{cause:3}));return i.name!=="AggregateError"||i.errors[0]!==1||i.message!==u2||i.cause!==3})},Qh=Zi.structuredClone,$De=xDe||!SG(Qh,OG)||!SG(Qh,Wu)||!VDe(Qh),GDe=!Qh&&qG(function(a){return new LDe(u2,{detail:a}).detail}),_s=qG(Qh)||GDe,a2=function(a){throw new Wu("Uncloneable type: "+a,Cm)},zn=function(a,i){throw new Wu((i||"Cloning")+" of "+a+" cannot be properly polyfilled in this engine",Cm)},s2=function(a,i){return _s||zn(i),_s(a)},WDe=function(){var a;try{a=new Zi.DataTransfer}catch{try{a=new Zi.ClipboardEvent("").clipboardData}catch{}}return a&&a.items&&a.files?a:null},RG=function(a,i,l){if(d2(i,a))return CG(i,a);var o=l||t0(a),c,t,v,S,C,D;if(o==="SharedArrayBuffer")_s?c=_s(a):c=a;else{var z=Zi.DataView;!z&&!ef(a.slice)&&zn("ArrayBuffer");try{if(ef(a.slice)&&!a.resizable)c=a.slice(0);else for(t=a.byteLength,v=("maxByteLength"in a)?{maxByteLength:a.maxByteLength}:void 0,c=new ArrayBuffer(t,v),S=new z(a),C=new z(c),D=0;D<t;D++)C.setUint8(D,S.getUint8(D))}catch{throw new Wu("ArrayBuffer is detached",Cm)}}return r0(i,a,c),c},ZDe=function(a,i,l,o,c){var t=Zi[i];return i0(t)||zn(i),new t(RG(a.buffer,c),l,o)},Wi=function(a,i){if(SDe(a)&&a2("Symbol"),!i0(a))return a;if(i){if(d2(i,a))return CG(i,a)}else i=new l2;var l=t0(a),o,c,t,v,S,C,D,z;switch(l){case"Array":t=RDe(Qv(a));break;case"Object":t={};break;case"Map":t=new l2;break;case"Set":t=new PG;break;case"RegExp":t=new RegExp(a.source,PDe(a));break;case"Error":switch(c=a.name,c){case"AggregateError":t=new(Om(c))([]);break;case"EvalError":case"RangeError":case"ReferenceError":case"SuppressedError":case"SyntaxError":case"TypeError":case"URIError":t=new(Om(c));break;case"CompileError":case"LinkError":case"RuntimeError":t=new(Om("WebAssembly",c));break;default:t=new OG}break;case"DOMException":t=new Wu(a.message,a.name);break;case"ArrayBuffer":case"SharedArrayBuffer":t=RG(a,i,l);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":C=l==="DataView"?a.byteLength:a.length,t=ZDe(a,l,a.byteOffset,C,i);break;case"DOMQuad":try{t=new DOMQuad(Wi(a.p1,i),Wi(a.p2,i),Wi(a.p3,i),Wi(a.p4,i))}catch{t=s2(a,l)}break;case"File":if(_s)try{t=_s(a),t0(t)!==l&&(t=void 0)}catch{}if(!t)try{t=new File([a],a.name,a)}catch{}t||zn(l);break;case"FileList":if(v=WDe(),v){for(S=0,C=Qv(a);S<C;S++)v.items.add(Wi(a[S],i));t=v.files}else t=s2(a,l);break;case"ImageData":try{t=new ImageData(Wi(a.data,i),a.width,a.height,{colorSpace:a.colorSpace})}catch{t=s2(a,l)}break;default:if(_s)t=_s(a);else switch(l){case"BigInt":t=Am(a.valueOf());break;case"Boolean":t=Am(FDe(a));break;case"Number":t=Am(NDe(a));break;case"String":t=Am(UDe(a));break;case"Date":t=new AG(jDe(a));break;case"Blob":try{t=a.slice(0,a.size,a.type)}catch{zn(l)}break;case"DOMPoint":case"DOMPointReadOnly":o=Zi[l];try{t=o.fromPoint?o.fromPoint(a):new o(a.x,a.y,a.z,a.w)}catch{zn(l)}break;case"DOMRect":case"DOMRectReadOnly":o=Zi[l];try{t=o.fromRect?o.fromRect(a):new o(a.x,a.y,a.width,a.height)}catch{zn(l)}break;case"DOMMatrix":case"DOMMatrixReadOnly":o=Zi[l];try{t=o.fromMatrix?o.fromMatrix(a):new o(a)}catch{zn(l)}break;case"AudioData":case"VideoFrame":ef(a.clone)||zn(l);try{t=a.clone()}catch{a2(l)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":zn(l);default:a2(l)}}switch(r0(i,a,t),l){case"Array":case"Object":for(D=BDe(a),S=0,C=Qv(D);S<C;S++)z=D[S],ODe(t,z,Wi(a[z],i));break;case"Map":a.forEach(function(B,ne){r0(t,Wi(ne,i),Wi(B,i))});break;case"Set":a.forEach(function(B){MG(t,Wi(B,i))});break;case"Error":o2(t,"message",Wi(a.message,i)),ADe(a,"cause")&&o2(t,"cause",Wi(a.cause,i)),c==="AggregateError"?t.errors=Wi(a.errors,i):c==="SuppressedError"&&(t.error=Wi(a.error,i),t.suppressed=Wi(a.suppressed,i));case"DOMException":qDe&&o2(t,"stack",Wi(a.stack,i))}return t},HDe=function(a,i){if(!i0(a))throw new DDe("Transfer option cannot be converted to a sequence");var l=[];IDe(a,function(ne){zDe(l,IG(ne))});for(var o=0,c=Qv(l),t=new PG,v,S,C,D,z,B;o<c;){if(v=l[o++],S=t0(v),S==="ArrayBuffer"?kDe(t,v):d2(i,v))throw new Wu("Duplicate transferable",Cm);if(S==="ArrayBuffer"){MG(t,v);continue}if(f2)D=Qh(v,{transfer:[v]});else switch(S){case"ImageBitmap":C=Zi.OffscreenCanvas,TDe(C)||zn(S,e0);try{z=new C(v.width,v.height),B=z.getContext("bitmaprenderer"),B.transferFromImageBitmap(v),D=z.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!ef(v.clone)||!ef(v.close))&&zn(S,e0);try{D=v.clone(),v.close()}catch{}break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":zn(S,e0)}if(D===void 0)throw new Wu("This object cannot be transferred: "+S,Cm);r0(i,v,D)}return t},XDe=function(a){MDe(a,function(i){f2?_s(i,{transfer:[i]}):ef(i.transfer)?i.transfer():EG?EG(i):zn("ArrayBuffer",e0)})};bDe({global:!0,enumerable:!0,sham:!f2,forced:$De},{structuredClone:function(i){var l=CDe(arguments.length,1)>1&&!EDe(arguments[1])?IG(arguments[1]):void 0,o=l?l.transfer:void 0,c,t;o!==void 0&&(c=new l2,t=HDe(o,c));var v=Wi(i,c);return t&&XDe(t),v}})});var BG=P(()=>{"use strict";var KDe=ge(),kG=It(),YDe=Kv(),LG=YDe(kG.setInterval,!0);KDe({global:!0,bind:!0,forced:kG.setInterval!==LG},{setInterval:LG})});var NG=P(()=>{"use strict";var JDe=ge(),FG=It(),QDe=Kv(),zG=QDe(FG.setTimeout,!0);JDe({global:!0,bind:!0,forced:FG.setTimeout!==zG},{setTimeout:zG})});var UG=P(()=>{"use strict";BG();NG()});var o0=P((tJe,VG)=>{"use strict";var eLe=ct(),tLe=pr(),rLe=Vt(),jG=fi(),iLe=tLe("iterator");VG.exports=!eLe(function(){var a=new URL("b?a=1&b=2&c=3","http://a"),i=a.searchParams,l=new URLSearchParams("a=1&a=2&b=3"),o="";return a.pathname="c%20d",i.forEach(function(c,t){i.delete("b"),o+=t+c}),l.delete("a",2),l.delete("b",void 0),jG&&(!a.toJSON||!l.has("a",1)||l.has("a",2)||!l.has("a",void 0)||l.has("b"))||!i.size&&(jG||!rLe)||!i.sort||a.href!=="http://a/c%20d?a=1&c=3"||i.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!i[iLe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"})});var JG=P((rJe,YG)=>{"use strict";var Zu=pt(),p2=2147483647,Mm=36,HG=1,y2=26,nLe=38,oLe=700,aLe=72,sLe=128,lLe="-",uLe=/[^\0-\u007E]/,XG=/[.\u3002\uFF0E\uFF61]/g,$G="Overflow: input needs wider integers to process",m2=Mm-HG,GG=RangeError,cLe=Zu(XG.exec),tf=Math.floor,_2=String.fromCharCode,WG=Zu("".charCodeAt),KG=Zu([].join),xl=Zu([].push),hLe=Zu("".replace),fLe=Zu("".split),dLe=Zu("".toLowerCase),pLe=function(a){for(var i=[],l=0,o=a.length;l<o;){var c=WG(a,l++);if(c>=55296&&c<=56319&&l<o){var t=WG(a,l++);(t&64512)===56320?xl(i,((c&1023)<<10)+(t&1023)+65536):(xl(i,c),l--)}else xl(i,c)}return i},ZG=function(a){return a+22+75*(a<26)},mLe=function(a,i,l){var o=0;for(a=l?tf(a/oLe):a>>1,a+=tf(a/i);a>m2*y2>>1;)a=tf(a/m2),o+=Mm;return tf(o+(m2+1)*a/(a+nLe))},_Le=function(a){var i=[];a=pLe(a);var l=a.length,o=sLe,c=0,t=aLe,v,S;for(v=0;v<a.length;v++)S=a[v],S<128&&xl(i,_2(S));var C=i.length,D=C;for(C&&xl(i,lLe);D<l;){var z=p2;for(v=0;v<a.length;v++)S=a[v],S>=o&&S<z&&(z=S);var B=D+1;if(z-o>tf((p2-c)/B))throw new GG($G);for(c+=(z-o)*B,o=z,v=0;v<a.length;v++){if(S=a[v],S<o&&++c>p2)throw new GG($G);if(S===o){for(var ne=c,pe=Mm;;){var $e=pe<=t?HG:pe>=t+y2?y2:pe-t;if(ne<$e)break;var Ae=ne-$e,ke=Mm-$e;xl(i,_2(ZG($e+Ae%ke))),ne=tf(Ae/ke),pe+=Mm}xl(i,_2(ZG(ne))),t=mLe(c,B,D===C),c=0,D++}}c++,o++}return KG(i,"")};YG.exports=function(a){var i=[],l=fLe(hLe(dLe(a),XG,"."),"."),o,c;for(o=0;o<l.length;o++)c=l[o],xl(i,cLe(uLe,c)?"xn--"+_Le(c):c);return KG(i,".")}});var I2=P((iJe,vW)=>{"use strict";Mp();var w2=ge(),c0=It(),E2=VT(),a0=rr(),Aa=pt(),qm=Vt(),hW=o0(),fW=Kr(),yLe=Ri(),gLe=bh(),vLe=pn(),xLe=pg(),S2=Ai(),dW=Xo(),g2=_r(),bLe=yr(),wLe=ho(),TLe=Zo(),ELe=ir(),pW=ur(),yn=Qt(),SLe=Rn(),QG=Hn(),eW=Sp(),ILe=yh(),s0=xh(),rf=mo(),ALe=pr(),OLe=xg(),CLe=ALe("iterator"),of="URLSearchParams",mW=of+"Iterator",_W=S2.set,_o=S2.getterFor(of),PLe=S2.getterFor(mW),tW=E2("fetch"),u0=E2("Request"),Rm=E2("Headers"),v2=u0&&u0.prototype,rW=Rm&&Rm.prototype,MLe=c0.RegExp,qLe=c0.TypeError,yW=c0.decodeURIComponent,RLe=c0.encodeURIComponent,DLe=Aa("".charAt),iW=Aa([].join),Hu=Aa([].push),T2=Aa("".replace),LLe=Aa([].shift),nW=Aa([].splice),oW=Aa("".split),kLe=Aa("".slice),BLe=/\+/g,aW=Array(4),zLe=function(a){return aW[a-1]||(aW[a-1]=MLe("((?:%[\\da-f]{2}){"+a+"})","gi"))},FLe=function(a){try{return yW(a)}catch{return a}},sW=function(a){var i=T2(a,BLe," "),l=4;try{return yW(i)}catch{for(;l;)i=T2(i,zLe(l--),FLe);return i}},NLe=/[!'()~]|%20/g,ULe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},jLe=function(a){return ULe[a]},lW=function(a){return T2(RLe(a),NLe,jLe)},x2=xLe(function(i,l){_W(this,{type:mW,target:_o(i).entries,index:0,kind:l})},of,function(){var i=PLe(this),l=i.target,o=i.index++;if(!l||o>=l.length)return i.target=void 0,s0(void 0,!0);var c=l[o];switch(i.kind){case"keys":return s0(c.key,!1);case"values":return s0(c.value,!1)}return s0([c.key,c.value],!1)},!0),gW=function(a){this.entries=[],this.url=null,a!==void 0&&(pW(a)?this.parseObject(a):this.parseQuery(typeof a=="string"?DLe(a,0)==="?"?kLe(a,1):a:yn(a)))};gW.prototype={type:of,bindURL:function(a){this.url=a,this.update()},parseObject:function(a){var i=this.entries,l=ILe(a),o,c,t,v,S,C,D;if(l)for(o=eW(a,l),c=o.next;!(t=a0(c,o)).done;){if(v=eW(ELe(t.value)),S=v.next,(C=a0(S,v)).done||(D=a0(S,v)).done||!a0(S,v).done)throw new qLe("Expected sequence with length 2");Hu(i,{key:yn(C.value),value:yn(D.value)})}else for(var z in a)bLe(a,z)&&Hu(i,{key:z,value:yn(a[z])})},parseQuery:function(a){if(a)for(var i=this.entries,l=oW(a,"&"),o=0,c,t;o<l.length;)c=l[o++],c.length&&(t=oW(c,"="),Hu(i,{key:sW(LLe(t)),value:sW(iW(t,"="))}))},serialize:function(){for(var a=this.entries,i=[],l=0,o;l<a.length;)o=a[l++],Hu(i,lW(o.key)+"="+lW(o.value));return iW(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var h0=function(){dW(this,nf);var i=arguments.length>0?arguments[0]:void 0,l=_W(this,new gW(i));qm||(this.size=l.entries.length)},nf=h0.prototype;gLe(nf,{append:function(i,l){var o=_o(this);rf(arguments.length,2),Hu(o.entries,{key:yn(i),value:yn(l)}),qm||this.length++,o.updateURL()},delete:function(a){for(var i=_o(this),l=rf(arguments.length,1),o=i.entries,c=yn(a),t=l<2?void 0:arguments[1],v=t===void 0?t:yn(t),S=0;S<o.length;){var C=o[S];if(C.key===c&&(v===void 0||C.value===v)){if(nW(o,S,1),v!==void 0)break}else S++}qm||(this.size=o.length),i.updateURL()},get:function(i){var l=_o(this).entries;rf(arguments.length,1);for(var o=yn(i),c=0;c<l.length;c++)if(l[c].key===o)return l[c].value;return null},getAll:function(i){var l=_o(this).entries;rf(arguments.length,1);for(var o=yn(i),c=[],t=0;t<l.length;t++)l[t].key===o&&Hu(c,l[t].value);return c},has:function(i){for(var l=_o(this).entries,o=rf(arguments.length,1),c=yn(i),t=o<2?void 0:arguments[1],v=t===void 0?t:yn(t),S=0;S<l.length;){var C=l[S++];if(C.key===c&&(v===void 0||C.value===v))return!0}return!1},set:function(i,l){var o=_o(this);rf(arguments.length,1);for(var c=o.entries,t=!1,v=yn(i),S=yn(l),C=0,D;C<c.length;C++)D=c[C],D.key===v&&(t?nW(c,C--,1):(t=!0,D.value=S));t||Hu(c,{key:v,value:S}),qm||(this.size=c.length),o.updateURL()},sort:function(){var i=_o(this);OLe(i.entries,function(l,o){return l.key>o.key?1:-1}),i.updateURL()},forEach:function(i){for(var l=_o(this).entries,o=wLe(i,arguments.length>1?arguments[1]:void 0),c=0,t;c<l.length;)t=l[c++],o(t.value,t.key,this)},keys:function(){return new x2(this,"keys")},values:function(){return new x2(this,"values")},entries:function(){return new x2(this,"entries")}},{enumerable:!0});fW(nf,CLe,nf.entries,{name:"entries"});fW(nf,"toString",function(){return _o(this).serialize()},{enumerable:!0});qm&&yLe(nf,"size",{get:function(){return _o(this).entries.length},configurable:!0,enumerable:!0});vLe(h0,of);w2({global:!0,constructor:!0,forced:!hW},{URLSearchParams:h0});!hW&&g2(Rm)&&(uW=Aa(rW.has),cW=Aa(rW.set),b2=function(a){if(pW(a)){var i=a.body,l;if(TLe(i)===of)return l=a.headers?new Rm(a.headers):new Rm,uW(l,"content-type")||cW(l,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),SLe(a,{body:QG(0,yn(i)),headers:QG(0,l)})}return a},g2(tW)&&w2({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(i){return tW(i,arguments.length>1?b2(arguments[1]):{})}}),g2(u0)&&(l0=function(i){return dW(this,v2),new u0(i,arguments.length>1?b2(arguments[1]):{})},v2.constructor=l0,l0.prototype=v2,w2({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:l0})));var uW,cW,b2,l0;vW.exports={URLSearchParams:h0,getState:_o}});var BW=P(()=>{"use strict";PE();var VLe=ge(),V2=Vt(),$Le=o0(),$2=It(),xW=ho(),bo=pt(),_0=Kr(),yo=Ri(),GLe=Xo(),N2=yr(),G2=IT(),af=Kb(),Jo=co(),WLe=am().codeAt,ZLe=JG(),gs=Qt(),HLe=pn(),XLe=mo(),MW=I2(),qW=Ai(),KLe=qW.set,y0=qW.getterFor("URL"),YLe=MW.URLSearchParams,JLe=MW.getState,Dm=$2.URL,U2=$2.TypeError,g0=$2.parseInt,QLe=Math.floor,bW=Math.pow,xo=bo("".charAt),Qo=bo(/./.exec),km=bo([].join),eke=bo(1 .toString),tke=bo([].pop),lf=bo([].push),A2=bo("".replace),rke=bo([].shift),ike=bo("".split),zm=bo("".slice),v0=bo("".toLowerCase),nke=bo([].unshift),oke="Invalid authority",O2="Invalid scheme",Xu="Invalid host",wW="Invalid port",RW=/[a-z]/i,ake=/[\d+-.a-z]/i,j2=/\d/,ske=/^0x/i,lke=/^[0-7]+$/,uke=/^\d+$/,DW=/^[\da-f]+$/i,cke=/[\0\t\n\r #%/:<>?@[\\\]^|]/,hke=/[\0\t\n\r #/:<>?@[\\\]^|]/,fke=/^[\u0000-\u0020]+/,dke=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,pke=/[\t\n\r]/g,go,mke=function(a){var i=ike(a,"."),l,o,c,t,v,S,C;if(i.length&&i[i.length-1]===""&&i.length--,l=i.length,l>4)return a;for(o=[],c=0;c<l;c++){if(t=i[c],t==="")return a;if(v=10,t.length>1&&xo(t,0)==="0"&&(v=Qo(ske,t)?16:8,t=zm(t,v===8?1:2)),t==="")S=0;else{if(!Qo(v===10?uke:v===8?lke:DW,t))return a;S=g0(t,v)}lf(o,S)}for(c=0;c<l;c++)if(S=o[c],c===l-1){if(S>=bW(256,5-l))return null}else if(S>255)return null;for(C=tke(o),c=0;c<o.length;c++)C+=o[c]*bW(256,3-c);return C},_ke=function(a){var i=[0,0,0,0,0,0,0,0],l=0,o=null,c=0,t,v,S,C,D,z,B,ne=function(){return xo(a,c)};if(ne()===":"){if(xo(a,1)!==":")return;c+=2,l++,o=l}for(;ne();){if(l===8)return;if(ne()===":"){if(o!==null)return;c++,l++,o=l;continue}for(t=v=0;v<4&&Qo(DW,ne());)t=t*16+g0(ne(),16),c++,v++;if(ne()==="."){if(v===0||(c-=v,l>6))return;for(S=0;ne();){if(C=null,S>0)if(ne()==="."&&S<4)c++;else return;if(!Qo(j2,ne()))return;for(;Qo(j2,ne());){if(D=g0(ne(),10),C===null)C=D;else{if(C===0)return;C=C*10+D}if(C>255)return;c++}i[l]=i[l]*256+C,S++,(S===2||S===4)&&l++}if(S!==4)return;break}else if(ne()===":"){if(c++,!ne())return}else if(ne())return;i[l++]=t}if(o!==null)for(z=l-o,l=7;l!==0&&z>0;)B=i[l],i[l--]=i[o+z-1],i[o+--z]=B;else if(l!==8)return;return i},yke=function(a){for(var i=null,l=1,o=null,c=0,t=0;t<8;t++)a[t]!==0?(c>l&&(i=o,l=c),o=null,c=0):(o===null&&(o=t),++c);return c>l&&(i=o,l=c),i},Lm=function(a){var i,l,o,c;if(typeof a=="number"){for(i=[],l=0;l<4;l++)nke(i,a%256),a=QLe(a/256);return km(i,".")}else if(typeof a=="object"){for(i="",o=yke(a),l=0;l<8;l++)c&&a[l]===0||(c&&(c=!1),o===l?(i+=l?":":"::",c=!0):(i+=eke(a[l],16),l<7&&(i+=":")));return"["+i+"]"}return a},m0={},LW=G2({},m0,{" ":1,'"':1,"<":1,">":1,"`":1}),kW=G2({},LW,{"#":1,"?":1,"{":1,"}":1}),C2=G2({},kW,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),bl=function(a,i){var l=WLe(a,0);return l>32&&l<127&&!N2(i,a)?a:encodeURIComponent(a)},f0={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Bm=function(a,i){var l;return a.length===2&&Qo(RW,xo(a,0))&&((l=xo(a,1))===":"||!i&&l==="|")},TW=function(a){var i;return a.length>1&&Bm(zm(a,0,2))&&(a.length===2||(i=xo(a,2))==="/"||i==="\\"||i==="?"||i==="#")},gke=function(a){return a==="."||v0(a)==="%2e"},vke=function(a){return a=v0(a),a===".."||a==="%2e."||a===".%2e"||a==="%2e%2e"},P2={},EW={},M2={},SW={},IW={},q2={},AW={},OW={},d0={},p0={},R2={},D2={},L2={},k2={},CW={},B2={},sf={},Oa={},PW={},Ku={},ys={},W2=function(a,i,l){var o=gs(a),c,t,v;if(i){if(t=this.parse(o),t)throw new U2(t);this.searchParams=null}else{if(l!==void 0&&(c=new W2(l,!0)),t=this.parse(o,null,c),t)throw new U2(t);v=JLe(new YLe),v.bindURL(this),this.searchParams=v}};W2.prototype={type:"URL",parse:function(a,i,l){var o=this,c=i||P2,t=0,v="",S=!1,C=!1,D=!1,z,B,ne,pe;for(a=gs(a),i||(o.scheme="",o.username="",o.password="",o.host=null,o.port=null,o.path=[],o.query=null,o.fragment=null,o.cannotBeABaseURL=!1,a=A2(a,fke,""),a=A2(a,dke,"$1")),a=A2(a,pke,""),z=af(a);t<=z.length;){switch(B=z[t],c){case P2:if(B&&Qo(RW,B))v+=v0(B),c=EW;else{if(i)return O2;c=M2;continue}break;case EW:if(B&&(Qo(ake,B)||B==="+"||B==="-"||B==="."))v+=v0(B);else if(B===":"){if(i&&(o.isSpecial()!==N2(f0,v)||v==="file"&&(o.includesCredentials()||o.port!==null)||o.scheme==="file"&&!o.host))return;if(o.scheme=v,i){o.isSpecial()&&f0[o.scheme]===o.port&&(o.port=null);return}v="",o.scheme==="file"?c=k2:o.isSpecial()&&l&&l.scheme===o.scheme?c=SW:o.isSpecial()?c=OW:z[t+1]==="/"?(c=IW,t++):(o.cannotBeABaseURL=!0,lf(o.path,""),c=PW)}else{if(i)return O2;v="",c=M2,t=0;continue}break;case M2:if(!l||l.cannotBeABaseURL&&B!=="#")return O2;if(l.cannotBeABaseURL&&B==="#"){o.scheme=l.scheme,o.path=Jo(l.path),o.query=l.query,o.fragment="",o.cannotBeABaseURL=!0,c=ys;break}c=l.scheme==="file"?k2:q2;continue;case SW:if(B==="/"&&z[t+1]==="/")c=d0,t++;else{c=q2;continue}break;case IW:if(B==="/"){c=p0;break}else{c=Oa;continue}case q2:if(o.scheme=l.scheme,B===go)o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,o.path=Jo(l.path),o.query=l.query;else if(B==="/"||B==="\\"&&o.isSpecial())c=AW;else if(B==="?")o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,o.path=Jo(l.path),o.query="",c=Ku;else if(B==="#")o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,o.path=Jo(l.path),o.query=l.query,o.fragment="",c=ys;else{o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,o.path=Jo(l.path),o.path.length--,c=Oa;continue}break;case AW:if(o.isSpecial()&&(B==="/"||B==="\\"))c=d0;else if(B==="/")c=p0;else{o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,c=Oa;continue}break;case OW:if(c=d0,B!=="/"||xo(v,t+1)!=="/")continue;t++;break;case d0:if(B!=="/"&&B!=="\\"){c=p0;continue}break;case p0:if(B==="@"){S&&(v="%40"+v),S=!0,ne=af(v);for(var $e=0;$e<ne.length;$e++){var Ae=ne[$e];if(Ae===":"&&!D){D=!0;continue}var ke=bl(Ae,C2);D?o.password+=ke:o.username+=ke}v=""}else if(B===go||B==="/"||B==="?"||B==="#"||B==="\\"&&o.isSpecial()){if(S&&v==="")return oke;t-=af(v).length+1,v="",c=R2}else v+=B;break;case R2:case D2:if(i&&o.scheme==="file"){c=B2;continue}else if(B===":"&&!C){if(v==="")return Xu;if(pe=o.parseHost(v),pe)return pe;if(v="",c=L2,i===D2)return}else if(B===go||B==="/"||B==="?"||B==="#"||B==="\\"&&o.isSpecial()){if(o.isSpecial()&&v==="")return Xu;if(i&&v===""&&(o.includesCredentials()||o.port!==null))return;if(pe=o.parseHost(v),pe)return pe;if(v="",c=sf,i)return;continue}else B==="["?C=!0:B==="]"&&(C=!1),v+=B;break;case L2:if(Qo(j2,B))v+=B;else if(B===go||B==="/"||B==="?"||B==="#"||B==="\\"&&o.isSpecial()||i){if(v!==""){var Ge=g0(v,10);if(Ge>65535)return wW;o.port=o.isSpecial()&&Ge===f0[o.scheme]?null:Ge,v=""}if(i)return;c=sf;continue}else return wW;break;case k2:if(o.scheme="file",B==="/"||B==="\\")c=CW;else if(l&&l.scheme==="file")switch(B){case go:o.host=l.host,o.path=Jo(l.path),o.query=l.query;break;case"?":o.host=l.host,o.path=Jo(l.path),o.query="",c=Ku;break;case"#":o.host=l.host,o.path=Jo(l.path),o.query=l.query,o.fragment="",c=ys;break;default:TW(km(Jo(z,t),""))||(o.host=l.host,o.path=Jo(l.path),o.shortenPath()),c=Oa;continue}else{c=Oa;continue}break;case CW:if(B==="/"||B==="\\"){c=B2;break}l&&l.scheme==="file"&&!TW(km(Jo(z,t),""))&&(Bm(l.path[0],!0)?lf(o.path,l.path[0]):o.host=l.host),c=Oa;continue;case B2:if(B===go||B==="/"||B==="\\"||B==="?"||B==="#"){if(!i&&Bm(v))c=Oa;else if(v===""){if(o.host="",i)return;c=sf}else{if(pe=o.parseHost(v),pe)return pe;if(o.host==="localhost"&&(o.host=""),i)return;v="",c=sf}continue}else v+=B;break;case sf:if(o.isSpecial()){if(c=Oa,B!=="/"&&B!=="\\")continue}else if(!i&&B==="?")o.query="",c=Ku;else if(!i&&B==="#")o.fragment="",c=ys;else if(B!==go&&(c=Oa,B!=="/"))continue;break;case Oa:if(B===go||B==="/"||B==="\\"&&o.isSpecial()||!i&&(B==="?"||B==="#")){if(vke(v)?(o.shortenPath(),B!=="/"&&!(B==="\\"&&o.isSpecial())&&lf(o.path,"")):gke(v)?B!=="/"&&!(B==="\\"&&o.isSpecial())&&lf(o.path,""):(o.scheme==="file"&&!o.path.length&&Bm(v)&&(o.host&&(o.host=""),v=xo(v,0)+":"),lf(o.path,v)),v="",o.scheme==="file"&&(B===go||B==="?"||B==="#"))for(;o.path.length>1&&o.path[0]==="";)rke(o.path);B==="?"?(o.query="",c=Ku):B==="#"&&(o.fragment="",c=ys)}else v+=bl(B,kW);break;case PW:B==="?"?(o.query="",c=Ku):B==="#"?(o.fragment="",c=ys):B!==go&&(o.path[0]+=bl(B,m0));break;case Ku:!i&&B==="#"?(o.fragment="",c=ys):B!==go&&(B==="'"&&o.isSpecial()?o.query+="%27":B==="#"?o.query+="%23":o.query+=bl(B,m0));break;case ys:B!==go&&(o.fragment+=bl(B,LW));break}t++}},parseHost:function(a){var i,l,o;if(xo(a,0)==="["){if(xo(a,a.length-1)!=="]"||(i=_ke(zm(a,1,-1)),!i))return Xu;this.host=i}else if(this.isSpecial()){if(a=ZLe(a),Qo(cke,a)||(i=mke(a),i===null))return Xu;this.host=i}else{if(Qo(hke,a))return Xu;for(i="",l=af(a),o=0;o<l.length;o++)i+=bl(l[o],m0);this.host=i}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return N2(f0,this.scheme)},shortenPath:function(){var a=this.path,i=a.length;i&&(this.scheme!=="file"||i!==1||!Bm(a[0],!0))&&a.length--},serialize:function(){var a=this,i=a.scheme,l=a.username,o=a.password,c=a.host,t=a.port,v=a.path,S=a.query,C=a.fragment,D=i+":";return c!==null?(D+="//",a.includesCredentials()&&(D+=l+(o?":"+o:"")+"@"),D+=Lm(c),t!==null&&(D+=":"+t)):i==="file"&&(D+="//"),D+=a.cannotBeABaseURL?v[0]:v.length?"/"+km(v,"/"):"",S!==null&&(D+="?"+S),C!==null&&(D+="#"+C),D},setHref:function(a){var i=this.parse(a);if(i)throw new U2(i);this.searchParams.update()},getOrigin:function(){var a=this.scheme,i=this.port;if(a==="blob")try{return new uf(a.path[0]).origin}catch{return"null"}return a==="file"||!this.isSpecial()?"null":a+"://"+Lm(this.host)+(i!==null?":"+i:"")},getProtocol:function(){return this.scheme+":"},setProtocol:function(a){this.parse(gs(a)+":",P2)},getUsername:function(){return this.username},setUsername:function(a){var i=af(gs(a));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var l=0;l<i.length;l++)this.username+=bl(i[l],C2)}},getPassword:function(){return this.password},setPassword:function(a){var i=af(gs(a));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var l=0;l<i.length;l++)this.password+=bl(i[l],C2)}},getHost:function(){var a=this.host,i=this.port;return a===null?"":i===null?Lm(a):Lm(a)+":"+i},setHost:function(a){this.cannotBeABaseURL||this.parse(a,R2)},getHostname:function(){var a=this.host;return a===null?"":Lm(a)},setHostname:function(a){this.cannotBeABaseURL||this.parse(a,D2)},getPort:function(){var a=this.port;return a===null?"":gs(a)},setPort:function(a){this.cannotHaveUsernamePasswordPort()||(a=gs(a),a===""?this.port=null:this.parse(a,L2))},getPathname:function(){var a=this.path;return this.cannotBeABaseURL?a[0]:a.length?"/"+km(a,"/"):""},setPathname:function(a){this.cannotBeABaseURL||(this.path=[],this.parse(a,sf))},getSearch:function(){var a=this.query;return a?"?"+a:""},setSearch:function(a){a=gs(a),a===""?this.query=null:(xo(a,0)==="?"&&(a=zm(a,1)),this.query="",this.parse(a,Ku)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var a=this.fragment;return a?"#"+a:""},setHash:function(a){if(a=gs(a),a===""){this.fragment=null;return}xo(a,0)==="#"&&(a=zm(a,1)),this.fragment="",this.parse(a,ys)},update:function(){this.query=this.searchParams.serialize()||null}};var uf=function(i){var l=GLe(this,gn),o=XLe(arguments.length,1)>1?arguments[1]:void 0,c=KLe(l,new W2(i,!1,o));V2||(l.href=c.serialize(),l.origin=c.getOrigin(),l.protocol=c.getProtocol(),l.username=c.getUsername(),l.password=c.getPassword(),l.host=c.getHost(),l.hostname=c.getHostname(),l.port=c.getPort(),l.pathname=c.getPathname(),l.search=c.getSearch(),l.searchParams=c.getSearchParams(),l.hash=c.getHash())},gn=uf.prototype,vo=function(a,i){return{get:function(){return y0(this)[a]()},set:i&&function(l){return y0(this)[i](l)},configurable:!0,enumerable:!0}};V2&&(yo(gn,"href",vo("serialize","setHref")),yo(gn,"origin",vo("getOrigin")),yo(gn,"protocol",vo("getProtocol","setProtocol")),yo(gn,"username",vo("getUsername","setUsername")),yo(gn,"password",vo("getPassword","setPassword")),yo(gn,"host",vo("getHost","setHost")),yo(gn,"hostname",vo("getHostname","setHostname")),yo(gn,"port",vo("getPort","setPort")),yo(gn,"pathname",vo("getPathname","setPathname")),yo(gn,"search",vo("getSearch","setSearch")),yo(gn,"searchParams",vo("getSearchParams")),yo(gn,"hash",vo("getHash","setHash")));_0(gn,"toJSON",function(){return y0(this).serialize()},{enumerable:!0});_0(gn,"toString",function(){return y0(this).serialize()},{enumerable:!0});Dm&&(z2=Dm.createObjectURL,F2=Dm.revokeObjectURL,z2&&_0(uf,"createObjectURL",xW(z2,Dm)),F2&&_0(uf,"revokeObjectURL",xW(F2,Dm)));var z2,F2;HLe(uf,"URL");VLe({global:!0,constructor:!0,forced:!$Le,sham:!V2},{URL:uf})});var zW=P(()=>{"use strict";BW()});var UW=P(()=>{"use strict";var xke=ge(),bke=Wr(),wke=ct(),Tke=mo(),FW=Qt(),Eke=o0(),NW=bke("URL"),Ske=Eke&&wke(function(){NW.canParse()});xke({target:"URL",stat:!0,forced:!Ske},{canParse:function(i){var l=Tke(arguments.length,1),o=FW(i),c=l<2||arguments[1]===void 0?void 0:FW(arguments[1]);try{return!!new NW(o,c)}catch{return!1}}})});var jW=P(()=>{"use strict";var Ike=ge(),Ake=rr();Ike({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return Ake(URL.prototype.toString,this)}})});var VW=P(()=>{"use strict";I2()});var ZW=P(()=>{"use strict";var Oke=Kr(),x0=pt(),$W=Qt(),Cke=mo(),WW=URLSearchParams,b0=WW.prototype,Pke=x0(b0.append),GW=x0(b0.delete),Mke=x0(b0.forEach),qke=x0([].push),Z2=new WW("a=1&a=2&b=3");Z2.delete("a",1);Z2.delete("b",void 0);Z2+""!="a=2"&&Oke(b0,"delete",function(a){var i=arguments.length,l=i<2?void 0:arguments[1];if(i&&l===void 0)return GW(this,a);var o=[];Mke(this,function(B,ne){qke(o,{key:ne,value:B})}),Cke(i,1);for(var c=$W(a),t=$W(l),v=0,S=0,C=!1,D=o.length,z;v<D;)z=o[v++],C||z.key===c?(C=!0,GW(this,z.key)):S++;for(;S<D;)z=o[S++],z.key===c&&z.value===t||Pke(this,z.key,z.value)},{enumerable:!0,unsafe:!0})});var YW=P(()=>{"use strict";var Rke=Kr(),XW=pt(),Dke=Qt(),Lke=mo(),KW=URLSearchParams,H2=KW.prototype,kke=XW(H2.getAll),Bke=XW(H2.has),HW=new KW("a=1");(HW.has("a",2)||!HW.has("a",void 0))&&Rke(H2,"has",function(i){var l=arguments.length,o=l<2?void 0:arguments[1];if(l&&o===void 0)return Bke(this,i);var c=kke(this,i);Lke(l,1);for(var t=Dke(o),v=0;v<c.length;)if(c[v++]===t)return!0;return!1},{enumerable:!0,unsafe:!0})});var JW=P(()=>{"use strict";var zke=Vt(),Fke=pt(),Nke=Ri(),X2=URLSearchParams.prototype,Uke=Fke(X2.forEach);zke&&!("size"in X2)&&Nke(X2,"size",{get:function(){var i=0;return Uke(this,function(){i++}),i},configurable:!0,enumerable:!0})});var e7=P((xJe,QW)=>{"use strict";fR();vR();xR();bR();wR();TR();ER();SR();IR();AR();OR();CR();PR();MR();qR();nD();uD();ID();PD();qD();FD();VD();GD();HD();XD();YD();QD();rL();iL();aL();sL();cL();xL();bL();TL();EL();Mp();GL();XL();KL();JL();ek();sk();uk();hk();pk();mk();Mk();Dk();Lk();Bk();Uk();jk();Vk();$k();Gk();Zk();EB();kB();GB();ZB();YB();p3();_3();y3();v3();w3();T3();R3();D3();F3();V3();G3();Y3();ez();nz();oz();Eb();az();Tz();Sz();Oz();Mz();Rz();Dz();Lz();zz();Nz();Uz();Vz();Gz();Zz();Hz();Xz();Kz();Qz();rF();iF();nF();mF();_F();vF();bF();wF();TF();EF();SF();MF();FF();$F();KF();QF();nN();oN();lN();cN();fN();dN();vN();xN();bN();EN();SN();IN();ON();CN();PN();qN();DN();kN();zN();NN();UN();jN();VN();HN();XN();KN();QN();eU();rU();nU();p4();m4();y4();b4();w4();T4();P4();R4();D4();z4();F4();N4();U4();j4();V4();$4();X4();Y4();J4();p5();_5();pv();w5();E5();A5();M5();R5();D5();z5();V5();W5();H5();K5();PE();u6();v6();b6();w6();I6();A6();R6();k6();F6();$6();Z6();X6();Q6();ij();lj();dj();yj();gj();vj();xj();bj();wj();Tj();Ej();Sj();Ij();Aj();Oj();Cj();oV();aV();sV();lV();uV();cV();hV();fV();dV();mV();yV();vV();bV();AV();CV();MV();RV();LV();BV();zV();NV();jV();ZV();XV();YV();QV();t8();i8();o8();s8();d8();m8();y8();T8();I8();M8();q8();R8();L8();k8();U8();r$();n$();_$();b$();O$();R$();G$();J$();eG();hG();fG();pG();DG();UG();zW();UW();jW();VW();ZW();YW();JW();QW.exports=Ky()});var t7=P((bJe,Y2)=>{var K2=function(a){"use strict";var i=Object.prototype,l=i.hasOwnProperty,o=Object.defineProperty||function(Fe,Le,Ke){Fe[Le]=Ke.value},c,t=typeof Symbol=="function"?Symbol:{},v=t.iterator||"@@iterator",S=t.asyncIterator||"@@asyncIterator",C=t.toStringTag||"@@toStringTag";function D(Fe,Le,Ke){return Object.defineProperty(Fe,Le,{value:Ke,enumerable:!0,configurable:!0,writable:!0}),Fe[Le]}try{D({},"")}catch{D=function(Le,Ke,gt){return Le[Ke]=gt}}function z(Fe,Le,Ke,gt){var vt=Le&&Le.prototype instanceof Ge?Le:Ge,tr=Object.create(vt.prototype),hr=new xi(gt||[]);return o(tr,"_invoke",{value:Pt(Fe,Ke,hr)}),tr}a.wrap=z;function B(Fe,Le,Ke){try{return{type:"normal",arg:Fe.call(Le,Ke)}}catch(gt){return{type:"throw",arg:gt}}}var ne="suspendedStart",pe="suspendedYield",$e="executing",Ae="completed",ke={};function Ge(){}function tt(){}function mt(){}var Mt={};D(Mt,v,function(){return this});var Kt=Object.getPrototypeOf,At=Kt&&Kt(Kt(qe([])));At&&At!==i&&l.call(At,v)&&(Mt=At);var Ve=mt.prototype=Ge.prototype=Object.create(Mt);tt.prototype=mt,o(Ve,"constructor",{value:mt,configurable:!0}),o(mt,"constructor",{value:tt,configurable:!0}),tt.displayName=D(mt,C,"GeneratorFunction");function er(Fe){["next","throw","return"].forEach(function(Le){D(Fe,Le,function(Ke){return this._invoke(Le,Ke)})})}a.isGeneratorFunction=function(Fe){var Le=typeof Fe=="function"&&Fe.constructor;return Le?Le===tt||(Le.displayName||Le.name)==="GeneratorFunction":!1},a.mark=function(Fe){return Object.setPrototypeOf?Object.setPrototypeOf(Fe,mt):(Fe.__proto__=mt,D(Fe,C,"GeneratorFunction")),Fe.prototype=Object.create(Ve),Fe},a.awrap=function(Fe){return{__await:Fe}};function Dt(Fe,Le){function Ke(tr,hr,Dr,Yr){var yi=B(Fe[tr],Fe,hr);if(yi.type==="throw")Yr(yi.arg);else{var Un=yi.arg,vn=Un.value;return vn&&typeof vn=="object"&&l.call(vn,"__await")?Le.resolve(vn.__await).then(function(zt){Ke("next",zt,Dr,Yr)},function(zt){Ke("throw",zt,Dr,Yr)}):Le.resolve(vn).then(function(zt){Un.value=zt,Dr(Un)},function(zt){return Ke("throw",zt,Dr,Yr)})}}var gt;function vt(tr,hr){function Dr(){return new Le(function(Yr,yi){Ke(tr,hr,Yr,yi)})}return gt=gt?gt.then(Dr,Dr):Dr()}o(this,"_invoke",{value:vt})}er(Dt.prototype),D(Dt.prototype,S,function(){return this}),a.AsyncIterator=Dt,a.async=function(Fe,Le,Ke,gt,vt){vt===void 0&&(vt=Promise);var tr=new Dt(z(Fe,Le,Ke,gt),vt);return a.isGeneratorFunction(Le)?tr:tr.next().then(function(hr){return hr.done?hr.value:tr.next()})};function Pt(Fe,Le,Ke){var gt=ne;return function(tr,hr){if(gt===$e)throw new Error("Generator is already running");if(gt===Ae){if(tr==="throw")throw hr;return Ne()}for(Ke.method=tr,Ke.arg=hr;;){var Dr=Ke.delegate;if(Dr){var Yr=Or(Dr,Ke);if(Yr){if(Yr===ke)continue;return Yr}}if(Ke.method==="next")Ke.sent=Ke._sent=Ke.arg;else if(Ke.method==="throw"){if(gt===ne)throw gt=Ae,Ke.arg;Ke.dispatchException(Ke.arg)}else Ke.method==="return"&&Ke.abrupt("return",Ke.arg);gt=$e;var yi=B(Fe,Le,Ke);if(yi.type==="normal"){if(gt=Ke.done?Ae:pe,yi.arg===ke)continue;return{value:yi.arg,done:Ke.done}}else yi.type==="throw"&&(gt=Ae,Ke.method="throw",Ke.arg=yi.arg)}}}function Or(Fe,Le){var Ke=Le.method,gt=Fe.iterator[Ke];if(gt===c)return Le.delegate=null,Ke==="throw"&&Fe.iterator.return&&(Le.method="return",Le.arg=c,Or(Fe,Le),Le.method==="throw")||Ke!=="return"&&(Le.method="throw",Le.arg=new TypeError("The iterator does not provide a '"+Ke+"' method")),ke;var vt=B(gt,Fe.iterator,Le.arg);if(vt.type==="throw")return Le.method="throw",Le.arg=vt.arg,Le.delegate=null,ke;var tr=vt.arg;if(!tr)return Le.method="throw",Le.arg=new TypeError("iterator result is not an object"),Le.delegate=null,ke;if(tr.done)Le[Fe.resultName]=tr.value,Le.next=Fe.nextLoc,Le.method!=="return"&&(Le.method="next",Le.arg=c);else return tr;return Le.delegate=null,ke}er(Ve),D(Ve,C,"Generator"),D(Ve,v,function(){return this}),D(Ve,"toString",function(){return"[object Generator]"});function vr(Fe){var Le={tryLoc:Fe[0]};1 in Fe&&(Le.catchLoc=Fe[1]),2 in Fe&&(Le.finallyLoc=Fe[2],Le.afterLoc=Fe[3]),this.tryEntries.push(Le)}function di(Fe){var Le=Fe.completion||{};Le.type="normal",delete Le.arg,Fe.completion=Le}function xi(Fe){this.tryEntries=[{tryLoc:"root"}],Fe.forEach(vr,this),this.reset(!0)}a.keys=function(Fe){var Le=Object(Fe),Ke=[];for(var gt in Le)Ke.push(gt);return Ke.reverse(),function vt(){for(;Ke.length;){var tr=Ke.pop();if(tr in Le)return vt.value=tr,vt.done=!1,vt}return vt.done=!0,vt}};function qe(Fe){if(Fe!=null){var Le=Fe[v];if(Le)return Le.call(Fe);if(typeof Fe.next=="function")return Fe;if(!isNaN(Fe.length)){var Ke=-1,gt=function vt(){for(;++Ke<Fe.length;)if(l.call(Fe,Ke))return vt.value=Fe[Ke],vt.done=!1,vt;return vt.value=c,vt.done=!0,vt};return gt.next=gt}}throw new TypeError(typeof Fe+" is not iterable")}a.values=qe;function Ne(){return{value:c,done:!0}}return xi.prototype={constructor:xi,reset:function(Fe){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(di),!Fe)for(var Le in this)Le.charAt(0)==="t"&&l.call(this,Le)&&!isNaN(+Le.slice(1))&&(this[Le]=c)},stop:function(){this.done=!0;var Fe=this.tryEntries[0],Le=Fe.completion;if(Le.type==="throw")throw Le.arg;return this.rval},dispatchException:function(Fe){if(this.done)throw Fe;var Le=this;function Ke(Yr,yi){return tr.type="throw",tr.arg=Fe,Le.next=Yr,yi&&(Le.method="next",Le.arg=c),!!yi}for(var gt=this.tryEntries.length-1;gt>=0;--gt){var vt=this.tryEntries[gt],tr=vt.completion;if(vt.tryLoc==="root")return Ke("end");if(vt.tryLoc<=this.prev){var hr=l.call(vt,"catchLoc"),Dr=l.call(vt,"finallyLoc");if(hr&&Dr){if(this.prev<vt.catchLoc)return Ke(vt.catchLoc,!0);if(this.prev<vt.finallyLoc)return Ke(vt.finallyLoc)}else if(hr){if(this.prev<vt.catchLoc)return Ke(vt.catchLoc,!0)}else if(Dr){if(this.prev<vt.finallyLoc)return Ke(vt.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(Fe,Le){for(var Ke=this.tryEntries.length-1;Ke>=0;--Ke){var gt=this.tryEntries[Ke];if(gt.tryLoc<=this.prev&&l.call(gt,"finallyLoc")&&this.prev<gt.finallyLoc){var vt=gt;break}}vt&&(Fe==="break"||Fe==="continue")&&vt.tryLoc<=Le&&Le<=vt.finallyLoc&&(vt=null);var tr=vt?vt.completion:{};return tr.type=Fe,tr.arg=Le,vt?(this.method="next",this.next=vt.finallyLoc,ke):this.complete(tr)},complete:function(Fe,Le){if(Fe.type==="throw")throw Fe.arg;return Fe.type==="break"||Fe.type==="continue"?this.next=Fe.arg:Fe.type==="return"?(this.rval=this.arg=Fe.arg,this.method="return",this.next="end"):Fe.type==="normal"&&Le&&(this.next=Le),ke},finish:function(Fe){for(var Le=this.tryEntries.length-1;Le>=0;--Le){var Ke=this.tryEntries[Le];if(Ke.finallyLoc===Fe)return this.complete(Ke.completion,Ke.afterLoc),di(Ke),ke}},catch:function(Fe){for(var Le=this.tryEntries.length-1;Le>=0;--Le){var Ke=this.tryEntries[Le];if(Ke.tryLoc===Fe){var gt=Ke.completion;if(gt.type==="throw"){var vt=gt.arg;di(Ke)}return vt}}throw new Error("illegal catch attempt")},delegateYield:function(Fe,Le,Ke){return this.delegate={iterator:qe(Fe),resultName:Le,nextLoc:Ke},this.method==="next"&&(this.arg=c),ke}},a}(typeof Y2=="object"?Y2.exports:{});try{regeneratorRuntime=K2}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=K2:Function("r","regeneratorRuntime = r")(K2)}});var Q2=P((wJe,J2)=>{"use strict";var cf=typeof Reflect=="object"?Reflect:null,r7=cf&&typeof cf.apply=="function"?cf.apply:function(i,l,o){return Function.prototype.apply.call(i,l,o)},w0;cf&&typeof cf.ownKeys=="function"?w0=cf.ownKeys:Object.getOwnPropertySymbols?w0=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:w0=function(i){return Object.getOwnPropertyNames(i)};function jke(a){console&&console.warn&&console.warn(a)}var n7=Number.isNaN||function(i){return i!==i};function Ur(){Ur.init.call(this)}J2.exports=Ur;J2.exports.once=Wke;Ur.EventEmitter=Ur;Ur.prototype._events=void 0;Ur.prototype._eventsCount=0;Ur.prototype._maxListeners=void 0;var i7=10;function T0(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(Ur,"defaultMaxListeners",{enumerable:!0,get:function(){return i7},set:function(a){if(typeof a!="number"||a<0||n7(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");i7=a}});Ur.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ur.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||n7(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function o7(a){return a._maxListeners===void 0?Ur.defaultMaxListeners:a._maxListeners}Ur.prototype.getMaxListeners=function(){return o7(this)};Ur.prototype.emit=function(i){for(var l=[],o=1;o<arguments.length;o++)l.push(arguments[o]);var c=i==="error",t=this._events;if(t!==void 0)c=c&&t.error===void 0;else if(!c)return!1;if(c){var v;if(l.length>0&&(v=l[0]),v instanceof Error)throw v;var S=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw S.context=v,S}var C=t[i];if(C===void 0)return!1;if(typeof C=="function")r7(C,this,l);else for(var D=C.length,z=c7(C,D),o=0;o<D;++o)r7(z[o],this,l);return!0};function a7(a,i,l,o){var c,t,v;if(T0(l),t=a._events,t===void 0?(t=a._events=Object.create(null),a._eventsCount=0):(t.newListener!==void 0&&(a.emit("newListener",i,l.listener?l.listener:l),t=a._events),v=t[i]),v===void 0)v=t[i]=l,++a._eventsCount;else if(typeof v=="function"?v=t[i]=o?[l,v]:[v,l]:o?v.unshift(l):v.push(l),c=o7(a),c>0&&v.length>c&&!v.warned){v.warned=!0;var S=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");S.name="MaxListenersExceededWarning",S.emitter=a,S.type=i,S.count=v.length,jke(S)}return a}Ur.prototype.addListener=function(i,l){return a7(this,i,l,!1)};Ur.prototype.on=Ur.prototype.addListener;Ur.prototype.prependListener=function(i,l){return a7(this,i,l,!0)};function Vke(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function s7(a,i,l){var o={fired:!1,wrapFn:void 0,target:a,type:i,listener:l},c=Vke.bind(o);return c.listener=l,o.wrapFn=c,c}Ur.prototype.once=function(i,l){return T0(l),this.on(i,s7(this,i,l)),this};Ur.prototype.prependOnceListener=function(i,l){return T0(l),this.prependListener(i,s7(this,i,l)),this};Ur.prototype.removeListener=function(i,l){var o,c,t,v,S;if(T0(l),c=this._events,c===void 0)return this;if(o=c[i],o===void 0)return this;if(o===l||o.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete c[i],c.removeListener&&this.emit("removeListener",i,o.listener||l));else if(typeof o!="function"){for(t=-1,v=o.length-1;v>=0;v--)if(o[v]===l||o[v].listener===l){S=o[v].listener,t=v;break}if(t<0)return this;t===0?o.shift():$ke(o,t),o.length===1&&(c[i]=o[0]),c.removeListener!==void 0&&this.emit("removeListener",i,S||l)}return this};Ur.prototype.off=Ur.prototype.removeListener;Ur.prototype.removeAllListeners=function(i){var l,o,c;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[i]),this;if(arguments.length===0){var t=Object.keys(o),v;for(c=0;c<t.length;++c)v=t[c],v!=="removeListener"&&this.removeAllListeners(v);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=o[i],typeof l=="function")this.removeListener(i,l);else if(l!==void 0)for(c=l.length-1;c>=0;c--)this.removeListener(i,l[c]);return this};function l7(a,i,l){var o=a._events;if(o===void 0)return[];var c=o[i];return c===void 0?[]:typeof c=="function"?l?[c.listener||c]:[c]:l?Gke(c):c7(c,c.length)}Ur.prototype.listeners=function(i){return l7(this,i,!0)};Ur.prototype.rawListeners=function(i){return l7(this,i,!1)};Ur.listenerCount=function(a,i){return typeof a.listenerCount=="function"?a.listenerCount(i):u7.call(a,i)};Ur.prototype.listenerCount=u7;function u7(a){var i=this._events;if(i!==void 0){var l=i[a];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}Ur.prototype.eventNames=function(){return this._eventsCount>0?w0(this._events):[]};function c7(a,i){for(var l=new Array(i),o=0;o<i;++o)l[o]=a[o];return l}function $ke(a,i){for(;i+1<a.length;i++)a[i]=a[i+1];a.pop()}function Gke(a){for(var i=new Array(a.length),l=0;l<i.length;++l)i[l]=a[l].listener||a[l];return i}function Wke(a,i){return new Promise(function(l,o){function c(v){a.removeListener(i,t),o(v)}function t(){typeof a.removeListener=="function"&&a.removeListener("error",c),l([].slice.call(arguments))}h7(a,i,t,{once:!0}),i!=="error"&&Zke(a,c,{once:!0})})}function Zke(a,i,l){typeof a.on=="function"&&h7(a,"error",i,l)}function h7(a,i,l,o){if(typeof a.on=="function")o.once?a.once(i,l):a.on(i,l);else if(typeof a.addEventListener=="function")a.addEventListener(i,function c(t){o.once&&a.removeEventListener(i,c),l(t)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}});var pf=P((SJe,I7)=>{function nBe(a){var i=typeof a;return a!=null&&(i=="object"||i=="function")}I7.exports=nBe});var O7=P((IJe,A7)=>{var oBe=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;A7.exports=oBe});var Nm=P((AJe,C7)=>{var aBe=O7(),sBe=typeof self=="object"&&self&&self.Object===Object&&self,lBe=aBe||sBe||Function("return this")();C7.exports=lBe});var M7=P((OJe,P7)=>{var uBe=Nm(),cBe=function(){return uBe.Date.now()};P7.exports=cBe});var R7=P((CJe,q7)=>{var hBe=/\s/;function fBe(a){for(var i=a.length;i--&&hBe.test(a.charAt(i)););return i}q7.exports=fBe});var L7=P((PJe,D7)=>{var dBe=R7(),pBe=/^\s+/;function mBe(a){return a&&a.slice(0,dBe(a)+1).replace(pBe,"")}D7.exports=mBe});var Um=P((MJe,k7)=>{var _Be=Nm(),yBe=_Be.Symbol;k7.exports=yBe});var N7=P((qJe,F7)=>{var B7=Um(),z7=Object.prototype,gBe=z7.hasOwnProperty,vBe=z7.toString,jm=B7?B7.toStringTag:void 0;function xBe(a){var i=gBe.call(a,jm),l=a[jm];try{a[jm]=void 0;var o=!0}catch{}var c=vBe.call(a);return o&&(i?a[jm]=l:delete a[jm]),c}F7.exports=xBe});var j7=P((RJe,U7)=>{var bBe=Object.prototype,wBe=bBe.toString;function TBe(a){return wBe.call(a)}U7.exports=TBe});var O0=P((DJe,G7)=>{var V7=Um(),EBe=N7(),SBe=j7(),IBe="[object Null]",ABe="[object Undefined]",$7=V7?V7.toStringTag:void 0;function OBe(a){return a==null?a===void 0?ABe:IBe:$7&&$7 in Object(a)?EBe(a):SBe(a)}G7.exports=OBe});var C0=P((LJe,W7)=>{function CBe(a){return a!=null&&typeof a=="object"}W7.exports=CBe});var Vm=P((kJe,Z7)=>{var PBe=O0(),MBe=C0(),qBe="[object Symbol]";function RBe(a){return typeof a=="symbol"||MBe(a)&&PBe(a)==qBe}Z7.exports=RBe});var Y7=P((BJe,K7)=>{var DBe=L7(),H7=pf(),LBe=Vm(),X7=NaN,kBe=/^[-+]0x[0-9a-f]+$/i,BBe=/^0b[01]+$/i,zBe=/^0o[0-7]+$/i,FBe=parseInt;function NBe(a){if(typeof a=="number")return a;if(LBe(a))return X7;if(H7(a)){var i=typeof a.valueOf=="function"?a.valueOf():a;a=H7(i)?i+"":i}if(typeof a!="string")return a===0?a:+a;a=DBe(a);var l=BBe.test(a);return l||zBe.test(a)?FBe(a.slice(2),l?2:8):kBe.test(a)?X7:+a}K7.exports=NBe});var lI=P((zJe,Q7)=>{var UBe=pf(),sI=M7(),J7=Y7(),jBe="Expected a function",VBe=Math.max,$Be=Math.min;function GBe(a,i,l){var o,c,t,v,S,C,D=0,z=!1,B=!1,ne=!0;if(typeof a!="function")throw new TypeError(jBe);i=J7(i)||0,UBe(l)&&(z=!!l.leading,B="maxWait"in l,t=B?VBe(J7(l.maxWait)||0,i):t,ne="trailing"in l?!!l.trailing:ne);function pe(At){var Ve=o,er=c;return o=c=void 0,D=At,v=a.apply(er,Ve),v}function $e(At){return D=At,S=setTimeout(Ge,i),z?pe(At):v}function Ae(At){var Ve=At-C,er=At-D,Dt=i-Ve;return B?$Be(Dt,t-er):Dt}function ke(At){var Ve=At-C,er=At-D;return C===void 0||Ve>=i||Ve<0||B&&er>=t}function Ge(){var At=sI();if(ke(At))return tt(At);S=setTimeout(Ge,Ae(At))}function tt(At){return S=void 0,ne&&o?pe(At):(o=c=void 0,v)}function mt(){S!==void 0&&clearTimeout(S),D=0,o=C=c=S=void 0}function Mt(){return S===void 0?v:tt(sI())}function Kt(){var At=sI(),Ve=ke(At);if(o=arguments,c=this,C=At,Ve){if(S===void 0)return $e(C);if(B)return clearTimeout(S),S=setTimeout(Ge,i),pe(C)}return S===void 0&&(S=setTimeout(Ge,i)),v}return Kt.cancel=mt,Kt.flush=Mt,Kt}Q7.exports=GBe});var iZ=P(uI=>{"use strict";var eZ=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,WBe=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,tZ=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,ZBe=/\\([\u000b\u0020-\u00ff])/g,HBe=/([\\"])/g,rZ=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;uI.format=XBe;uI.parse=KBe;function XBe(a){if(!a||typeof a!="object")throw new TypeError("argument obj is required");var i=a.parameters,l=a.type;if(!l||!rZ.test(l))throw new TypeError("invalid type");var o=l;if(i&&typeof i=="object")for(var c,t=Object.keys(i).sort(),v=0;v<t.length;v++){if(c=t[v],!tZ.test(c))throw new TypeError("invalid parameter name");o+="; "+c+"="+JBe(i[c])}return o}function KBe(a){if(!a)throw new TypeError("argument string is required");var i=typeof a=="object"?YBe(a):a;if(typeof i!="string")throw new TypeError("argument string is required to be a string");var l=i.indexOf(";"),o=l!==-1?i.slice(0,l).trim():i.trim();if(!rZ.test(o))throw new TypeError("invalid media type");var c=new QBe(o.toLowerCase());if(l!==-1){var t,v,S;for(eZ.lastIndex=l;v=eZ.exec(i);){if(v.index!==l)throw new TypeError("invalid parameter format");l+=v[0].length,t=v[1].toLowerCase(),S=v[2],S.charCodeAt(0)===34&&(S=S.slice(1,-1),S.indexOf("\\")!==-1&&(S=S.replace(ZBe,"$1"))),c.parameters[t]=S}if(l!==i.length)throw new TypeError("invalid parameter format")}return c}function YBe(a){var i;if(typeof a.getHeader=="function"?i=a.getHeader("content-type"):typeof a.headers=="object"&&(i=a.headers&&a.headers["content-type"]),typeof i!="string")throw new TypeError("content-type header is missing from object");return i}function JBe(a){var i=String(a);if(tZ.test(i))return i;if(i.length>0&&!WBe.test(i))throw new TypeError("invalid parameter value");return'"'+i.replace(HBe,"\\$1")+'"'}function QBe(a){this.parameters=Object.create(null),this.type=a}});var hI=P(($m,cI)=>{(function(a){"use strict";function i(l){var o=l&&l.Promise||a.Promise,c=l&&l.XMLHttpRequest||a.XMLHttpRequest;return function(){var t=Object.create(a,{fetch:{value:void 0,writable:!0}});return function(v,S){typeof $m=="object"&&typeof cI<"u"?S($m):typeof define=="function"&&define.amd?define(["exports"],S):S(v.WHATWGFetch={})}(this,function(v){"use strict";var S=typeof t<"u"&&t||typeof self<"u"&&self||typeof S<"u"&&S,C={searchParams:"URLSearchParams"in S,iterable:"Symbol"in S&&"iterator"in Symbol,blob:"FileReader"in S&&"Blob"in S&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in S,arrayBuffer:"ArrayBuffer"in S};function D(qe){return qe&&DataView.prototype.isPrototypeOf(qe)}if(C.arrayBuffer)var z=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],B=ArrayBuffer.isView||function(qe){return qe&&z.indexOf(Object.prototype.toString.call(qe))>-1};function ne(qe){if(typeof qe!="string"&&(qe=String(qe)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(qe)||qe==="")throw new TypeError("Invalid character in header field name");return qe.toLowerCase()}function pe(qe){return typeof qe!="string"&&(qe=String(qe)),qe}function $e(qe){var Ne={next:function(){var Fe=qe.shift();return{done:Fe===void 0,value:Fe}}};return C.iterable&&(Ne[Symbol.iterator]=function(){return Ne}),Ne}function Ae(qe){this.map={},qe instanceof Ae?qe.forEach(function(Ne,Fe){this.append(Fe,Ne)},this):Array.isArray(qe)?qe.forEach(function(Ne){this.append(Ne[0],Ne[1])},this):qe&&Object.getOwnPropertyNames(qe).forEach(function(Ne){this.append(Ne,qe[Ne])},this)}Ae.prototype.append=function(qe,Ne){qe=ne(qe),Ne=pe(Ne);var Fe=this.map[qe];this.map[qe]=Fe?Fe+", "+Ne:Ne},Ae.prototype.delete=function(qe){delete this.map[ne(qe)]},Ae.prototype.get=function(qe){return qe=ne(qe),this.has(qe)?this.map[qe]:null},Ae.prototype.has=function(qe){return this.map.hasOwnProperty(ne(qe))},Ae.prototype.set=function(qe,Ne){this.map[ne(qe)]=pe(Ne)},Ae.prototype.forEach=function(qe,Ne){for(var Fe in this.map)this.map.hasOwnProperty(Fe)&&qe.call(Ne,this.map[Fe],Fe,this)},Ae.prototype.keys=function(){var qe=[];return this.forEach(function(Ne,Fe){qe.push(Fe)}),$e(qe)},Ae.prototype.values=function(){var qe=[];return this.forEach(function(Ne){qe.push(Ne)}),$e(qe)},Ae.prototype.entries=function(){var qe=[];return this.forEach(function(Ne,Fe){qe.push([Fe,Ne])}),$e(qe)},C.iterable&&(Ae.prototype[Symbol.iterator]=Ae.prototype.entries);function ke(qe){if(qe.bodyUsed)return o.reject(new TypeError("Already read"));qe.bodyUsed=!0}function Ge(qe){return new o(function(Ne,Fe){qe.onload=function(){Ne(qe.result)},qe.onerror=function(){Fe(qe.error)}})}function tt(qe){var Ne=new FileReader,Fe=Ge(Ne);return Ne.readAsArrayBuffer(qe),Fe}function mt(qe){var Ne=new FileReader,Fe=Ge(Ne);return Ne.readAsText(qe),Fe}function Mt(qe){for(var Ne=new Uint8Array(qe),Fe=new Array(Ne.length),Le=0;Le<Ne.length;Le++)Fe[Le]=String.fromCharCode(Ne[Le]);return Fe.join("")}function Kt(qe){if(qe.slice)return qe.slice(0);var Ne=new Uint8Array(qe.byteLength);return Ne.set(new Uint8Array(qe)),Ne.buffer}function At(){return this.bodyUsed=!1,this._initBody=function(qe){this.bodyUsed=this.bodyUsed,this._bodyInit=qe,qe?typeof qe=="string"?this._bodyText=qe:C.blob&&Blob.prototype.isPrototypeOf(qe)?this._bodyBlob=qe:C.formData&&FormData.prototype.isPrototypeOf(qe)?this._bodyFormData=qe:C.searchParams&&URLSearchParams.prototype.isPrototypeOf(qe)?this._bodyText=qe.toString():C.arrayBuffer&&C.blob&&D(qe)?(this._bodyArrayBuffer=Kt(qe.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):C.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(qe)||B(qe))?this._bodyArrayBuffer=Kt(qe):this._bodyText=qe=Object.prototype.toString.call(qe):this._bodyText="",this.headers.get("content-type")||(typeof qe=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):C.searchParams&&URLSearchParams.prototype.isPrototypeOf(qe)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},C.blob&&(this.blob=function(){var qe=ke(this);if(qe)return qe;if(this._bodyBlob)return o.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return o.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return o.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var qe=ke(this);return qe||(ArrayBuffer.isView(this._bodyArrayBuffer)?o.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):o.resolve(this._bodyArrayBuffer))}else return this.blob().then(tt)}),this.text=function(){var qe=ke(this);if(qe)return qe;if(this._bodyBlob)return mt(this._bodyBlob);if(this._bodyArrayBuffer)return o.resolve(Mt(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return o.resolve(this._bodyText)},C.formData&&(this.formData=function(){return this.text().then(Pt)}),this.json=function(){return this.text().then(JSON.parse)},this}var Ve=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function er(qe){var Ne=qe.toUpperCase();return Ve.indexOf(Ne)>-1?Ne:qe}function Dt(qe,Ne){if(!(this instanceof Dt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');Ne=Ne||{};var Fe=Ne.body;if(qe instanceof Dt){if(qe.bodyUsed)throw new TypeError("Already read");this.url=qe.url,this.credentials=qe.credentials,Ne.headers||(this.headers=new Ae(qe.headers)),this.method=qe.method,this.mode=qe.mode,this.signal=qe.signal,!Fe&&qe._bodyInit!=null&&(Fe=qe._bodyInit,qe.bodyUsed=!0)}else this.url=String(qe);if(this.credentials=Ne.credentials||this.credentials||"same-origin",(Ne.headers||!this.headers)&&(this.headers=new Ae(Ne.headers)),this.method=er(Ne.method||this.method||"GET"),this.mode=Ne.mode||this.mode||null,this.signal=Ne.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Fe)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(Fe),(this.method==="GET"||this.method==="HEAD")&&(Ne.cache==="no-store"||Ne.cache==="no-cache")){var Le=/([?&])_=[^&]*/;if(Le.test(this.url))this.url=this.url.replace(Le,"$1_="+new Date().getTime());else{var Ke=/\?/;this.url+=(Ke.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Dt.prototype.clone=function(){return new Dt(this,{body:this._bodyInit})};function Pt(qe){var Ne=new FormData;return qe.trim().split("&").forEach(function(Fe){if(Fe){var Le=Fe.split("="),Ke=Le.shift().replace(/\+/g," "),gt=Le.join("=").replace(/\+/g," ");Ne.append(decodeURIComponent(Ke),decodeURIComponent(gt))}}),Ne}function Or(qe){var Ne=new Ae,Fe=qe.replace(/\r?\n[\t ]+/g," ");return Fe.split("\r").map(function(Le){return Le.indexOf(`
`)===0?Le.substr(1,Le.length):Le}).forEach(function(Le){var Ke=Le.split(":"),gt=Ke.shift().trim();if(gt){var vt=Ke.join(":").trim();Ne.append(gt,vt)}}),Ne}At.call(Dt.prototype);function vr(qe,Ne){if(!(this instanceof vr))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');Ne||(Ne={}),this.type="default",this.status=Ne.status===void 0?200:Ne.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in Ne?Ne.statusText:"",this.headers=new Ae(Ne.headers),this.url=Ne.url||"",this._initBody(qe)}At.call(vr.prototype),vr.prototype.clone=function(){return new vr(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Ae(this.headers),url:this.url})},vr.error=function(){var qe=new vr(null,{status:0,statusText:""});return qe.type="error",qe};var di=[301,302,303,307,308];vr.redirect=function(qe,Ne){if(di.indexOf(Ne)===-1)throw new RangeError("Invalid status code");return new vr(null,{status:Ne,headers:{location:qe}})},v.DOMException=S.DOMException;try{new v.DOMException}catch{v.DOMException=function(Ne,Fe){this.message=Ne,this.name=Fe;var Le=Error(Ne);this.stack=Le.stack},v.DOMException.prototype=Object.create(Error.prototype),v.DOMException.prototype.constructor=v.DOMException}function xi(qe,Ne){return new o(function(Fe,Le){var Ke=new Dt(qe,Ne);if(Ke.signal&&Ke.signal.aborted)return Le(new v.DOMException("Aborted","AbortError"));var gt=new c;function vt(){gt.abort()}gt.onload=function(){var hr={status:gt.status,statusText:gt.statusText,headers:Or(gt.getAllResponseHeaders()||"")};hr.url="responseURL"in gt?gt.responseURL:hr.headers.get("X-Request-URL");var Dr="response"in gt?gt.response:gt.responseText;setTimeout(function(){Fe(new vr(Dr,hr))},0)},gt.onerror=function(){setTimeout(function(){Le(new TypeError("Network request failed"))},0)},gt.ontimeout=function(){setTimeout(function(){Le(new TypeError("Network request failed"))},0)},gt.onabort=function(){setTimeout(function(){Le(new v.DOMException("Aborted","AbortError"))},0)};function tr(hr){try{return hr===""&&S.location.href?S.location.href:hr}catch{return hr}}gt.open(Ke.method,tr(Ke.url),!0),Ke.credentials==="include"?gt.withCredentials=!0:Ke.credentials==="omit"&&(gt.withCredentials=!1),"responseType"in gt&&(C.blob?gt.responseType="blob":C.arrayBuffer&&Ke.headers.get("Content-Type")&&Ke.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(gt.responseType="arraybuffer")),Ne&&typeof Ne.headers=="object"&&!(Ne.headers instanceof Ae)?Object.getOwnPropertyNames(Ne.headers).forEach(function(hr){gt.setRequestHeader(hr,pe(Ne.headers[hr]))}):Ke.headers.forEach(function(hr,Dr){gt.setRequestHeader(Dr,hr)}),Ke.signal&&(Ke.signal.addEventListener("abort",vt),gt.onreadystatechange=function(){gt.readyState===4&&Ke.signal.removeEventListener("abort",vt)}),gt.send(typeof Ke._bodyInit>"u"?null:Ke._bodyInit)})}xi.polyfill=!0,S.fetch||(S.fetch=xi,S.Headers=Ae,S.Request=Dt,S.Response=vr),v.Headers=Ae,v.Request=Dt,v.Response=vr,v.fetch=xi,Object.defineProperty(v,"__esModule",{value:!0})}),{fetch:t.fetch,Headers:t.Headers,Request:t.Request,Response:t.Response,DOMException:t.DOMException}}()}typeof define=="function"&&define.amd?define(function(){return i}):typeof $m=="object"?cI.exports=i:a.fetchPonyfill=i})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof globalThis<"u"?globalThis:$m)});var oZ=P((NJe,nZ)=>{"use strict";var{EventEmitter:e3e}=Q2(),{fetch:t3e}=hI()(),r3e=(a,i={})=>{let{interval:l,respectDataSaving:o,respectPageVisibility:c,fetchOpts:t,setTimer:v,clearTimer:S}={interval:3e4,respectDataSaving:!0,respectPageVisibility:!0,fetchOpts:{},setTimer:setTimeout,clearTimer:clearTimeout,...i},C="minInterval"in i?i.minInterval:l*3,D=new e3e,z=null,B=null,ne=async()=>{let er={};z!==null?er["if-none-match"]=z:B!==null&&(er["if-modified-since"]=B);let Dt=await t3e(a,{...t,headers:{...t.headers,...er}});if(!Dt.ok&&Dt.status!==304){let di=new Error(Dt.statusText);throw di.response=Dt,di}let Pt=!0;Dt.status===304&&(Pt=!1);let Or=Dt.headers.get("etag");Or&&(Or===z&&(Pt=!1),z=Or);let vr=Dt.headers.get("last-modified")||null;return vr=vr&&+new Date(vr),Number.isInteger(vr)||(vr=null),vr!==null&&B!==null&&(vr<=B&&(Pt=!1),B=vr),{changed:Pt,response:Dt}},pe=null,$e=()=>(pe!==null||(D.emit("fetch"),pe=ne().then(({changed:er,response:Dt})=>(pe=null,D.emit("fetch-done"),er&&D.emit("change",Dt),Dt),er=>{throw pe=null,D.emit("fetch-done"),D.emit("error",er),er})),pe),Ae=globalThis.document,ke=()=>!c||!Ae?!1:typeof Ae.hidden=="boolean"?Ae.hidden:!1,Ge=globalThis.navigator&&globalThis.navigator.connection,tt=()=>o&&Ge?Ge.saveData:!1,mt=!1,Mt=null,Kt=()=>{$e().catch(()=>{}).then(()=>{if(!mt)return;let er=ke()||tt()?C:l;Mt=v(Kt,er)})},At=()=>{mt||(mt=!0,Kt(),D.emit("start"))},Ve=()=>{mt&&(Mt===null&&(S(Mt),Mt=null),mt=!1,D.emit("stop"))};return At(),D.url=()=>a,D.start=At,D.stop=Ve,D.isActive=()=>!!mt,D.refetch=$e,D.isFetching=()=>!!pe,D};nZ.exports=r3e});var lZ=P(P0=>{"use strict";P0.byteLength=n3e;P0.toByteArray=a3e;P0.fromByteArray=u3e;var Ca=[],wo=[],i3e=typeof Uint8Array<"u"?Uint8Array:Array,fI="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Ju=0,aZ=fI.length;Ju<aZ;++Ju)Ca[Ju]=fI[Ju],wo[fI.charCodeAt(Ju)]=Ju;var Ju,aZ;wo[45]=62;wo[95]=63;function sZ(a){var i=a.length;if(i%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=a.indexOf("=");l===-1&&(l=i);var o=l===i?0:4-l%4;return[l,o]}function n3e(a){var i=sZ(a),l=i[0],o=i[1];return(l+o)*3/4-o}function o3e(a,i,l){return(i+l)*3/4-l}function a3e(a){var i,l=sZ(a),o=l[0],c=l[1],t=new i3e(o3e(a,o,c)),v=0,S=c>0?o-4:o,C;for(C=0;C<S;C+=4)i=wo[a.charCodeAt(C)]<<18|wo[a.charCodeAt(C+1)]<<12|wo[a.charCodeAt(C+2)]<<6|wo[a.charCodeAt(C+3)],t[v++]=i>>16&255,t[v++]=i>>8&255,t[v++]=i&255;return c===2&&(i=wo[a.charCodeAt(C)]<<2|wo[a.charCodeAt(C+1)]>>4,t[v++]=i&255),c===1&&(i=wo[a.charCodeAt(C)]<<10|wo[a.charCodeAt(C+1)]<<4|wo[a.charCodeAt(C+2)]>>2,t[v++]=i>>8&255,t[v++]=i&255),t}function s3e(a){return Ca[a>>18&63]+Ca[a>>12&63]+Ca[a>>6&63]+Ca[a&63]}function l3e(a,i,l){for(var o,c=[],t=i;t<l;t+=3)o=(a[t]<<16&16711680)+(a[t+1]<<8&65280)+(a[t+2]&255),c.push(s3e(o));return c.join("")}function u3e(a){for(var i,l=a.length,o=l%3,c=[],t=16383,v=0,S=l-o;v<S;v+=t)c.push(l3e(a,v,v+t>S?S:v+t));return o===1?(i=a[l-1],c.push(Ca[i>>2]+Ca[i<<4&63]+"==")):o===2&&(i=(a[l-2]<<8)+a[l-1],c.push(Ca[i>>10]+Ca[i>>4&63]+Ca[i<<2&63]+"=")),c.join("")}});var uZ=P(dI=>{dI.read=function(a,i,l,o,c){var t,v,S=c*8-o-1,C=(1<<S)-1,D=C>>1,z=-7,B=l?c-1:0,ne=l?-1:1,pe=a[i+B];for(B+=ne,t=pe&(1<<-z)-1,pe>>=-z,z+=S;z>0;t=t*256+a[i+B],B+=ne,z-=8);for(v=t&(1<<-z)-1,t>>=-z,z+=o;z>0;v=v*256+a[i+B],B+=ne,z-=8);if(t===0)t=1-D;else{if(t===C)return v?NaN:(pe?-1:1)*(1/0);v=v+Math.pow(2,o),t=t-D}return(pe?-1:1)*v*Math.pow(2,t-o)};dI.write=function(a,i,l,o,c,t){var v,S,C,D=t*8-c-1,z=(1<<D)-1,B=z>>1,ne=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,pe=o?0:t-1,$e=o?1:-1,Ae=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(S=isNaN(i)?1:0,v=z):(v=Math.floor(Math.log(i)/Math.LN2),i*(C=Math.pow(2,-v))<1&&(v--,C*=2),v+B>=1?i+=ne/C:i+=ne*Math.pow(2,1-B),i*C>=2&&(v++,C/=2),v+B>=z?(S=0,v=z):v+B>=1?(S=(i*C-1)*Math.pow(2,c),v=v+B):(S=i*Math.pow(2,B-1)*Math.pow(2,c),v=0));c>=8;a[l+pe]=S&255,pe+=$e,S/=256,c-=8);for(v=v<<c|S,D+=c;D>0;a[l+pe]=v&255,pe+=$e,v/=256,D-=8);a[l+pe-$e]|=Ae*128}});var IZ=P(gf=>{"use strict";var pI=lZ(),_f=uZ(),cZ=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;gf.Buffer=We;gf.SlowBuffer=m3e;gf.INSPECT_MAX_BYTES=50;var M0=2147483647;gf.kMaxLength=M0;We.TYPED_ARRAY_SUPPORT=c3e();!We.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c3e(){try{let a=new Uint8Array(1),i={foo:function(){return 42}};return Object.setPrototypeOf(i,Uint8Array.prototype),Object.setPrototypeOf(a,i),a.foo()===42}catch{return!1}}Object.defineProperty(We.prototype,"parent",{enumerable:!0,get:function(){if(We.isBuffer(this))return this.buffer}});Object.defineProperty(We.prototype,"offset",{enumerable:!0,get:function(){if(We.isBuffer(this))return this.byteOffset}});function vs(a){if(a>M0)throw new RangeError('The value "'+a+'" is invalid for option "size"');let i=new Uint8Array(a);return Object.setPrototypeOf(i,We.prototype),i}function We(a,i,l){if(typeof a=="number"){if(typeof i=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return gI(a)}return pZ(a,i,l)}We.poolSize=8192;function pZ(a,i,l){if(typeof a=="string")return f3e(a,i);if(ArrayBuffer.isView(a))return d3e(a);if(a==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a);if(Pa(a,ArrayBuffer)||a&&Pa(a.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Pa(a,SharedArrayBuffer)||a&&Pa(a.buffer,SharedArrayBuffer)))return _I(a,i,l);if(typeof a=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let o=a.valueOf&&a.valueOf();if(o!=null&&o!==a)return We.from(o,i,l);let c=p3e(a);if(c)return c;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof a[Symbol.toPrimitive]=="function")return We.from(a[Symbol.toPrimitive]("string"),i,l);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a)}We.from=function(a,i,l){return pZ(a,i,l)};Object.setPrototypeOf(We.prototype,Uint8Array.prototype);Object.setPrototypeOf(We,Uint8Array);function mZ(a){if(typeof a!="number")throw new TypeError('"size" argument must be of type number');if(a<0)throw new RangeError('The value "'+a+'" is invalid for option "size"')}function h3e(a,i,l){return mZ(a),a<=0?vs(a):i!==void 0?typeof l=="string"?vs(a).fill(i,l):vs(a).fill(i):vs(a)}We.alloc=function(a,i,l){return h3e(a,i,l)};function gI(a){return mZ(a),vs(a<0?0:vI(a)|0)}We.allocUnsafe=function(a){return gI(a)};We.allocUnsafeSlow=function(a){return gI(a)};function f3e(a,i){if((typeof i!="string"||i==="")&&(i="utf8"),!We.isEncoding(i))throw new TypeError("Unknown encoding: "+i);let l=_Z(a,i)|0,o=vs(l),c=o.write(a,i);return c!==l&&(o=o.slice(0,c)),o}function mI(a){let i=a.length<0?0:vI(a.length)|0,l=vs(i);for(let o=0;o<i;o+=1)l[o]=a[o]&255;return l}function d3e(a){if(Pa(a,Uint8Array)){let i=new Uint8Array(a);return _I(i.buffer,i.byteOffset,i.byteLength)}return mI(a)}function _I(a,i,l){if(i<0||a.byteLength<i)throw new RangeError('"offset" is outside of buffer bounds');if(a.byteLength<i+(l||0))throw new RangeError('"length" is outside of buffer bounds');let o;return i===void 0&&l===void 0?o=new Uint8Array(a):l===void 0?o=new Uint8Array(a,i):o=new Uint8Array(a,i,l),Object.setPrototypeOf(o,We.prototype),o}function p3e(a){if(We.isBuffer(a)){let i=vI(a.length)|0,l=vs(i);return l.length===0||a.copy(l,0,0,i),l}if(a.length!==void 0)return typeof a.length!="number"||bI(a.length)?vs(0):mI(a);if(a.type==="Buffer"&&Array.isArray(a.data))return mI(a.data)}function vI(a){if(a>=M0)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+M0.toString(16)+" bytes");return a|0}function m3e(a){return+a!=a&&(a=0),We.alloc(+a)}We.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==We.prototype};We.compare=function(i,l){if(Pa(i,Uint8Array)&&(i=We.from(i,i.offset,i.byteLength)),Pa(l,Uint8Array)&&(l=We.from(l,l.offset,l.byteLength)),!We.isBuffer(i)||!We.isBuffer(l))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===l)return 0;let o=i.length,c=l.length;for(let t=0,v=Math.min(o,c);t<v;++t)if(i[t]!==l[t]){o=i[t],c=l[t];break}return o<c?-1:c<o?1:0};We.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};We.concat=function(i,l){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return We.alloc(0);let o;if(l===void 0)for(l=0,o=0;o<i.length;++o)l+=i[o].length;let c=We.allocUnsafe(l),t=0;for(o=0;o<i.length;++o){let v=i[o];if(Pa(v,Uint8Array))t+v.length>c.length?(We.isBuffer(v)||(v=We.from(v)),v.copy(c,t)):Uint8Array.prototype.set.call(c,v,t);else if(We.isBuffer(v))v.copy(c,t);else throw new TypeError('"list" argument must be an Array of Buffers');t+=v.length}return c};function _Z(a,i){if(We.isBuffer(a))return a.length;if(ArrayBuffer.isView(a)||Pa(a,ArrayBuffer))return a.byteLength;if(typeof a!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof a);let l=a.length,o=arguments.length>2&&arguments[2]===!0;if(!o&&l===0)return 0;let c=!1;for(;;)switch(i){case"ascii":case"latin1":case"binary":return l;case"utf8":case"utf-8":return yI(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l*2;case"hex":return l>>>1;case"base64":return SZ(a).length;default:if(c)return o?-1:yI(a).length;i=(""+i).toLowerCase(),c=!0}}We.byteLength=_Z;function _3e(a,i,l){let o=!1;if((i===void 0||i<0)&&(i=0),i>this.length||((l===void 0||l>this.length)&&(l=this.length),l<=0)||(l>>>=0,i>>>=0,l<=i))return"";for(a||(a="utf8");;)switch(a){case"hex":return I3e(this,i,l);case"utf8":case"utf-8":return gZ(this,i,l);case"ascii":return E3e(this,i,l);case"latin1":case"binary":return S3e(this,i,l);case"base64":return w3e(this,i,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A3e(this,i,l);default:if(o)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),o=!0}}We.prototype._isBuffer=!0;function Qu(a,i,l){let o=a[i];a[i]=a[l],a[l]=o}We.prototype.swap16=function(){let i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let l=0;l<i;l+=2)Qu(this,l,l+1);return this};We.prototype.swap32=function(){let i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let l=0;l<i;l+=4)Qu(this,l,l+3),Qu(this,l+1,l+2);return this};We.prototype.swap64=function(){let i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let l=0;l<i;l+=8)Qu(this,l,l+7),Qu(this,l+1,l+6),Qu(this,l+2,l+5),Qu(this,l+3,l+4);return this};We.prototype.toString=function(){let i=this.length;return i===0?"":arguments.length===0?gZ(this,0,i):_3e.apply(this,arguments)};We.prototype.toLocaleString=We.prototype.toString;We.prototype.equals=function(i){if(!We.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:We.compare(this,i)===0};We.prototype.inspect=function(){let i="",l=gf.INSPECT_MAX_BYTES;return i=this.toString("hex",0,l).replace(/(.{2})/g,"$1 ").trim(),this.length>l&&(i+=" ... "),"<Buffer "+i+">"};cZ&&(We.prototype[cZ]=We.prototype.inspect);We.prototype.compare=function(i,l,o,c,t){if(Pa(i,Uint8Array)&&(i=We.from(i,i.offset,i.byteLength)),!We.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(l===void 0&&(l=0),o===void 0&&(o=i?i.length:0),c===void 0&&(c=0),t===void 0&&(t=this.length),l<0||o>i.length||c<0||t>this.length)throw new RangeError("out of range index");if(c>=t&&l>=o)return 0;if(c>=t)return-1;if(l>=o)return 1;if(l>>>=0,o>>>=0,c>>>=0,t>>>=0,this===i)return 0;let v=t-c,S=o-l,C=Math.min(v,S),D=this.slice(c,t),z=i.slice(l,o);for(let B=0;B<C;++B)if(D[B]!==z[B]){v=D[B],S=z[B];break}return v<S?-1:S<v?1:0};function yZ(a,i,l,o,c){if(a.length===0)return-1;if(typeof l=="string"?(o=l,l=0):l>2147483647?l=2147483647:l<-2147483648&&(l=-2147483648),l=+l,bI(l)&&(l=c?0:a.length-1),l<0&&(l=a.length+l),l>=a.length){if(c)return-1;l=a.length-1}else if(l<0)if(c)l=0;else return-1;if(typeof i=="string"&&(i=We.from(i,o)),We.isBuffer(i))return i.length===0?-1:hZ(a,i,l,o,c);if(typeof i=="number")return i=i&255,typeof Uint8Array.prototype.indexOf=="function"?c?Uint8Array.prototype.indexOf.call(a,i,l):Uint8Array.prototype.lastIndexOf.call(a,i,l):hZ(a,[i],l,o,c);throw new TypeError("val must be string, number or Buffer")}function hZ(a,i,l,o,c){let t=1,v=a.length,S=i.length;if(o!==void 0&&(o=String(o).toLowerCase(),o==="ucs2"||o==="ucs-2"||o==="utf16le"||o==="utf-16le")){if(a.length<2||i.length<2)return-1;t=2,v/=2,S/=2,l/=2}function C(z,B){return t===1?z[B]:z.readUInt16BE(B*t)}let D;if(c){let z=-1;for(D=l;D<v;D++)if(C(a,D)===C(i,z===-1?0:D-z)){if(z===-1&&(z=D),D-z+1===S)return z*t}else z!==-1&&(D-=D-z),z=-1}else for(l+S>v&&(l=v-S),D=l;D>=0;D--){let z=!0;for(let B=0;B<S;B++)if(C(a,D+B)!==C(i,B)){z=!1;break}if(z)return D}return-1}We.prototype.includes=function(i,l,o){return this.indexOf(i,l,o)!==-1};We.prototype.indexOf=function(i,l,o){return yZ(this,i,l,o,!0)};We.prototype.lastIndexOf=function(i,l,o){return yZ(this,i,l,o,!1)};function y3e(a,i,l,o){l=Number(l)||0;let c=a.length-l;o?(o=Number(o),o>c&&(o=c)):o=c;let t=i.length;o>t/2&&(o=t/2);let v;for(v=0;v<o;++v){let S=parseInt(i.substr(v*2,2),16);if(bI(S))return v;a[l+v]=S}return v}function g3e(a,i,l,o){return q0(yI(i,a.length-l),a,l,o)}function v3e(a,i,l,o){return q0(M3e(i),a,l,o)}function x3e(a,i,l,o){return q0(SZ(i),a,l,o)}function b3e(a,i,l,o){return q0(q3e(i,a.length-l),a,l,o)}We.prototype.write=function(i,l,o,c){if(l===void 0)c="utf8",o=this.length,l=0;else if(o===void 0&&typeof l=="string")c=l,o=this.length,l=0;else if(isFinite(l))l=l>>>0,isFinite(o)?(o=o>>>0,c===void 0&&(c="utf8")):(c=o,o=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let t=this.length-l;if((o===void 0||o>t)&&(o=t),i.length>0&&(o<0||l<0)||l>this.length)throw new RangeError("Attempt to write outside buffer bounds");c||(c="utf8");let v=!1;for(;;)switch(c){case"hex":return y3e(this,i,l,o);case"utf8":case"utf-8":return g3e(this,i,l,o);case"ascii":case"latin1":case"binary":return v3e(this,i,l,o);case"base64":return x3e(this,i,l,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b3e(this,i,l,o);default:if(v)throw new TypeError("Unknown encoding: "+c);c=(""+c).toLowerCase(),v=!0}};We.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function w3e(a,i,l){return i===0&&l===a.length?pI.fromByteArray(a):pI.fromByteArray(a.slice(i,l))}function gZ(a,i,l){l=Math.min(a.length,l);let o=[],c=i;for(;c<l;){let t=a[c],v=null,S=t>239?4:t>223?3:t>191?2:1;if(c+S<=l){let C,D,z,B;switch(S){case 1:t<128&&(v=t);break;case 2:C=a[c+1],(C&192)===128&&(B=(t&31)<<6|C&63,B>127&&(v=B));break;case 3:C=a[c+1],D=a[c+2],(C&192)===128&&(D&192)===128&&(B=(t&15)<<12|(C&63)<<6|D&63,B>2047&&(B<55296||B>57343)&&(v=B));break;case 4:C=a[c+1],D=a[c+2],z=a[c+3],(C&192)===128&&(D&192)===128&&(z&192)===128&&(B=(t&15)<<18|(C&63)<<12|(D&63)<<6|z&63,B>65535&&B<1114112&&(v=B))}}v===null?(v=65533,S=1):v>65535&&(v-=65536,o.push(v>>>10&1023|55296),v=56320|v&1023),o.push(v),c+=S}return T3e(o)}var fZ=4096;function T3e(a){let i=a.length;if(i<=fZ)return String.fromCharCode.apply(String,a);let l="",o=0;for(;o<i;)l+=String.fromCharCode.apply(String,a.slice(o,o+=fZ));return l}function E3e(a,i,l){let o="";l=Math.min(a.length,l);for(let c=i;c<l;++c)o+=String.fromCharCode(a[c]&127);return o}function S3e(a,i,l){let o="";l=Math.min(a.length,l);for(let c=i;c<l;++c)o+=String.fromCharCode(a[c]);return o}function I3e(a,i,l){let o=a.length;(!i||i<0)&&(i=0),(!l||l<0||l>o)&&(l=o);let c="";for(let t=i;t<l;++t)c+=R3e[a[t]];return c}function A3e(a,i,l){let o=a.slice(i,l),c="";for(let t=0;t<o.length-1;t+=2)c+=String.fromCharCode(o[t]+o[t+1]*256);return c}We.prototype.slice=function(i,l){let o=this.length;i=~~i,l=l===void 0?o:~~l,i<0?(i+=o,i<0&&(i=0)):i>o&&(i=o),l<0?(l+=o,l<0&&(l=0)):l>o&&(l=o),l<i&&(l=i);let c=this.subarray(i,l);return Object.setPrototypeOf(c,We.prototype),c};function Ui(a,i,l){if(a%1!==0||a<0)throw new RangeError("offset is not uint");if(a+i>l)throw new RangeError("Trying to access beyond buffer length")}We.prototype.readUintLE=We.prototype.readUIntLE=function(i,l,o){i=i>>>0,l=l>>>0,o||Ui(i,l,this.length);let c=this[i],t=1,v=0;for(;++v<l&&(t*=256);)c+=this[i+v]*t;return c};We.prototype.readUintBE=We.prototype.readUIntBE=function(i,l,o){i=i>>>0,l=l>>>0,o||Ui(i,l,this.length);let c=this[i+--l],t=1;for(;l>0&&(t*=256);)c+=this[i+--l]*t;return c};We.prototype.readUint8=We.prototype.readUInt8=function(i,l){return i=i>>>0,l||Ui(i,1,this.length),this[i]};We.prototype.readUint16LE=We.prototype.readUInt16LE=function(i,l){return i=i>>>0,l||Ui(i,2,this.length),this[i]|this[i+1]<<8};We.prototype.readUint16BE=We.prototype.readUInt16BE=function(i,l){return i=i>>>0,l||Ui(i,2,this.length),this[i]<<8|this[i+1]};We.prototype.readUint32LE=We.prototype.readUInt32LE=function(i,l){return i=i>>>0,l||Ui(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216};We.prototype.readUint32BE=We.prototype.readUInt32BE=function(i,l){return i=i>>>0,l||Ui(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])};We.prototype.readBigUInt64LE=Tl(function(i){i=i>>>0,yf(i,"offset");let l=this[i],o=this[i+7];(l===void 0||o===void 0)&&Gm(i,this.length-8);let c=l+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,t=this[++i]+this[++i]*2**8+this[++i]*2**16+o*2**24;return BigInt(c)+(BigInt(t)<<BigInt(32))});We.prototype.readBigUInt64BE=Tl(function(i){i=i>>>0,yf(i,"offset");let l=this[i],o=this[i+7];(l===void 0||o===void 0)&&Gm(i,this.length-8);let c=l*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],t=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+o;return(BigInt(c)<<BigInt(32))+BigInt(t)});We.prototype.readIntLE=function(i,l,o){i=i>>>0,l=l>>>0,o||Ui(i,l,this.length);let c=this[i],t=1,v=0;for(;++v<l&&(t*=256);)c+=this[i+v]*t;return t*=128,c>=t&&(c-=Math.pow(2,8*l)),c};We.prototype.readIntBE=function(i,l,o){i=i>>>0,l=l>>>0,o||Ui(i,l,this.length);let c=l,t=1,v=this[i+--c];for(;c>0&&(t*=256);)v+=this[i+--c]*t;return t*=128,v>=t&&(v-=Math.pow(2,8*l)),v};We.prototype.readInt8=function(i,l){return i=i>>>0,l||Ui(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]};We.prototype.readInt16LE=function(i,l){i=i>>>0,l||Ui(i,2,this.length);let o=this[i]|this[i+1]<<8;return o&32768?o|4294901760:o};We.prototype.readInt16BE=function(i,l){i=i>>>0,l||Ui(i,2,this.length);let o=this[i+1]|this[i]<<8;return o&32768?o|4294901760:o};We.prototype.readInt32LE=function(i,l){return i=i>>>0,l||Ui(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24};We.prototype.readInt32BE=function(i,l){return i=i>>>0,l||Ui(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]};We.prototype.readBigInt64LE=Tl(function(i){i=i>>>0,yf(i,"offset");let l=this[i],o=this[i+7];(l===void 0||o===void 0)&&Gm(i,this.length-8);let c=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(o<<24);return(BigInt(c)<<BigInt(32))+BigInt(l+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)});We.prototype.readBigInt64BE=Tl(function(i){i=i>>>0,yf(i,"offset");let l=this[i],o=this[i+7];(l===void 0||o===void 0)&&Gm(i,this.length-8);let c=(l<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(c)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+o)});We.prototype.readFloatLE=function(i,l){return i=i>>>0,l||Ui(i,4,this.length),_f.read(this,i,!0,23,4)};We.prototype.readFloatBE=function(i,l){return i=i>>>0,l||Ui(i,4,this.length),_f.read(this,i,!1,23,4)};We.prototype.readDoubleLE=function(i,l){return i=i>>>0,l||Ui(i,8,this.length),_f.read(this,i,!0,52,8)};We.prototype.readDoubleBE=function(i,l){return i=i>>>0,l||Ui(i,8,this.length),_f.read(this,i,!1,52,8)};function Fn(a,i,l,o,c,t){if(!We.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(i>c||i<t)throw new RangeError('"value" argument is out of bounds');if(l+o>a.length)throw new RangeError("Index out of range")}We.prototype.writeUintLE=We.prototype.writeUIntLE=function(i,l,o,c){if(i=+i,l=l>>>0,o=o>>>0,!c){let S=Math.pow(2,8*o)-1;Fn(this,i,l,o,S,0)}let t=1,v=0;for(this[l]=i&255;++v<o&&(t*=256);)this[l+v]=i/t&255;return l+o};We.prototype.writeUintBE=We.prototype.writeUIntBE=function(i,l,o,c){if(i=+i,l=l>>>0,o=o>>>0,!c){let S=Math.pow(2,8*o)-1;Fn(this,i,l,o,S,0)}let t=o-1,v=1;for(this[l+t]=i&255;--t>=0&&(v*=256);)this[l+t]=i/v&255;return l+o};We.prototype.writeUint8=We.prototype.writeUInt8=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,1,255,0),this[l]=i&255,l+1};We.prototype.writeUint16LE=We.prototype.writeUInt16LE=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,2,65535,0),this[l]=i&255,this[l+1]=i>>>8,l+2};We.prototype.writeUint16BE=We.prototype.writeUInt16BE=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,2,65535,0),this[l]=i>>>8,this[l+1]=i&255,l+2};We.prototype.writeUint32LE=We.prototype.writeUInt32LE=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,4,4294967295,0),this[l+3]=i>>>24,this[l+2]=i>>>16,this[l+1]=i>>>8,this[l]=i&255,l+4};We.prototype.writeUint32BE=We.prototype.writeUInt32BE=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,4,4294967295,0),this[l]=i>>>24,this[l+1]=i>>>16,this[l+2]=i>>>8,this[l+3]=i&255,l+4};function vZ(a,i,l,o,c){EZ(i,o,c,a,l,7);let t=Number(i&BigInt(4294967295));a[l++]=t,t=t>>8,a[l++]=t,t=t>>8,a[l++]=t,t=t>>8,a[l++]=t;let v=Number(i>>BigInt(32)&BigInt(4294967295));return a[l++]=v,v=v>>8,a[l++]=v,v=v>>8,a[l++]=v,v=v>>8,a[l++]=v,l}function xZ(a,i,l,o,c){EZ(i,o,c,a,l,7);let t=Number(i&BigInt(4294967295));a[l+7]=t,t=t>>8,a[l+6]=t,t=t>>8,a[l+5]=t,t=t>>8,a[l+4]=t;let v=Number(i>>BigInt(32)&BigInt(4294967295));return a[l+3]=v,v=v>>8,a[l+2]=v,v=v>>8,a[l+1]=v,v=v>>8,a[l]=v,l+8}We.prototype.writeBigUInt64LE=Tl(function(i,l=0){return vZ(this,i,l,BigInt(0),BigInt("0xffffffffffffffff"))});We.prototype.writeBigUInt64BE=Tl(function(i,l=0){return xZ(this,i,l,BigInt(0),BigInt("0xffffffffffffffff"))});We.prototype.writeIntLE=function(i,l,o,c){if(i=+i,l=l>>>0,!c){let C=Math.pow(2,8*o-1);Fn(this,i,l,o,C-1,-C)}let t=0,v=1,S=0;for(this[l]=i&255;++t<o&&(v*=256);)i<0&&S===0&&this[l+t-1]!==0&&(S=1),this[l+t]=(i/v>>0)-S&255;return l+o};We.prototype.writeIntBE=function(i,l,o,c){if(i=+i,l=l>>>0,!c){let C=Math.pow(2,8*o-1);Fn(this,i,l,o,C-1,-C)}let t=o-1,v=1,S=0;for(this[l+t]=i&255;--t>=0&&(v*=256);)i<0&&S===0&&this[l+t+1]!==0&&(S=1),this[l+t]=(i/v>>0)-S&255;return l+o};We.prototype.writeInt8=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,1,127,-128),i<0&&(i=255+i+1),this[l]=i&255,l+1};We.prototype.writeInt16LE=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,2,32767,-32768),this[l]=i&255,this[l+1]=i>>>8,l+2};We.prototype.writeInt16BE=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,2,32767,-32768),this[l]=i>>>8,this[l+1]=i&255,l+2};We.prototype.writeInt32LE=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,4,2147483647,-2147483648),this[l]=i&255,this[l+1]=i>>>8,this[l+2]=i>>>16,this[l+3]=i>>>24,l+4};We.prototype.writeInt32BE=function(i,l,o){return i=+i,l=l>>>0,o||Fn(this,i,l,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[l]=i>>>24,this[l+1]=i>>>16,this[l+2]=i>>>8,this[l+3]=i&255,l+4};We.prototype.writeBigInt64LE=Tl(function(i,l=0){return vZ(this,i,l,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});We.prototype.writeBigInt64BE=Tl(function(i,l=0){return xZ(this,i,l,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function bZ(a,i,l,o,c,t){if(l+o>a.length)throw new RangeError("Index out of range");if(l<0)throw new RangeError("Index out of range")}function wZ(a,i,l,o,c){return i=+i,l=l>>>0,c||bZ(a,i,l,4,34028234663852886e22,-34028234663852886e22),_f.write(a,i,l,o,23,4),l+4}We.prototype.writeFloatLE=function(i,l,o){return wZ(this,i,l,!0,o)};We.prototype.writeFloatBE=function(i,l,o){return wZ(this,i,l,!1,o)};function TZ(a,i,l,o,c){return i=+i,l=l>>>0,c||bZ(a,i,l,8,17976931348623157e292,-17976931348623157e292),_f.write(a,i,l,o,52,8),l+8}We.prototype.writeDoubleLE=function(i,l,o){return TZ(this,i,l,!0,o)};We.prototype.writeDoubleBE=function(i,l,o){return TZ(this,i,l,!1,o)};We.prototype.copy=function(i,l,o,c){if(!We.isBuffer(i))throw new TypeError("argument should be a Buffer");if(o||(o=0),!c&&c!==0&&(c=this.length),l>=i.length&&(l=i.length),l||(l=0),c>0&&c<o&&(c=o),c===o||i.length===0||this.length===0)return 0;if(l<0)throw new RangeError("targetStart out of bounds");if(o<0||o>=this.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("sourceEnd out of bounds");c>this.length&&(c=this.length),i.length-l<c-o&&(c=i.length-l+o);let t=c-o;return this===i&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(l,o,c):Uint8Array.prototype.set.call(i,this.subarray(o,c),l),t};We.prototype.fill=function(i,l,o,c){if(typeof i=="string"){if(typeof l=="string"?(c=l,l=0,o=this.length):typeof o=="string"&&(c=o,o=this.length),c!==void 0&&typeof c!="string")throw new TypeError("encoding must be a string");if(typeof c=="string"&&!We.isEncoding(c))throw new TypeError("Unknown encoding: "+c);if(i.length===1){let v=i.charCodeAt(0);(c==="utf8"&&v<128||c==="latin1")&&(i=v)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(l<0||this.length<l||this.length<o)throw new RangeError("Out of range index");if(o<=l)return this;l=l>>>0,o=o===void 0?this.length:o>>>0,i||(i=0);let t;if(typeof i=="number")for(t=l;t<o;++t)this[t]=i;else{let v=We.isBuffer(i)?i:We.from(i,c),S=v.length;if(S===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(t=0;t<o-l;++t)this[t+l]=v[t%S]}return this};var mf={};function xI(a,i,l){mf[a]=class extends l{constructor(){super(),Object.defineProperty(this,"message",{value:i.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${a}]`,this.stack,delete this.name}get code(){return a}set code(c){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:c,writable:!0})}toString(){return`${this.name} [${a}]: ${this.message}`}}}xI("ERR_BUFFER_OUT_OF_BOUNDS",function(a){return a?`${a} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);xI("ERR_INVALID_ARG_TYPE",function(a,i){return`The "${a}" argument must be of type number. Received type ${typeof i}`},TypeError);xI("ERR_OUT_OF_RANGE",function(a,i,l){let o=`The value of "${a}" is out of range.`,c=l;return Number.isInteger(l)&&Math.abs(l)>2**32?c=dZ(String(l)):typeof l=="bigint"&&(c=String(l),(l>BigInt(2)**BigInt(32)||l<-(BigInt(2)**BigInt(32)))&&(c=dZ(c)),c+="n"),o+=` It must be ${i}. Received ${c}`,o},RangeError);function dZ(a){let i="",l=a.length,o=a[0]==="-"?1:0;for(;l>=o+4;l-=3)i=`_${a.slice(l-3,l)}${i}`;return`${a.slice(0,l)}${i}`}function O3e(a,i,l){yf(i,"offset"),(a[i]===void 0||a[i+l]===void 0)&&Gm(i,a.length-(l+1))}function EZ(a,i,l,o,c,t){if(a>l||a<i){let v=typeof i=="bigint"?"n":"",S;throw t>3?i===0||i===BigInt(0)?S=`>= 0${v} and < 2${v} ** ${(t+1)*8}${v}`:S=`>= -(2${v} ** ${(t+1)*8-1}${v}) and < 2 ** ${(t+1)*8-1}${v}`:S=`>= ${i}${v} and <= ${l}${v}`,new mf.ERR_OUT_OF_RANGE("value",S,a)}O3e(o,c,t)}function yf(a,i){if(typeof a!="number")throw new mf.ERR_INVALID_ARG_TYPE(i,"number",a)}function Gm(a,i,l){throw Math.floor(a)!==a?(yf(a,l),new mf.ERR_OUT_OF_RANGE(l||"offset","an integer",a)):i<0?new mf.ERR_BUFFER_OUT_OF_BOUNDS:new mf.ERR_OUT_OF_RANGE(l||"offset",`>= ${l?1:0} and <= ${i}`,a)}var C3e=/[^+/0-9A-Za-z-_]/g;function P3e(a){if(a=a.split("=")[0],a=a.trim().replace(C3e,""),a.length<2)return"";for(;a.length%4!==0;)a=a+"=";return a}function yI(a,i){i=i||1/0;let l,o=a.length,c=null,t=[];for(let v=0;v<o;++v){if(l=a.charCodeAt(v),l>55295&&l<57344){if(!c){if(l>56319){(i-=3)>-1&&t.push(239,191,189);continue}else if(v+1===o){(i-=3)>-1&&t.push(239,191,189);continue}c=l;continue}if(l<56320){(i-=3)>-1&&t.push(239,191,189),c=l;continue}l=(c-55296<<10|l-56320)+65536}else c&&(i-=3)>-1&&t.push(239,191,189);if(c=null,l<128){if((i-=1)<0)break;t.push(l)}else if(l<2048){if((i-=2)<0)break;t.push(l>>6|192,l&63|128)}else if(l<65536){if((i-=3)<0)break;t.push(l>>12|224,l>>6&63|128,l&63|128)}else if(l<1114112){if((i-=4)<0)break;t.push(l>>18|240,l>>12&63|128,l>>6&63|128,l&63|128)}else throw new Error("Invalid code point")}return t}function M3e(a){let i=[];for(let l=0;l<a.length;++l)i.push(a.charCodeAt(l)&255);return i}function q3e(a,i){let l,o,c,t=[];for(let v=0;v<a.length&&!((i-=2)<0);++v)l=a.charCodeAt(v),o=l>>8,c=l%256,t.push(c),t.push(o);return t}function SZ(a){return pI.toByteArray(P3e(a))}function q0(a,i,l,o){let c;for(c=0;c<o&&!(c+l>=i.length||c>=a.length);++c)i[c+l]=a[c];return c}function Pa(a,i){return a instanceof i||a!=null&&a.constructor!=null&&a.constructor.name!=null&&a.constructor.name===i.name}function bI(a){return a!==a}var R3e=function(){let a="0123456789abcdef",i=new Array(256);for(let l=0;l<16;++l){let o=l*16;for(let c=0;c<16;++c)i[o+c]=a[l]+a[c]}return i}();function Tl(a){return typeof BigInt>"u"?D3e:a}function D3e(){throw new Error("BigInt not supported")}});var OZ=P((GJe,AZ)=>{"use strict";AZ.exports=L3e;function L3e(a,i){for(var l=new Array(arguments.length-1),o=0,c=2,t=!0;c<arguments.length;)l[o++]=arguments[c++];return new Promise(function(S,C){l[o]=function(z){if(t)if(t=!1,z)C(z);else{for(var B=new Array(arguments.length-1),ne=0;ne<B.length;)B[ne++]=arguments[ne];S.apply(null,B)}};try{a.apply(i||null,l)}catch(D){t&&(t=!1,C(D))}})}});var qZ=P(MZ=>{"use strict";var R0=MZ;R0.length=function(i){var l=i.length;if(!l)return 0;for(var o=0;--l%4>1&&i.charAt(l)==="=";)++o;return Math.ceil(i.length*3)/4-o};var vf=new Array(64),PZ=new Array(123);for(ea=0;ea<64;)PZ[vf[ea]=ea<26?ea+65:ea<52?ea+71:ea<62?ea-4:ea-59|43]=ea++;var ea;R0.encode=function(i,l,o){for(var c=null,t=[],v=0,S=0,C;l<o;){var D=i[l++];switch(S){case 0:t[v++]=vf[D>>2],C=(D&3)<<4,S=1;break;case 1:t[v++]=vf[C|D>>4],C=(D&15)<<2,S=2;break;case 2:t[v++]=vf[C|D>>6],t[v++]=vf[D&63],S=0;break}v>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,t)),v=0)}return S&&(t[v++]=vf[C],t[v++]=61,S===1&&(t[v++]=61)),c?(v&&c.push(String.fromCharCode.apply(String,t.slice(0,v))),c.join("")):String.fromCharCode.apply(String,t.slice(0,v))};var CZ="invalid encoding";R0.decode=function(i,l,o){for(var c=o,t=0,v,S=0;S<i.length;){var C=i.charCodeAt(S++);if(C===61&&t>1)break;if((C=PZ[C])===void 0)throw Error(CZ);switch(t){case 0:v=C,t=1;break;case 1:l[o++]=v<<2|(C&48)>>4,v=C,t=2;break;case 2:l[o++]=(v&15)<<4|(C&60)>>2,v=C,t=3;break;case 3:l[o++]=(v&3)<<6|C,t=0;break}}if(t===1)throw Error(CZ);return o-c};R0.test=function(i){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(i)}});var DZ=P((ZJe,RZ)=>{"use strict";RZ.exports=D0;function D0(){this._listeners={}}D0.prototype.on=function(i,l,o){return(this._listeners[i]||(this._listeners[i]=[])).push({fn:l,ctx:o||this}),this};D0.prototype.off=function(i,l){if(i===void 0)this._listeners={};else if(l===void 0)this._listeners[i]=[];else for(var o=this._listeners[i],c=0;c<o.length;)o[c].fn===l?o.splice(c,1):++c;return this};D0.prototype.emit=function(i){var l=this._listeners[i];if(l){for(var o=[],c=1;c<arguments.length;)o.push(arguments[c++]);for(c=0;c<l.length;)l[c].fn.apply(l[c++].ctx,o)}return this}});var UZ=P((HJe,NZ)=>{"use strict";NZ.exports=LZ(LZ);function LZ(a){return typeof Float32Array<"u"?function(){var i=new Float32Array([-0]),l=new Uint8Array(i.buffer),o=l[3]===128;function c(C,D,z){i[0]=C,D[z]=l[0],D[z+1]=l[1],D[z+2]=l[2],D[z+3]=l[3]}function t(C,D,z){i[0]=C,D[z]=l[3],D[z+1]=l[2],D[z+2]=l[1],D[z+3]=l[0]}a.writeFloatLE=o?c:t,a.writeFloatBE=o?t:c;function v(C,D){return l[0]=C[D],l[1]=C[D+1],l[2]=C[D+2],l[3]=C[D+3],i[0]}function S(C,D){return l[3]=C[D],l[2]=C[D+1],l[1]=C[D+2],l[0]=C[D+3],i[0]}a.readFloatLE=o?v:S,a.readFloatBE=o?S:v}():function(){function i(o,c,t,v){var S=c<0?1:0;if(S&&(c=-c),c===0)o(1/c>0?0:2147483648,t,v);else if(isNaN(c))o(2143289344,t,v);else if(c>34028234663852886e22)o((S<<31|2139095040)>>>0,t,v);else if(c<11754943508222875e-54)o((S<<31|Math.round(c/1401298464324817e-60))>>>0,t,v);else{var C=Math.floor(Math.log(c)/Math.LN2),D=Math.round(c*Math.pow(2,-C)*8388608)&8388607;o((S<<31|C+127<<23|D)>>>0,t,v)}}a.writeFloatLE=i.bind(null,kZ),a.writeFloatBE=i.bind(null,BZ);function l(o,c,t){var v=o(c,t),S=(v>>31)*2+1,C=v>>>23&255,D=v&8388607;return C===255?D?NaN:S*(1/0):C===0?S*1401298464324817e-60*D:S*Math.pow(2,C-150)*(D+8388608)}a.readFloatLE=l.bind(null,zZ),a.readFloatBE=l.bind(null,FZ)}(),typeof Float64Array<"u"?function(){var i=new Float64Array([-0]),l=new Uint8Array(i.buffer),o=l[7]===128;function c(C,D,z){i[0]=C,D[z]=l[0],D[z+1]=l[1],D[z+2]=l[2],D[z+3]=l[3],D[z+4]=l[4],D[z+5]=l[5],D[z+6]=l[6],D[z+7]=l[7]}function t(C,D,z){i[0]=C,D[z]=l[7],D[z+1]=l[6],D[z+2]=l[5],D[z+3]=l[4],D[z+4]=l[3],D[z+5]=l[2],D[z+6]=l[1],D[z+7]=l[0]}a.writeDoubleLE=o?c:t,a.writeDoubleBE=o?t:c;function v(C,D){return l[0]=C[D],l[1]=C[D+1],l[2]=C[D+2],l[3]=C[D+3],l[4]=C[D+4],l[5]=C[D+5],l[6]=C[D+6],l[7]=C[D+7],i[0]}function S(C,D){return l[7]=C[D],l[6]=C[D+1],l[5]=C[D+2],l[4]=C[D+3],l[3]=C[D+4],l[2]=C[D+5],l[1]=C[D+6],l[0]=C[D+7],i[0]}a.readDoubleLE=o?v:S,a.readDoubleBE=o?S:v}():function(){function i(o,c,t,v,S,C){var D=v<0?1:0;if(D&&(v=-v),v===0)o(0,S,C+c),o(1/v>0?0:2147483648,S,C+t);else if(isNaN(v))o(0,S,C+c),o(2146959360,S,C+t);else if(v>17976931348623157e292)o(0,S,C+c),o((D<<31|2146435072)>>>0,S,C+t);else{var z;if(v<22250738585072014e-324)z=v/5e-324,o(z>>>0,S,C+c),o((D<<31|z/4294967296)>>>0,S,C+t);else{var B=Math.floor(Math.log(v)/Math.LN2);B===1024&&(B=1023),z=v*Math.pow(2,-B),o(z*4503599627370496>>>0,S,C+c),o((D<<31|B+1023<<20|z*1048576&1048575)>>>0,S,C+t)}}}a.writeDoubleLE=i.bind(null,kZ,0,4),a.writeDoubleBE=i.bind(null,BZ,4,0);function l(o,c,t,v,S){var C=o(v,S+c),D=o(v,S+t),z=(D>>31)*2+1,B=D>>>20&2047,ne=4294967296*(D&1048575)+C;return B===2047?ne?NaN:z*(1/0):B===0?z*5e-324*ne:z*Math.pow(2,B-1075)*(ne+4503599627370496)}a.readDoubleLE=l.bind(null,zZ,0,4),a.readDoubleBE=l.bind(null,FZ,4,0)}(),a}function kZ(a,i,l){i[l]=a&255,i[l+1]=a>>>8&255,i[l+2]=a>>>16&255,i[l+3]=a>>>24}function BZ(a,i,l){i[l]=a>>>24,i[l+1]=a>>>16&255,i[l+2]=a>>>8&255,i[l+3]=a&255}function zZ(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16|a[i+3]<<24)>>>0}function FZ(a,i){return(a[i]<<24|a[i+1]<<16|a[i+2]<<8|a[i+3])>>>0}});var jZ=P((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(a){}return null}});var $Z=P(VZ=>{"use strict";var wI=VZ;wI.length=function(i){for(var l=0,o=0,c=0;c<i.length;++c)o=i.charCodeAt(c),o<128?l+=1:o<2048?l+=2:(o&64512)===55296&&(i.charCodeAt(c+1)&64512)===56320?(++c,l+=4):l+=3;return l};wI.read=function(i,l,o){var c=o-l;if(c<1)return"";for(var t=null,v=[],S=0,C;l<o;)C=i[l++],C<128?v[S++]=C:C>191&&C<224?v[S++]=(C&31)<<6|i[l++]&63:C>239&&C<365?(C=((C&7)<<18|(i[l++]&63)<<12|(i[l++]&63)<<6|i[l++]&63)-65536,v[S++]=55296+(C>>10),v[S++]=56320+(C&1023)):v[S++]=(C&15)<<12|(i[l++]&63)<<6|i[l++]&63,S>8191&&((t||(t=[])).push(String.fromCharCode.apply(String,v)),S=0);return t?(S&&t.push(String.fromCharCode.apply(String,v.slice(0,S))),t.join("")):String.fromCharCode.apply(String,v.slice(0,S))};wI.write=function(i,l,o){for(var c=o,t,v,S=0;S<i.length;++S)t=i.charCodeAt(S),t<128?l[o++]=t:t<2048?(l[o++]=t>>6|192,l[o++]=t&63|128):(t&64512)===55296&&((v=i.charCodeAt(S+1))&64512)===56320?(t=65536+((t&1023)<<10)+(v&1023),++S,l[o++]=t>>18|240,l[o++]=t>>12&63|128,l[o++]=t>>6&63|128,l[o++]=t&63|128):(l[o++]=t>>12|224,l[o++]=t>>6&63|128,l[o++]=t&63|128);return o-c}});var WZ=P((KJe,GZ)=>{"use strict";GZ.exports=k3e;function k3e(a,i,l){var o=l||8192,c=o>>>1,t=null,v=o;return function(C){if(C<1||C>c)return a(C);v+C>o&&(t=a(o),v=0);var D=i.call(t,v,v+=C);return v&7&&(v=(v|7)+1),D}}});var HZ=P((YJe,ZZ)=>{"use strict";ZZ.exports=ji;var Wm=Sl();function ji(a,i){this.lo=a>>>0,this.hi=i>>>0}var ec=ji.zero=new ji(0,0);ec.toNumber=function(){return 0};ec.zzEncode=ec.zzDecode=function(){return this};ec.length=function(){return 1};var B3e=ji.zeroHash="\0\0\0\0\0\0\0\0";ji.fromNumber=function(i){if(i===0)return ec;var l=i<0;l&&(i=-i);var o=i>>>0,c=(i-o)/4294967296>>>0;return l&&(c=~c>>>0,o=~o>>>0,++o>4294967295&&(o=0,++c>4294967295&&(c=0))),new ji(o,c)};ji.from=function(i){if(typeof i=="number")return ji.fromNumber(i);if(Wm.isString(i))if(Wm.Long)i=Wm.Long.fromString(i);else return ji.fromNumber(parseInt(i,10));return i.low||i.high?new ji(i.low>>>0,i.high>>>0):ec};ji.prototype.toNumber=function(i){if(!i&&this.hi>>>31){var l=~this.lo+1>>>0,o=~this.hi>>>0;return l||(o=o+1>>>0),-(l+o*4294967296)}return this.lo+this.hi*4294967296};ji.prototype.toLong=function(i){return Wm.Long?new Wm.Long(this.lo|0,this.hi|0,!!i):{low:this.lo|0,high:this.hi|0,unsigned:!!i}};var El=String.prototype.charCodeAt;ji.fromHash=function(i){return i===B3e?ec:new ji((El.call(i,0)|El.call(i,1)<<8|El.call(i,2)<<16|El.call(i,3)<<24)>>>0,(El.call(i,4)|El.call(i,5)<<8|El.call(i,6)<<16|El.call(i,7)<<24)>>>0)};ji.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ji.prototype.zzEncode=function(){var i=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^i)>>>0,this.lo=(this.lo<<1^i)>>>0,this};ji.prototype.zzDecode=function(){var i=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^i)>>>0,this.hi=(this.hi>>>1^i)>>>0,this};ji.prototype.length=function(){var i=this.lo,l=(this.lo>>>28|this.hi<<4)>>>0,o=this.hi>>>24;return o===0?l===0?i<16384?i<128?1:2:i<2097152?3:4:l<16384?l<128?5:6:l<2097152?7:8:o<128?9:10}});var Sl=P(TI=>{"use strict";var qt=TI;qt.asPromise=OZ();qt.base64=qZ();qt.EventEmitter=DZ();qt.float=UZ();qt.inquire=jZ();qt.utf8=$Z();qt.pool=WZ();qt.LongBits=HZ();qt.isNode=!!(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);qt.global=qt.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||TI;qt.emptyArray=Object.freeze?Object.freeze([]):[];qt.emptyObject=Object.freeze?Object.freeze({}):{};qt.isInteger=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i};qt.isString=function(i){return typeof i=="string"||i instanceof String};qt.isObject=function(i){return i&&typeof i=="object"};qt.isset=qt.isSet=function(i,l){var o=i[l];return o!=null&&i.hasOwnProperty(l)?typeof o!="object"||(Array.isArray(o)?o.length:Object.keys(o).length)>0:!1};qt.Buffer=function(){try{var a=qt.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch{return null}}();qt._Buffer_from=null;qt._Buffer_allocUnsafe=null;qt.newBuffer=function(i){return typeof i=="number"?qt.Buffer?qt._Buffer_allocUnsafe(i):new qt.Array(i):qt.Buffer?qt._Buffer_from(i):typeof Uint8Array>"u"?i:new Uint8Array(i)};qt.Array=typeof Uint8Array<"u"?Uint8Array:Array;qt.Long=qt.global.dcodeIO&&qt.global.dcodeIO.Long||qt.global.Long||qt.inquire("long");qt.key2Re=/^true|false|0|1$/;qt.key32Re=/^-?(?:0|[1-9][0-9]*)$/;qt.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;qt.longToHash=function(i){return i?qt.LongBits.from(i).toHash():qt.LongBits.zeroHash};qt.longFromHash=function(i,l){var o=qt.LongBits.fromHash(i);return qt.Long?qt.Long.fromBits(o.lo,o.hi,l):o.toNumber(!!l)};function XZ(a,i,l){for(var o=Object.keys(i),c=0;c<o.length;++c)(a[o[c]]===void 0||!l)&&(a[o[c]]=i[o[c]]);return a}qt.merge=XZ;qt.lcFirst=function(i){return i.charAt(0).toLowerCase()+i.substring(1)};function KZ(a){function i(l,o){if(!(this instanceof i))return new i(l,o);Object.defineProperty(this,"message",{get:function(){return l}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:new Error().stack||""}),o&&XZ(this,o)}return i.prototype=Object.create(Error.prototype,{constructor:{value:i,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),i}qt.newError=KZ;qt.ProtocolError=KZ("ProtocolError");qt.oneOfGetter=function(i){for(var l={},o=0;o<i.length;++o)l[i[o]]=1;return function(){for(var c=Object.keys(this),t=c.length-1;t>-1;--t)if(l[c[t]]===1&&this[c[t]]!==void 0&&this[c[t]]!==null)return c[t]}};qt.oneOfSetter=function(i){return function(l){for(var o=0;o<i.length;++o)i[o]!==l&&delete this[i[o]]}};qt.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};qt._configure=function(){var a=qt.Buffer;if(!a){qt._Buffer_from=qt._Buffer_allocUnsafe=null;return}qt._Buffer_from=a.from!==Uint8Array.from&&a.from||function(l,o){return new a(l,o)},qt._Buffer_allocUnsafe=a.allocUnsafe||function(l){return new a(l)}}});var PI=P((QJe,eH)=>{"use strict";eH.exports=gr;var To=Sl(),EI,L0=To.LongBits,YZ=To.base64,JZ=To.utf8;function Zm(a,i,l){this.fn=a,this.len=i,this.next=void 0,this.val=l}function II(){}function z3e(a){this.head=a.head,this.tail=a.tail,this.len=a.len,this.next=a.states}function gr(){this.len=0,this.head=new Zm(II,0,0),this.tail=this.head,this.states=null}var QZ=function(){return To.Buffer?function(){return(gr.create=function(){return new EI})()}:function(){return new gr}};gr.create=QZ();gr.alloc=function(i){return new To.Array(i)};To.Array!==Array&&(gr.alloc=To.pool(gr.alloc,To.Array.prototype.subarray));gr.prototype._push=function(i,l,o){return this.tail=this.tail.next=new Zm(i,l,o),this.len+=l,this};function AI(a,i,l){i[l]=a&255}function F3e(a,i,l){for(;a>127;)i[l++]=a&127|128,a>>>=7;i[l]=a}function OI(a,i){this.len=a,this.next=void 0,this.val=i}OI.prototype=Object.create(Zm.prototype);OI.prototype.fn=F3e;gr.prototype.uint32=function(i){return this.len+=(this.tail=this.tail.next=new OI((i=i>>>0)<128?1:i<16384?2:i<2097152?3:i<268435456?4:5,i)).len,this};gr.prototype.int32=function(i){return i<0?this._push(CI,10,L0.fromNumber(i)):this.uint32(i)};gr.prototype.sint32=function(i){return this.uint32((i<<1^i>>31)>>>0)};function CI(a,i,l){for(;a.hi;)i[l++]=a.lo&127|128,a.lo=(a.lo>>>7|a.hi<<25)>>>0,a.hi>>>=7;for(;a.lo>127;)i[l++]=a.lo&127|128,a.lo=a.lo>>>7;i[l++]=a.lo}gr.prototype.uint64=function(i){var l=L0.from(i);return this._push(CI,l.length(),l)};gr.prototype.int64=gr.prototype.uint64;gr.prototype.sint64=function(i){var l=L0.from(i).zzEncode();return this._push(CI,l.length(),l)};gr.prototype.bool=function(i){return this._push(AI,1,i?1:0)};function SI(a,i,l){i[l]=a&255,i[l+1]=a>>>8&255,i[l+2]=a>>>16&255,i[l+3]=a>>>24}gr.prototype.fixed32=function(i){return this._push(SI,4,i>>>0)};gr.prototype.sfixed32=gr.prototype.fixed32;gr.prototype.fixed64=function(i){var l=L0.from(i);return this._push(SI,4,l.lo)._push(SI,4,l.hi)};gr.prototype.sfixed64=gr.prototype.fixed64;gr.prototype.float=function(i){return this._push(To.float.writeFloatLE,4,i)};gr.prototype.double=function(i){return this._push(To.float.writeDoubleLE,8,i)};var N3e=To.Array.prototype.set?function(i,l,o){l.set(i,o)}:function(i,l,o){for(var c=0;c<i.length;++c)l[o+c]=i[c]};gr.prototype.bytes=function(i){var l=i.length>>>0;if(!l)return this._push(AI,1,0);if(To.isString(i)){var o=gr.alloc(l=YZ.length(i));YZ.decode(i,o,0),i=o}return this.uint32(l)._push(N3e,l,i)};gr.prototype.string=function(i){var l=JZ.length(i);return l?this.uint32(l)._push(JZ.write,l,i):this._push(AI,1,0)};gr.prototype.fork=function(){return this.states=new z3e(this),this.head=this.tail=new Zm(II,0,0),this.len=0,this};gr.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Zm(II,0,0),this.len=0),this};gr.prototype.ldelim=function(){var i=this.head,l=this.tail,o=this.len;return this.reset().uint32(o),o&&(this.tail.next=i.next,this.tail=l,this.len+=o),this};gr.prototype.finish=function(){for(var i=this.head.next,l=this.constructor.alloc(this.len),o=0;i;)i.fn(i.val,l,o),o+=i.len,i=i.next;return l};gr._configure=function(a){EI=a,gr.create=QZ(),EI._configure()}});var iH=P((eQe,rH)=>{"use strict";rH.exports=Ma;var tH=PI();(Ma.prototype=Object.create(tH.prototype)).constructor=Ma;var Il=Sl();function Ma(){tH.call(this)}Ma._configure=function(){Ma.alloc=Il._Buffer_allocUnsafe,Ma.writeBytesBuffer=Il.Buffer&&Il.Buffer.prototype instanceof Uint8Array&&Il.Buffer.prototype.set.name==="set"?function(i,l,o){l.set(i,o)}:function(i,l,o){if(i.copy)i.copy(l,o,0,i.length);else for(var c=0;c<i.length;)l[o++]=i[c++]}};Ma.prototype.bytes=function(i){Il.isString(i)&&(i=Il._Buffer_from(i,"base64"));var l=i.length>>>0;return this.uint32(l),l&&this._push(Ma.writeBytesBuffer,l,i),this};function U3e(a,i,l){a.length<40?Il.utf8.write(a,i,l):i.utf8Write?i.utf8Write(a,l):i.write(a,l)}Ma.prototype.string=function(i){var l=Il.Buffer.byteLength(i);return this.uint32(l),l&&this._push(U3e,l,i),this};Ma._configure()});var RI=P((tQe,lH)=>{"use strict";lH.exports=gi;var ta=Sl(),qI,aH=ta.LongBits,j3e=ta.utf8;function ra(a,i){return RangeError("index out of range: "+a.pos+" + "+(i||1)+" > "+a.len)}function gi(a){this.buf=a,this.pos=0,this.len=a.length}var nH=typeof Uint8Array<"u"?function(i){if(i instanceof Uint8Array||Array.isArray(i))return new gi(i);throw Error("illegal buffer")}:function(i){if(Array.isArray(i))return new gi(i);throw Error("illegal buffer")},sH=function(){return ta.Buffer?function(l){return(gi.create=function(c){return ta.Buffer.isBuffer(c)?new qI(c):nH(c)})(l)}:nH};gi.create=sH();gi.prototype._slice=ta.Array.prototype.subarray||ta.Array.prototype.slice;gi.prototype.uint32=function(){var i=4294967295;return function(){if(i=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(i=(i|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(i=(i|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(i=(i|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(i=(i|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return i;if((this.pos+=5)>this.len)throw this.pos=this.len,ra(this,10);return i}}();gi.prototype.int32=function(){return this.uint32()|0};gi.prototype.sint32=function(){var i=this.uint32();return i>>>1^-(i&1)|0};function MI(){var a=new aH(0,0),i=0;if(this.len-this.pos>4){for(;i<4;++i)if(a.lo=(a.lo|(this.buf[this.pos]&127)<<i*7)>>>0,this.buf[this.pos++]<128)return a;if(a.lo=(a.lo|(this.buf[this.pos]&127)<<28)>>>0,a.hi=(a.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return a;i=0}else{for(;i<3;++i){if(this.pos>=this.len)throw ra(this);if(a.lo=(a.lo|(this.buf[this.pos]&127)<<i*7)>>>0,this.buf[this.pos++]<128)return a}return a.lo=(a.lo|(this.buf[this.pos++]&127)<<i*7)>>>0,a}if(this.len-this.pos>4){for(;i<5;++i)if(a.hi=(a.hi|(this.buf[this.pos]&127)<<i*7+3)>>>0,this.buf[this.pos++]<128)return a}else for(;i<5;++i){if(this.pos>=this.len)throw ra(this);if(a.hi=(a.hi|(this.buf[this.pos]&127)<<i*7+3)>>>0,this.buf[this.pos++]<128)return a}throw Error("invalid varint encoding")}gi.prototype.bool=function(){return this.uint32()!==0};function k0(a,i){return(a[i-4]|a[i-3]<<8|a[i-2]<<16|a[i-1]<<24)>>>0}gi.prototype.fixed32=function(){if(this.pos+4>this.len)throw ra(this,4);return k0(this.buf,this.pos+=4)};gi.prototype.sfixed32=function(){if(this.pos+4>this.len)throw ra(this,4);return k0(this.buf,this.pos+=4)|0};function oH(){if(this.pos+8>this.len)throw ra(this,8);return new aH(k0(this.buf,this.pos+=4),k0(this.buf,this.pos+=4))}gi.prototype.float=function(){if(this.pos+4>this.len)throw ra(this,4);var i=ta.float.readFloatLE(this.buf,this.pos);return this.pos+=4,i};gi.prototype.double=function(){if(this.pos+8>this.len)throw ra(this,4);var i=ta.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,i};gi.prototype.bytes=function(){var i=this.uint32(),l=this.pos,o=this.pos+i;if(o>this.len)throw ra(this,i);if(this.pos+=i,Array.isArray(this.buf))return this.buf.slice(l,o);if(l===o){var c=ta.Buffer;return c?c.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,l,o)};gi.prototype.string=function(){var i=this.bytes();return j3e.read(i,0,i.length)};gi.prototype.skip=function(i){if(typeof i=="number"){if(this.pos+i>this.len)throw ra(this,i);this.pos+=i}else do if(this.pos>=this.len)throw ra(this);while(this.buf[this.pos++]&128);return this};gi.prototype.skipType=function(a){switch(a){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(a=this.uint32()&7)!==4;)this.skipType(a);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+a+" at offset "+this.pos)}return this};gi._configure=function(a){qI=a,gi.create=sH(),qI._configure();var i=ta.Long?"toLong":"toNumber";ta.merge(gi.prototype,{int64:function(){return MI.call(this)[i](!1)},uint64:function(){return MI.call(this)[i](!0)},sint64:function(){return MI.call(this).zzDecode()[i](!1)},fixed64:function(){return oH.call(this)[i](!0)},sfixed64:function(){return oH.call(this)[i](!1)}})}});var fH=P((rQe,hH)=>{"use strict";hH.exports=tc;var cH=RI();(tc.prototype=Object.create(cH.prototype)).constructor=tc;var uH=Sl();function tc(a){cH.call(this,a)}tc._configure=function(){uH.Buffer&&(tc.prototype._slice=uH.Buffer.prototype.slice)};tc.prototype.string=function(){var i=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+i,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+i,this.len))};tc._configure()});var pH=P((iQe,dH)=>{"use strict";dH.exports=Hm;var DI=Sl();(Hm.prototype=Object.create(DI.EventEmitter.prototype)).constructor=Hm;function Hm(a,i,l){if(typeof a!="function")throw TypeError("rpcImpl must be a function");DI.EventEmitter.call(this),this.rpcImpl=a,this.requestDelimited=!!i,this.responseDelimited=!!l}Hm.prototype.rpcCall=function a(i,l,o,c,t){if(!c)throw TypeError("request must be specified");var v=this;if(!t)return DI.asPromise(a,v,i,l,o,c);if(!v.rpcImpl){setTimeout(function(){t(Error("already ended"))},0);return}try{return v.rpcImpl(i,l[v.requestDelimited?"encodeDelimited":"encode"](c).finish(),function(C,D){if(C)return v.emit("error",C,i),t(C);if(D===null){v.end(!0);return}if(!(D instanceof o))try{D=o[v.responseDelimited?"decodeDelimited":"decode"](D)}catch(z){return v.emit("error",z,i),t(z)}return v.emit("data",D,i),t(null,D)})}catch(S){v.emit("error",S,i),setTimeout(function(){t(S)},0);return}};Hm.prototype.end=function(i){return this.rpcImpl&&(i||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var _H=P(mH=>{"use strict";var V3e=mH;V3e.Service=pH()});var gH=P((oQe,yH)=>{"use strict";yH.exports={}});var bH=P(xH=>{"use strict";var Nn=xH;Nn.build="minimal";Nn.Writer=PI();Nn.BufferWriter=iH();Nn.Reader=RI();Nn.BufferReader=fH();Nn.util=Sl();Nn.rpc=_H();Nn.roots=gH();Nn.configure=vH;function vH(){Nn.util._configure(),Nn.Writer._configure(Nn.BufferWriter),Nn.Reader._configure(Nn.BufferReader)}vH()});var TH=P((sQe,wH)=>{"use strict";wH.exports=bH()});var SH=P((lQe,EH)=>{"use strict";var Zr=TH(),_t=Zr.Reader,vi=Zr.Writer,Ze=Zr.util,le=Zr.roots.default||(Zr.roots.default={});le.transit_realtime=function(){var a={};return a.FeedMessage=function(){function i(l){if(this.entity=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.header=null,i.prototype.entity=Ze.emptyArray,i.create=function(o){return new i(o)},i.encode=function(o,c){if(c||(c=vi.create()),le.transit_realtime.FeedHeader.encode(o.header,c.uint32(10).fork()).ldelim(),o.entity!=null&&o.entity.length)for(var t=0;t<o.entity.length;++t)le.transit_realtime.FeedEntity.encode(o.entity[t],c.uint32(18).fork()).ldelim();return c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.FeedMessage;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.header=le.transit_realtime.FeedHeader.decode(o,o.uint32());break}case 2:{v.entity&&v.entity.length||(v.entity=[]),v.entity.push(le.transit_realtime.FeedEntity.decode(o,o.uint32()));break}default:o.skipType(S&7);break}}if(!v.hasOwnProperty("header"))throw Ze.ProtocolError("missing required 'header'",{instance:v});return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";{var c=le.transit_realtime.FeedHeader.verify(o.header);if(c)return"header."+c}if(o.entity!=null&&o.hasOwnProperty("entity")){if(!Array.isArray(o.entity))return"entity: array expected";for(var t=0;t<o.entity.length;++t){var c=le.transit_realtime.FeedEntity.verify(o.entity[t]);if(c)return"entity."+c}}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.FeedMessage)return o;var c=new le.transit_realtime.FeedMessage;if(o.header!=null){if(typeof o.header!="object")throw TypeError(".transit_realtime.FeedMessage.header: object expected");c.header=le.transit_realtime.FeedHeader.fromObject(o.header)}if(o.entity){if(!Array.isArray(o.entity))throw TypeError(".transit_realtime.FeedMessage.entity: array expected");c.entity=[];for(var t=0;t<o.entity.length;++t){if(typeof o.entity[t]!="object")throw TypeError(".transit_realtime.FeedMessage.entity: object expected");c.entity[t]=le.transit_realtime.FeedEntity.fromObject(o.entity[t])}}return c},i.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.entity=[]),c.defaults&&(t.header=null),o.header!=null&&o.hasOwnProperty("header")&&(t.header=le.transit_realtime.FeedHeader.toObject(o.header,c)),o.entity&&o.entity.length){t.entity=[];for(var v=0;v<o.entity.length;++v)t.entity[v]=le.transit_realtime.FeedEntity.toObject(o.entity[v],c)}return t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.FeedMessage"},i}(),a.FeedHeader=function(){function i(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.gtfs_realtime_version="",i.prototype.incrementality=0,i.prototype.timestamp=Ze.Long?Ze.Long.fromBits(0,0,!0):0,i.create=function(o){return new i(o)},i.encode=function(o,c){return c||(c=vi.create()),c.uint32(10).string(o.gtfs_realtime_version),o.incrementality!=null&&Object.hasOwnProperty.call(o,"incrementality")&&c.uint32(16).int32(o.incrementality),o.timestamp!=null&&Object.hasOwnProperty.call(o,"timestamp")&&c.uint32(24).uint64(o.timestamp),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.FeedHeader;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.gtfs_realtime_version=o.string();break}case 2:{v.incrementality=o.int32();break}case 3:{v.timestamp=o.uint64();break}default:o.skipType(S&7);break}}if(!v.hasOwnProperty("gtfs_realtime_version"))throw Ze.ProtocolError("missing required 'gtfs_realtime_version'",{instance:v});return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(!Ze.isString(o.gtfs_realtime_version))return"gtfs_realtime_version: string expected";if(o.incrementality!=null&&o.hasOwnProperty("incrementality"))switch(o.incrementality){default:return"incrementality: enum value expected";case 0:case 1:break}return o.timestamp!=null&&o.hasOwnProperty("timestamp")&&!Ze.isInteger(o.timestamp)&&!(o.timestamp&&Ze.isInteger(o.timestamp.low)&&Ze.isInteger(o.timestamp.high))?"timestamp: integer|Long expected":null},i.fromObject=function(o){if(o instanceof le.transit_realtime.FeedHeader)return o;var c=new le.transit_realtime.FeedHeader;switch(o.gtfs_realtime_version!=null&&(c.gtfs_realtime_version=String(o.gtfs_realtime_version)),o.incrementality){default:if(typeof o.incrementality=="number"){c.incrementality=o.incrementality;break}break;case"FULL_DATASET":case 0:c.incrementality=0;break;case"DIFFERENTIAL":case 1:c.incrementality=1;break}return o.timestamp!=null&&(Ze.Long?(c.timestamp=Ze.Long.fromValue(o.timestamp)).unsigned=!0:typeof o.timestamp=="string"?c.timestamp=parseInt(o.timestamp,10):typeof o.timestamp=="number"?c.timestamp=o.timestamp:typeof o.timestamp=="object"&&(c.timestamp=new Ze.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0))),c},i.toObject=function(o,c){c||(c={});var t={};if(c.defaults)if(t.gtfs_realtime_version="",t.incrementality=c.enums===String?"FULL_DATASET":0,Ze.Long){var v=new Ze.Long(0,0,!0);t.timestamp=c.longs===String?v.toString():c.longs===Number?v.toNumber():v}else t.timestamp=c.longs===String?"0":0;return o.gtfs_realtime_version!=null&&o.hasOwnProperty("gtfs_realtime_version")&&(t.gtfs_realtime_version=o.gtfs_realtime_version),o.incrementality!=null&&o.hasOwnProperty("incrementality")&&(t.incrementality=c.enums===String?le.transit_realtime.FeedHeader.Incrementality[o.incrementality]===void 0?o.incrementality:le.transit_realtime.FeedHeader.Incrementality[o.incrementality]:o.incrementality),o.timestamp!=null&&o.hasOwnProperty("timestamp")&&(typeof o.timestamp=="number"?t.timestamp=c.longs===String?String(o.timestamp):o.timestamp:t.timestamp=c.longs===String?Ze.Long.prototype.toString.call(o.timestamp):c.longs===Number?new Ze.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0):o.timestamp),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.FeedHeader"},i.Incrementality=function(){var l={},o=Object.create(l);return o[l[0]="FULL_DATASET"]=0,o[l[1]="DIFFERENTIAL"]=1,o}(),i}(),a.FeedEntity=function(){function i(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.id="",i.prototype.is_deleted=!1,i.prototype.trip_update=null,i.prototype.vehicle=null,i.prototype.alert=null,i.prototype.shape=null,i.create=function(o){return new i(o)},i.encode=function(o,c){return c||(c=vi.create()),c.uint32(10).string(o.id),o.is_deleted!=null&&Object.hasOwnProperty.call(o,"is_deleted")&&c.uint32(16).bool(o.is_deleted),o.trip_update!=null&&Object.hasOwnProperty.call(o,"trip_update")&&le.transit_realtime.TripUpdate.encode(o.trip_update,c.uint32(26).fork()).ldelim(),o.vehicle!=null&&Object.hasOwnProperty.call(o,"vehicle")&&le.transit_realtime.VehiclePosition.encode(o.vehicle,c.uint32(34).fork()).ldelim(),o.alert!=null&&Object.hasOwnProperty.call(o,"alert")&&le.transit_realtime.Alert.encode(o.alert,c.uint32(42).fork()).ldelim(),o.shape!=null&&Object.hasOwnProperty.call(o,"shape")&&le.transit_realtime.Shape.encode(o.shape,c.uint32(50).fork()).ldelim(),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.FeedEntity;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.id=o.string();break}case 2:{v.is_deleted=o.bool();break}case 3:{v.trip_update=le.transit_realtime.TripUpdate.decode(o,o.uint32());break}case 4:{v.vehicle=le.transit_realtime.VehiclePosition.decode(o,o.uint32());break}case 5:{v.alert=le.transit_realtime.Alert.decode(o,o.uint32());break}case 6:{v.shape=le.transit_realtime.Shape.decode(o,o.uint32());break}default:o.skipType(S&7);break}}if(!v.hasOwnProperty("id"))throw Ze.ProtocolError("missing required 'id'",{instance:v});return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(!Ze.isString(o.id))return"id: string expected";if(o.is_deleted!=null&&o.hasOwnProperty("is_deleted")&&typeof o.is_deleted!="boolean")return"is_deleted: boolean expected";if(o.trip_update!=null&&o.hasOwnProperty("trip_update")){var c=le.transit_realtime.TripUpdate.verify(o.trip_update);if(c)return"trip_update."+c}if(o.vehicle!=null&&o.hasOwnProperty("vehicle")){var c=le.transit_realtime.VehiclePosition.verify(o.vehicle);if(c)return"vehicle."+c}if(o.alert!=null&&o.hasOwnProperty("alert")){var c=le.transit_realtime.Alert.verify(o.alert);if(c)return"alert."+c}if(o.shape!=null&&o.hasOwnProperty("shape")){var c=le.transit_realtime.Shape.verify(o.shape);if(c)return"shape."+c}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.FeedEntity)return o;var c=new le.transit_realtime.FeedEntity;if(o.id!=null&&(c.id=String(o.id)),o.is_deleted!=null&&(c.is_deleted=!!o.is_deleted),o.trip_update!=null){if(typeof o.trip_update!="object")throw TypeError(".transit_realtime.FeedEntity.trip_update: object expected");c.trip_update=le.transit_realtime.TripUpdate.fromObject(o.trip_update)}if(o.vehicle!=null){if(typeof o.vehicle!="object")throw TypeError(".transit_realtime.FeedEntity.vehicle: object expected");c.vehicle=le.transit_realtime.VehiclePosition.fromObject(o.vehicle)}if(o.alert!=null){if(typeof o.alert!="object")throw TypeError(".transit_realtime.FeedEntity.alert: object expected");c.alert=le.transit_realtime.Alert.fromObject(o.alert)}if(o.shape!=null){if(typeof o.shape!="object")throw TypeError(".transit_realtime.FeedEntity.shape: object expected");c.shape=le.transit_realtime.Shape.fromObject(o.shape)}return c},i.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.id="",t.is_deleted=!1,t.trip_update=null,t.vehicle=null,t.alert=null,t.shape=null),o.id!=null&&o.hasOwnProperty("id")&&(t.id=o.id),o.is_deleted!=null&&o.hasOwnProperty("is_deleted")&&(t.is_deleted=o.is_deleted),o.trip_update!=null&&o.hasOwnProperty("trip_update")&&(t.trip_update=le.transit_realtime.TripUpdate.toObject(o.trip_update,c)),o.vehicle!=null&&o.hasOwnProperty("vehicle")&&(t.vehicle=le.transit_realtime.VehiclePosition.toObject(o.vehicle,c)),o.alert!=null&&o.hasOwnProperty("alert")&&(t.alert=le.transit_realtime.Alert.toObject(o.alert,c)),o.shape!=null&&o.hasOwnProperty("shape")&&(t.shape=le.transit_realtime.Shape.toObject(o.shape,c)),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.FeedEntity"},i}(),a.TripUpdate=function(){function i(l){if(this.stop_time_update=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.trip=null,i.prototype.vehicle=null,i.prototype.stop_time_update=Ze.emptyArray,i.prototype.timestamp=Ze.Long?Ze.Long.fromBits(0,0,!0):0,i.prototype.delay=0,i.prototype.trip_properties=null,i.create=function(o){return new i(o)},i.encode=function(o,c){if(c||(c=vi.create()),le.transit_realtime.TripDescriptor.encode(o.trip,c.uint32(10).fork()).ldelim(),o.stop_time_update!=null&&o.stop_time_update.length)for(var t=0;t<o.stop_time_update.length;++t)le.transit_realtime.TripUpdate.StopTimeUpdate.encode(o.stop_time_update[t],c.uint32(18).fork()).ldelim();return o.vehicle!=null&&Object.hasOwnProperty.call(o,"vehicle")&&le.transit_realtime.VehicleDescriptor.encode(o.vehicle,c.uint32(26).fork()).ldelim(),o.timestamp!=null&&Object.hasOwnProperty.call(o,"timestamp")&&c.uint32(32).uint64(o.timestamp),o.delay!=null&&Object.hasOwnProperty.call(o,"delay")&&c.uint32(40).int32(o.delay),o.trip_properties!=null&&Object.hasOwnProperty.call(o,"trip_properties")&&le.transit_realtime.TripUpdate.TripProperties.encode(o.trip_properties,c.uint32(50).fork()).ldelim(),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.TripUpdate;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.trip=le.transit_realtime.TripDescriptor.decode(o,o.uint32());break}case 3:{v.vehicle=le.transit_realtime.VehicleDescriptor.decode(o,o.uint32());break}case 2:{v.stop_time_update&&v.stop_time_update.length||(v.stop_time_update=[]),v.stop_time_update.push(le.transit_realtime.TripUpdate.StopTimeUpdate.decode(o,o.uint32()));break}case 4:{v.timestamp=o.uint64();break}case 5:{v.delay=o.int32();break}case 6:{v.trip_properties=le.transit_realtime.TripUpdate.TripProperties.decode(o,o.uint32());break}default:o.skipType(S&7);break}}if(!v.hasOwnProperty("trip"))throw Ze.ProtocolError("missing required 'trip'",{instance:v});return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";{var c=le.transit_realtime.TripDescriptor.verify(o.trip);if(c)return"trip."+c}if(o.vehicle!=null&&o.hasOwnProperty("vehicle")){var c=le.transit_realtime.VehicleDescriptor.verify(o.vehicle);if(c)return"vehicle."+c}if(o.stop_time_update!=null&&o.hasOwnProperty("stop_time_update")){if(!Array.isArray(o.stop_time_update))return"stop_time_update: array expected";for(var t=0;t<o.stop_time_update.length;++t){var c=le.transit_realtime.TripUpdate.StopTimeUpdate.verify(o.stop_time_update[t]);if(c)return"stop_time_update."+c}}if(o.timestamp!=null&&o.hasOwnProperty("timestamp")&&!Ze.isInteger(o.timestamp)&&!(o.timestamp&&Ze.isInteger(o.timestamp.low)&&Ze.isInteger(o.timestamp.high)))return"timestamp: integer|Long expected";if(o.delay!=null&&o.hasOwnProperty("delay")&&!Ze.isInteger(o.delay))return"delay: integer expected";if(o.trip_properties!=null&&o.hasOwnProperty("trip_properties")){var c=le.transit_realtime.TripUpdate.TripProperties.verify(o.trip_properties);if(c)return"trip_properties."+c}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.TripUpdate)return o;var c=new le.transit_realtime.TripUpdate;if(o.trip!=null){if(typeof o.trip!="object")throw TypeError(".transit_realtime.TripUpdate.trip: object expected");c.trip=le.transit_realtime.TripDescriptor.fromObject(o.trip)}if(o.vehicle!=null){if(typeof o.vehicle!="object")throw TypeError(".transit_realtime.TripUpdate.vehicle: object expected");c.vehicle=le.transit_realtime.VehicleDescriptor.fromObject(o.vehicle)}if(o.stop_time_update){if(!Array.isArray(o.stop_time_update))throw TypeError(".transit_realtime.TripUpdate.stop_time_update: array expected");c.stop_time_update=[];for(var t=0;t<o.stop_time_update.length;++t){if(typeof o.stop_time_update[t]!="object")throw TypeError(".transit_realtime.TripUpdate.stop_time_update: object expected");c.stop_time_update[t]=le.transit_realtime.TripUpdate.StopTimeUpdate.fromObject(o.stop_time_update[t])}}if(o.timestamp!=null&&(Ze.Long?(c.timestamp=Ze.Long.fromValue(o.timestamp)).unsigned=!0:typeof o.timestamp=="string"?c.timestamp=parseInt(o.timestamp,10):typeof o.timestamp=="number"?c.timestamp=o.timestamp:typeof o.timestamp=="object"&&(c.timestamp=new Ze.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0))),o.delay!=null&&(c.delay=o.delay|0),o.trip_properties!=null){if(typeof o.trip_properties!="object")throw TypeError(".transit_realtime.TripUpdate.trip_properties: object expected");c.trip_properties=le.transit_realtime.TripUpdate.TripProperties.fromObject(o.trip_properties)}return c},i.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.stop_time_update=[]),c.defaults){if(t.trip=null,t.vehicle=null,Ze.Long){var v=new Ze.Long(0,0,!0);t.timestamp=c.longs===String?v.toString():c.longs===Number?v.toNumber():v}else t.timestamp=c.longs===String?"0":0;t.delay=0,t.trip_properties=null}if(o.trip!=null&&o.hasOwnProperty("trip")&&(t.trip=le.transit_realtime.TripDescriptor.toObject(o.trip,c)),o.stop_time_update&&o.stop_time_update.length){t.stop_time_update=[];for(var S=0;S<o.stop_time_update.length;++S)t.stop_time_update[S]=le.transit_realtime.TripUpdate.StopTimeUpdate.toObject(o.stop_time_update[S],c)}return o.vehicle!=null&&o.hasOwnProperty("vehicle")&&(t.vehicle=le.transit_realtime.VehicleDescriptor.toObject(o.vehicle,c)),o.timestamp!=null&&o.hasOwnProperty("timestamp")&&(typeof o.timestamp=="number"?t.timestamp=c.longs===String?String(o.timestamp):o.timestamp:t.timestamp=c.longs===String?Ze.Long.prototype.toString.call(o.timestamp):c.longs===Number?new Ze.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0):o.timestamp),o.delay!=null&&o.hasOwnProperty("delay")&&(t.delay=o.delay),o.trip_properties!=null&&o.hasOwnProperty("trip_properties")&&(t.trip_properties=le.transit_realtime.TripUpdate.TripProperties.toObject(o.trip_properties,c)),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TripUpdate"},i.StopTimeEvent=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.delay=0,l.prototype.time=Ze.Long?Ze.Long.fromBits(0,0,!1):0,l.prototype.uncertainty=0,l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=vi.create()),c.delay!=null&&Object.hasOwnProperty.call(c,"delay")&&t.uint32(8).int32(c.delay),c.time!=null&&Object.hasOwnProperty.call(c,"time")&&t.uint32(16).int64(c.time),c.uncertainty!=null&&Object.hasOwnProperty.call(c,"uncertainty")&&t.uint32(24).int32(c.uncertainty),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof _t||(c=_t.create(c));for(var v=t===void 0?c.len:c.pos+t,S=new le.transit_realtime.TripUpdate.StopTimeEvent;c.pos<v;){var C=c.uint32();switch(C>>>3){case 1:{S.delay=c.int32();break}case 2:{S.time=c.int64();break}case 3:{S.uncertainty=c.int32();break}default:c.skipType(C&7);break}}return S},l.decodeDelimited=function(c){return c instanceof _t||(c=new _t(c)),this.decode(c,c.uint32())},l.verify=function(c){return typeof c!="object"||c===null?"object expected":c.delay!=null&&c.hasOwnProperty("delay")&&!Ze.isInteger(c.delay)?"delay: integer expected":c.time!=null&&c.hasOwnProperty("time")&&!Ze.isInteger(c.time)&&!(c.time&&Ze.isInteger(c.time.low)&&Ze.isInteger(c.time.high))?"time: integer|Long expected":c.uncertainty!=null&&c.hasOwnProperty("uncertainty")&&!Ze.isInteger(c.uncertainty)?"uncertainty: integer expected":null},l.fromObject=function(c){if(c instanceof le.transit_realtime.TripUpdate.StopTimeEvent)return c;var t=new le.transit_realtime.TripUpdate.StopTimeEvent;return c.delay!=null&&(t.delay=c.delay|0),c.time!=null&&(Ze.Long?(t.time=Ze.Long.fromValue(c.time)).unsigned=!1:typeof c.time=="string"?t.time=parseInt(c.time,10):typeof c.time=="number"?t.time=c.time:typeof c.time=="object"&&(t.time=new Ze.LongBits(c.time.low>>>0,c.time.high>>>0).toNumber())),c.uncertainty!=null&&(t.uncertainty=c.uncertainty|0),t},l.toObject=function(c,t){t||(t={});var v={};if(t.defaults){if(v.delay=0,Ze.Long){var S=new Ze.Long(0,0,!1);v.time=t.longs===String?S.toString():t.longs===Number?S.toNumber():S}else v.time=t.longs===String?"0":0;v.uncertainty=0}return c.delay!=null&&c.hasOwnProperty("delay")&&(v.delay=c.delay),c.time!=null&&c.hasOwnProperty("time")&&(typeof c.time=="number"?v.time=t.longs===String?String(c.time):c.time:v.time=t.longs===String?Ze.Long.prototype.toString.call(c.time):t.longs===Number?new Ze.LongBits(c.time.low>>>0,c.time.high>>>0).toNumber():c.time),c.uncertainty!=null&&c.hasOwnProperty("uncertainty")&&(v.uncertainty=c.uncertainty),v},l.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TripUpdate.StopTimeEvent"},l}(),i.StopTimeUpdate=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.stop_sequence=0,l.prototype.stop_id="",l.prototype.arrival=null,l.prototype.departure=null,l.prototype.departure_occupancy_status=0,l.prototype.schedule_relationship=0,l.prototype.stop_time_properties=null,l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=vi.create()),c.stop_sequence!=null&&Object.hasOwnProperty.call(c,"stop_sequence")&&t.uint32(8).uint32(c.stop_sequence),c.arrival!=null&&Object.hasOwnProperty.call(c,"arrival")&&le.transit_realtime.TripUpdate.StopTimeEvent.encode(c.arrival,t.uint32(18).fork()).ldelim(),c.departure!=null&&Object.hasOwnProperty.call(c,"departure")&&le.transit_realtime.TripUpdate.StopTimeEvent.encode(c.departure,t.uint32(26).fork()).ldelim(),c.stop_id!=null&&Object.hasOwnProperty.call(c,"stop_id")&&t.uint32(34).string(c.stop_id),c.schedule_relationship!=null&&Object.hasOwnProperty.call(c,"schedule_relationship")&&t.uint32(40).int32(c.schedule_relationship),c.stop_time_properties!=null&&Object.hasOwnProperty.call(c,"stop_time_properties")&&le.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.encode(c.stop_time_properties,t.uint32(50).fork()).ldelim(),c.departure_occupancy_status!=null&&Object.hasOwnProperty.call(c,"departure_occupancy_status")&&t.uint32(56).int32(c.departure_occupancy_status),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof _t||(c=_t.create(c));for(var v=t===void 0?c.len:c.pos+t,S=new le.transit_realtime.TripUpdate.StopTimeUpdate;c.pos<v;){var C=c.uint32();switch(C>>>3){case 1:{S.stop_sequence=c.uint32();break}case 4:{S.stop_id=c.string();break}case 2:{S.arrival=le.transit_realtime.TripUpdate.StopTimeEvent.decode(c,c.uint32());break}case 3:{S.departure=le.transit_realtime.TripUpdate.StopTimeEvent.decode(c,c.uint32());break}case 7:{S.departure_occupancy_status=c.int32();break}case 5:{S.schedule_relationship=c.int32();break}case 6:{S.stop_time_properties=le.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.decode(c,c.uint32());break}default:c.skipType(C&7);break}}return S},l.decodeDelimited=function(c){return c instanceof _t||(c=new _t(c)),this.decode(c,c.uint32())},l.verify=function(c){if(typeof c!="object"||c===null)return"object expected";if(c.stop_sequence!=null&&c.hasOwnProperty("stop_sequence")&&!Ze.isInteger(c.stop_sequence))return"stop_sequence: integer expected";if(c.stop_id!=null&&c.hasOwnProperty("stop_id")&&!Ze.isString(c.stop_id))return"stop_id: string expected";if(c.arrival!=null&&c.hasOwnProperty("arrival")){var t=le.transit_realtime.TripUpdate.StopTimeEvent.verify(c.arrival);if(t)return"arrival."+t}if(c.departure!=null&&c.hasOwnProperty("departure")){var t=le.transit_realtime.TripUpdate.StopTimeEvent.verify(c.departure);if(t)return"departure."+t}if(c.departure_occupancy_status!=null&&c.hasOwnProperty("departure_occupancy_status"))switch(c.departure_occupancy_status){default:return"departure_occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}if(c.schedule_relationship!=null&&c.hasOwnProperty("schedule_relationship"))switch(c.schedule_relationship){default:return"schedule_relationship: enum value expected";case 0:case 1:case 2:case 3:break}if(c.stop_time_properties!=null&&c.hasOwnProperty("stop_time_properties")){var t=le.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.verify(c.stop_time_properties);if(t)return"stop_time_properties."+t}return null},l.fromObject=function(c){if(c instanceof le.transit_realtime.TripUpdate.StopTimeUpdate)return c;var t=new le.transit_realtime.TripUpdate.StopTimeUpdate;if(c.stop_sequence!=null&&(t.stop_sequence=c.stop_sequence>>>0),c.stop_id!=null&&(t.stop_id=String(c.stop_id)),c.arrival!=null){if(typeof c.arrival!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.arrival: object expected");t.arrival=le.transit_realtime.TripUpdate.StopTimeEvent.fromObject(c.arrival)}if(c.departure!=null){if(typeof c.departure!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.departure: object expected");t.departure=le.transit_realtime.TripUpdate.StopTimeEvent.fromObject(c.departure)}switch(c.departure_occupancy_status){default:if(typeof c.departure_occupancy_status=="number"){t.departure_occupancy_status=c.departure_occupancy_status;break}break;case"EMPTY":case 0:t.departure_occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:t.departure_occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:t.departure_occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:t.departure_occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:t.departure_occupancy_status=4;break;case"FULL":case 5:t.departure_occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:t.departure_occupancy_status=6;break;case"NO_DATA_AVAILABLE":case 7:t.departure_occupancy_status=7;break;case"NOT_BOARDABLE":case 8:t.departure_occupancy_status=8;break}switch(c.schedule_relationship){default:if(typeof c.schedule_relationship=="number"){t.schedule_relationship=c.schedule_relationship;break}break;case"SCHEDULED":case 0:t.schedule_relationship=0;break;case"SKIPPED":case 1:t.schedule_relationship=1;break;case"NO_DATA":case 2:t.schedule_relationship=2;break;case"UNSCHEDULED":case 3:t.schedule_relationship=3;break}if(c.stop_time_properties!=null){if(typeof c.stop_time_properties!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.stop_time_properties: object expected");t.stop_time_properties=le.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.fromObject(c.stop_time_properties)}return t},l.toObject=function(c,t){t||(t={});var v={};return t.defaults&&(v.stop_sequence=0,v.arrival=null,v.departure=null,v.stop_id="",v.schedule_relationship=t.enums===String?"SCHEDULED":0,v.stop_time_properties=null,v.departure_occupancy_status=t.enums===String?"EMPTY":0),c.stop_sequence!=null&&c.hasOwnProperty("stop_sequence")&&(v.stop_sequence=c.stop_sequence),c.arrival!=null&&c.hasOwnProperty("arrival")&&(v.arrival=le.transit_realtime.TripUpdate.StopTimeEvent.toObject(c.arrival,t)),c.departure!=null&&c.hasOwnProperty("departure")&&(v.departure=le.transit_realtime.TripUpdate.StopTimeEvent.toObject(c.departure,t)),c.stop_id!=null&&c.hasOwnProperty("stop_id")&&(v.stop_id=c.stop_id),c.schedule_relationship!=null&&c.hasOwnProperty("schedule_relationship")&&(v.schedule_relationship=t.enums===String?le.transit_realtime.TripUpdate.StopTimeUpdate.ScheduleRelationship[c.schedule_relationship]===void 0?c.schedule_relationship:le.transit_realtime.TripUpdate.StopTimeUpdate.ScheduleRelationship[c.schedule_relationship]:c.schedule_relationship),c.stop_time_properties!=null&&c.hasOwnProperty("stop_time_properties")&&(v.stop_time_properties=le.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.toObject(c.stop_time_properties,t)),c.departure_occupancy_status!=null&&c.hasOwnProperty("departure_occupancy_status")&&(v.departure_occupancy_status=t.enums===String?le.transit_realtime.VehiclePosition.OccupancyStatus[c.departure_occupancy_status]===void 0?c.departure_occupancy_status:le.transit_realtime.VehiclePosition.OccupancyStatus[c.departure_occupancy_status]:c.departure_occupancy_status),v},l.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TripUpdate.StopTimeUpdate"},l.ScheduleRelationship=function(){var o={},c=Object.create(o);return c[o[0]="SCHEDULED"]=0,c[o[1]="SKIPPED"]=1,c[o[2]="NO_DATA"]=2,c[o[3]="UNSCHEDULED"]=3,c}(),l.StopTimeProperties=function(){function o(c){if(c)for(var t=Object.keys(c),v=0;v<t.length;++v)c[t[v]]!=null&&(this[t[v]]=c[t[v]])}return o.prototype.assigned_stop_id="",o.create=function(t){return new o(t)},o.encode=function(t,v){return v||(v=vi.create()),t.assigned_stop_id!=null&&Object.hasOwnProperty.call(t,"assigned_stop_id")&&v.uint32(10).string(t.assigned_stop_id),v},o.encodeDelimited=function(t,v){return this.encode(t,v).ldelim()},o.decode=function(t,v){t instanceof _t||(t=_t.create(t));for(var S=v===void 0?t.len:t.pos+v,C=new le.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties;t.pos<S;){var D=t.uint32();switch(D>>>3){case 1:{C.assigned_stop_id=t.string();break}default:t.skipType(D&7);break}}return C},o.decodeDelimited=function(t){return t instanceof _t||(t=new _t(t)),this.decode(t,t.uint32())},o.verify=function(t){return typeof t!="object"||t===null?"object expected":t.assigned_stop_id!=null&&t.hasOwnProperty("assigned_stop_id")&&!Ze.isString(t.assigned_stop_id)?"assigned_stop_id: string expected":null},o.fromObject=function(t){if(t instanceof le.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties)return t;var v=new le.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties;return t.assigned_stop_id!=null&&(v.assigned_stop_id=String(t.assigned_stop_id)),v},o.toObject=function(t,v){v||(v={});var S={};return v.defaults&&(S.assigned_stop_id=""),t.assigned_stop_id!=null&&t.hasOwnProperty("assigned_stop_id")&&(S.assigned_stop_id=t.assigned_stop_id),S},o.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},o.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties"},o}(),l}(),i.TripProperties=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.trip_id="",l.prototype.start_date="",l.prototype.start_time="",l.prototype.shape_id="",l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=vi.create()),c.trip_id!=null&&Object.hasOwnProperty.call(c,"trip_id")&&t.uint32(10).string(c.trip_id),c.start_date!=null&&Object.hasOwnProperty.call(c,"start_date")&&t.uint32(18).string(c.start_date),c.start_time!=null&&Object.hasOwnProperty.call(c,"start_time")&&t.uint32(26).string(c.start_time),c.shape_id!=null&&Object.hasOwnProperty.call(c,"shape_id")&&t.uint32(34).string(c.shape_id),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof _t||(c=_t.create(c));for(var v=t===void 0?c.len:c.pos+t,S=new le.transit_realtime.TripUpdate.TripProperties;c.pos<v;){var C=c.uint32();switch(C>>>3){case 1:{S.trip_id=c.string();break}case 2:{S.start_date=c.string();break}case 3:{S.start_time=c.string();break}case 4:{S.shape_id=c.string();break}default:c.skipType(C&7);break}}return S},l.decodeDelimited=function(c){return c instanceof _t||(c=new _t(c)),this.decode(c,c.uint32())},l.verify=function(c){return typeof c!="object"||c===null?"object expected":c.trip_id!=null&&c.hasOwnProperty("trip_id")&&!Ze.isString(c.trip_id)?"trip_id: string expected":c.start_date!=null&&c.hasOwnProperty("start_date")&&!Ze.isString(c.start_date)?"start_date: string expected":c.start_time!=null&&c.hasOwnProperty("start_time")&&!Ze.isString(c.start_time)?"start_time: string expected":c.shape_id!=null&&c.hasOwnProperty("shape_id")&&!Ze.isString(c.shape_id)?"shape_id: string expected":null},l.fromObject=function(c){if(c instanceof le.transit_realtime.TripUpdate.TripProperties)return c;var t=new le.transit_realtime.TripUpdate.TripProperties;return c.trip_id!=null&&(t.trip_id=String(c.trip_id)),c.start_date!=null&&(t.start_date=String(c.start_date)),c.start_time!=null&&(t.start_time=String(c.start_time)),c.shape_id!=null&&(t.shape_id=String(c.shape_id)),t},l.toObject=function(c,t){t||(t={});var v={};return t.defaults&&(v.trip_id="",v.start_date="",v.start_time="",v.shape_id=""),c.trip_id!=null&&c.hasOwnProperty("trip_id")&&(v.trip_id=c.trip_id),c.start_date!=null&&c.hasOwnProperty("start_date")&&(v.start_date=c.start_date),c.start_time!=null&&c.hasOwnProperty("start_time")&&(v.start_time=c.start_time),c.shape_id!=null&&c.hasOwnProperty("shape_id")&&(v.shape_id=c.shape_id),v},l.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TripUpdate.TripProperties"},l}(),i}(),a.VehiclePosition=function(){function i(l){if(this.multi_carriage_details=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.trip=null,i.prototype.vehicle=null,i.prototype.position=null,i.prototype.current_stop_sequence=0,i.prototype.stop_id="",i.prototype.current_status=2,i.prototype.timestamp=Ze.Long?Ze.Long.fromBits(0,0,!0):0,i.prototype.congestion_level=0,i.prototype.occupancy_status=0,i.prototype.occupancy_percentage=0,i.prototype.multi_carriage_details=Ze.emptyArray,i.create=function(o){return new i(o)},i.encode=function(o,c){if(c||(c=vi.create()),o.trip!=null&&Object.hasOwnProperty.call(o,"trip")&&le.transit_realtime.TripDescriptor.encode(o.trip,c.uint32(10).fork()).ldelim(),o.position!=null&&Object.hasOwnProperty.call(o,"position")&&le.transit_realtime.Position.encode(o.position,c.uint32(18).fork()).ldelim(),o.current_stop_sequence!=null&&Object.hasOwnProperty.call(o,"current_stop_sequence")&&c.uint32(24).uint32(o.current_stop_sequence),o.current_status!=null&&Object.hasOwnProperty.call(o,"current_status")&&c.uint32(32).int32(o.current_status),o.timestamp!=null&&Object.hasOwnProperty.call(o,"timestamp")&&c.uint32(40).uint64(o.timestamp),o.congestion_level!=null&&Object.hasOwnProperty.call(o,"congestion_level")&&c.uint32(48).int32(o.congestion_level),o.stop_id!=null&&Object.hasOwnProperty.call(o,"stop_id")&&c.uint32(58).string(o.stop_id),o.vehicle!=null&&Object.hasOwnProperty.call(o,"vehicle")&&le.transit_realtime.VehicleDescriptor.encode(o.vehicle,c.uint32(66).fork()).ldelim(),o.occupancy_status!=null&&Object.hasOwnProperty.call(o,"occupancy_status")&&c.uint32(72).int32(o.occupancy_status),o.occupancy_percentage!=null&&Object.hasOwnProperty.call(o,"occupancy_percentage")&&c.uint32(80).uint32(o.occupancy_percentage),o.multi_carriage_details!=null&&o.multi_carriage_details.length)for(var t=0;t<o.multi_carriage_details.length;++t)le.transit_realtime.VehiclePosition.CarriageDetails.encode(o.multi_carriage_details[t],c.uint32(90).fork()).ldelim();return c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.VehiclePosition;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.trip=le.transit_realtime.TripDescriptor.decode(o,o.uint32());break}case 8:{v.vehicle=le.transit_realtime.VehicleDescriptor.decode(o,o.uint32());break}case 2:{v.position=le.transit_realtime.Position.decode(o,o.uint32());break}case 3:{v.current_stop_sequence=o.uint32();break}case 7:{v.stop_id=o.string();break}case 4:{v.current_status=o.int32();break}case 5:{v.timestamp=o.uint64();break}case 6:{v.congestion_level=o.int32();break}case 9:{v.occupancy_status=o.int32();break}case 10:{v.occupancy_percentage=o.uint32();break}case 11:{v.multi_carriage_details&&v.multi_carriage_details.length||(v.multi_carriage_details=[]),v.multi_carriage_details.push(le.transit_realtime.VehiclePosition.CarriageDetails.decode(o,o.uint32()));break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.trip!=null&&o.hasOwnProperty("trip")){var c=le.transit_realtime.TripDescriptor.verify(o.trip);if(c)return"trip."+c}if(o.vehicle!=null&&o.hasOwnProperty("vehicle")){var c=le.transit_realtime.VehicleDescriptor.verify(o.vehicle);if(c)return"vehicle."+c}if(o.position!=null&&o.hasOwnProperty("position")){var c=le.transit_realtime.Position.verify(o.position);if(c)return"position."+c}if(o.current_stop_sequence!=null&&o.hasOwnProperty("current_stop_sequence")&&!Ze.isInteger(o.current_stop_sequence))return"current_stop_sequence: integer expected";if(o.stop_id!=null&&o.hasOwnProperty("stop_id")&&!Ze.isString(o.stop_id))return"stop_id: string expected";if(o.current_status!=null&&o.hasOwnProperty("current_status"))switch(o.current_status){default:return"current_status: enum value expected";case 0:case 1:case 2:break}if(o.timestamp!=null&&o.hasOwnProperty("timestamp")&&!Ze.isInteger(o.timestamp)&&!(o.timestamp&&Ze.isInteger(o.timestamp.low)&&Ze.isInteger(o.timestamp.high)))return"timestamp: integer|Long expected";if(o.congestion_level!=null&&o.hasOwnProperty("congestion_level"))switch(o.congestion_level){default:return"congestion_level: enum value expected";case 0:case 1:case 2:case 3:case 4:break}if(o.occupancy_status!=null&&o.hasOwnProperty("occupancy_status"))switch(o.occupancy_status){default:return"occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}if(o.occupancy_percentage!=null&&o.hasOwnProperty("occupancy_percentage")&&!Ze.isInteger(o.occupancy_percentage))return"occupancy_percentage: integer expected";if(o.multi_carriage_details!=null&&o.hasOwnProperty("multi_carriage_details")){if(!Array.isArray(o.multi_carriage_details))return"multi_carriage_details: array expected";for(var t=0;t<o.multi_carriage_details.length;++t){var c=le.transit_realtime.VehiclePosition.CarriageDetails.verify(o.multi_carriage_details[t]);if(c)return"multi_carriage_details."+c}}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.VehiclePosition)return o;var c=new le.transit_realtime.VehiclePosition;if(o.trip!=null){if(typeof o.trip!="object")throw TypeError(".transit_realtime.VehiclePosition.trip: object expected");c.trip=le.transit_realtime.TripDescriptor.fromObject(o.trip)}if(o.vehicle!=null){if(typeof o.vehicle!="object")throw TypeError(".transit_realtime.VehiclePosition.vehicle: object expected");c.vehicle=le.transit_realtime.VehicleDescriptor.fromObject(o.vehicle)}if(o.position!=null){if(typeof o.position!="object")throw TypeError(".transit_realtime.VehiclePosition.position: object expected");c.position=le.transit_realtime.Position.fromObject(o.position)}switch(o.current_stop_sequence!=null&&(c.current_stop_sequence=o.current_stop_sequence>>>0),o.stop_id!=null&&(c.stop_id=String(o.stop_id)),o.current_status){case"INCOMING_AT":case 0:c.current_status=0;break;case"STOPPED_AT":case 1:c.current_status=1;break;default:if(typeof o.current_status=="number"){c.current_status=o.current_status;break}break;case"IN_TRANSIT_TO":case 2:c.current_status=2;break}switch(o.timestamp!=null&&(Ze.Long?(c.timestamp=Ze.Long.fromValue(o.timestamp)).unsigned=!0:typeof o.timestamp=="string"?c.timestamp=parseInt(o.timestamp,10):typeof o.timestamp=="number"?c.timestamp=o.timestamp:typeof o.timestamp=="object"&&(c.timestamp=new Ze.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0))),o.congestion_level){default:if(typeof o.congestion_level=="number"){c.congestion_level=o.congestion_level;break}break;case"UNKNOWN_CONGESTION_LEVEL":case 0:c.congestion_level=0;break;case"RUNNING_SMOOTHLY":case 1:c.congestion_level=1;break;case"STOP_AND_GO":case 2:c.congestion_level=2;break;case"CONGESTION":case 3:c.congestion_level=3;break;case"SEVERE_CONGESTION":case 4:c.congestion_level=4;break}switch(o.occupancy_status){default:if(typeof o.occupancy_status=="number"){c.occupancy_status=o.occupancy_status;break}break;case"EMPTY":case 0:c.occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:c.occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:c.occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:c.occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:c.occupancy_status=4;break;case"FULL":case 5:c.occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:c.occupancy_status=6;break;case"NO_DATA_AVAILABLE":case 7:c.occupancy_status=7;break;case"NOT_BOARDABLE":case 8:c.occupancy_status=8;break}if(o.occupancy_percentage!=null&&(c.occupancy_percentage=o.occupancy_percentage>>>0),o.multi_carriage_details){if(!Array.isArray(o.multi_carriage_details))throw TypeError(".transit_realtime.VehiclePosition.multi_carriage_details: array expected");c.multi_carriage_details=[];for(var t=0;t<o.multi_carriage_details.length;++t){if(typeof o.multi_carriage_details[t]!="object")throw TypeError(".transit_realtime.VehiclePosition.multi_carriage_details: object expected");c.multi_carriage_details[t]=le.transit_realtime.VehiclePosition.CarriageDetails.fromObject(o.multi_carriage_details[t])}}return c},i.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.multi_carriage_details=[]),c.defaults){if(t.trip=null,t.position=null,t.current_stop_sequence=0,t.current_status=c.enums===String?"IN_TRANSIT_TO":2,Ze.Long){var v=new Ze.Long(0,0,!0);t.timestamp=c.longs===String?v.toString():c.longs===Number?v.toNumber():v}else t.timestamp=c.longs===String?"0":0;t.congestion_level=c.enums===String?"UNKNOWN_CONGESTION_LEVEL":0,t.stop_id="",t.vehicle=null,t.occupancy_status=c.enums===String?"EMPTY":0,t.occupancy_percentage=0}if(o.trip!=null&&o.hasOwnProperty("trip")&&(t.trip=le.transit_realtime.TripDescriptor.toObject(o.trip,c)),o.position!=null&&o.hasOwnProperty("position")&&(t.position=le.transit_realtime.Position.toObject(o.position,c)),o.current_stop_sequence!=null&&o.hasOwnProperty("current_stop_sequence")&&(t.current_stop_sequence=o.current_stop_sequence),o.current_status!=null&&o.hasOwnProperty("current_status")&&(t.current_status=c.enums===String?le.transit_realtime.VehiclePosition.VehicleStopStatus[o.current_status]===void 0?o.current_status:le.transit_realtime.VehiclePosition.VehicleStopStatus[o.current_status]:o.current_status),o.timestamp!=null&&o.hasOwnProperty("timestamp")&&(typeof o.timestamp=="number"?t.timestamp=c.longs===String?String(o.timestamp):o.timestamp:t.timestamp=c.longs===String?Ze.Long.prototype.toString.call(o.timestamp):c.longs===Number?new Ze.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0):o.timestamp),o.congestion_level!=null&&o.hasOwnProperty("congestion_level")&&(t.congestion_level=c.enums===String?le.transit_realtime.VehiclePosition.CongestionLevel[o.congestion_level]===void 0?o.congestion_level:le.transit_realtime.VehiclePosition.CongestionLevel[o.congestion_level]:o.congestion_level),o.stop_id!=null&&o.hasOwnProperty("stop_id")&&(t.stop_id=o.stop_id),o.vehicle!=null&&o.hasOwnProperty("vehicle")&&(t.vehicle=le.transit_realtime.VehicleDescriptor.toObject(o.vehicle,c)),o.occupancy_status!=null&&o.hasOwnProperty("occupancy_status")&&(t.occupancy_status=c.enums===String?le.transit_realtime.VehiclePosition.OccupancyStatus[o.occupancy_status]===void 0?o.occupancy_status:le.transit_realtime.VehiclePosition.OccupancyStatus[o.occupancy_status]:o.occupancy_status),o.occupancy_percentage!=null&&o.hasOwnProperty("occupancy_percentage")&&(t.occupancy_percentage=o.occupancy_percentage),o.multi_carriage_details&&o.multi_carriage_details.length){t.multi_carriage_details=[];for(var S=0;S<o.multi_carriage_details.length;++S)t.multi_carriage_details[S]=le.transit_realtime.VehiclePosition.CarriageDetails.toObject(o.multi_carriage_details[S],c)}return t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.VehiclePosition"},i.VehicleStopStatus=function(){var l={},o=Object.create(l);return o[l[0]="INCOMING_AT"]=0,o[l[1]="STOPPED_AT"]=1,o[l[2]="IN_TRANSIT_TO"]=2,o}(),i.CongestionLevel=function(){var l={},o=Object.create(l);return o[l[0]="UNKNOWN_CONGESTION_LEVEL"]=0,o[l[1]="RUNNING_SMOOTHLY"]=1,o[l[2]="STOP_AND_GO"]=2,o[l[3]="CONGESTION"]=3,o[l[4]="SEVERE_CONGESTION"]=4,o}(),i.OccupancyStatus=function(){var l={},o=Object.create(l);return o[l[0]="EMPTY"]=0,o[l[1]="MANY_SEATS_AVAILABLE"]=1,o[l[2]="FEW_SEATS_AVAILABLE"]=2,o[l[3]="STANDING_ROOM_ONLY"]=3,o[l[4]="CRUSHED_STANDING_ROOM_ONLY"]=4,o[l[5]="FULL"]=5,o[l[6]="NOT_ACCEPTING_PASSENGERS"]=6,o[l[7]="NO_DATA_AVAILABLE"]=7,o[l[8]="NOT_BOARDABLE"]=8,o}(),i.CarriageDetails=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.id="",l.prototype.label="",l.prototype.occupancy_status=7,l.prototype.occupancy_percentage=-1,l.prototype.carriage_sequence=0,l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=vi.create()),c.id!=null&&Object.hasOwnProperty.call(c,"id")&&t.uint32(10).string(c.id),c.label!=null&&Object.hasOwnProperty.call(c,"label")&&t.uint32(18).string(c.label),c.occupancy_status!=null&&Object.hasOwnProperty.call(c,"occupancy_status")&&t.uint32(24).int32(c.occupancy_status),c.occupancy_percentage!=null&&Object.hasOwnProperty.call(c,"occupancy_percentage")&&t.uint32(32).int32(c.occupancy_percentage),c.carriage_sequence!=null&&Object.hasOwnProperty.call(c,"carriage_sequence")&&t.uint32(40).uint32(c.carriage_sequence),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof _t||(c=_t.create(c));for(var v=t===void 0?c.len:c.pos+t,S=new le.transit_realtime.VehiclePosition.CarriageDetails;c.pos<v;){var C=c.uint32();switch(C>>>3){case 1:{S.id=c.string();break}case 2:{S.label=c.string();break}case 3:{S.occupancy_status=c.int32();break}case 4:{S.occupancy_percentage=c.int32();break}case 5:{S.carriage_sequence=c.uint32();break}default:c.skipType(C&7);break}}return S},l.decodeDelimited=function(c){return c instanceof _t||(c=new _t(c)),this.decode(c,c.uint32())},l.verify=function(c){if(typeof c!="object"||c===null)return"object expected";if(c.id!=null&&c.hasOwnProperty("id")&&!Ze.isString(c.id))return"id: string expected";if(c.label!=null&&c.hasOwnProperty("label")&&!Ze.isString(c.label))return"label: string expected";if(c.occupancy_status!=null&&c.hasOwnProperty("occupancy_status"))switch(c.occupancy_status){default:return"occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}return c.occupancy_percentage!=null&&c.hasOwnProperty("occupancy_percentage")&&!Ze.isInteger(c.occupancy_percentage)?"occupancy_percentage: integer expected":c.carriage_sequence!=null&&c.hasOwnProperty("carriage_sequence")&&!Ze.isInteger(c.carriage_sequence)?"carriage_sequence: integer expected":null},l.fromObject=function(c){if(c instanceof le.transit_realtime.VehiclePosition.CarriageDetails)return c;var t=new le.transit_realtime.VehiclePosition.CarriageDetails;switch(c.id!=null&&(t.id=String(c.id)),c.label!=null&&(t.label=String(c.label)),c.occupancy_status){case"EMPTY":case 0:t.occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:t.occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:t.occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:t.occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:t.occupancy_status=4;break;case"FULL":case 5:t.occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:t.occupancy_status=6;break;default:if(typeof c.occupancy_status=="number"){t.occupancy_status=c.occupancy_status;break}break;case"NO_DATA_AVAILABLE":case 7:t.occupancy_status=7;break;case"NOT_BOARDABLE":case 8:t.occupancy_status=8;break}return c.occupancy_percentage!=null&&(t.occupancy_percentage=c.occupancy_percentage|0),c.carriage_sequence!=null&&(t.carriage_sequence=c.carriage_sequence>>>0),t},l.toObject=function(c,t){t||(t={});var v={};return t.defaults&&(v.id="",v.label="",v.occupancy_status=t.enums===String?"NO_DATA_AVAILABLE":7,v.occupancy_percentage=-1,v.carriage_sequence=0),c.id!=null&&c.hasOwnProperty("id")&&(v.id=c.id),c.label!=null&&c.hasOwnProperty("label")&&(v.label=c.label),c.occupancy_status!=null&&c.hasOwnProperty("occupancy_status")&&(v.occupancy_status=t.enums===String?le.transit_realtime.VehiclePosition.OccupancyStatus[c.occupancy_status]===void 0?c.occupancy_status:le.transit_realtime.VehiclePosition.OccupancyStatus[c.occupancy_status]:c.occupancy_status),c.occupancy_percentage!=null&&c.hasOwnProperty("occupancy_percentage")&&(v.occupancy_percentage=c.occupancy_percentage),c.carriage_sequence!=null&&c.hasOwnProperty("carriage_sequence")&&(v.carriage_sequence=c.carriage_sequence),v},l.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.VehiclePosition.CarriageDetails"},l}(),i}(),a.Alert=function(){function i(l){if(this.active_period=[],this.informed_entity=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.active_period=Ze.emptyArray,i.prototype.informed_entity=Ze.emptyArray,i.prototype.cause=1,i.prototype.effect=8,i.prototype.url=null,i.prototype.header_text=null,i.prototype.description_text=null,i.prototype.tts_header_text=null,i.prototype.tts_description_text=null,i.prototype.severity_level=1,i.prototype.image=null,i.prototype.image_alternative_text=null,i.prototype.cause_detail=null,i.prototype.effect_detail=null,i.create=function(o){return new i(o)},i.encode=function(o,c){if(c||(c=vi.create()),o.active_period!=null&&o.active_period.length)for(var t=0;t<o.active_period.length;++t)le.transit_realtime.TimeRange.encode(o.active_period[t],c.uint32(10).fork()).ldelim();if(o.informed_entity!=null&&o.informed_entity.length)for(var t=0;t<o.informed_entity.length;++t)le.transit_realtime.EntitySelector.encode(o.informed_entity[t],c.uint32(42).fork()).ldelim();return o.cause!=null&&Object.hasOwnProperty.call(o,"cause")&&c.uint32(48).int32(o.cause),o.effect!=null&&Object.hasOwnProperty.call(o,"effect")&&c.uint32(56).int32(o.effect),o.url!=null&&Object.hasOwnProperty.call(o,"url")&&le.transit_realtime.TranslatedString.encode(o.url,c.uint32(66).fork()).ldelim(),o.header_text!=null&&Object.hasOwnProperty.call(o,"header_text")&&le.transit_realtime.TranslatedString.encode(o.header_text,c.uint32(82).fork()).ldelim(),o.description_text!=null&&Object.hasOwnProperty.call(o,"description_text")&&le.transit_realtime.TranslatedString.encode(o.description_text,c.uint32(90).fork()).ldelim(),o.tts_header_text!=null&&Object.hasOwnProperty.call(o,"tts_header_text")&&le.transit_realtime.TranslatedString.encode(o.tts_header_text,c.uint32(98).fork()).ldelim(),o.tts_description_text!=null&&Object.hasOwnProperty.call(o,"tts_description_text")&&le.transit_realtime.TranslatedString.encode(o.tts_description_text,c.uint32(106).fork()).ldelim(),o.severity_level!=null&&Object.hasOwnProperty.call(o,"severity_level")&&c.uint32(112).int32(o.severity_level),o.image!=null&&Object.hasOwnProperty.call(o,"image")&&le.transit_realtime.TranslatedImage.encode(o.image,c.uint32(122).fork()).ldelim(),o.image_alternative_text!=null&&Object.hasOwnProperty.call(o,"image_alternative_text")&&le.transit_realtime.TranslatedString.encode(o.image_alternative_text,c.uint32(130).fork()).ldelim(),o.cause_detail!=null&&Object.hasOwnProperty.call(o,"cause_detail")&&le.transit_realtime.TranslatedString.encode(o.cause_detail,c.uint32(138).fork()).ldelim(),o.effect_detail!=null&&Object.hasOwnProperty.call(o,"effect_detail")&&le.transit_realtime.TranslatedString.encode(o.effect_detail,c.uint32(146).fork()).ldelim(),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.Alert;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.active_period&&v.active_period.length||(v.active_period=[]),v.active_period.push(le.transit_realtime.TimeRange.decode(o,o.uint32()));break}case 5:{v.informed_entity&&v.informed_entity.length||(v.informed_entity=[]),v.informed_entity.push(le.transit_realtime.EntitySelector.decode(o,o.uint32()));break}case 6:{v.cause=o.int32();break}case 7:{v.effect=o.int32();break}case 8:{v.url=le.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 10:{v.header_text=le.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 11:{v.description_text=le.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 12:{v.tts_header_text=le.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 13:{v.tts_description_text=le.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 14:{v.severity_level=o.int32();break}case 15:{v.image=le.transit_realtime.TranslatedImage.decode(o,o.uint32());break}case 16:{v.image_alternative_text=le.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 17:{v.cause_detail=le.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 18:{v.effect_detail=le.transit_realtime.TranslatedString.decode(o,o.uint32());break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.active_period!=null&&o.hasOwnProperty("active_period")){if(!Array.isArray(o.active_period))return"active_period: array expected";for(var c=0;c<o.active_period.length;++c){var t=le.transit_realtime.TimeRange.verify(o.active_period[c]);if(t)return"active_period."+t}}if(o.informed_entity!=null&&o.hasOwnProperty("informed_entity")){if(!Array.isArray(o.informed_entity))return"informed_entity: array expected";for(var c=0;c<o.informed_entity.length;++c){var t=le.transit_realtime.EntitySelector.verify(o.informed_entity[c]);if(t)return"informed_entity."+t}}if(o.cause!=null&&o.hasOwnProperty("cause"))switch(o.cause){default:return"cause: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:break}if(o.effect!=null&&o.hasOwnProperty("effect"))switch(o.effect){default:return"effect: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:break}if(o.url!=null&&o.hasOwnProperty("url")){var t=le.transit_realtime.TranslatedString.verify(o.url);if(t)return"url."+t}if(o.header_text!=null&&o.hasOwnProperty("header_text")){var t=le.transit_realtime.TranslatedString.verify(o.header_text);if(t)return"header_text."+t}if(o.description_text!=null&&o.hasOwnProperty("description_text")){var t=le.transit_realtime.TranslatedString.verify(o.description_text);if(t)return"description_text."+t}if(o.tts_header_text!=null&&o.hasOwnProperty("tts_header_text")){var t=le.transit_realtime.TranslatedString.verify(o.tts_header_text);if(t)return"tts_header_text."+t}if(o.tts_description_text!=null&&o.hasOwnProperty("tts_description_text")){var t=le.transit_realtime.TranslatedString.verify(o.tts_description_text);if(t)return"tts_description_text."+t}if(o.severity_level!=null&&o.hasOwnProperty("severity_level"))switch(o.severity_level){default:return"severity_level: enum value expected";case 1:case 2:case 3:case 4:break}if(o.image!=null&&o.hasOwnProperty("image")){var t=le.transit_realtime.TranslatedImage.verify(o.image);if(t)return"image."+t}if(o.image_alternative_text!=null&&o.hasOwnProperty("image_alternative_text")){var t=le.transit_realtime.TranslatedString.verify(o.image_alternative_text);if(t)return"image_alternative_text."+t}if(o.cause_detail!=null&&o.hasOwnProperty("cause_detail")){var t=le.transit_realtime.TranslatedString.verify(o.cause_detail);if(t)return"cause_detail."+t}if(o.effect_detail!=null&&o.hasOwnProperty("effect_detail")){var t=le.transit_realtime.TranslatedString.verify(o.effect_detail);if(t)return"effect_detail."+t}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.Alert)return o;var c=new le.transit_realtime.Alert;if(o.active_period){if(!Array.isArray(o.active_period))throw TypeError(".transit_realtime.Alert.active_period: array expected");c.active_period=[];for(var t=0;t<o.active_period.length;++t){if(typeof o.active_period[t]!="object")throw TypeError(".transit_realtime.Alert.active_period: object expected");c.active_period[t]=le.transit_realtime.TimeRange.fromObject(o.active_period[t])}}if(o.informed_entity){if(!Array.isArray(o.informed_entity))throw TypeError(".transit_realtime.Alert.informed_entity: array expected");c.informed_entity=[];for(var t=0;t<o.informed_entity.length;++t){if(typeof o.informed_entity[t]!="object")throw TypeError(".transit_realtime.Alert.informed_entity: object expected");c.informed_entity[t]=le.transit_realtime.EntitySelector.fromObject(o.informed_entity[t])}}switch(o.cause){default:if(typeof o.cause=="number"){c.cause=o.cause;break}break;case"UNKNOWN_CAUSE":case 1:c.cause=1;break;case"OTHER_CAUSE":case 2:c.cause=2;break;case"TECHNICAL_PROBLEM":case 3:c.cause=3;break;case"STRIKE":case 4:c.cause=4;break;case"DEMONSTRATION":case 5:c.cause=5;break;case"ACCIDENT":case 6:c.cause=6;break;case"HOLIDAY":case 7:c.cause=7;break;case"WEATHER":case 8:c.cause=8;break;case"MAINTENANCE":case 9:c.cause=9;break;case"CONSTRUCTION":case 10:c.cause=10;break;case"POLICE_ACTIVITY":case 11:c.cause=11;break;case"MEDICAL_EMERGENCY":case 12:c.cause=12;break}switch(o.effect){case"NO_SERVICE":case 1:c.effect=1;break;case"REDUCED_SERVICE":case 2:c.effect=2;break;case"SIGNIFICANT_DELAYS":case 3:c.effect=3;break;case"DETOUR":case 4:c.effect=4;break;case"ADDITIONAL_SERVICE":case 5:c.effect=5;break;case"MODIFIED_SERVICE":case 6:c.effect=6;break;case"OTHER_EFFECT":case 7:c.effect=7;break;default:if(typeof o.effect=="number"){c.effect=o.effect;break}break;case"UNKNOWN_EFFECT":case 8:c.effect=8;break;case"STOP_MOVED":case 9:c.effect=9;break;case"NO_EFFECT":case 10:c.effect=10;break;case"ACCESSIBILITY_ISSUE":case 11:c.effect=11;break}if(o.url!=null){if(typeof o.url!="object")throw TypeError(".transit_realtime.Alert.url: object expected");c.url=le.transit_realtime.TranslatedString.fromObject(o.url)}if(o.header_text!=null){if(typeof o.header_text!="object")throw TypeError(".transit_realtime.Alert.header_text: object expected");c.header_text=le.transit_realtime.TranslatedString.fromObject(o.header_text)}if(o.description_text!=null){if(typeof o.description_text!="object")throw TypeError(".transit_realtime.Alert.description_text: object expected");c.description_text=le.transit_realtime.TranslatedString.fromObject(o.description_text)}if(o.tts_header_text!=null){if(typeof o.tts_header_text!="object")throw TypeError(".transit_realtime.Alert.tts_header_text: object expected");c.tts_header_text=le.transit_realtime.TranslatedString.fromObject(o.tts_header_text)}if(o.tts_description_text!=null){if(typeof o.tts_description_text!="object")throw TypeError(".transit_realtime.Alert.tts_description_text: object expected");c.tts_description_text=le.transit_realtime.TranslatedString.fromObject(o.tts_description_text)}switch(o.severity_level){default:if(typeof o.severity_level=="number"){c.severity_level=o.severity_level;break}break;case"UNKNOWN_SEVERITY":case 1:c.severity_level=1;break;case"INFO":case 2:c.severity_level=2;break;case"WARNING":case 3:c.severity_level=3;break;case"SEVERE":case 4:c.severity_level=4;break}if(o.image!=null){if(typeof o.image!="object")throw TypeError(".transit_realtime.Alert.image: object expected");c.image=le.transit_realtime.TranslatedImage.fromObject(o.image)}if(o.image_alternative_text!=null){if(typeof o.image_alternative_text!="object")throw TypeError(".transit_realtime.Alert.image_alternative_text: object expected");c.image_alternative_text=le.transit_realtime.TranslatedString.fromObject(o.image_alternative_text)}if(o.cause_detail!=null){if(typeof o.cause_detail!="object")throw TypeError(".transit_realtime.Alert.cause_detail: object expected");c.cause_detail=le.transit_realtime.TranslatedString.fromObject(o.cause_detail)}if(o.effect_detail!=null){if(typeof o.effect_detail!="object")throw TypeError(".transit_realtime.Alert.effect_detail: object expected");c.effect_detail=le.transit_realtime.TranslatedString.fromObject(o.effect_detail)}return c},i.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.active_period=[],t.informed_entity=[]),c.defaults&&(t.cause=c.enums===String?"UNKNOWN_CAUSE":1,t.effect=c.enums===String?"UNKNOWN_EFFECT":8,t.url=null,t.header_text=null,t.description_text=null,t.tts_header_text=null,t.tts_description_text=null,t.severity_level=c.enums===String?"UNKNOWN_SEVERITY":1,t.image=null,t.image_alternative_text=null,t.cause_detail=null,t.effect_detail=null),o.active_period&&o.active_period.length){t.active_period=[];for(var v=0;v<o.active_period.length;++v)t.active_period[v]=le.transit_realtime.TimeRange.toObject(o.active_period[v],c)}if(o.informed_entity&&o.informed_entity.length){t.informed_entity=[];for(var v=0;v<o.informed_entity.length;++v)t.informed_entity[v]=le.transit_realtime.EntitySelector.toObject(o.informed_entity[v],c)}return o.cause!=null&&o.hasOwnProperty("cause")&&(t.cause=c.enums===String?le.transit_realtime.Alert.Cause[o.cause]===void 0?o.cause:le.transit_realtime.Alert.Cause[o.cause]:o.cause),o.effect!=null&&o.hasOwnProperty("effect")&&(t.effect=c.enums===String?le.transit_realtime.Alert.Effect[o.effect]===void 0?o.effect:le.transit_realtime.Alert.Effect[o.effect]:o.effect),o.url!=null&&o.hasOwnProperty("url")&&(t.url=le.transit_realtime.TranslatedString.toObject(o.url,c)),o.header_text!=null&&o.hasOwnProperty("header_text")&&(t.header_text=le.transit_realtime.TranslatedString.toObject(o.header_text,c)),o.description_text!=null&&o.hasOwnProperty("description_text")&&(t.description_text=le.transit_realtime.TranslatedString.toObject(o.description_text,c)),o.tts_header_text!=null&&o.hasOwnProperty("tts_header_text")&&(t.tts_header_text=le.transit_realtime.TranslatedString.toObject(o.tts_header_text,c)),o.tts_description_text!=null&&o.hasOwnProperty("tts_description_text")&&(t.tts_description_text=le.transit_realtime.TranslatedString.toObject(o.tts_description_text,c)),o.severity_level!=null&&o.hasOwnProperty("severity_level")&&(t.severity_level=c.enums===String?le.transit_realtime.Alert.SeverityLevel[o.severity_level]===void 0?o.severity_level:le.transit_realtime.Alert.SeverityLevel[o.severity_level]:o.severity_level),o.image!=null&&o.hasOwnProperty("image")&&(t.image=le.transit_realtime.TranslatedImage.toObject(o.image,c)),o.image_alternative_text!=null&&o.hasOwnProperty("image_alternative_text")&&(t.image_alternative_text=le.transit_realtime.TranslatedString.toObject(o.image_alternative_text,c)),o.cause_detail!=null&&o.hasOwnProperty("cause_detail")&&(t.cause_detail=le.transit_realtime.TranslatedString.toObject(o.cause_detail,c)),o.effect_detail!=null&&o.hasOwnProperty("effect_detail")&&(t.effect_detail=le.transit_realtime.TranslatedString.toObject(o.effect_detail,c)),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.Alert"},i.Cause=function(){var l={},o=Object.create(l);return o[l[1]="UNKNOWN_CAUSE"]=1,o[l[2]="OTHER_CAUSE"]=2,o[l[3]="TECHNICAL_PROBLEM"]=3,o[l[4]="STRIKE"]=4,o[l[5]="DEMONSTRATION"]=5,o[l[6]="ACCIDENT"]=6,o[l[7]="HOLIDAY"]=7,o[l[8]="WEATHER"]=8,o[l[9]="MAINTENANCE"]=9,o[l[10]="CONSTRUCTION"]=10,o[l[11]="POLICE_ACTIVITY"]=11,o[l[12]="MEDICAL_EMERGENCY"]=12,o}(),i.Effect=function(){var l={},o=Object.create(l);return o[l[1]="NO_SERVICE"]=1,o[l[2]="REDUCED_SERVICE"]=2,o[l[3]="SIGNIFICANT_DELAYS"]=3,o[l[4]="DETOUR"]=4,o[l[5]="ADDITIONAL_SERVICE"]=5,o[l[6]="MODIFIED_SERVICE"]=6,o[l[7]="OTHER_EFFECT"]=7,o[l[8]="UNKNOWN_EFFECT"]=8,o[l[9]="STOP_MOVED"]=9,o[l[10]="NO_EFFECT"]=10,o[l[11]="ACCESSIBILITY_ISSUE"]=11,o}(),i.SeverityLevel=function(){var l={},o=Object.create(l);return o[l[1]="UNKNOWN_SEVERITY"]=1,o[l[2]="INFO"]=2,o[l[3]="WARNING"]=3,o[l[4]="SEVERE"]=4,o}(),i}(),a.TimeRange=function(){function i(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.start=Ze.Long?Ze.Long.fromBits(0,0,!0):0,i.prototype.end=Ze.Long?Ze.Long.fromBits(0,0,!0):0,i.create=function(o){return new i(o)},i.encode=function(o,c){return c||(c=vi.create()),o.start!=null&&Object.hasOwnProperty.call(o,"start")&&c.uint32(8).uint64(o.start),o.end!=null&&Object.hasOwnProperty.call(o,"end")&&c.uint32(16).uint64(o.end),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.TimeRange;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.start=o.uint64();break}case 2:{v.end=o.uint64();break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){return typeof o!="object"||o===null?"object expected":o.start!=null&&o.hasOwnProperty("start")&&!Ze.isInteger(o.start)&&!(o.start&&Ze.isInteger(o.start.low)&&Ze.isInteger(o.start.high))?"start: integer|Long expected":o.end!=null&&o.hasOwnProperty("end")&&!Ze.isInteger(o.end)&&!(o.end&&Ze.isInteger(o.end.low)&&Ze.isInteger(o.end.high))?"end: integer|Long expected":null},i.fromObject=function(o){if(o instanceof le.transit_realtime.TimeRange)return o;var c=new le.transit_realtime.TimeRange;return o.start!=null&&(Ze.Long?(c.start=Ze.Long.fromValue(o.start)).unsigned=!0:typeof o.start=="string"?c.start=parseInt(o.start,10):typeof o.start=="number"?c.start=o.start:typeof o.start=="object"&&(c.start=new Ze.LongBits(o.start.low>>>0,o.start.high>>>0).toNumber(!0))),o.end!=null&&(Ze.Long?(c.end=Ze.Long.fromValue(o.end)).unsigned=!0:typeof o.end=="string"?c.end=parseInt(o.end,10):typeof o.end=="number"?c.end=o.end:typeof o.end=="object"&&(c.end=new Ze.LongBits(o.end.low>>>0,o.end.high>>>0).toNumber(!0))),c},i.toObject=function(o,c){c||(c={});var t={};if(c.defaults){if(Ze.Long){var v=new Ze.Long(0,0,!0);t.start=c.longs===String?v.toString():c.longs===Number?v.toNumber():v}else t.start=c.longs===String?"0":0;if(Ze.Long){var v=new Ze.Long(0,0,!0);t.end=c.longs===String?v.toString():c.longs===Number?v.toNumber():v}else t.end=c.longs===String?"0":0}return o.start!=null&&o.hasOwnProperty("start")&&(typeof o.start=="number"?t.start=c.longs===String?String(o.start):o.start:t.start=c.longs===String?Ze.Long.prototype.toString.call(o.start):c.longs===Number?new Ze.LongBits(o.start.low>>>0,o.start.high>>>0).toNumber(!0):o.start),o.end!=null&&o.hasOwnProperty("end")&&(typeof o.end=="number"?t.end=c.longs===String?String(o.end):o.end:t.end=c.longs===String?Ze.Long.prototype.toString.call(o.end):c.longs===Number?new Ze.LongBits(o.end.low>>>0,o.end.high>>>0).toNumber(!0):o.end),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TimeRange"},i}(),a.Position=function(){function i(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.latitude=0,i.prototype.longitude=0,i.prototype.bearing=0,i.prototype.odometer=0,i.prototype.speed=0,i.create=function(o){return new i(o)},i.encode=function(o,c){return c||(c=vi.create()),c.uint32(13).float(o.latitude),c.uint32(21).float(o.longitude),o.bearing!=null&&Object.hasOwnProperty.call(o,"bearing")&&c.uint32(29).float(o.bearing),o.odometer!=null&&Object.hasOwnProperty.call(o,"odometer")&&c.uint32(33).double(o.odometer),o.speed!=null&&Object.hasOwnProperty.call(o,"speed")&&c.uint32(45).float(o.speed),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.Position;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.latitude=o.float();break}case 2:{v.longitude=o.float();break}case 3:{v.bearing=o.float();break}case 4:{v.odometer=o.double();break}case 5:{v.speed=o.float();break}default:o.skipType(S&7);break}}if(!v.hasOwnProperty("latitude"))throw Ze.ProtocolError("missing required 'latitude'",{instance:v});if(!v.hasOwnProperty("longitude"))throw Ze.ProtocolError("missing required 'longitude'",{instance:v});return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){return typeof o!="object"||o===null?"object expected":typeof o.latitude!="number"?"latitude: number expected":typeof o.longitude!="number"?"longitude: number expected":o.bearing!=null&&o.hasOwnProperty("bearing")&&typeof o.bearing!="number"?"bearing: number expected":o.odometer!=null&&o.hasOwnProperty("odometer")&&typeof o.odometer!="number"?"odometer: number expected":o.speed!=null&&o.hasOwnProperty("speed")&&typeof o.speed!="number"?"speed: number expected":null},i.fromObject=function(o){if(o instanceof le.transit_realtime.Position)return o;var c=new le.transit_realtime.Position;return o.latitude!=null&&(c.latitude=Number(o.latitude)),o.longitude!=null&&(c.longitude=Number(o.longitude)),o.bearing!=null&&(c.bearing=Number(o.bearing)),o.odometer!=null&&(c.odometer=Number(o.odometer)),o.speed!=null&&(c.speed=Number(o.speed)),c},i.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.latitude=0,t.longitude=0,t.bearing=0,t.odometer=0,t.speed=0),o.latitude!=null&&o.hasOwnProperty("latitude")&&(t.latitude=c.json&&!isFinite(o.latitude)?String(o.latitude):o.latitude),o.longitude!=null&&o.hasOwnProperty("longitude")&&(t.longitude=c.json&&!isFinite(o.longitude)?String(o.longitude):o.longitude),o.bearing!=null&&o.hasOwnProperty("bearing")&&(t.bearing=c.json&&!isFinite(o.bearing)?String(o.bearing):o.bearing),o.odometer!=null&&o.hasOwnProperty("odometer")&&(t.odometer=c.json&&!isFinite(o.odometer)?String(o.odometer):o.odometer),o.speed!=null&&o.hasOwnProperty("speed")&&(t.speed=c.json&&!isFinite(o.speed)?String(o.speed):o.speed),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.Position"},i}(),a.TripDescriptor=function(){function i(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.trip_id="",i.prototype.route_id="",i.prototype.direction_id=0,i.prototype.start_time="",i.prototype.start_date="",i.prototype.schedule_relationship=0,i.create=function(o){return new i(o)},i.encode=function(o,c){return c||(c=vi.create()),o.trip_id!=null&&Object.hasOwnProperty.call(o,"trip_id")&&c.uint32(10).string(o.trip_id),o.start_time!=null&&Object.hasOwnProperty.call(o,"start_time")&&c.uint32(18).string(o.start_time),o.start_date!=null&&Object.hasOwnProperty.call(o,"start_date")&&c.uint32(26).string(o.start_date),o.schedule_relationship!=null&&Object.hasOwnProperty.call(o,"schedule_relationship")&&c.uint32(32).int32(o.schedule_relationship),o.route_id!=null&&Object.hasOwnProperty.call(o,"route_id")&&c.uint32(42).string(o.route_id),o.direction_id!=null&&Object.hasOwnProperty.call(o,"direction_id")&&c.uint32(48).uint32(o.direction_id),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.TripDescriptor;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.trip_id=o.string();break}case 5:{v.route_id=o.string();break}case 6:{v.direction_id=o.uint32();break}case 2:{v.start_time=o.string();break}case 3:{v.start_date=o.string();break}case 4:{v.schedule_relationship=o.int32();break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.trip_id!=null&&o.hasOwnProperty("trip_id")&&!Ze.isString(o.trip_id))return"trip_id: string expected";if(o.route_id!=null&&o.hasOwnProperty("route_id")&&!Ze.isString(o.route_id))return"route_id: string expected";if(o.direction_id!=null&&o.hasOwnProperty("direction_id")&&!Ze.isInteger(o.direction_id))return"direction_id: integer expected";if(o.start_time!=null&&o.hasOwnProperty("start_time")&&!Ze.isString(o.start_time))return"start_time: string expected";if(o.start_date!=null&&o.hasOwnProperty("start_date")&&!Ze.isString(o.start_date))return"start_date: string expected";if(o.schedule_relationship!=null&&o.hasOwnProperty("schedule_relationship"))switch(o.schedule_relationship){default:return"schedule_relationship: enum value expected";case 0:case 1:case 2:case 3:case 5:case 6:case 7:break}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.TripDescriptor)return o;var c=new le.transit_realtime.TripDescriptor;switch(o.trip_id!=null&&(c.trip_id=String(o.trip_id)),o.route_id!=null&&(c.route_id=String(o.route_id)),o.direction_id!=null&&(c.direction_id=o.direction_id>>>0),o.start_time!=null&&(c.start_time=String(o.start_time)),o.start_date!=null&&(c.start_date=String(o.start_date)),o.schedule_relationship){default:if(typeof o.schedule_relationship=="number"){c.schedule_relationship=o.schedule_relationship;break}break;case"SCHEDULED":case 0:c.schedule_relationship=0;break;case"ADDED":case 1:c.schedule_relationship=1;break;case"UNSCHEDULED":case 2:c.schedule_relationship=2;break;case"CANCELED":case 3:c.schedule_relationship=3;break;case"REPLACEMENT":case 5:c.schedule_relationship=5;break;case"DUPLICATED":case 6:c.schedule_relationship=6;break;case"DELETED":case 7:c.schedule_relationship=7;break}return c},i.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.trip_id="",t.start_time="",t.start_date="",t.schedule_relationship=c.enums===String?"SCHEDULED":0,t.route_id="",t.direction_id=0),o.trip_id!=null&&o.hasOwnProperty("trip_id")&&(t.trip_id=o.trip_id),o.start_time!=null&&o.hasOwnProperty("start_time")&&(t.start_time=o.start_time),o.start_date!=null&&o.hasOwnProperty("start_date")&&(t.start_date=o.start_date),o.schedule_relationship!=null&&o.hasOwnProperty("schedule_relationship")&&(t.schedule_relationship=c.enums===String?le.transit_realtime.TripDescriptor.ScheduleRelationship[o.schedule_relationship]===void 0?o.schedule_relationship:le.transit_realtime.TripDescriptor.ScheduleRelationship[o.schedule_relationship]:o.schedule_relationship),o.route_id!=null&&o.hasOwnProperty("route_id")&&(t.route_id=o.route_id),o.direction_id!=null&&o.hasOwnProperty("direction_id")&&(t.direction_id=o.direction_id),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TripDescriptor"},i.ScheduleRelationship=function(){var l={},o=Object.create(l);return o[l[0]="SCHEDULED"]=0,o[l[1]="ADDED"]=1,o[l[2]="UNSCHEDULED"]=2,o[l[3]="CANCELED"]=3,o[l[5]="REPLACEMENT"]=5,o[l[6]="DUPLICATED"]=6,o[l[7]="DELETED"]=7,o}(),i}(),a.VehicleDescriptor=function(){function i(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.id="",i.prototype.label="",i.prototype.license_plate="",i.prototype.wheelchair_accessible=0,i.create=function(o){return new i(o)},i.encode=function(o,c){return c||(c=vi.create()),o.id!=null&&Object.hasOwnProperty.call(o,"id")&&c.uint32(10).string(o.id),o.label!=null&&Object.hasOwnProperty.call(o,"label")&&c.uint32(18).string(o.label),o.license_plate!=null&&Object.hasOwnProperty.call(o,"license_plate")&&c.uint32(26).string(o.license_plate),o.wheelchair_accessible!=null&&Object.hasOwnProperty.call(o,"wheelchair_accessible")&&c.uint32(32).int32(o.wheelchair_accessible),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.VehicleDescriptor;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.id=o.string();break}case 2:{v.label=o.string();break}case 3:{v.license_plate=o.string();break}case 4:{v.wheelchair_accessible=o.int32();break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.id!=null&&o.hasOwnProperty("id")&&!Ze.isString(o.id))return"id: string expected";if(o.label!=null&&o.hasOwnProperty("label")&&!Ze.isString(o.label))return"label: string expected";if(o.license_plate!=null&&o.hasOwnProperty("license_plate")&&!Ze.isString(o.license_plate))return"license_plate: string expected";if(o.wheelchair_accessible!=null&&o.hasOwnProperty("wheelchair_accessible"))switch(o.wheelchair_accessible){default:return"wheelchair_accessible: enum value expected";case 0:case 1:case 2:case 3:break}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.VehicleDescriptor)return o;var c=new le.transit_realtime.VehicleDescriptor;switch(o.id!=null&&(c.id=String(o.id)),o.label!=null&&(c.label=String(o.label)),o.license_plate!=null&&(c.license_plate=String(o.license_plate)),o.wheelchair_accessible){default:if(typeof o.wheelchair_accessible=="number"){c.wheelchair_accessible=o.wheelchair_accessible;break}break;case"NO_VALUE":case 0:c.wheelchair_accessible=0;break;case"UNKNOWN":case 1:c.wheelchair_accessible=1;break;case"WHEELCHAIR_ACCESSIBLE":case 2:c.wheelchair_accessible=2;break;case"WHEELCHAIR_INACCESSIBLE":case 3:c.wheelchair_accessible=3;break}return c},i.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.id="",t.label="",t.license_plate="",t.wheelchair_accessible=c.enums===String?"NO_VALUE":0),o.id!=null&&o.hasOwnProperty("id")&&(t.id=o.id),o.label!=null&&o.hasOwnProperty("label")&&(t.label=o.label),o.license_plate!=null&&o.hasOwnProperty("license_plate")&&(t.license_plate=o.license_plate),o.wheelchair_accessible!=null&&o.hasOwnProperty("wheelchair_accessible")&&(t.wheelchair_accessible=c.enums===String?le.transit_realtime.VehicleDescriptor.WheelchairAccessible[o.wheelchair_accessible]===void 0?o.wheelchair_accessible:le.transit_realtime.VehicleDescriptor.WheelchairAccessible[o.wheelchair_accessible]:o.wheelchair_accessible),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.VehicleDescriptor"},i.WheelchairAccessible=function(){var l={},o=Object.create(l);return o[l[0]="NO_VALUE"]=0,o[l[1]="UNKNOWN"]=1,o[l[2]="WHEELCHAIR_ACCESSIBLE"]=2,o[l[3]="WHEELCHAIR_INACCESSIBLE"]=3,o}(),i}(),a.EntitySelector=function(){function i(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.agency_id="",i.prototype.route_id="",i.prototype.route_type=0,i.prototype.trip=null,i.prototype.stop_id="",i.prototype.direction_id=0,i.create=function(o){return new i(o)},i.encode=function(o,c){return c||(c=vi.create()),o.agency_id!=null&&Object.hasOwnProperty.call(o,"agency_id")&&c.uint32(10).string(o.agency_id),o.route_id!=null&&Object.hasOwnProperty.call(o,"route_id")&&c.uint32(18).string(o.route_id),o.route_type!=null&&Object.hasOwnProperty.call(o,"route_type")&&c.uint32(24).int32(o.route_type),o.trip!=null&&Object.hasOwnProperty.call(o,"trip")&&le.transit_realtime.TripDescriptor.encode(o.trip,c.uint32(34).fork()).ldelim(),o.stop_id!=null&&Object.hasOwnProperty.call(o,"stop_id")&&c.uint32(42).string(o.stop_id),o.direction_id!=null&&Object.hasOwnProperty.call(o,"direction_id")&&c.uint32(48).uint32(o.direction_id),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.EntitySelector;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.agency_id=o.string();break}case 2:{v.route_id=o.string();break}case 3:{v.route_type=o.int32();break}case 4:{v.trip=le.transit_realtime.TripDescriptor.decode(o,o.uint32());break}case 5:{v.stop_id=o.string();break}case 6:{v.direction_id=o.uint32();break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.agency_id!=null&&o.hasOwnProperty("agency_id")&&!Ze.isString(o.agency_id))return"agency_id: string expected";if(o.route_id!=null&&o.hasOwnProperty("route_id")&&!Ze.isString(o.route_id))return"route_id: string expected";if(o.route_type!=null&&o.hasOwnProperty("route_type")&&!Ze.isInteger(o.route_type))return"route_type: integer expected";if(o.trip!=null&&o.hasOwnProperty("trip")){var c=le.transit_realtime.TripDescriptor.verify(o.trip);if(c)return"trip."+c}return o.stop_id!=null&&o.hasOwnProperty("stop_id")&&!Ze.isString(o.stop_id)?"stop_id: string expected":o.direction_id!=null&&o.hasOwnProperty("direction_id")&&!Ze.isInteger(o.direction_id)?"direction_id: integer expected":null},i.fromObject=function(o){if(o instanceof le.transit_realtime.EntitySelector)return o;var c=new le.transit_realtime.EntitySelector;if(o.agency_id!=null&&(c.agency_id=String(o.agency_id)),o.route_id!=null&&(c.route_id=String(o.route_id)),o.route_type!=null&&(c.route_type=o.route_type|0),o.trip!=null){if(typeof o.trip!="object")throw TypeError(".transit_realtime.EntitySelector.trip: object expected");c.trip=le.transit_realtime.TripDescriptor.fromObject(o.trip)}return o.stop_id!=null&&(c.stop_id=String(o.stop_id)),o.direction_id!=null&&(c.direction_id=o.direction_id>>>0),c},i.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.agency_id="",t.route_id="",t.route_type=0,t.trip=null,t.stop_id="",t.direction_id=0),o.agency_id!=null&&o.hasOwnProperty("agency_id")&&(t.agency_id=o.agency_id),o.route_id!=null&&o.hasOwnProperty("route_id")&&(t.route_id=o.route_id),o.route_type!=null&&o.hasOwnProperty("route_type")&&(t.route_type=o.route_type),o.trip!=null&&o.hasOwnProperty("trip")&&(t.trip=le.transit_realtime.TripDescriptor.toObject(o.trip,c)),o.stop_id!=null&&o.hasOwnProperty("stop_id")&&(t.stop_id=o.stop_id),o.direction_id!=null&&o.hasOwnProperty("direction_id")&&(t.direction_id=o.direction_id),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.EntitySelector"},i}(),a.TranslatedString=function(){function i(l){if(this.translation=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.translation=Ze.emptyArray,i.create=function(o){return new i(o)},i.encode=function(o,c){if(c||(c=vi.create()),o.translation!=null&&o.translation.length)for(var t=0;t<o.translation.length;++t)le.transit_realtime.TranslatedString.Translation.encode(o.translation[t],c.uint32(10).fork()).ldelim();return c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.TranslatedString;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.translation&&v.translation.length||(v.translation=[]),v.translation.push(le.transit_realtime.TranslatedString.Translation.decode(o,o.uint32()));break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.translation!=null&&o.hasOwnProperty("translation")){if(!Array.isArray(o.translation))return"translation: array expected";for(var c=0;c<o.translation.length;++c){var t=le.transit_realtime.TranslatedString.Translation.verify(o.translation[c]);if(t)return"translation."+t}}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.TranslatedString)return o;var c=new le.transit_realtime.TranslatedString;if(o.translation){if(!Array.isArray(o.translation))throw TypeError(".transit_realtime.TranslatedString.translation: array expected");c.translation=[];for(var t=0;t<o.translation.length;++t){if(typeof o.translation[t]!="object")throw TypeError(".transit_realtime.TranslatedString.translation: object expected");c.translation[t]=le.transit_realtime.TranslatedString.Translation.fromObject(o.translation[t])}}return c},i.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.translation=[]),o.translation&&o.translation.length){t.translation=[];for(var v=0;v<o.translation.length;++v)t.translation[v]=le.transit_realtime.TranslatedString.Translation.toObject(o.translation[v],c)}return t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TranslatedString"},i.Translation=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.text="",l.prototype.language="",l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=vi.create()),t.uint32(10).string(c.text),c.language!=null&&Object.hasOwnProperty.call(c,"language")&&t.uint32(18).string(c.language),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof _t||(c=_t.create(c));for(var v=t===void 0?c.len:c.pos+t,S=new le.transit_realtime.TranslatedString.Translation;c.pos<v;){var C=c.uint32();switch(C>>>3){case 1:{S.text=c.string();break}case 2:{S.language=c.string();break}default:c.skipType(C&7);break}}if(!S.hasOwnProperty("text"))throw Ze.ProtocolError("missing required 'text'",{instance:S});return S},l.decodeDelimited=function(c){return c instanceof _t||(c=new _t(c)),this.decode(c,c.uint32())},l.verify=function(c){return typeof c!="object"||c===null?"object expected":Ze.isString(c.text)?c.language!=null&&c.hasOwnProperty("language")&&!Ze.isString(c.language)?"language: string expected":null:"text: string expected"},l.fromObject=function(c){if(c instanceof le.transit_realtime.TranslatedString.Translation)return c;var t=new le.transit_realtime.TranslatedString.Translation;return c.text!=null&&(t.text=String(c.text)),c.language!=null&&(t.language=String(c.language)),t},l.toObject=function(c,t){t||(t={});var v={};return t.defaults&&(v.text="",v.language=""),c.text!=null&&c.hasOwnProperty("text")&&(v.text=c.text),c.language!=null&&c.hasOwnProperty("language")&&(v.language=c.language),v},l.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TranslatedString.Translation"},l}(),i}(),a.TranslatedImage=function(){function i(l){if(this.localized_image=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.localized_image=Ze.emptyArray,i.create=function(o){return new i(o)},i.encode=function(o,c){if(c||(c=vi.create()),o.localized_image!=null&&o.localized_image.length)for(var t=0;t<o.localized_image.length;++t)le.transit_realtime.TranslatedImage.LocalizedImage.encode(o.localized_image[t],c.uint32(10).fork()).ldelim();return c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.TranslatedImage;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.localized_image&&v.localized_image.length||(v.localized_image=[]),v.localized_image.push(le.transit_realtime.TranslatedImage.LocalizedImage.decode(o,o.uint32()));break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.localized_image!=null&&o.hasOwnProperty("localized_image")){if(!Array.isArray(o.localized_image))return"localized_image: array expected";for(var c=0;c<o.localized_image.length;++c){var t=le.transit_realtime.TranslatedImage.LocalizedImage.verify(o.localized_image[c]);if(t)return"localized_image."+t}}return null},i.fromObject=function(o){if(o instanceof le.transit_realtime.TranslatedImage)return o;var c=new le.transit_realtime.TranslatedImage;if(o.localized_image){if(!Array.isArray(o.localized_image))throw TypeError(".transit_realtime.TranslatedImage.localized_image: array expected");c.localized_image=[];for(var t=0;t<o.localized_image.length;++t){if(typeof o.localized_image[t]!="object")throw TypeError(".transit_realtime.TranslatedImage.localized_image: object expected");c.localized_image[t]=le.transit_realtime.TranslatedImage.LocalizedImage.fromObject(o.localized_image[t])}}return c},i.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.localized_image=[]),o.localized_image&&o.localized_image.length){t.localized_image=[];for(var v=0;v<o.localized_image.length;++v)t.localized_image[v]=le.transit_realtime.TranslatedImage.LocalizedImage.toObject(o.localized_image[v],c)}return t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TranslatedImage"},i.LocalizedImage=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.url="",l.prototype.media_type="",l.prototype.language="",l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=vi.create()),t.uint32(10).string(c.url),t.uint32(18).string(c.media_type),c.language!=null&&Object.hasOwnProperty.call(c,"language")&&t.uint32(26).string(c.language),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof _t||(c=_t.create(c));for(var v=t===void 0?c.len:c.pos+t,S=new le.transit_realtime.TranslatedImage.LocalizedImage;c.pos<v;){var C=c.uint32();switch(C>>>3){case 1:{S.url=c.string();break}case 2:{S.media_type=c.string();break}case 3:{S.language=c.string();break}default:c.skipType(C&7);break}}if(!S.hasOwnProperty("url"))throw Ze.ProtocolError("missing required 'url'",{instance:S});if(!S.hasOwnProperty("media_type"))throw Ze.ProtocolError("missing required 'media_type'",{instance:S});return S},l.decodeDelimited=function(c){return c instanceof _t||(c=new _t(c)),this.decode(c,c.uint32())},l.verify=function(c){return typeof c!="object"||c===null?"object expected":Ze.isString(c.url)?Ze.isString(c.media_type)?c.language!=null&&c.hasOwnProperty("language")&&!Ze.isString(c.language)?"language: string expected":null:"media_type: string expected":"url: string expected"},l.fromObject=function(c){if(c instanceof le.transit_realtime.TranslatedImage.LocalizedImage)return c;var t=new le.transit_realtime.TranslatedImage.LocalizedImage;return c.url!=null&&(t.url=String(c.url)),c.media_type!=null&&(t.media_type=String(c.media_type)),c.language!=null&&(t.language=String(c.language)),t},l.toObject=function(c,t){t||(t={});var v={};return t.defaults&&(v.url="",v.media_type="",v.language=""),c.url!=null&&c.hasOwnProperty("url")&&(v.url=c.url),c.media_type!=null&&c.hasOwnProperty("media_type")&&(v.media_type=c.media_type),c.language!=null&&c.hasOwnProperty("language")&&(v.language=c.language),v},l.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TranslatedImage.LocalizedImage"},l}(),i}(),a.Shape=function(){function i(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return i.prototype.shape_id="",i.prototype.encoded_polyline="",i.create=function(o){return new i(o)},i.encode=function(o,c){return c||(c=vi.create()),o.shape_id!=null&&Object.hasOwnProperty.call(o,"shape_id")&&c.uint32(10).string(o.shape_id),o.encoded_polyline!=null&&Object.hasOwnProperty.call(o,"encoded_polyline")&&c.uint32(18).string(o.encoded_polyline),c},i.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},i.decode=function(o,c){o instanceof _t||(o=_t.create(o));for(var t=c===void 0?o.len:o.pos+c,v=new le.transit_realtime.Shape;o.pos<t;){var S=o.uint32();switch(S>>>3){case 1:{v.shape_id=o.string();break}case 2:{v.encoded_polyline=o.string();break}default:o.skipType(S&7);break}}return v},i.decodeDelimited=function(o){return o instanceof _t||(o=new _t(o)),this.decode(o,o.uint32())},i.verify=function(o){return typeof o!="object"||o===null?"object expected":o.shape_id!=null&&o.hasOwnProperty("shape_id")&&!Ze.isString(o.shape_id)?"shape_id: string expected":o.encoded_polyline!=null&&o.hasOwnProperty("encoded_polyline")&&!Ze.isString(o.encoded_polyline)?"encoded_polyline: string expected":null},i.fromObject=function(o){if(o instanceof le.transit_realtime.Shape)return o;var c=new le.transit_realtime.Shape;return o.shape_id!=null&&(c.shape_id=String(o.shape_id)),o.encoded_polyline!=null&&(c.encoded_polyline=String(o.encoded_polyline)),c},i.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.shape_id="",t.encoded_polyline=""),o.shape_id!=null&&o.hasOwnProperty("shape_id")&&(t.shape_id=o.shape_id),o.encoded_polyline!=null&&o.hasOwnProperty("encoded_polyline")&&(t.encoded_polyline=o.encoded_polyline),t},i.prototype.toJSON=function(){return this.constructor.toObject(this,Zr.util.toJSONOptions)},i.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.Shape"},i}(),a}();EH.exports=le});var LI=P((uQe,IH)=>{"use strict";var{transit_realtime:$3e}=SH();IH.exports=$3e});var DH=P((fQe,B0)=>{"use strict";var{AbortController:RH,AbortSignal:K3e}=typeof self<"u"?self:typeof window<"u"?window:void 0;B0.exports=RH;B0.exports.AbortSignal=K3e;B0.exports.default=RH});var FH=P((_Qe,zH)=>{var nze=O0(),oze=pf(),aze="[object AsyncFunction]",sze="[object Function]",lze="[object GeneratorFunction]",uze="[object Proxy]";function cze(a){if(!oze(a))return!1;var i=nze(a);return i==sze||i==lze||i==aze||i==uze}zH.exports=cze});var UH=P((yQe,NH)=>{var hze=Nm(),fze=hze["__core-js_shared__"];NH.exports=fze});var $H=P((gQe,VH)=>{var zI=UH(),jH=function(){var a=/[^.]+$/.exec(zI&&zI.keys&&zI.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}();function dze(a){return!!jH&&jH in a}VH.exports=dze});var WH=P((vQe,GH)=>{var pze=Function.prototype,mze=pze.toString;function _ze(a){if(a!=null){try{return mze.call(a)}catch{}try{return a+""}catch{}}return""}GH.exports=_ze});var HH=P((xQe,ZH)=>{var yze=FH(),gze=$H(),vze=pf(),xze=WH(),bze=/[\\^$.*+?()[\]{}|]/g,wze=/^\[object .+?Constructor\]$/,Tze=Function.prototype,Eze=Object.prototype,Sze=Tze.toString,Ize=Eze.hasOwnProperty,Aze=RegExp("^"+Sze.call(Ize).replace(bze,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Oze(a){if(!vze(a)||gze(a))return!1;var i=yze(a)?Aze:wze;return i.test(xze(a))}ZH.exports=Oze});var KH=P((bQe,XH)=>{function Cze(a,i){return a?.[i]}XH.exports=Cze});var z0=P((wQe,YH)=>{var Pze=HH(),Mze=KH();function qze(a,i){var l=Mze(a,i);return Pze(l)?l:void 0}YH.exports=qze});var Ym=P((TQe,JH)=>{var Rze=z0(),Dze=Rze(Object,"create");JH.exports=Dze});var t9=P((EQe,e9)=>{var QH=Ym();function Lze(){this.__data__=QH?QH(null):{},this.size=0}e9.exports=Lze});var i9=P((SQe,r9)=>{function kze(a){var i=this.has(a)&&delete this.__data__[a];return this.size-=i?1:0,i}r9.exports=kze});var o9=P((IQe,n9)=>{var Bze=Ym(),zze="__lodash_hash_undefined__",Fze=Object.prototype,Nze=Fze.hasOwnProperty;function Uze(a){var i=this.__data__;if(Bze){var l=i[a];return l===zze?void 0:l}return Nze.call(i,a)?i[a]:void 0}n9.exports=Uze});var s9=P((AQe,a9)=>{var jze=Ym(),Vze=Object.prototype,$ze=Vze.hasOwnProperty;function Gze(a){var i=this.__data__;return jze?i[a]!==void 0:$ze.call(i,a)}a9.exports=Gze});var u9=P((OQe,l9)=>{var Wze=Ym(),Zze="__lodash_hash_undefined__";function Hze(a,i){var l=this.__data__;return this.size+=this.has(a)?0:1,l[a]=Wze&&i===void 0?Zze:i,this}l9.exports=Hze});var h9=P((CQe,c9)=>{var Xze=t9(),Kze=i9(),Yze=o9(),Jze=s9(),Qze=u9();function wf(a){var i=-1,l=a==null?0:a.length;for(this.clear();++i<l;){var o=a[i];this.set(o[0],o[1])}}wf.prototype.clear=Xze;wf.prototype.delete=Kze;wf.prototype.get=Yze;wf.prototype.has=Jze;wf.prototype.set=Qze;c9.exports=wf});var d9=P((PQe,f9)=>{function eFe(){this.__data__=[],this.size=0}f9.exports=eFe});var FI=P((MQe,p9)=>{function tFe(a,i){return a===i||a!==a&&i!==i}p9.exports=tFe});var Jm=P((qQe,m9)=>{var rFe=FI();function iFe(a,i){for(var l=a.length;l--;)if(rFe(a[l][0],i))return l;return-1}m9.exports=iFe});var y9=P((RQe,_9)=>{var nFe=Jm(),oFe=Array.prototype,aFe=oFe.splice;function sFe(a){var i=this.__data__,l=nFe(i,a);if(l<0)return!1;var o=i.length-1;return l==o?i.pop():aFe.call(i,l,1),--this.size,!0}_9.exports=sFe});var v9=P((DQe,g9)=>{var lFe=Jm();function uFe(a){var i=this.__data__,l=lFe(i,a);return l<0?void 0:i[l][1]}g9.exports=uFe});var b9=P((LQe,x9)=>{var cFe=Jm();function hFe(a){return cFe(this.__data__,a)>-1}x9.exports=hFe});var T9=P((kQe,w9)=>{var fFe=Jm();function dFe(a,i){var l=this.__data__,o=fFe(l,a);return o<0?(++this.size,l.push([a,i])):l[o][1]=i,this}w9.exports=dFe});var S9=P((BQe,E9)=>{var pFe=d9(),mFe=y9(),_Fe=v9(),yFe=b9(),gFe=T9();function Tf(a){var i=-1,l=a==null?0:a.length;for(this.clear();++i<l;){var o=a[i];this.set(o[0],o[1])}}Tf.prototype.clear=pFe;Tf.prototype.delete=mFe;Tf.prototype.get=_Fe;Tf.prototype.has=yFe;Tf.prototype.set=gFe;E9.exports=Tf});var A9=P((zQe,I9)=>{var vFe=z0(),xFe=Nm(),bFe=vFe(xFe,"Map");I9.exports=bFe});var P9=P((FQe,C9)=>{var O9=h9(),wFe=S9(),TFe=A9();function EFe(){this.size=0,this.__data__={hash:new O9,map:new(TFe||wFe),string:new O9}}C9.exports=EFe});var q9=P((NQe,M9)=>{function SFe(a){var i=typeof a;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?a!=="__proto__":a===null}M9.exports=SFe});var Qm=P((UQe,R9)=>{var IFe=q9();function AFe(a,i){var l=a.__data__;return IFe(i)?l[typeof i=="string"?"string":"hash"]:l.map}R9.exports=AFe});var L9=P((jQe,D9)=>{var OFe=Qm();function CFe(a){var i=OFe(this,a).delete(a);return this.size-=i?1:0,i}D9.exports=CFe});var B9=P((VQe,k9)=>{var PFe=Qm();function MFe(a){return PFe(this,a).get(a)}k9.exports=MFe});var F9=P(($Qe,z9)=>{var qFe=Qm();function RFe(a){return qFe(this,a).has(a)}z9.exports=RFe});var U9=P((GQe,N9)=>{var DFe=Qm();function LFe(a,i){var l=DFe(this,a),o=l.size;return l.set(a,i),this.size+=l.size==o?0:1,this}N9.exports=LFe});var V9=P((WQe,j9)=>{var kFe=P9(),BFe=L9(),zFe=B9(),FFe=F9(),NFe=U9();function Ef(a){var i=-1,l=a==null?0:a.length;for(this.clear();++i<l;){var o=a[i];this.set(o[0],o[1])}}Ef.prototype.clear=kFe;Ef.prototype.delete=BFe;Ef.prototype.get=zFe;Ef.prototype.has=FFe;Ef.prototype.set=NFe;j9.exports=Ef});var UI=P((ZQe,G9)=>{var $9=V9(),UFe="Expected a function";function NI(a,i){if(typeof a!="function"||i!=null&&typeof i!="function")throw new TypeError(UFe);var l=function(){var o=arguments,c=i?i.apply(this,o):o[0],t=l.cache;if(t.has(c))return t.get(c);var v=a.apply(this,o);return l.cache=t.set(c,v)||t,v};return l.cache=new(NI.Cache||$9),l}NI.Cache=$9;G9.exports=NI});var Sf=P((HQe,W9)=>{var jFe=Array.isArray;W9.exports=jFe});var H9=P((XQe,Z9)=>{var VFe=Sf(),$Fe=Vm(),GFe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,WFe=/^\w*$/;function ZFe(a,i){if(VFe(a))return!1;var l=typeof a;return l=="number"||l=="symbol"||l=="boolean"||a==null||$Fe(a)?!0:WFe.test(a)||!GFe.test(a)||i!=null&&a in Object(i)}Z9.exports=ZFe});var K9=P((KQe,X9)=>{var HFe=UI(),XFe=500;function KFe(a){var i=HFe(a,function(o){return l.size===XFe&&l.clear(),o}),l=i.cache;return i}X9.exports=KFe});var J9=P((YQe,Y9)=>{var YFe=K9(),JFe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,QFe=/\\(\\)?/g,eNe=YFe(function(a){var i=[];return a.charCodeAt(0)===46&&i.push(""),a.replace(JFe,function(l,o,c,t){i.push(c?t.replace(QFe,"$1"):o||l)}),i});Y9.exports=eNe});var eX=P((JQe,Q9)=>{function tNe(a,i){for(var l=-1,o=a==null?0:a.length,c=Array(o);++l<o;)c[l]=i(a[l],l,a);return c}Q9.exports=tNe});var aX=P((QQe,oX)=>{var tX=Um(),rNe=eX(),iNe=Sf(),nNe=Vm(),oNe=1/0,rX=tX?tX.prototype:void 0,iX=rX?rX.toString:void 0;function nX(a){if(typeof a=="string")return a;if(iNe(a))return rNe(a,nX)+"";if(nNe(a))return iX?iX.call(a):"";var i=a+"";return i=="0"&&1/a==-oNe?"-0":i}oX.exports=nX});var lX=P((eet,sX)=>{var aNe=aX();function sNe(a){return a==null?"":aNe(a)}sX.exports=sNe});var e_=P((tet,uX)=>{var lNe=Sf(),uNe=H9(),cNe=J9(),hNe=lX();function fNe(a,i){return lNe(a)?a:uNe(a,i)?[a]:cNe(hNe(a))}uX.exports=fNe});var F0=P((ret,cX)=>{var dNe=Vm(),pNe=1/0;function mNe(a){if(typeof a=="string"||dNe(a))return a;var i=a+"";return i=="0"&&1/a==-pNe?"-0":i}cX.exports=mNe});var fX=P((iet,hX)=>{var _Ne=e_(),yNe=F0();function gNe(a,i){i=_Ne(i,a);for(var l=0,o=i.length;a!=null&&l<o;)a=a[yNe(i[l++])];return l&&l==o?a:void 0}hX.exports=gNe});var jI=P((net,dX)=>{var vNe=z0(),xNe=function(){try{var a=vNe(Object,"defineProperty");return a({},"",{}),a}catch{}}();dX.exports=xNe});var _X=P((oet,mX)=>{var pX=jI();function bNe(a,i,l){i=="__proto__"&&pX?pX(a,i,{configurable:!0,enumerable:!0,value:l,writable:!0}):a[i]=l}mX.exports=bNe});var gX=P((aet,yX)=>{var wNe=_X(),TNe=FI(),ENe=Object.prototype,SNe=ENe.hasOwnProperty;function INe(a,i,l){var o=a[i];(!(SNe.call(a,i)&&TNe(o,l))||l===void 0&&!(i in a))&&wNe(a,i,l)}yX.exports=INe});var VI=P((set,vX)=>{var ANe=9007199254740991,ONe=/^(?:0|[1-9]\d*)$/;function CNe(a,i){var l=typeof a;return i=i??ANe,!!i&&(l=="number"||l!="symbol"&&ONe.test(a))&&a>-1&&a%1==0&&a<i}vX.exports=CNe});var wX=P((uet,bX)=>{var PNe=gX(),MNe=e_(),qNe=VI(),xX=pf(),RNe=F0();function DNe(a,i,l,o){if(!xX(a))return a;i=MNe(i,a);for(var c=-1,t=i.length,v=t-1,S=a;S!=null&&++c<t;){var C=RNe(i[c]),D=l;if(C==="__proto__"||C==="constructor"||C==="prototype")return a;if(c!=v){var z=S[C];D=o?o(z,C,S):void 0,D===void 0&&(D=xX(z)?z:qNe(i[c+1])?[]:{})}PNe(S,C,D),S=S[C]}return a}bX.exports=DNe});var EX=P((cet,TX)=>{var LNe=fX(),kNe=wX(),BNe=e_();function zNe(a,i,l){for(var o=-1,c=i.length,t={};++o<c;){var v=i[o],S=LNe(a,v);l(S,v)&&kNe(t,BNe(v,a),S)}return t}TX.exports=zNe});var IX=P((het,SX)=>{function FNe(a,i){return a!=null&&i in Object(a)}SX.exports=FNe});var OX=P((fet,AX)=>{var NNe=O0(),UNe=C0(),jNe="[object Arguments]";function VNe(a){return UNe(a)&&NNe(a)==jNe}AX.exports=VNe});var $I=P((det,MX)=>{var CX=OX(),$Ne=C0(),PX=Object.prototype,GNe=PX.hasOwnProperty,WNe=PX.propertyIsEnumerable,ZNe=CX(function(){return arguments}())?CX:function(a){return $Ne(a)&&GNe.call(a,"callee")&&!WNe.call(a,"callee")};MX.exports=ZNe});var RX=P((pet,qX)=>{var HNe=9007199254740991;function XNe(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=HNe}qX.exports=XNe});var LX=P((met,DX)=>{var KNe=e_(),YNe=$I(),JNe=Sf(),QNe=VI(),eUe=RX(),tUe=F0();function rUe(a,i,l){i=KNe(i,a);for(var o=-1,c=i.length,t=!1;++o<c;){var v=tUe(i[o]);if(!(t=a!=null&&l(a,v)))break;a=a[v]}return t||++o!=c?t:(c=a==null?0:a.length,!!c&&eUe(c)&&QNe(v,c)&&(JNe(a)||YNe(a)))}DX.exports=rUe});var BX=P((_et,kX)=>{var iUe=IX(),nUe=LX();function oUe(a,i){return a!=null&&nUe(a,i,iUe)}kX.exports=oUe});var FX=P((yet,zX)=>{var aUe=EX(),sUe=BX();function lUe(a,i){return aUe(a,i,function(l,o){return sUe(a,o)})}zX.exports=lUe});var UX=P((get,NX)=>{function uUe(a,i){for(var l=-1,o=i.length,c=a.length;++l<o;)a[c+l]=i[l];return a}NX.exports=uUe});var GX=P((vet,$X)=>{var jX=Um(),cUe=$I(),hUe=Sf(),VX=jX?jX.isConcatSpreadable:void 0;function fUe(a){return hUe(a)||cUe(a)||!!(VX&&a&&a[VX])}$X.exports=fUe});var HX=P((xet,ZX)=>{var dUe=UX(),pUe=GX();function WX(a,i,l,o,c){var t=-1,v=a.length;for(l||(l=pUe),c||(c=[]);++t<v;){var S=a[t];i>0&&l(S)?i>1?WX(S,i-1,l,o,c):dUe(c,S):o||(c[c.length]=S)}return c}ZX.exports=WX});var KX=P((bet,XX)=>{var mUe=HX();function _Ue(a){var i=a==null?0:a.length;return i?mUe(a,1):[]}XX.exports=_Ue});var JX=P((wet,YX)=>{function yUe(a,i,l){switch(l.length){case 0:return a.call(i);case 1:return a.call(i,l[0]);case 2:return a.call(i,l[0],l[1]);case 3:return a.call(i,l[0],l[1],l[2])}return a.apply(i,l)}YX.exports=yUe});var tK=P((Tet,eK)=>{var gUe=JX(),QX=Math.max;function vUe(a,i,l){return i=QX(i===void 0?a.length-1:i,0),function(){for(var o=arguments,c=-1,t=QX(o.length-i,0),v=Array(t);++c<t;)v[c]=o[i+c];c=-1;for(var S=Array(i+1);++c<i;)S[c]=o[c];return S[i]=l(v),gUe(a,this,S)}}eK.exports=vUe});var iK=P((Eet,rK)=>{function xUe(a){return function(){return a}}rK.exports=xUe});var oK=P((Iet,nK)=>{function bUe(a){return a}nK.exports=bUe});var lK=P((Aet,sK)=>{var wUe=iK(),aK=jI(),TUe=oK(),EUe=aK?function(a,i){return aK(a,"toString",{configurable:!0,enumerable:!1,value:wUe(i),writable:!0})}:TUe;sK.exports=EUe});var cK=P((Oet,uK)=>{var SUe=800,IUe=16,AUe=Date.now;function OUe(a){var i=0,l=0;return function(){var o=AUe(),c=IUe-(o-l);if(l=o,c>0){if(++i>=SUe)return arguments[0]}else i=0;return a.apply(void 0,arguments)}}uK.exports=OUe});var fK=P((Cet,hK)=>{var CUe=lK(),PUe=cK(),MUe=PUe(CUe);hK.exports=MUe});var pK=P((Pet,dK)=>{var qUe=KX(),RUe=tK(),DUe=fK();function LUe(a){return DUe(RUe(a,void 0,qUe),a+"")}dK.exports=LUe});var _K=P((Met,mK)=>{var kUe=FX(),BUe=pK(),zUe=BUe(function(a,i){return a==null?{}:kUe(a,i)});mK.exports=zUe});var JI=P((Yet,zK)=>{var Af=1e3,Of=Af*60,Cf=Of*60,rc=Cf*24,t4e=rc*7,r4e=rc*365.25;zK.exports=function(a,i){i=i||{};var l=typeof a;if(l==="string"&&a.length>0)return i4e(a);if(l==="number"&&isFinite(a))return i.long?o4e(a):n4e(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))};function i4e(a){if(a=String(a),!(a.length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(i){var l=parseFloat(i[1]),o=(i[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return l*r4e;case"weeks":case"week":case"w":return l*t4e;case"days":case"day":case"d":return l*rc;case"hours":case"hour":case"hrs":case"hr":case"h":return l*Cf;case"minutes":case"minute":case"mins":case"min":case"m":return l*Of;case"seconds":case"second":case"secs":case"sec":case"s":return l*Af;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function n4e(a){var i=Math.abs(a);return i>=rc?Math.round(a/rc)+"d":i>=Cf?Math.round(a/Cf)+"h":i>=Of?Math.round(a/Of)+"m":i>=Af?Math.round(a/Af)+"s":a+"ms"}function o4e(a){var i=Math.abs(a);return i>=rc?U0(a,i,rc,"day"):i>=Cf?U0(a,i,Cf,"hour"):i>=Of?U0(a,i,Of,"minute"):i>=Af?U0(a,i,Af,"second"):a+" ms"}function U0(a,i,l,o){var c=i>=l*1.5;return Math.round(a/l)+" "+o+(c?"s":"")}});var GK=P((eA,tA)=>{(function(a,i){typeof eA=="object"&&typeof tA<"u"?tA.exports=i():typeof define=="function"&&define.amd?define(i):(a=typeof globalThis<"u"?globalThis:a||self,a.mapboxgl=i())})(eA,function(){"use strict";var a,i,l;function o(t,v){if(!a)a=v;else if(!i)i=v;else{var S="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",C={};a(C),l=v(C),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([S],{type:"text/javascript"})))}}o(["exports"],function(t){"use strict";var v=typeof self<"u"?self:{},S="2.15.0";let C,D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):r}catch{C=r}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!D.API_URL)return null;try{let r=new URL(D.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},z={supported:!1,testSupport:function(r){!pe&&ne&&($e?Ae(r):B=r)}},B,ne,pe=!1,$e=!1;function Ae(r){let e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,ne),r.isContextLost())return;z.supported=!0}catch{}r.deleteTexture(e),pe=!0}v.document&&(ne=v.document.createElement("img"),ne.onload=function(){B&&Ae(B),B=null,$e=!0},ne.onerror=function(){pe=!0,B=null},ne.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let ke="01";function Ge(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var tt=mt;function mt(r,e,n,u){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(u-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=u}mt.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,u=0;u<8;u++){var f=this.sampleCurveX(n)-r;if(Math.abs(f)<e)return n;var p=this.sampleCurveDerivativeX(n);if(Math.abs(p)<1e-6)break;n-=f/p}var _=0,g=1;for(n=r,u=0;u<20&&(f=this.sampleCurveX(n),!(Math.abs(f-r)<e));u++)r>f?_=n:g=n,n=.5*(g-_)+_;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Mt=Ge(tt),Kt=At;function At(r,e){this.x=r,this.y=e}At.prototype={clone:function(){return new At(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),n=Math.sin(r),u=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=u,this},_rotateAround:function(r,e){var n=Math.cos(r),u=Math.sin(r),f=e.y+u*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-u*(this.y-e.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},At.convert=function(r){return r instanceof At?r:Array.isArray(r)?new At(r[0],r[1]):r};var Ve=Ge(Kt);let er=Math.PI/180,Dt=180/Math.PI;function Pt(r){return r*er}function Or(r){return r*Dt}let vr=[[0,0],[1,0],[1,1],[0,1]];function di(r){if(r<=0)return 0;if(r>=1)return 1;let e=r*r,n=e*r;return 4*(r<.5?n:3*(r-e)+n-.75)}function xi(r,e,n,u){let f=new Mt(r,e,n,u);return function(p){return f.solve(p)}}let qe=xi(.25,.1,.25,1);function Ne(r,e,n){return Math.min(n,Math.max(e,r))}function Fe(r,e,n){return(n=Ne((n-r)/(e-r),0,1))*n*(3-2*n)}function Le(r,e,n){let u=n-e,f=((r-e)%u+u)%u+e;return f===e?n:f}function Ke(r,e,n){if(!r.length)return n(null,[]);let u=r.length,f=new Array(r.length),p=null;r.forEach((_,g)=>{e(_,(b,w)=>{b&&(p=b),f[g]=w,--u==0&&n(p,f)})})}function gt(r){let e=[];for(let n in r)e.push(r[n]);return e}function vt(r,...e){for(let n of e)for(let u in n)r[u]=n[u];return r}let tr=1;function hr(){return tr++}function Dr(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Yr(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function yi(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Un(r,e){r.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function vn(r,e){return r.indexOf(e,r.length-e.length)!==-1}function zt(r,e,n){let u={};for(let f in r)u[f]=e.call(n||this,r[f],f,r);return u}function bs(r,e,n){let u={};for(let f in r)e.call(n||this,r[f],f,r)&&(u[f]=r[f]);return u}function sn(r){return Array.isArray(r)?r.map(sn):typeof r=="object"&&r?zt(r,sn):r}let Pl={};function jr(r){Pl[r]||(typeof console<"u"&&console.warn(r),Pl[r]=!0)}function xn(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function ic(r){let e=0;for(let n,u,f=0,p=r.length,_=p-1;f<p;_=f++)n=r[f],u=r[_],e+=(u.x-n.x)*(n.y+u.y);return e}function Eo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ln(r){let e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,u,f,p)=>{let _=f||p;return e[u]=!_||_.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Ml=null;function ws(r){if(Ml==null){let e=r.navigator?r.navigator.userAgent:null;Ml=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ml}function ql(r){try{let e=v[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ia(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}let Ts="mapbox-tiles",nc=500,oc=50,bn,na;function Rl(){try{return v.caches}catch{}}function Da(){Rl()&&!bn&&(bn=v.caches.open(Ts))}function Es(r){let e=r.indexOf("?");if(e<0)return r;let n=function(f){let p=f.indexOf("?");return p>0?f.slice(p+1).split("&"):[]}(r),u=n.filter(f=>{let p=f.split("=");return p[0]==="language"||p[0]==="worldview"});return u.length?`${r.slice(0,e)}?${u.join("&")}`:r.slice(0,e)}let Dl=1/0,La={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(La);class oa extends Error{constructor(e,n,u){n===401&&be(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let ka=Eo()?()=>self.worker&&self.worker.referrer:()=>(v.location.protocol==="blob:"?v.parent:v).location.href,Ba=function(r,e){if(!(/^file:/.test(n=r.url)||/^file:/.test(ka())&&!/^\w+:/.test(n))){if(v.fetch&&v.Request&&v.AbortController&&v.Request.prototype.hasOwnProperty("signal"))return function(u,f){let p=new v.AbortController,_=new v.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ka(),referrerPolicy:u.referrerPolicy,signal:p.signal}),g=!1,b=!1,w=(I=_.url).indexOf("sku=")>0&&be(I);var I;u.type==="json"&&_.headers.set("Accept","application/json");let O=(L,k,U)=>{if(b)return;if(L&&L.message!=="SecurityError"&&jr(L.toString()),k&&U)return M(k);let G=Date.now();v.fetch(_).then(Y=>{if(Y.ok){let ae=w?Y.clone():null;return M(Y,ae,G)}return f(new oa(Y.statusText,Y.status,u.url))}).catch(Y=>{Y.name!=="AbortError"&&f(new Error(`${Y.message} ${u.url}`))})},M=(L,k,U)=>{(u.type==="arrayBuffer"?L.arrayBuffer():u.type==="json"?L.json():L.text()).then(G=>{b||(k&&U&&function(Y,ae,J){if(Da(),!bn)return;let ie={status:ae.status,statusText:ae.statusText,headers:new v.Headers};ae.headers.forEach((Ie,Te)=>ie.headers.set(Te,Ie));let ue=ln(ae.headers.get("Cache-Control")||"");if(ue["no-store"])return;ue["max-age"]&&ie.headers.set("Expires",new Date(J+1e3*ue["max-age"]).toUTCString());let se=ie.headers.get("Expires");se&&(new Date(se).getTime()-J<42e4||function(Ie,Te){if(na===void 0)try{new Response(new ReadableStream),na=!0}catch{na=!1}na?Te(Ie.body):Ie.blob().then(Te)}(ae,Ie=>{let Te=new v.Response(Ie,ie);Da(),bn&&bn.then(De=>De.put(Es(Y.url),Te)).catch(De=>jr(De.message))}))}(_,k,U),g=!0,f(null,G,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(G=>{b||f(new Error(G.message))})};return w?function(L,k){if(Da(),!bn)return k(null);let U=Es(L.url);bn.then(G=>{G.match(U).then(Y=>{let ae=function(J){if(!J)return!1;let ie=new Date(J.headers.get("Expires")||0),ue=ln(J.headers.get("Cache-Control")||"");return ie>Date.now()&&!ue["no-cache"]}(Y);G.delete(U),ae&&G.put(U,Y.clone()),k(null,Y,ae)}).catch(k)}).catch(k)}(_,O):O(null,null),{cancel:()=>{b=!0,g||p.abort()}}}(r,e);if(Eo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var n;return function(u,f){let p=new v.XMLHttpRequest;p.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(let _ in u.headers)p.setRequestHeader(_,u.headers[_]);return u.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=u.credentials==="include",p.onerror=()=>{f(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let _=p.response;if(u.type==="json")try{_=JSON.parse(p.response)}catch(g){return f(g)}f(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else f(new oa(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}}(r,e)},Ss=function(r,e){return Ba(vt(r,{type:"arrayBuffer"}),e)};function ac(r){let e=v.document.createElement("a");return e.href=r,e.protocol===v.document.location.protocol&&e.host===v.document.location.host}let oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",j,V;j=[],V=0;let te=function(r,e){if(z.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),V>=D.MAX_PARALLEL_IMAGE_REQUESTS){let p={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return j.push(p),p}V++;let n=!1,u=()=>{if(!n)for(n=!0,V--;j.length&&V<D.MAX_PARALLEL_IMAGE_REQUESTS;){let p=j.shift(),{requestParameters:_,callback:g,cancelled:b}=p;b||(p.cancel=te(_,g).cancel)}},f=Ss(r,(p,_,g,b)=>{u(),p?e(p):_&&(v.createImageBitmap?function(w,I){let O=new v.Blob([new Uint8Array(w)],{type:"image/png"});v.createImageBitmap(O).then(M=>{I(null,M)}).catch(M=>{I(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(w,I)=>e(w,I,g,b)):function(w,I){let O=new v.Image,M=v.URL;O.onload=()=>{I(null,O),M.revokeObjectURL(O.src),O.onload=null,v.requestAnimationFrame(()=>{O.src=oe})},O.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let L=new v.Blob([new Uint8Array(w)],{type:"image/png"});O.src=w.byteLength?M.createObjectURL(L):oe}(_,(w,I)=>e(w,I,g,b)))});return{cancel:()=>{f.cancel(),u()}}},ce="NO_ACCESS_TOKEN";function _e(r){return r.indexOf("mapbox:")===0}function be(r){return D.API_URL_REGEX.test(r)}function xe(r){return D.API_CDN_URL_REGEX.test(r)}function me(r){return D.API_STYLE_REGEX.test(r)&&!Pe(r)}function Pe(r){return D.API_SPRITE_REGEX.test(r)}let at=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function st(r){let e=r.match(at);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function it(r){let e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}let Ft="mapbox.eventData";function $t(r){if(!r)return null;let e=r.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(v.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Nt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=$t(D.ACCESS_TOKEN),u="";return u=n&&n.u?v.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(f,p)=>String.fromCharCode(+("0x"+p)))):D.ACCESS_TOKEN||"",e?`${Ft}.${e}:${u}`:`${Ft}:${u}`}fetchEventData(){let e=ql("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(e)try{let f=v.localStorage.getItem(n);f&&(this.eventData=JSON.parse(f));let p=v.localStorage.getItem(u);p&&(this.anonId=p)}catch{jr("Unable to read from LocalStorage")}}saveEventData(){let e=ql("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(e)try{v.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&v.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{jr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,u,f){if(!D.EVENTS_URL)return;let p=st(D.EVENTS_URL);p.params.push(`access_token=${f||D.ACCESS_TOKEN||""}`);let _={event:this.type,created:new Date(e).toISOString()},g=n?vt(_,n):_,b={url:it(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=function(w,I){return Ba(vt(w,{method:"POST"}),I)}(b,w=>{this.pendingRequest=null,u(w),this.saveEventData(),this.processRequests(f)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let Gt=new class extends Nt{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(r)&&r.some(n=>_e(n)||be(n))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=$t(D.ACCESS_TOKEN),n=e?e.u:D.ACCESS_TOKEN,u=n!==this.eventData.tokenU;yi(this.anonId)||(this.anonId=Dr(),u=!0);let f=this.queue.shift();if(this.eventData.lastSuccess){let p=new Date(this.eventData.lastSuccess),_=new Date(f),g=(f-this.eventData.lastSuccess)/864e5;u=u||g>=1||g<-1||p.getDate()!==_.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:ke,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=f,this.eventData.tokenU=n)},r):this.processRequests()}},Jt=Gt.postTurnstileEvent.bind(Gt),Vr=new class extends Nt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,n,u){this.skuToken=e,this.errorCb=u,D.EVENTS_URL&&(n||D.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},n):this.errorCb(new Error(ce)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),yi(this.anonId)||(this.anonId=Dr()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:ke,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):e&&(this.success[e]=!0)},r))}},ii=Vr.postMapLoadEvent.bind(Vr),Di=new class extends Nt{constructor(){super("gljs.performance")}postPerformanceEvent(r,e){D.EVENTS_URL&&(r||D.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},r)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),u=function(f){let p=v.performance.getEntriesByType("resource"),_=v.performance.getEntriesByType("mark"),g=function(M){let L={};if(M){for(let k in M)if(k!=="other")for(let U of M[k]){let G=`${k}ResolveRangeMin`,Y=`${k}ResolveRangeMax`,ae=`${k}RequestCount`,J=`${k}RequestCachedCount`;L[G]=Math.min(L[G]||1/0,U.startTime),L[Y]=Math.max(L[Y]||-1/0,U.responseEnd);let ie=ue=>{L[ue]===void 0&&(L[ue]=0),++L[ue]};U.transferSize!==void 0&&U.transferSize===0&&ie(J),ie(ae)}}return L}(function(M,L){let k={};if(M)for(let U of M){let G=L(U);k[G]===void 0&&(k[G]=[]),k[G].push(U)}return k}(p,o_)),b=v.devicePixelRatio,w=v.navigator.connection||v.navigator.mozConnection||v.navigator.webkitConnection,I={counters:[],metadata:[],attributes:[]},O=(M,L,k)=>{k!=null&&M.push({name:L,value:k.toString()})};for(let M in g)O(I.counters,M,g[M]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(O(I.counters,"interactionRangeMin",f.interactionRange[0]),O(I.counters,"interactionRangeMax",f.interactionRange[1])),_)for(let M of Object.keys(Is)){let L=Is[M],k=_.find(U=>U.name===L);k&&O(I.counters,L,k.startTime)}return O(I.counters,"visibilityHidden",f.visibilityHidden),O(I.attributes,"style",function(M){if(M)for(let L of M){let k=L.name.split("?")[0];if(me(k)){let U=k.split("/").slice(-2);if(U.length===2)return`mapbox://styles/${U[0]}/${U[1]}`}}}(p)),O(I.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),O(I.attributes,"fogEnabled",f.fogEnabled?"true":"false"),O(I.attributes,"projection",f.projection),O(I.attributes,"zoom",f.zoom),O(I.metadata,"devicePixelRatio",b),O(I.metadata,"connectionEffectiveType",w?w.effectiveType:void 0),O(I.metadata,"navigatorUserAgent",v.navigator.userAgent),O(I.metadata,"screenWidth",v.screen.width),O(I.metadata,"screenHeight",v.screen.height),O(I.metadata,"windowWidth",v.innerWidth),O(I.metadata,"windowHeight",v.innerHeight),O(I.metadata,"mapWidth",f.width/b),O(I.metadata,"mapHeight",f.height/b),O(I.metadata,"webglRenderer",f.renderer),O(I.metadata,"webglVendor",f.vendor),O(I.metadata,"sdkVersion",S),O(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(let f of u.metadata);for(let f of u.counters);for(let f of u.attributes);this.postEvent(e,u,()=>{},r)}},pi=Di.postPerformanceEvent.bind(Di),Qn=new class extends Nt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,n,u){if(!D.API_URL||!D.SESSION_PATH)return;let f=st(D.API_URL+D.SESSION_PATH);f.params.push(`sku=${e||""}`),f.params.push(`access_token=${u||D.ACCESS_TOKEN||""}`);let p={url:it(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(_,g){return Ba(vt(_,{method:"GET"}),g)}(p,_=>{this.pendingRequest=null,n(_),this.saveEventData(),this.processRequests(u)})}getSessionAPI(r,e,n,u){this.skuToken=e,this.errorCb=u,D.SESSION_PATH&&D.API_URL&&(n||D.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},n):this.errorCb(new Error(ce)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,u=>{u?this.errorCb(u):e&&(this.success[e]=!0)},r)}},bi=Qn.getSessionAPI.bind(Qn),Vi=new Set,Is={create:"create",load:"load",fullLoad:"fullLoad"},W0={mark(r){v.performance.mark(r)},measure(r,e,n){v.performance.measure(r,e,n)}};function o_(r){let e=r.name.split("?")[0];return xe(e)&&e.includes("mapbox-gl.js")?"javascript":xe(e)&&e.includes("mapbox-gl.css")?"css":function(n){return D.API_FONTS_REGEX.test(n)}(e)?"fontRange":Pe(e)?"sprite":me(e)?"style":function(n){return D.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}let fr=v.performance;function Rf(r){let e=r?r.url.toString():void 0;return fr.getEntriesByName(e)}let Ll,Df,sc,eo,So={now:()=>sc!==void 0?sc:v.performance.now(),setNow(r){sc=r},restoreNow(){sc=void 0},frame(r){let e=v.requestAnimationFrame(r);return{cancel:()=>v.cancelAnimationFrame(e)}},getImageData(r,e=0){let{width:n,height:u}=r;eo||(eo=v.document.createElement("canvas"));let f=eo.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(n>eo.width||u>eo.height)&&(eo.width=n,eo.height=u),f.clearRect(-e,-e,n+2*e,u+2*e),f.drawImage(r,0,0,n,u),f.getImageData(-e,-e,n+2*e,u+2*e)},resolveURL:r=>(Ll||(Ll=v.document.createElement("a")),Ll.href=r,Ll.href),get devicePixelRatio(){return v.devicePixelRatio},get prefersReducedMotion(){return!!v.matchMedia&&(Df==null&&(Df=v.matchMedia("(prefers-reduced-motion: reduce)")),Df.matches)}};function Lf(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function kf(r,e,n){if(n&&n[r]){let u=n[r].indexOf(e);u!==-1&&n[r].splice(u,1)}}class za{constructor(e,n={}){vt(this,n),this.type=e}}class Io extends za{constructor(e,n={}){super("error",vt({error:e},n))}}class kl{on(e,n){return this._listeners=this._listeners||{},Lf(e,n,this._listeners),this}off(e,n){return kf(e,n,this._listeners),kf(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Lf(e,n,this._oneTimeListeners),this):new Promise(u=>this.once(e,u))}fire(e,n){typeof e=="string"&&(e=new za(e,n||{}));let u=e.type;if(this.listens(u)){e.target=this;let f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(let g of f)g.call(this,e);let p=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(let g of p)kf(u,g,this._oneTimeListeners),g.call(this,e);let _=this._eventedParent;_&&(vt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Io&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ao(r,...e){for(let n of e)for(let u in n)r[u]=n[u];return r}function ni(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function wi(r){if(Array.isArray(r))return r.map(wi);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){let e={};for(let n in r)e[n]=wi(r[n]);return e}return ni(r)}class a_ extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var to=a_;class Bf{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[u,f]of n)this.bindings[u]=f}concat(e){return new Bf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var s_=Bf;let As={kind:"null"},ft={kind:"number"},Yt={kind:"string"},Zt={kind:"boolean"},un={kind:"color"},jn={kind:"object"},Ht={kind:"value"},cn={kind:"collator"},Bl={kind:"formatted"},Fa={kind:"resolvedImage"};function wn(r,e){return{kind:"array",itemType:r,N:e}}function Fr(r){if(r.kind==="array"){let e=Fr(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}let l_=[As,ft,Yt,Zt,un,Bl,jn,wn(Ht),Fa];function Oo(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Oo(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(let n of l_)if(!Oo(n,e))return null}}return`Expected ${Fr(r)} but found ${Fr(e)} instead.`}function zl(r,e){return e.some(n=>n.kind===r.kind)}function Fl(r,e){return e.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}var zf,u_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Nl(r){return(r=Math.round(r))<0?0:r>255?255:r}function Ul(r){return Nl(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function lc(r){return(e=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function Os(r,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?r+(e-r)*n*6:2*n<1?e:3*n<2?r+(e-r)*(2/3-n)*6:r}try{zf={}.parseCSSColor=function(r){var e,n=r.replace(/ /g,"").toLowerCase();if(n in u_)return u_[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=n.indexOf("("),f=n.indexOf(")");if(u!==-1&&f+1===n.length){var p=n.substr(0,u),_=n.substr(u+1,f-(u+1)).split(","),g=1;switch(p){case"rgba":if(_.length!==4)return null;g=lc(_.pop());case"rgb":return _.length!==3?null:[Ul(_[0]),Ul(_[1]),Ul(_[2]),g];case"hsla":if(_.length!==4)return null;g=lc(_.pop());case"hsl":if(_.length!==3)return null;var b=(parseFloat(_[0])%360+360)%360/360,w=lc(_[1]),I=lc(_[2]),O=I<=.5?I*(w+1):I+w-I*w,M=2*I-O;return[Nl(255*Os(M,O,b+1/3)),Nl(255*Os(M,O,b)),Nl(255*Os(M,O,b-1/3)),g];default:return null}}return null}}catch{}class Hi{constructor(e,n,u,f=1){this.r=e,this.g=n,this.b=u,this.a=f}static parse(e){if(!e)return;if(e instanceof Hi)return e;if(typeof e!="string")return;let n=zf(e);return n?new Hi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,u,f]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(u)},${f})`}toArray(){let{r:e,g:n,b:u,a:f}=this;return f===0?[0,0,0,0]:[255*e/f,255*n/f,255*u/f,f]}toArray01(){let{r:e,g:n,b:u,a:f}=this;return f===0?[0,0,0,0]:[e/f,n/f,u/f,f]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:u,a:f}=this;return[e,n,u,f]}}Hi.black=new Hi(0,0,0,1),Hi.white=new Hi(1,1,1,1),Hi.transparent=new Hi(0,0,0,0),Hi.red=new Hi(1,0,0,1),Hi.blue=new Hi(0,0,1,1);var Jr=Hi;class Ff{constructor(e,n,u){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Nf{constructor(e,n,u,f,p){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=u,this.fontStack=f,this.textColor=p}}class Xi{constructor(e){this.sections=e}static fromString(e){return new Xi([new Nf(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Xi?e:Xi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);let u={};n.fontStack&&(u["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(u["font-scale"]=n.scale),n.textColor&&(u["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(u)}return e}}class Tn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Tn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function c_(r,e,n,u){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[r,e,n,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[r,e,n,u]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function jl(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Jr||r instanceof Ff||r instanceof Xi||r instanceof Tn)return!0;if(Array.isArray(r)){for(let e of r)if(!jl(e))return!1;return!0}if(typeof r=="object"){for(let e in r)if(!jl(r[e]))return!1;return!0}return!1}function Hr(r){if(r===null)return As;if(typeof r=="string")return Yt;if(typeof r=="boolean")return Zt;if(typeof r=="number")return ft;if(r instanceof Jr)return un;if(r instanceof Ff)return cn;if(r instanceof Xi)return Bl;if(r instanceof Tn)return Fa;if(Array.isArray(r)){let e=r.length,n;for(let u of r){let f=Hr(u);if(n){if(n===f)continue;n=Ht;break}n=f}return wn(n||Ht,e)}return jn}function Vl(r){let e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Jr||r instanceof Xi||r instanceof Tn?r.toString():JSON.stringify(r)}class Uf{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!jl(e[1]))return n.error("invalid value");let u=e[1],f=Hr(u),p=n.expectedType;return f.kind!=="array"||f.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(f=p),new Uf(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Jr?["rgba"].concat(this.value.toArray()):this.value instanceof Xi?this.value.serialize():this.value}}var Na=Uf,Ci=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};let jf={string:Yt,number:ft,boolean:Zt,object:jn};class Vf{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let u,f=1,p=e[0];if(p==="array"){let g,b;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in jf)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);g=jf[w],f++}else g=Ht;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],f++}u=wn(g,b)}else u=jf[p];let _=[];for(;f<e.length;f++){let g=n.parse(e[f],f,Ht);if(!g)return null;_.push(g)}return new Vf(u,_)}evaluate(e){for(let n=0;n<this.args.length;n++){let u=this.args[n].evaluate(e);if(!Oo(this.type,Hr(u)))return u;if(n===this.args.length-1)throw new Ci(`Expected value to be of type ${Fr(this.type)}, but found ${Fr(Hr(u))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let u=e.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){n.push(u.kind);let f=e.N;(typeof f=="number"||this.args.length>1)&&n.push(f)}}return n.concat(this.args.map(u=>u.serialize()))}}var Co=Vf;class aa{constructor(e){this.type=Bl,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let u=e[1];if(!Array.isArray(u)&&typeof u=="object")return n.error("First argument must be an image or text section.");let f=[],p=!1;for(let _=1;_<=e.length-1;++_){let g=e[_];if(p&&typeof g=="object"&&!Array.isArray(g)){p=!1;let b=null;if(g["font-scale"]&&(b=n.parse(g["font-scale"],1,ft),!b))return null;let w=null;if(g["text-font"]&&(w=n.parse(g["text-font"],1,wn(Yt)),!w))return null;let I=null;if(g["text-color"]&&(I=n.parse(g["text-color"],1,un),!I))return null;let O=f[f.length-1];O.scale=b,O.font=w,O.textColor=I}else{let b=n.parse(e[_],1,Ht);if(!b)return null;let w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,f.push({content:b,scale:null,font:null,textColor:null})}}return new aa(f)}evaluate(e){return new Xi(this.sections.map(n=>{let u=n.content.evaluate(e);return Hr(u)===Fa?new Nf("",u,null,null,null):new Nf(Vl(u),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let u={};n.scale&&(u["font-scale"]=n.scale.serialize()),n.font&&(u["text-font"]=n.font.serialize()),n.textColor&&(u["text-color"]=n.textColor.serialize()),e.push(u)}return e}}class uc{constructor(e){this.type=Fa,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");let u=n.parse(e[1],1,Yt);return u?new uc(u):n.error("No image name provided.")}evaluate(e){let n=this.input.evaluate(e),u=Tn.fromString(n);return u&&e.availableImages&&(u.available=e.availableImages.indexOf(n)>-1),u}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let Z0={"to-boolean":Zt,"to-color":un,"to-number":ft,"to-string":Yt};class $f{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let u=e[0];if((u==="to-boolean"||u==="to-string")&&e.length!==2)return n.error("Expected one argument.");let f=Z0[u],p=[];for(let _=1;_<e.length;_++){let g=n.parse(e[_],_,Ht);if(!g)return null;p.push(g)}return new $f(f,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,u;for(let f of this.args){if(n=f.evaluate(e),u=null,n instanceof Jr)return n;if(typeof n=="string"){let p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(u=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:c_(n[0],n[1],n[2],n[3]),!u))return new Jr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ci(u||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let u of this.args){if(n=u.evaluate(e),n===null)return 0;let f=Number(n);if(!isNaN(f))return f}throw new Ci(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Xi.fromString(Vl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Tn.fromString(Vl(this.args[0].evaluate(e))):Vl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new aa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uc(this.args[0]).serialize();let e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Cs=$f;let ro=["Unknown","Point","LineString","Polygon"];var Gf=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ro[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let r=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-r[0])+this.featureDistanceData.bearing[1]*(u*e-r[1])}return 0}parseColor(r){let e=this._parseColorCache[r];return e||(e=this._parseColorCache[r]=Jr.parse(r)),e}};class Ua{constructor(e,n,u,f){this.name=e,this.type=n,this._evaluate=u,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let u=e[0],f=Ua.definitions[u];if(!f)return n.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let p=Array.isArray(f)?f[0]:f.type,_=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,g=_.filter(([w])=>!Array.isArray(w)||w.length===e.length-1),b=null;for(let[w,I]of g){b=new Yf(n.registry,n.path,null,n.scope);let O=[],M=!1;for(let L=1;L<e.length;L++){let k=e[L],U=Array.isArray(w)?w[L-1]:w.type,G=b.parse(k,1+O.length,U);if(!G){M=!0;break}O.push(G)}if(!M)if(Array.isArray(w)&&w.length!==O.length)b.error(`Expected ${w.length} arguments, but found ${O.length} instead.`);else{for(let L=0;L<O.length;L++){let k=Array.isArray(w)?w[L]:w.type,U=O[L];b.concat(L+1).checkSubtype(k,U.type)}if(b.errors.length===0)return new Ua(u,p,I,O)}}if(g.length===1)n.errors.push(...b.errors);else{let w=(g.length?g:_).map(([O])=>{return M=O,Array.isArray(M)?`(${M.map(Fr).join(", ")})`:`(${Fr(M.type)}...)`;var M}).join(" | "),I=[];for(let O=1;O<e.length;O++){let M=n.parse(e[O],1+I.length);if(!M)return null;I.push(Fr(M.type))}n.error(`Expected arguments of type ${w}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Ua.definitions=n;for(let u in n)e[u]=Ua}}var Po=Ua;class $l{constructor(e,n,u){this.type=cn,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let u=e[1];if(typeof u!="object"||Array.isArray(u))return n.error("Collator options argument must be an object.");let f=n.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Zt);if(!f)return null;let p=n.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Zt);if(!p)return null;let _=null;return u.locale&&(_=n.parse(u.locale,1,Yt),!_)?null:new $l(f,p,_)}evaluate(e){return new Ff(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}let Mo=8192;function cc(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Ps(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Gl(r,e){let n=(180+r[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(n*f*Mo),Math.round(u*f*Mo)]}function h_(r,e,n){let u=r[0]-e[0],f=r[1]-e[1],p=r[0]-n[0],_=r[1]-n[1];return u*_-p*f==0&&u*p<=0&&f*_<=0}function hc(r,e){let n=!1;for(let _=0,g=e.length;_<g;_++){let b=e[_];for(let w=0,I=b.length;w<I-1;w++){if(h_(r,b[w],b[w+1]))return!1;(f=b[w])[1]>(u=r)[1]!=(p=b[w+1])[1]>u[1]&&u[0]<(p[0]-f[0])*(u[1]-f[1])/(p[1]-f[1])+f[0]&&(n=!n)}}var u,f,p;return n}function Wf(r,e){for(let n=0;n<e.length;n++)if(hc(r,e[n]))return!0;return!1}function Zf(r,e,n,u){let f=u[0]-n[0],p=u[1]-n[1],_=(r[0]-n[0])*p-f*(r[1]-n[1]),g=(e[0]-n[0])*p-f*(e[1]-n[1]);return _>0&&g<0||_<0&&g>0}function Ms(r,e,n){for(let w of n)for(let I=0;I<w.length-1;++I)if((g=[(_=w[I+1])[0]-(p=w[I])[0],_[1]-p[1]])[0]*(b=[(f=e)[0]-(u=r)[0],f[1]-u[1]])[1]-g[1]*b[0]!=0&&Zf(u,f,p,_)&&Zf(p,_,u,f))return!0;var u,f,p,_,g,b;return!1}function dr(r,e){for(let n=0;n<r.length;++n)if(!hc(r[n],e))return!1;for(let n=0;n<r.length-1;++n)if(Ms(r[n],r[n+1],e))return!1;return!0}function H0(r,e){for(let n=0;n<e.length;n++)if(dr(r,e[n]))return!0;return!1}function Hf(r,e,n){let u=[];for(let f=0;f<r.length;f++){let p=[];for(let _=0;_<r[f].length;_++){let g=Gl(r[f][_],n);cc(e,g),p.push(g)}u.push(p)}return u}function f_(r,e,n){let u=[];for(let f=0;f<r.length;f++){let p=Hf(r[f],e,n);u.push(p)}return u}function Xf(r,e,n,u){if(r[0]<n[0]||r[0]>n[2]){let f=.5*u,p=r[0]-n[0]>f?-u:n[0]-r[0]>f?u:0;p===0&&(p=r[0]-n[2]>f?-u:n[2]-r[0]>f?u:0),r[0]+=p}cc(e,r)}function d_(r,e,n,u){let f=Math.pow(2,u.z)*Mo,p=[u.x*Mo,u.y*Mo],_=[];if(!r)return _;for(let g of r)for(let b of g){let w=[b.x+p[0],b.y+p[1]];Xf(w,e,n,f),_.push(w)}return _}function Kf(r,e,n,u){let f=Math.pow(2,u.z)*Mo,p=[u.x*Mo,u.y*Mo],_=[];if(!r)return _;for(let b of r){let w=[];for(let I of b){let O=[I.x+p[0],I.y+p[1]];cc(e,O),w.push(O)}_.push(w)}if(e[2]-e[0]<=f/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(let b of _)for(let w of b)Xf(w,e,n,f)}var g;return _}class qs{constructor(e,n){this.type=Zt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(jl(e[1])){let u=e[1];if(u.type==="FeatureCollection")for(let f=0;f<u.features.length;++f){let p=u.features[f].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new qs(u,u.features[f].geometry)}else if(u.type==="Feature"){let f=u.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new qs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new qs(u,u)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,u){let f=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if(u.type==="Polygon"){let g=Hf(u.coordinates,p,_),b=d_(n.geometry(),f,p,_);if(!Ps(f,p))return!1;for(let w of b)if(!hc(w,g))return!1}if(u.type==="MultiPolygon"){let g=f_(u.coordinates,p,_),b=d_(n.geometry(),f,p,_);if(!Ps(f,p))return!1;for(let w of b)if(!Wf(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,u){let f=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if(u.type==="Polygon"){let g=Hf(u.coordinates,p,_),b=Kf(n.geometry(),f,p,_);if(!Ps(f,p))return!1;for(let w of b)if(!dr(w,g))return!1}if(u.type==="MultiPolygon"){let g=f_(u.coordinates,p,_),b=Kf(n.geometry(),f,p,_);if(!Ps(f,p))return!1;for(let w of b)if(!H0(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var fc=qs;function Rs(r){if(r instanceof Po&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof fc)return!1;let e=!0;return r.eachChild(n=>{e&&!Rs(n)&&(e=!1)}),e}function qo(r){if(r instanceof Po&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(n=>{e&&!qo(n)&&(e=!1)}),e}function ja(r,e){if(r instanceof Po&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(u=>{n&&!ja(u,e)&&(n=!1)}),n}class dc{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let u=e[1];return n.scope.has(u)?new dc(u,n.scope.get(u)):n.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var p_=dc;class Wl{constructor(e,n=[],u,f=new s_,p=[]){this.registry=e,this.path=n,this.key=n.map(_=>`[${_}]`).join(""),this.scope=f,this.errors=p,this.expectedType=u}parse(e,n,u,f,p={}){return n?this.concat(n,u,f)._parse(e,p):this._parse(e,p)}_parse(e,n){function u(f,p,_){return _==="assert"?new Co(p,[f]):_==="coerce"?new Cs(p,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let p=this.registry[f];if(p){let _=p.parse(e,this);if(!_)return null;if(this.expectedType){let g=this.expectedType,b=_.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else _=u(_,g,n.typeAnnotation||"coerce");else _=u(_,g,n.typeAnnotation||"assert")}if(!(_ instanceof Na)&&_.type.kind!=="resolvedImage"&&Jf(_)){let g=new Gf;try{_=new Na(_.type,_.evaluate(g))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,u){let f=typeof e=="number"?this.path.concat(e):this.path,p=u?this.scope.concat(u):this.scope;return new Wl(this.registry,f,n||null,p,this.errors)}error(e,...n){let u=`${this.key}${n.map(f=>`[${f}]`).join("")}`;this.errors.push(new to(u,e))}checkSubtype(e,n){let u=Oo(e,n);return u&&this.error(u),u}}var Yf=Wl;function Jf(r){if(r instanceof p_)return Jf(r.boundExpression);if(r instanceof Po&&r.name==="error"||r instanceof $l||r instanceof fc)return!1;let e=r instanceof Cs||r instanceof Co,n=!0;return r.eachChild(u=>{n=e?n&&Jf(u):n&&u instanceof Na}),!!n&&Rs(r)&&ja(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function pc(r,e){let n=r.length-1,u,f,p=0,_=n,g=0;for(;p<=_;)if(g=Math.floor((p+_)/2),u=r[g],f=r[g+1],u<=e){if(g===n||e<f)return g;p=g+1}else{if(!(u>e))throw new Ci("Input is not a number.");_=g-1}return 0}class mc{constructor(e,n,u){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[f,p]of u)this.labels.push(f),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let u=n.parse(e[1],1,ft);if(!u)return null;let f=[],p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let _=1;_<e.length;_+=2){let g=_===1?-1/0:e[_],b=e[_+1],w=_,I=_+1;if(typeof g!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(f.length&&f[f.length-1][0]>=g)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let O=n.parse(b,I,p);if(!O)return null;p=p||O.type,f.push([g,O])}return new mc(p,u,f)}evaluate(e){let n=this.labels,u=this.outputs;if(n.length===1)return u[0].evaluate(e);let f=this.input.evaluate(e);if(f<=n[0])return u[0].evaluate(e);let p=n.length;return f>=n[p-1]?u[p-1].evaluate(e):u[pc(n,f)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Qf=mc;function nr(r,e,n){return r*(1-n)+e*n}var Zl=Object.freeze({__proto__:null,array:function(r,e,n){return r.map((u,f)=>nr(u,e[f],n))},color:function(r,e,n){return new Jr(nr(r.r,e.r,n),nr(r.g,e.g,n),nr(r.b,e.b,n),nr(r.a,e.a,n))},number:nr});let m_=.95047,ed=1.08883,__=4/29,Va=6/29,td=3*Va*Va,X0=Va*Va*Va,K0=Math.PI/180,Y0=180/Math.PI;function rd(r){return r>X0?Math.pow(r,1/3):r/td+__}function id(r){return r>Va?r*r*r:td*(r-__)}function nd(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function _c(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function y_(r){let e=_c(r.r),n=_c(r.g),u=_c(r.b),f=rd((.4124564*e+.3575761*n+.1804375*u)/m_),p=rd((.2126729*e+.7151522*n+.072175*u)/1);return{l:116*p-16,a:500*(f-p),b:200*(p-rd((.0193339*e+.119192*n+.9503041*u)/ed)),alpha:r.a}}function g_(r){let e=(r.l+16)/116,n=isNaN(r.a)?e:e+r.a/500,u=isNaN(r.b)?e:e-r.b/200;return e=1*id(e),n=m_*id(n),u=ed*id(u),new Jr(nd(3.2404542*n-1.5371385*e-.4985314*u),nd(-.969266*n+1.8760108*e+.041556*u),nd(.0556434*n-.2040259*e+1.0572252*u),r.alpha)}function J0(r,e,n){let u=e-r;return r+n*(u>180||u<-180?u-360*Math.round(u/360):u)}let Hl={forward:y_,reverse:g_,interpolate:function(r,e,n){return{l:nr(r.l,e.l,n),a:nr(r.a,e.a,n),b:nr(r.b,e.b,n),alpha:nr(r.alpha,e.alpha,n)}}},Ds={forward:function(r){let{l:e,a:n,b:u}=y_(r),f=Math.atan2(u,n)*Y0;return{h:f<0?f+360:f,c:Math.sqrt(n*n+u*u),l:e,alpha:r.a}},reverse:function(r){let e=r.h*K0,n=r.c;return g_({l:r.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:r.alpha})},interpolate:function(r,e,n){return{h:J0(r.h,e.h,n),c:nr(r.c,e.c,n),l:nr(r.l,e.l,n),alpha:nr(r.alpha,e.alpha,n)}}};var od=Object.freeze({__proto__:null,hcl:Ds,lab:Hl});class Xl{constructor(e,n,u,f,p){this.type=e,this.operator=n,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(let[_,g]of p)this.labels.push(_),this.outputs.push(g)}static interpolationFactor(e,n,u,f){let p=0;if(e.name==="exponential")p=ad(n,e.base,u,f);else if(e.name==="linear")p=ad(n,1,u,f);else if(e.name==="cubic-bezier"){let _=e.controlPoints;p=new Mt(_[0],_[1],_[2],_[3]).solve(ad(n,1,u,f))}return p}static parse(e,n){let[u,f,p,..._]=e;if(!Array.isArray(f)||f.length===0)return n.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){let w=f[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:w}}else{if(f[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(f[0])}`,1,0);{let w=f.slice(1);if(w.length!==4||w.some(I=>typeof I!="number"||I<0||I>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,ft),!p)return null;let g=[],b=null;u==="interpolate-hcl"||u==="interpolate-lab"?b=un:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let w=0;w<_.length;w+=2){let I=_[w],O=_[w+1],M=w+3,L=w+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);let k=n.parse(O,L,b);if(!k)return null;b=b||k.type,g.push([I,k])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Xl(b,u,f,p,g):n.error(`Type ${Fr(b)} is not interpolatable.`)}evaluate(e){let n=this.labels,u=this.outputs;if(n.length===1)return u[0].evaluate(e);let f=this.input.evaluate(e);if(f<=n[0])return u[0].evaluate(e);let p=n.length;if(f>=n[p-1])return u[p-1].evaluate(e);let _=pc(n,f),g=Xl.interpolationFactor(this.interpolation,f,n[_],n[_+1]),b=u[_].evaluate(e),w=u[_+1].evaluate(e);return this.operator==="interpolate"?Zl[this.type.kind.toLowerCase()](b,w,g):this.operator==="interpolate-hcl"?Ds.reverse(Ds.interpolate(Ds.forward(b),Ds.forward(w),g)):Hl.reverse(Hl.interpolate(Hl.forward(b),Hl.forward(w),g))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)n.push(this.labels[u],this.outputs[u].serialize());return n}}function ad(r,e,n,u){let f=u-n,p=r-n;return f===0?0:e===1?p/f:(Math.pow(e,p)-1)/(Math.pow(e,f)-1)}var io=Xl;class yc{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let u=null,f=n.expectedType;f&&f.kind!=="value"&&(u=f);let p=[];for(let g of e.slice(1)){let b=n.parse(g,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!b)return null;u=u||b.type,p.push(b)}let _=f&&p.some(g=>Oo(f,g.type));return new yc(_?Ht:u,p)}evaluate(e){let n,u=null,f=0;for(let p of this.args){if(f++,u=p.evaluate(e),u&&u instanceof Tn&&!u.available&&(n||(n=u),u=null,f===this.args.length))return n;if(u!==null)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var sd=yc;class gc{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let u=[];for(let p=1;p<e.length-1;p+=2){let _=e[p];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);let g=n.parse(e[p+1],p+1);if(!g)return null;u.push([_,g])}let f=n.parse(e[e.length-1],e.length-1,n.expectedType,u);return f?new gc(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,u]of this.bindings)e.push(n,u.serialize());return e.push(this.result.serialize()),e}}var v_=gc;class ld{constructor(e,n,u){this.type=e,this.index=n,this.input=u}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=n.parse(e[1],1,ft),f=n.parse(e[2],2,wn(n.expectedType||Ht));return u&&f?new ld(f.type.itemType,u,f):null}evaluate(e){let n=this.index.evaluate(e),u=this.input.evaluate(e);if(n<0)throw new Ci(`Array index out of bounds: ${n} < 0.`);if(n>=u.length)throw new Ci(`Array index out of bounds: ${n} > ${u.length-1}.`);if(n!==Math.floor(n))throw new Ci(`Array index must be an integer, but found ${n} instead.`);return u[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Q0=ld;class ud{constructor(e,n){this.type=Zt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=n.parse(e[1],1,Ht),f=n.parse(e[2],2,Ht);return u&&f?zl(u.type,[Zt,Yt,ft,As,Ht])?new ud(u,f):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(u.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(u==null)return!1;if(!Fl(n,["boolean","string","number","null"]))throw new Ci(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(Hr(n))} instead.`);if(!Fl(u,["string","array"]))throw new Ci(`Expected second argument to be of type array or string, but found ${Fr(Hr(u))} instead.`);return u.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var vc=ud;class Kl{constructor(e,n,u){this.type=ft,this.needle=e,this.haystack=n,this.fromIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let u=n.parse(e[1],1,Ht),f=n.parse(e[2],2,Ht);if(!u||!f)return null;if(!zl(u.type,[Zt,Yt,ft,As,Ht]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(u.type)} instead`);if(e.length===4){let p=n.parse(e[3],3,ft);return p?new Kl(u,f,p):null}return new Kl(u,f)}evaluate(e){let n=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Fl(n,["boolean","string","number","null"]))throw new Ci(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(Hr(n))} instead.`);if(!Fl(u,["string","array"]))throw new Ci(`Expected second argument to be of type array or string, but found ${Fr(Hr(u))} instead.`);if(this.fromIndex){let f=this.fromIndex.evaluate(e);return u.indexOf(n,f)}return u.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var x_=Kl;class cd{constructor(e,n,u,f,p,_){this.inputType=e,this.type=n,this.input=u,this.cases=f,this.outputs=p,this.otherwise=_}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let u,f;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);let p={},_=[];for(let w=2;w<e.length-1;w+=2){let I=e[w],O=e[w+1];Array.isArray(I)||(I=[I]);let M=n.concat(w);if(I.length===0)return M.error("Expected at least one branch label.");for(let k of I){if(typeof k!="number"&&typeof k!="string")return M.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return M.error("Numeric branch labels must be integer values.");if(u){if(M.checkSubtype(u,Hr(k)))return null}else u=Hr(k);if(p[String(k)]!==void 0)return M.error("Branch labels must be unique.");p[String(k)]=_.length}let L=n.parse(O,w,f);if(!L)return null;f=f||L.type,_.push(L)}let g=n.parse(e[1],1,Ht);if(!g)return null;let b=n.parse(e[e.length-1],e.length-1,f);return b?g.type.kind!=="value"&&n.concat(1).checkSubtype(u,g.type)?null:new cd(u,f,g,p,_,b):null}evaluate(e){let n=this.input.evaluate(e);return(Hr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),u=[],f={};for(let _ of n){let g=f[this.cases[_]];g===void 0?(f[this.cases[_]]=u.length,u.push([this.cases[_],[_]])):u[g][1].push(_)}let p=_=>this.inputType.kind==="number"?Number(_):_;for(let[_,g]of u)e.push(g.length===1?p(g[0]):g.map(p)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}var ex=cd;class hd{constructor(e,n,u){this.type=e,this.branches=n,this.otherwise=u}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);let f=[];for(let _=1;_<e.length-1;_+=2){let g=n.parse(e[_],_,Zt);if(!g)return null;let b=n.parse(e[_+1],_+1,u);if(!b)return null;f.push([g,b]),u=u||b.type}let p=n.parse(e[e.length-1],e.length-1,u);return p?new hd(u,f,p):null}evaluate(e){for(let[n,u]of this.branches)if(n.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,u]of this.branches)e(n),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var b_=hd;class Yl{constructor(e,n,u,f){this.type=e,this.input=n,this.beginIndex=u,this.endIndex=f}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let u=n.parse(e[1],1,Ht),f=n.parse(e[2],2,ft);if(!u||!f)return null;if(!zl(u.type,[wn(Ht),Yt,Ht]))return n.error(`Expected first argument to be of type array or string, but found ${Fr(u.type)} instead`);if(e.length===4){let p=n.parse(e[3],3,ft);return p?new Yl(u.type,u,f,p):null}return new Yl(u.type,u,f)}evaluate(e){let n=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Fl(n,["string","array"]))throw new Ci(`Expected first argument to be of type array or string, but found ${Fr(Hr(n))} instead.`);if(this.endIndex){let f=this.endIndex.evaluate(e);return n.slice(u,f)}return n.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var w_=Yl;function xc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function T_(r,e,n,u){return u.compare(e,n)===0}function Ls(r,e,n){let u=r!=="=="&&r!=="!=";return class $K{constructor(p,_,g){this.type=Zt,this.lhs=p,this.rhs=_,this.collator=g,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");let g=p[0],b=_.parse(p[1],1,Ht);if(!b)return null;if(!xc(g,b.type))return _.concat(1).error(`"${g}" comparisons are not supported for type '${Fr(b.type)}'.`);let w=_.parse(p[2],2,Ht);if(!w)return null;if(!xc(g,w.type))return _.concat(2).error(`"${g}" comparisons are not supported for type '${Fr(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return _.error(`Cannot compare types '${Fr(b.type)}' and '${Fr(w.type)}'.`);u&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new Co(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new Co(b.type,[w])));let I=null;if(p.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(p[3],3,cn),!I)return null}return new $K(b,w,I)}evaluate(p){let _=this.lhs.evaluate(p),g=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){let b=Hr(_),w=Hr(g);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new Ci(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let b=Hr(_),w=Hr(g);if(b.kind!=="string"||w.kind!=="string")return e(p,_,g)}return this.collator?n(p,_,g,this.collator.evaluate(p)):e(p,_,g)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){let p=[r];return this.eachChild(_=>{p.push(_.serialize())}),p}}}let tx=Ls("==",function(r,e,n){return e===n},T_),rx=Ls("!=",function(r,e,n){return e!==n},function(r,e,n,u){return!T_(0,e,n,u)}),ix=Ls("<",function(r,e,n){return e<n},function(r,e,n,u){return u.compare(e,n)<0}),nx=Ls(">",function(r,e,n){return e>n},function(r,e,n,u){return u.compare(e,n)>0}),ox=Ls("<=",function(r,e,n){return e<=n},function(r,e,n,u){return u.compare(e,n)<=0}),E_=Ls(">=",function(r,e,n){return e>=n},function(r,e,n,u){return u.compare(e,n)>=0});class bc{constructor(e,n,u,f,p,_){this.type=Yt,this.number=e,this.locale=n,this.currency=u,this.unit=f,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let u=n.parse(e[1],1,ft);if(!u)return null;let f=e[2];if(typeof f!="object"||Array.isArray(f))return n.error("NumberFormat options argument must be an object.");let p=null;if(f.locale&&(p=n.parse(f.locale,1,Yt),!p))return null;let _=null;if(f.currency&&(_=n.parse(f.currency,1,Yt),!_))return null;let g=null;if(f.unit&&(g=n.parse(f.unit,1,Yt),!g))return null;let b=null;if(f["min-fraction-digits"]&&(b=n.parse(f["min-fraction-digits"],1,ft),!b))return null;let w=null;return f["max-fraction-digits"]&&(w=n.parse(f["max-fraction-digits"],1,ft),!w)?null:new bc(u,p,_,g,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ks{constructor(e){this.type=ft,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let u=n.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Fr(u.type)} instead.`):new ks(u):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Ci(`Expected value to be of type string or array, but found ${Fr(Hr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}let S_={"==":tx,"!=":rx,">":nx,"<":ix,">=":E_,"<=":ox,array:Co,at:Q0,boolean:Co,case:b_,coalesce:sd,collator:$l,format:aa,image:uc,in:vc,"index-of":x_,interpolate:io,"interpolate-hcl":io,"interpolate-lab":io,length:ks,let:v_,literal:Na,match:ex,number:Co,"number-format":bc,object:Co,slice:w_,step:Qf,string:Co,"to-boolean":Cs,"to-color":Cs,"to-number":Cs,"to-string":Cs,var:p_,within:fc};function I_(r,[e,n,u,f]){e=e.evaluate(r),n=n.evaluate(r),u=u.evaluate(r);let p=f?f.evaluate(r):1,_=c_(e,n,u,p);if(_)throw new Ci(_);return new Jr(e/255*p,n/255*p,u/255*p,p)}function Ro(r,e){return r in e}function wc(r,e){let n=e[r];return n===void 0?null:n}function En(r){return{type:r}}Po.register(S_,{error:[{kind:"error"},[Yt],(r,[e])=>{throw new Ci(e.evaluate(r))}],typeof:[Yt,[Ht],(r,[e])=>Fr(Hr(e.evaluate(r)))],"to-rgba":[wn(ft,4),[un],(r,[e])=>e.evaluate(r).toArray()],rgb:[un,[ft,ft,ft],I_],rgba:[un,[ft,ft,ft,ft],I_],has:{type:Zt,overloads:[[[Yt],(r,[e])=>Ro(e.evaluate(r),r.properties())],[[Yt,jn],(r,[e,n])=>Ro(e.evaluate(r),n.evaluate(r))]]},get:{type:Ht,overloads:[[[Yt],(r,[e])=>wc(e.evaluate(r),r.properties())],[[Yt,jn],(r,[e,n])=>wc(e.evaluate(r),n.evaluate(r))]]},"feature-state":[Ht,[Yt],(r,[e])=>wc(e.evaluate(r),r.featureState||{})],properties:[jn,[],r=>r.properties()],"geometry-type":[Yt,[],r=>r.geometryType()],id:[Ht,[],r=>r.id()],zoom:[ft,[],r=>r.globals.zoom],pitch:[ft,[],r=>r.globals.pitch||0],"distance-from-center":[ft,[],r=>r.distanceFromCenter()],"heatmap-density":[ft,[],r=>r.globals.heatmapDensity||0],"line-progress":[ft,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[ft,[],r=>r.globals.skyRadialProgress||0],accumulated:[Ht,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ft,En(ft),(r,e)=>{let n=0;for(let u of e)n+=u.evaluate(r);return n}],"*":[ft,En(ft),(r,e)=>{let n=1;for(let u of e)n*=u.evaluate(r);return n}],"-":{type:ft,overloads:[[[ft,ft],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[ft],(r,[e])=>-e.evaluate(r)]]},"/":[ft,[ft,ft],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[ft,[ft,ft],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[ft,[],()=>Math.LN2],pi:[ft,[],()=>Math.PI],e:[ft,[],()=>Math.E],"^":[ft,[ft,ft],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[ft,[ft],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[ft,[ft],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[ft,[ft],(r,[e])=>Math.log(e.evaluate(r))],log2:[ft,[ft],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[ft,[ft],(r,[e])=>Math.sin(e.evaluate(r))],cos:[ft,[ft],(r,[e])=>Math.cos(e.evaluate(r))],tan:[ft,[ft],(r,[e])=>Math.tan(e.evaluate(r))],asin:[ft,[ft],(r,[e])=>Math.asin(e.evaluate(r))],acos:[ft,[ft],(r,[e])=>Math.acos(e.evaluate(r))],atan:[ft,[ft],(r,[e])=>Math.atan(e.evaluate(r))],min:[ft,En(ft),(r,e)=>Math.min(...e.map(n=>n.evaluate(r)))],max:[ft,En(ft),(r,e)=>Math.max(...e.map(n=>n.evaluate(r)))],abs:[ft,[ft],(r,[e])=>Math.abs(e.evaluate(r))],round:[ft,[ft],(r,[e])=>{let n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[ft,[ft],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[ft,[ft],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Zt,[Yt,Ht],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[Zt,[Ht],(r,[e])=>r.id()===e.value],"filter-type-==":[Zt,[Yt],(r,[e])=>r.geometryType()===e.value],"filter-<":[Zt,[Yt,Ht],(r,[e,n])=>{let u=r.properties()[e.value],f=n.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Zt,[Ht],(r,[e])=>{let n=r.id(),u=e.value;return typeof n==typeof u&&n<u}],"filter->":[Zt,[Yt,Ht],(r,[e,n])=>{let u=r.properties()[e.value],f=n.value;return typeof u==typeof f&&u>f}],"filter-id->":[Zt,[Ht],(r,[e])=>{let n=r.id(),u=e.value;return typeof n==typeof u&&n>u}],"filter-<=":[Zt,[Yt,Ht],(r,[e,n])=>{let u=r.properties()[e.value],f=n.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Zt,[Ht],(r,[e])=>{let n=r.id(),u=e.value;return typeof n==typeof u&&n<=u}],"filter->=":[Zt,[Yt,Ht],(r,[e,n])=>{let u=r.properties()[e.value],f=n.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Zt,[Ht],(r,[e])=>{let n=r.id(),u=e.value;return typeof n==typeof u&&n>=u}],"filter-has":[Zt,[Ht],(r,[e])=>e.value in r.properties()],"filter-has-id":[Zt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Zt,[wn(Yt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Zt,[wn(Ht)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Zt,[Yt,wn(Ht)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Zt,[Yt,wn(Ht)],(r,[e,n])=>function(u,f,p,_){for(;p<=_;){let g=p+_>>1;if(f[g]===u)return!0;f[g]>u?_=g-1:p=g+1}return!1}(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Zt,overloads:[[[Zt,Zt],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[En(Zt),(r,e)=>{for(let n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[En(Zt),(r,e)=>{for(let n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[Zt,[Zt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Zt,[Yt],(r,[e])=>{let n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[Yt,[Yt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Yt,[Yt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Yt,En(Ht),(r,e)=>e.map(n=>Vl(n.evaluate(r))).join("")],"resolved-locale":[Yt,[cn],(r,[e])=>e.evaluate(r).resolvedLocale()]});var Jl=S_;function A_(r){return{result:"success",value:r}}function $a(r){return{result:"error",value:r}}function Bs(r){return r["property-type"]==="data-driven"}function Tc(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Ec(r){return!!r.expression&&r.expression.interpolated}function or(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Ql(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function O_(r){return r}function Sc(r,e){let n=e.type==="color",u=r.stops&&typeof r.stops[0][0]=="object",f=u||!(u||r.property!==void 0),p=r.type||(Ec(e)?"exponential":"interval");if(n&&((r=Ao({},r)).stops&&(r.stops=r.stops.map(w=>[w[0],Jr.parse(w[1])])),r.default=Jr.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!od[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,g,b;if(p==="exponential")_=Do;else if(p==="interval")_=Ic;else if(p==="categorical"){_=C_,g=Object.create(null);for(let w of r.stops)g[w[0]]=w[1];b=typeof r.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=P_}if(u){let w={},I=[];for(let L=0;L<r.stops.length;L++){let k=r.stops[L],U=k[0].zoom;w[U]===void 0&&(w[U]={zoom:U,type:r.type,property:r.property,default:r.default,stops:[]},I.push(U)),w[U].stops.push([k[0].value,k[1]])}let O=[];for(let L of I)O.push([w[L].zoom,Sc(w[L],e)]);let M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:io.interpolationFactor.bind(void 0,M),zoomStops:O.map(L=>L[0]),evaluate:({zoom:L},k)=>Do({stops:O,base:r.base},e,L).evaluate(L,k)}}if(f){let w=p==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:io.interpolationFactor.bind(void 0,w),zoomStops:r.stops.map(I=>I[0]),evaluate:({zoom:I})=>_(r,e,I,g,b)}}return{kind:"source",evaluate(w,I){let O=I&&I.properties?I.properties[r.property]:void 0;return O===void 0?zs(r.default,e.default):_(r,e,O,g,b)}}}function zs(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function C_(r,e,n,u,f){return zs(typeof n===f?u[n]:void 0,r.default,e.default)}function Ic(r,e,n){if(or(n)!=="number")return zs(r.default,e.default);let u=r.stops.length;if(u===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[u-1][0])return r.stops[u-1][1];let f=pc(r.stops.map(p=>p[0]),n);return r.stops[f][1]}function Do(r,e,n){let u=r.base!==void 0?r.base:1;if(or(n)!=="number")return zs(r.default,e.default);let f=r.stops.length;if(f===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[f-1][0])return r.stops[f-1][1];let p=pc(r.stops.map(I=>I[0]),n),_=function(I,O,M,L){let k=L-M,U=I-M;return k===0?0:O===1?U/k:(Math.pow(O,U)-1)/(Math.pow(O,k)-1)}(n,u,r.stops[p][0],r.stops[p+1][0]),g=r.stops[p][1],b=r.stops[p+1][1],w=Zl[e.type]||O_;if(r.colorSpace&&r.colorSpace!=="rgb"){let I=od[r.colorSpace];w=(O,M)=>I.reverse(I.interpolate(I.forward(O),I.forward(M),_))}return typeof g.evaluate=="function"?{evaluate(...I){let O=g.evaluate.apply(void 0,I),M=b.evaluate.apply(void 0,I);if(O!==void 0&&M!==void 0)return w(O,M,_)}}:w(g,b,_)}function P_(r,e,n){return e.type==="color"?n=Jr.parse(n):e.type==="formatted"?n=Xi.fromString(n.toString()):e.type==="resolvedImage"?n=Tn.fromString(n.toString()):or(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),zs(n,r.default,e.default)}class Ac{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new Gf,this._defaultValue=n?function(u){return u.type==="color"&&(Ql(u.default)||Array.isArray(u.default))?new Jr(0,0,0,0):u.type==="color"?Jr.parse(u.default)||null:u.default===void 0?null:u.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,u,f,p,_,g,b){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,u,f,p,_,g,b){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Ci(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Fs(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Jl}function Ns(r,e){let n=new Yf(Jl,[],e?function(f){let p={color:un,string:Yt,number:ft,enum:Yt,boolean:Zt,formatted:Bl,resolvedImage:Fa};return f.type==="array"?wn(p[f.value]||Ht,f.length):p[f.type]}(e):void 0),u=n.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?A_(new Ac(u,e)):$a(n.errors)}class fd{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!qo(n.expression)}evaluateWithoutErrorHandling(e,n,u,f,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,u,f,p,_)}evaluate(e,n,u,f,p,_){return this._styleExpression.evaluate(e,n,u,f,p,_)}}class eu{constructor(e,n,u,f){this.kind=e,this.zoomStops=u,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!qo(n.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,n,u,f,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,u,f,p,_)}evaluate(e,n,u,f,p,_){return this._styleExpression.evaluate(e,n,u,f,p,_)}interpolationFactor(e,n,u){return this.interpolationType?io.interpolationFactor(this.interpolationType,e,n,u):0}}function tu(r,e){if((r=Ns(r,e)).result==="error")return r;let n=r.value.expression,u=Rs(n);if(!u&&!Bs(e))return $a([new to("","data expressions not supported")]);let f=ja(n,["zoom","pitch","distance-from-center"]);if(!f&&!Tc(e))return $a([new to("","zoom expressions not supported")]);let p=Cc(n);return p||f?p instanceof to?$a([p]):p instanceof io&&!Ec(e)?$a([new to("",'"interpolate" expressions cannot be used with this property')]):A_(p?new eu(u?"camera":"composite",r.value,p.labels,p instanceof io?p.interpolation:void 0):new fd(u?"constant":"source",r.value)):$a([new to("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Oc{constructor(e,n){this._parameters=e,this._specification=n,Ao(this,Sc(this._parameters,this._specification))}static deserialize(e){return new Oc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Cc(r){let e=null;if(r instanceof v_)e=Cc(r.result);else if(r instanceof sd){for(let n of r.args)if(e=Cc(n),e)break}else(r instanceof Qf||r instanceof io)&&r.input instanceof Po&&r.input.name==="zoom"&&(e=r);return e instanceof to||r.eachChild(n=>{let u=Cc(n);u instanceof to?e=u:!e&&u?e=new to("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&u&&e!==u&&(e=new to("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class dt{constructor(e,n,u,f){this.message=(e?`${e}: `:"")+u,f&&(this.identifier=f),n!=null&&n.__line__&&(this.line=n.__line__)}}function Vn(r){let e=r.key,n=r.value,u=r.valueSpec||{},f=r.objectElementValidators||{},p=r.style,_=r.styleSpec,g=[],b=or(n);if(b!=="object")return[new dt(e,n,`object expected, ${b} found`)];for(let w in n){let I=w.split(".")[0],O;f[I]?O=f[I]:u[I]?O=Li:f["*"]?O=f["*"]:u["*"]&&(O=Li),O?g=g.concat(O({key:(e&&`${e}.`)+w,value:n[w],valueSpec:u[I]||u["*"],style:p,styleSpec:_,object:n,objectKey:w},n)):g.push(new dt(e,n[w],`unknown property "${w}"`))}for(let w in u)f[w]||u[w].required&&u[w].default===void 0&&n[w]===void 0&&g.push(new dt(e,n,`missing required property "${w}"`));return g}function M_(r){let e=r.value,n=r.valueSpec,u=r.style,f=r.styleSpec,p=r.key,_=r.arrayElementValidator||Li;if(or(e)!=="array")return[new dt(p,e,`array expected, ${or(e)} found`)];if(n.length&&e.length!==n.length)return[new dt(p,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new dt(p,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let g={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};f.$version<7&&(g.function=n.function),or(n.value)==="object"&&(g=n.value);let b=[];for(let w=0;w<e.length;w++)b=b.concat(_({array:e,arrayIndex:w,value:e[w],valueSpec:g,style:u,styleSpec:f,key:`${p}[${w}]`}));return b}function ru(r){let e=r.key,n=r.value,u=r.valueSpec,f=or(n);if(f==="number"&&n!=n&&(f="NaN"),f!=="number")return[new dt(e,n,`number expected, ${f} found`)];if("minimum"in u){let p=u.minimum;if(or(u.minimum)==="array"&&(p=u.minimum[r.arrayIndex]),n<p)return[new dt(e,n,`${n} is less than the minimum value ${p}`)]}if("maximum"in u){let p=u.maximum;if(or(u.maximum)==="array"&&(p=u.maximum[r.arrayIndex]),n>p)return[new dt(e,n,`${n} is greater than the maximum value ${p}`)]}return[]}function iu(r){let e=r.valueSpec,n=ni(r.value.type),u,f,p,_={},g=n!=="categorical"&&r.value.property===void 0,b=!g,w=or(r.value.stops)==="array"&&or(r.value.stops[0])==="array"&&or(r.value.stops[0][0])==="object",I=Vn({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(L){if(n==="identity")return[new dt(L.key,L.value,'identity function may not have a "stops" property')];let k=[],U=L.value;return k=k.concat(M_({key:L.key,value:U,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:O})),or(U)==="array"&&U.length===0&&k.push(new dt(L.key,U,"array must have at least one stop")),k},default:function(L){return Li({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return n==="identity"&&g&&I.push(new dt(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||I.push(new dt(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Ec(r.valueSpec)&&I.push(new dt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(b&&!Bs(r.valueSpec)?I.push(new dt(r.key,r.value,"property functions not supported")):g&&!Tc(r.valueSpec)&&I.push(new dt(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!w||r.value.property!==void 0||I.push(new dt(r.key,r.value,'"property" property is required')),I;function O(L){let k=[],U=L.value,G=L.key;if(or(U)!=="array")return[new dt(G,U,`array expected, ${or(U)} found`)];if(U.length!==2)return[new dt(G,U,`array length 2 expected, length ${U.length} found`)];if(w){if(or(U[0])!=="object")return[new dt(G,U,`object expected, ${or(U[0])} found`)];if(U[0].zoom===void 0)return[new dt(G,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new dt(G,U,"object stop key must have value")];let Y=ni(U[0].zoom);if(typeof Y!="number")return[new dt(G,U[0].zoom,"stop zoom values must be numbers")];if(p&&p>Y)return[new dt(G,U[0].zoom,"stop zoom values must appear in ascending order")];Y!==p&&(p=Y,f=void 0,_={}),k=k.concat(Vn({key:`${G}[0]`,value:U[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:ru,value:M}}))}else k=k.concat(M({key:`${G}[0]`,value:U[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},U));return Fs(wi(U[1]))?k.concat([new dt(`${G}[1]`,U[1],"expressions are not allowed in function stops.")]):k.concat(Li({key:`${G}[1]`,value:U[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function M(L,k){let U=or(L.value),G=ni(L.value),Y=L.value!==null?L.value:k;if(u){if(U!==u)return[new dt(L.key,Y,`${U} stop domain type must match previous stop domain type ${u}`)]}else u=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new dt(L.key,Y,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&n!=="categorical"){let ae=`number expected, ${U} found`;return Bs(e)&&n===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new dt(L.key,Y,ae)]}return n!=="categorical"||U!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?n!=="categorical"&&U==="number"&&typeof G=="number"&&typeof f=="number"&&f!==void 0&&G<f?[new dt(L.key,Y,"stop domain values must appear in ascending order")]:(f=G,n==="categorical"&&G in _?[new dt(L.key,Y,"stop domain values must be unique")]:(_[G]=!0,[])):[new dt(L.key,Y,`integer expected, found ${String(G)}`)]}}function Ti(r){let e=(r.expressionContext==="property"?tu:Ns)(wi(r.value),r.valueSpec);if(e.result==="error")return e.value.map(u=>new dt(`${r.key}${u.key}`,r.value,u.message));let n=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new dt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!qo(n))return[new dt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter")return nu(n,r);if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!ja(n,["zoom","feature-state"]))return[new dt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Rs(n))return[new dt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nu(r,e){let n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(let f of e.valueSpec.expression.parameters)n.delete(f);if(n.size===0)return[];let u=[];return r instanceof Po&&n.has(r.name)?[new dt(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(f=>{u.push(...nu(f,e))}),u)}function Pc(r){let e=r.key,n=r.value,u=r.valueSpec,f=[];return Array.isArray(u.values)?u.values.indexOf(ni(n))===-1&&f.push(new dt(e,n,`expected one of [${u.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(u.values).indexOf(ni(n))===-1&&f.push(new dt(e,n,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(n)} found`)),f}function dd(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(let e of r.slice(1))if(!dd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Mc(r,e="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};dd(r)||(r=js(r));let n=r,u=!0;try{u=function(w){if(!Us(w))return w;let I=wi(w);return qc(I),I=q_(I),I}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let f=Re[`filter_${e}`],p=Ns(u,f),_=null;if(p.result==="error")throw new Error(p.value.map(w=>`${w.key}: ${w.message}`).join(", "));_=(w,I,O)=>p.value.evaluate(w,I,{},O);let g=null,b=null;if(u!==n){let w=Ns(n,f);if(w.result==="error")throw new Error(w.value.map(I=>`${I.key}: ${I.message}`).join(", "));g=(I,O,M,L,k)=>w.value.evaluate(I,O,{},M,void 0,void 0,L,k),b=!Rs(w.value.expression)}return{filter:_,dynamicFilter:g||void 0,needGeometry:R_(u),needFeature:!!b}}function q_(r){if(!Array.isArray(r))return r;let e=function(n){if(pd.has(n[0])){for(let u=1;u<n.length;u++)if(Us(n[u]))return!0}return n}(r);return e===!0?e:e.map(n=>q_(n))}function qc(r){let e=!1,n=[];if(r[0]==="case"){for(let u=1;u<r.length-1;u+=2)e=e||Us(r[u]),n.push(r[u+1]);n.push(r[r.length-1])}else if(r[0]==="match"){e=e||Us(r[1]);for(let u=2;u<r.length-1;u+=2)n.push(r[u+1]);n.push(r[r.length-1])}else if(r[0]==="step"){e=e||Us(r[1]);for(let u=1;u<r.length-1;u+=2)n.push(r[u+1])}e&&(r.length=0,r.push("any",...n));for(let u=1;u<r.length;u++)qc(r[u])}function Us(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<r.length;n++)if(Us(r[n]))return!0;return!1}let pd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ax(r,e){return r<e?-1:r>e?1:0}function R_(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(R_(r[e]))return!0;return!1}function js(r){if(!r)return!0;let e=r[0];return r.length<=1?e!=="any":e==="=="?md(r[1],r[2],"=="):e==="!="?Rc(md(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?md(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(js))):e==="all"?["all"].concat(r.slice(1).map(js)):e==="none"?["all"].concat(r.slice(1).map(js).map(Rc)):e==="in"?_d(r[1],r.slice(2)):e==="!in"?Rc(_d(r[1],r.slice(2))):e==="has"?yd(r[1]):e==="!has"?Rc(yd(r[1])):e!=="within"||r;var n}function md(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function _d(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",r,["literal",e.sort(ax)]]:["filter-in-small",r,["literal",e]]}}function yd(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Rc(r){return["!",r]}function ou(r){return dd(wi(r.value))?Ti(Ao({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):au(r)}function au(r){let e=r.value,n=r.key;if(or(e)!=="array")return[new dt(n,e,`array expected, ${or(e)} found`)];let u=r.styleSpec,f,p=[];if(e.length<1)return[new dt(n,e,"filter array must have at least 1 element")];switch(p=p.concat(Pc({key:`${n}[0]`,value:e[0],valueSpec:u.filter_operator,style:r.style,styleSpec:r.styleSpec})),ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ni(e[1])==="$type"&&p.push(new dt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new dt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=or(e[1]),f!=="string"&&p.push(new dt(`${n}[1]`,e[1],`string expected, ${f} found`)));for(let _=2;_<e.length;_++)f=or(e[_]),ni(e[1])==="$type"?p=p.concat(Pc({key:`${n}[${_}]`,value:e[_],valueSpec:u.geometry_type,style:r.style,styleSpec:r.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&p.push(new dt(`${n}[${_}]`,e[_],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)p=p.concat(au({key:`${n}[${_}]`,value:e[_],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":f=or(e[1]),e.length!==2?p.push(new dt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&p.push(new dt(`${n}[1]`,e[1],`string expected, ${f} found`));break;case"within":f=or(e[1]),e.length!==2?p.push(new dt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="object"&&p.push(new dt(`${n}[1]`,e[1],`object expected, ${f} found`))}return p}function gd(r,e){let n=r.key,u=r.style,f=r.styleSpec,p=r.value,_=r.objectKey,g=f[`${e}_${r.layerType}`];if(!g)return[];let b=_.match(/^(.*)-transition$/);if(e==="paint"&&b&&g[b[1]]&&g[b[1]].transition)return Li({key:n,value:p,valueSpec:f.transition,style:u,styleSpec:f});let w=r.valueSpec||g[_];if(!w)return[new dt(n,p,`unknown property "${_}"`)];let I;if(or(p)==="string"&&Bs(w)&&!w.tokens&&(I=/^{([^}]+)}$/.exec(p))){let M=`\`{ "type": "identity", "property": ${I?JSON.stringify(I[1]):'"_"'} }\``;return[new dt(n,p,`"${_}" does not support interpolation syntax
Use an identity property function instead: ${M}.`)]}let O=[];return r.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&O.push(new dt(n,p,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Ql(wi(p))&&ni(p.type)==="identity"&&O.push(new dt(n,p,'"text-font" does not support identity functions'))),O.concat(Li({key:r.key,value:p,valueSpec:w,style:u,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:_}))}function D_(r){return gd(r,"paint")}function vd(r){return gd(r,"layout")}function L_(r){let e=[],n=r.value,u=r.key,f=r.style,p=r.styleSpec;n.type||n.ref||e.push(new dt(u,n,'either "type" or "ref" is required'));let _=ni(n.type),g=ni(n.ref);if(n.id){let b=ni(n.id);for(let w=0;w<r.arrayIndex;w++){let I=f.layers[w];ni(I.id)===b&&e.push(new dt(u,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&e.push(new dt(u,n[w],`"${w}" is prohibited for ref layers`))}),f.layers.forEach(w=>{ni(w.id)===g&&(b=w)}),b?b.ref?e.push(new dt(u,n.ref,"ref cannot reference another ref layer")):_=ni(b.type):typeof g=="string"&&e.push(new dt(u,n.ref,`ref layer "${g}" not found`))}else if(_!=="background"&&_!=="sky")if(n.source){let b=f.sources&&f.sources[n.source],w=b&&ni(b.type);b?w==="vector"&&_==="raster"?e.push(new dt(u,n.source,`layer "${n.id}" requires a raster source`)):w==="raster"&&_!=="raster"?e.push(new dt(u,n.source,`layer "${n.id}" requires a vector source`)):w!=="vector"||n["source-layer"]?w==="raster-dem"&&_!=="hillshade"?e.push(new dt(u,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||w==="geojson"&&b.lineMetrics||e.push(new dt(u,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new dt(u,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new dt(u,n.source,`source "${n.source}" not found`))}else e.push(new dt(u,n,'missing required property "source"'));return e=e.concat(Vn({key:u,value:n,valueSpec:p.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Li({key:`${u}.type`,value:n.type,valueSpec:p.layer.type,style:r.style,styleSpec:r.styleSpec,object:n,objectKey:"type"}),filter:b=>ou(Ao({layerType:_},b)),layout:b=>Vn({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>vd(Ao({layerType:_},w))}}),paint:b=>Vn({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>D_(Ao({layerType:_},w))}})}})),e}function sa(r){let e=r.value,n=r.key,u=or(e);return u!=="string"?[new dt(n,e,`string expected, ${u} found`)]:[]}let k_={promoteId:function({key:r,value:e}){if(or(e)==="string")return sa({key:r,value:e});{let n=[];for(let u in e)n.push(...sa({key:`${r}.${u}`,value:e[u]}));return n}}};function B_(r){let e=r.value,n=r.key,u=r.styleSpec,f=r.style;if(!e.type)return[new dt(n,e,'"type" is required')];let p=ni(e.type),_;switch(p){case"vector":case"raster":case"raster-dem":return _=Vn({key:n,value:e,valueSpec:u[`source_${p.replace("-","_")}`],style:r.style,styleSpec:u,objectElementValidators:k_}),_;case"geojson":if(_=Vn({key:n,value:e,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:k_}),e.cluster)for(let g in e.clusterProperties){let[b,w]=e.clusterProperties[g],I=typeof b=="string"?[b,["accumulated"],["get",g]]:b;_.push(...Ti({key:`${n}.${g}.map`,value:w,expressionContext:"cluster-map"})),_.push(...Ti({key:`${n}.${g}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return _;case"video":return Vn({key:n,value:e,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Vn({key:n,value:e,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new dt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pc({key:`${n}.type`,value:e.type,valueSpec:{values:sx(u)},style:f,styleSpec:u})}}function sx(r){return r.source.reduce((e,n)=>{let u=r[n];return u.type.type==="enum"&&(e=e.concat(Object.keys(u.type.values))),e},[])}function z_(r){let e=r.value,n=r.styleSpec,u=n.light,f=r.style,p=[],_=or(e);if(e===void 0)return p;if(_!=="object")return p=p.concat([new dt("light",e,`object expected, ${_} found`)]),p;for(let g in e){let b=g.match(/^(.*)-transition$/);p=p.concat(b&&u[b[1]]&&u[b[1]].transition?Li({key:g,value:e[g],valueSpec:n.transition,style:f,styleSpec:n}):u[g]?Li({key:g,value:e[g],valueSpec:u[g],style:f,styleSpec:n}):[new dt(g,e[g],`unknown property "${g}"`)])}return p}function xd(r){let e=r.value,n=r.key,u=r.style,f=r.styleSpec,p=f.terrain,_=[],g=or(e);if(e===void 0)return _;if(g!=="object")return _=_.concat([new dt("terrain",e,`object expected, ${g} found`)]),_;for(let b in e){let w=b.match(/^(.*)-transition$/);_=_.concat(w&&p[w[1]]&&p[w[1]].transition?Li({key:b,value:e[b],valueSpec:f.transition,style:u,styleSpec:f}):p[b]?Li({key:b,value:e[b],valueSpec:p[b],style:u,styleSpec:f}):[new dt(b,e[b],`unknown property "${b}"`)])}if(e.source){let b=u.sources&&u.sources[e.source],w=b&&ni(b.type);b?w!=="raster-dem"&&_.push(new dt(n,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):_.push(new dt(n,e.source,`source "${e.source}" not found`))}else _.push(new dt(n,e,'terrain is missing required property "source"'));return _}function F_(r){let e=r.value,n=r.style,u=r.styleSpec,f=u.fog,p=[],_=or(e);if(e===void 0)return p;if(_!=="object")return p=p.concat([new dt("fog",e,`object expected, ${_} found`)]),p;for(let g in e){let b=g.match(/^(.*)-transition$/);p=p.concat(b&&f[b[1]]&&f[b[1]].transition?Li({key:g,value:e[g],valueSpec:u.transition,style:n,styleSpec:u}):f[g]?Li({key:g,value:e[g],valueSpec:f[g],style:n,styleSpec:u}):[new dt(g,e[g],`unknown property "${g}"`)])}return p}let N_={"*":()=>[],array:M_,boolean:function(r){let e=r.value,n=r.key,u=or(e);return u!=="boolean"?[new dt(n,e,`boolean expected, ${u} found`)]:[]},number:ru,color:function(r){let e=r.key,n=r.value,u=or(n);return u!=="string"?[new dt(e,n,`color expected, ${u} found`)]:zf(n)===null?[new dt(e,n,`color expected, "${n}" found`)]:[]},enum:Pc,filter:ou,function:iu,layer:L_,object:Vn,source:B_,light:z_,terrain:xd,fog:F_,string:sa,formatted:function(r){return sa(r).length===0?[]:Ti(r)},resolvedImage:function(r){return sa(r).length===0?[]:Ti(r)},projection:function(r){let e=r.value,n=r.styleSpec,u=n.projection,f=r.style,p=[],_=or(e);if(_==="object")for(let g in e)p=p.concat(Li({key:g,value:e[g],valueSpec:u[g],style:f,styleSpec:n}));else _!=="string"&&(p=p.concat([new dt("projection",e,`object or string expected, ${_} found`)]));return p}};function Li(r){let e=r.value,n=r.valueSpec,u=r.styleSpec;return n.expression&&Ql(ni(e))?iu(r):n.expression&&Fs(wi(e))?Ti(r):n.type&&N_[n.type]?N_[n.type](r):Vn(Ao({},r,{valueSpec:n.type?u[n.type]:n}))}function lx(r){let e=r.value,n=r.key,u=sa(r);return u.length||(e.indexOf("{fontstack}")===-1&&u.push(new dt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&u.push(new dt(n,e,'"glyphs" url must include a "{range}" token'))),u}function U_(r,e=Re){return Sn(Li({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:lx,"*":()=>[]}}))}let ux=r=>Sn(D_(r)),cx=r=>Sn(vd(r));function Sn(r){return r.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function j_(r,e){let n=!1;if(e&&e.length)for(let u of e)r.fire(new Io(new Error(u.message))),n=!0;return n}var hx=no,$n=3;function no(r,e,n){var u=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var f=new Int32Array(this.arrayBuffer);r=f[0],this.d=(e=f[1])+2*(n=f[2]);for(var p=0;p<this.d*this.d;p++){var _=f[$n+p],g=f[$n+p+1];u.push(_===g?null:f.subarray(_,g))}var b=f[$n+u.length+1];this.keys=f.subarray(f[$n+u.length],b),this.bboxes=f.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)u.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=n,this.scale=e/r,this.uid=0;var I=n/e*r;this.min=-I,this.max=r+I}no.prototype.insert=function(r,e,n,u,f){this._forEachCell(e,n,u,f,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(f)},no.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},no.prototype._insertCell=function(r,e,n,u,f,p){this.cells[f].push(p)},no.prototype.query=function(r,e,n,u,f){var p=this.min,_=this.max;if(r<=p&&e<=p&&_<=n&&_<=u&&!f)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(r,e,n,u,this._queryCell,g,{},f),g},no.prototype._queryCell=function(r,e,n,u,f,p,_,g){var b=this.cells[f];if(b!==null)for(var w=this.keys,I=this.bboxes,O=0;O<b.length;O++){var M=b[O];if(_[M]===void 0){var L=4*M;(g?g(I[L+0],I[L+1],I[L+2],I[L+3]):r<=I[L+2]&&e<=I[L+3]&&n>=I[L+0]&&u>=I[L+1])?(_[M]=!0,p.push(w[M])):_[M]=!1}}},no.prototype._forEachCell=function(r,e,n,u,f,p,_,g){for(var b=this._convertToCellCoord(r),w=this._convertToCellCoord(e),I=this._convertToCellCoord(n),O=this._convertToCellCoord(u),M=b;M<=I;M++)for(var L=w;L<=O;L++){var k=this.d*L+M;if((!g||g(this._convertFromCellCoord(M),this._convertFromCellCoord(L),this._convertFromCellCoord(M+1),this._convertFromCellCoord(L+1)))&&f.call(this,r,e,n,u,k,p,_,g))return}},no.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},no.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},no.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=$n+this.cells.length+1+1,n=0,u=0;u<this.cells.length;u++)n+=this.cells[u].length;var f=new Int32Array(e+n+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var p=e,_=0;_<r.length;_++){var g=r[_];f[$n+_]=p,f.set(g,p),p+=g.length}return f[$n+r.length]=p,f.set(this.keys,p),f[$n+r.length+1]=p+=this.keys.length,f.set(this.bboxes,p),p+=this.bboxes.length,f.buffer};var Ga=Ge(hx);let Dc={};function yt(r,e,n={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),Dc[e]={klass:r,omit:n.omit||[]}}yt(Object,"Object"),Ga.serialize=function(r,e){let n=r.toArrayBuffer();return e&&e.push(n),{buffer:n}},Ga.deserialize=function(r){return new Ga(r.buffer)},Object.defineProperty(Ga,"name",{value:"Grid"}),yt(Ga,"Grid"),yt(Jr,"Color"),yt(Error,"Error"),yt(oa,"AJAXError"),yt(Tn,"ResolvedImage"),yt(Oc,"StylePropertyFunction"),yt(Ac,"StyleExpression",{omit:["_evaluator"]}),yt(eu,"ZoomDependentExpression"),yt(fd,"ZoomConstantExpression"),yt(Po,"CompoundExpression",{omit:["_evaluate"]});for(let r in Jl)Dc[Jl[r]._classRegistryKey]||yt(Jl[r],`Expression${r}`);function bd(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function wd(r){return v.ImageBitmap&&r instanceof v.ImageBitmap}function Vs(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(bd(r)||wd(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){let n=r;return e&&e.push(n.buffer),n}if(r instanceof v.ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){let n=[];for(let u of r)n.push(Vs(u,e));return n}if(typeof r=="object"){let n=r.constructor,u=n._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);let f=n.serialize?n.serialize(r,e):{};if(!n.serialize){for(let p in r)r.hasOwnProperty(p)&&(Dc[u].omit.indexOf(p)>=0||(f[p]=Vs(r[p],e)));r instanceof Error&&(f.message=r.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof r)}function Wa(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||bd(r)||wd(r)||ArrayBuffer.isView(r)||r instanceof v.ImageData)return r;if(Array.isArray(r))return r.map(Wa);if(typeof r=="object"){let e=r.$name||"Object",{klass:n}=Dc[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(r);let u=Object.create(n.prototype);for(let f of Object.keys(r))f!=="$name"&&(u[f]=Wa(r[f]));return u}throw new Error("can't deserialize object of type "+typeof r)}let ht={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Td(r){for(let e of r)if(Ed(e.charCodeAt(0)))return!0;return!1}function fx(r){for(let e of r)if(!V_(e.charCodeAt(0)))return!1;return!0}function V_(r){return!(ht.Arabic(r)||ht["Arabic Supplement"](r)||ht["Arabic Extended-A"](r)||ht["Arabic Presentation Forms-A"](r)||ht["Arabic Presentation Forms-B"](r))}function Ed(r){return!(r!==746&&r!==747&&(r<4352||!(ht["Bopomofo Extended"](r)||ht.Bopomofo(r)||ht["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ht["CJK Compatibility Ideographs"](r)||ht["CJK Compatibility"](r)||ht["CJK Radicals Supplement"](r)||ht["CJK Strokes"](r)||!(!ht["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ht["CJK Unified Ideographs Extension A"](r)||ht["CJK Unified Ideographs"](r)||ht["Enclosed CJK Letters and Months"](r)||ht["Hangul Compatibility Jamo"](r)||ht["Hangul Jamo Extended-A"](r)||ht["Hangul Jamo Extended-B"](r)||ht["Hangul Jamo"](r)||ht["Hangul Syllables"](r)||ht.Hiragana(r)||ht["Ideographic Description Characters"](r)||ht.Kanbun(r)||ht["Kangxi Radicals"](r)||ht["Katakana Phonetic Extensions"](r)||ht.Katakana(r)&&r!==12540||!(!ht["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ht["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ht["Unified Canadian Aboriginal Syllabics"](r)||ht["Unified Canadian Aboriginal Syllabics Extended"](r)||ht["Vertical Forms"](r)||ht["Yijing Hexagram Symbols"](r)||ht["Yi Syllables"](r)||ht["Yi Radicals"](r))))}function $_(r){return!(Ed(r)||function(e){return!!(ht["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ht["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ht["Letterlike Symbols"](e)||ht["Number Forms"](e)||ht["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ht["Control Pictures"](e)&&e!==9251||ht["Optical Character Recognition"](e)||ht["Enclosed Alphanumerics"](e)||ht["Geometric Shapes"](e)||ht["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ht["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ht["CJK Symbols and Punctuation"](e)||ht.Katakana(e)||ht["Private Use Area"](e)||ht["CJK Compatibility Forms"](e)||ht["Small Form Variants"](e)||ht["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function G_(r){return r>=1424&&r<=2303||ht["Arabic Presentation Forms-A"](r)||ht["Arabic Presentation Forms-B"](r)}function dx(r,e){return!(!e&&G_(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ht.Khmer(r))}function px(r){for(let e of r)if(G_(e.charCodeAt(0)))return!0;return!1}let Sd="deferred",Id="loading",Ad="loaded",$s=null,d="unavailable",s=null,h=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(d="error"),$s&&$s(r)};function m(){y.fire(new za("pluginStateChange",{pluginStatus:d,pluginURL:s}))}let y=new kl,x=function(){return d},T=function(){if(d!==Sd||!s)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=Id,m(),s&&Ss({url:s},r=>{r?h(r):(d=Ad,m())})},E={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===Ad||E.applyArabicShaping!=null,isLoading:()=>d===Id,setState(r){d=r.pluginStatus,s=r.pluginURL},isParsed:()=>E.applyArabicShaping!=null&&E.processBidirectionalText!=null&&E.processStyledBidirectionalText!=null,getPluginURL:()=>s};class A{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,u){for(let f of n)if(!dx(f.charCodeAt(0),u))return!1;return!0}(e,E.isLoaded())}}class R{constructor(e,n){this.property=e,this.value=n,this.expression=function(u,f){if(Ql(u))return new Oc(u,f);if(Fs(u)){let p=tu(u,f);if(p.result==="error")throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=u;return typeof u=="string"&&f.type==="color"&&(p=Jr.parse(u)),{kind:"constant",evaluate:()=>p}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,u){return this.property.possiblyEvaluate(this,e,n,u)}}class q{constructor(e){this.property=e,this.value=new R(e,void 0)}transitioned(e,n){return new $(this.property,this.value,n,vt({},e.transition,this.transition),e.now)}untransitioned(){return new $(this.property,this.value,null,{},0)}}class F{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return sn(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new q(this._values[e].property)),this._values[e].value=new R(this._values[e].property,n===null?void 0:sn(n))}getTransition(e){return sn(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new q(this._values[e].property)),this._values[e].transition=sn(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let u=this.getValue(n);u!==void 0&&(e[n]=u);let f=this.getTransition(n);f!==void 0&&(e[`${n}-transition`]=f)}return e}transitioned(e,n){let u=new Z(this._properties);for(let f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(e,n._values[f]);return u}untransitioned(){let e=new Z(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ${constructor(e,n,u,f,p){let _=f.delay||0,g=f.duration||0;p=p||0,this.property=e,this.value=n,this.begin=p+_,this.end=this.begin+g,e.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(e,n,u){let f=e.now||0,p=this.value.possiblyEvaluate(e,n,u),_=this.prior;if(_){if(f>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(f<this.begin)return _.possiblyEvaluate(e,n,u);{let g=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,n,u),p,di(g))}}return p}}class Z{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,u){let f=new K(this._properties);for(let p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(e,n,u);return f}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class X{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return sn(this._values[e].value)}setValue(e,n){this._values[e]=new R(this._values[e].property,n===null?void 0:sn(n))}serialize(){let e={};for(let n of Object.keys(this._values)){let u=this.getValue(n);u!==void 0&&(e[n]=u)}return e}possiblyEvaluate(e,n,u){let f=new K(this._properties);for(let p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(e,n,u);return f}}class H{constructor(e,n,u){this.property=e,this.value=n,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,u,f){return this.property.evaluate(this.value,this.parameters,e,n,u,f)}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class N{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,u){let f=Zl[this.specification.type];return f?f(e,n,u):e}}class W{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,u,f){return new H(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},u,f)}:e.expression,n)}interpolate(e,n,u){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new H(this,{kind:"constant",value:void 0},e.parameters);let f=Zl[this.specification.type];return f?new H(this,{kind:"constant",value:f(e.value.value,n.value.value,u)},e.parameters):e}evaluate(e,n,u,f,p,_){return e.kind==="constant"?e.value:e.evaluate(n,u,f,p,_)}}class Q{constructor(e){this.specification=e}possiblyEvaluate(e,n,u,f){return!!e.expression.evaluate(n,null,{},u,f)}interpolate(){return!1}}class ee{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new A(0,{});for(let u in e){let f=e[u];f.specification.overridable&&this.overridableProperties.push(u);let p=this.defaultPropertyValues[u]=new R(f,void 0),_=this.defaultTransitionablePropertyValues[u]=new q(f);this.defaultTransitioningPropertyValues[u]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(n)}}}function he(r,e){return 256*(r=Ne(Math.floor(r),0,255))+Ne(Math.floor(e),0,255)}yt(W,"DataDrivenProperty"),yt(N,"DataConstantProperty"),yt(Q,"ColorRampProperty");let de={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fe{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ve{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ye(r,e=1){let n=0,u=0;return{members:r.map(f=>{let p=de[f.type].BYTES_PER_ELEMENT,_=n=Se(n,Math.max(e,p)),g=f.components||1;return u=Math.max(u,p),n+=p*g,{name:f.name,type:f.type,components:g,offset:_}}),size:Se(n,Math.max(u,e)),alignment:e}}function Se(r,e){return Math.ceil(r/e)*e}class Je extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let u=this.length;return this.resize(u+1),this.emplace(u,e,n)}emplace(e,n,u){let f=2*e;return this.int16[f+0]=n,this.int16[f+1]=u,e}}Je.prototype.bytesPerElement=4,yt(Je,"StructArrayLayout2i4");class we extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,u)}emplace(e,n,u,f){let p=3*e;return this.int16[p+0]=n,this.int16[p+1]=u,this.int16[p+2]=f,e}}we.prototype.bytesPerElement=6,yt(we,"StructArrayLayout3i6");class ze extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u,f){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,u,f)}emplace(e,n,u,f,p){let _=4*e;return this.int16[_+0]=n,this.int16[_+1]=u,this.int16[_+2]=f,this.int16[_+3]=p,e}}ze.prototype.bytesPerElement=8,yt(ze,"StructArrayLayout4i8");class Oe extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,u,f,p,_,g)}emplace(e,n,u,f,p,_,g,b){let w=6*e,I=12*e,O=3*e;return this.int16[w+0]=n,this.int16[w+1]=u,this.uint8[I+4]=f,this.uint8[I+5]=p,this.uint8[I+6]=_,this.uint8[I+7]=g,this.float32[O+2]=b,e}}Oe.prototype.bytesPerElement=12,yt(Oe,"StructArrayLayout2i4ub1f12");class Ye extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,f){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,u,f)}emplace(e,n,u,f,p){let _=4*e;return this.float32[_+0]=n,this.float32[_+1]=u,this.float32[_+2]=f,this.float32[_+3]=p,e}}Ye.prototype.bytesPerElement=16,yt(Ye,"StructArrayLayout4f16");class Ee extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,u,f,p)}emplace(e,n,u,f,p,_){let g=6*e,b=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=u,this.uint16[g+2]=f,this.uint16[g+3]=p,this.float32[b+2]=_,e}}Ee.prototype.bytesPerElement=12,yt(Ee,"StructArrayLayout4ui1f12");class Be extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u,f){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,u,f)}emplace(e,n,u,f,p){let _=4*e;return this.uint16[_+0]=n,this.uint16[_+1]=u,this.uint16[_+2]=f,this.uint16[_+3]=p,e}}Be.prototype.bytesPerElement=8,yt(Be,"StructArrayLayout4ui8");class et extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p,_){let g=this.length;return this.resize(g+1),this.emplace(g,e,n,u,f,p,_)}emplace(e,n,u,f,p,_,g){let b=6*e;return this.int16[b+0]=n,this.int16[b+1]=u,this.int16[b+2]=f,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=g,e}}et.prototype.bytesPerElement=12,yt(et,"StructArrayLayout6i12");class He extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p,_,g,b,w,I,O,M){let L=this.length;return this.resize(L+1),this.emplace(L,e,n,u,f,p,_,g,b,w,I,O,M)}emplace(e,n,u,f,p,_,g,b,w,I,O,M,L){let k=12*e;return this.int16[k+0]=n,this.int16[k+1]=u,this.int16[k+2]=f,this.int16[k+3]=p,this.uint16[k+4]=_,this.uint16[k+5]=g,this.uint16[k+6]=b,this.uint16[k+7]=w,this.int16[k+8]=I,this.int16[k+9]=O,this.int16[k+10]=M,this.int16[k+11]=L,e}}He.prototype.bytesPerElement=24,yt(He,"StructArrayLayout4i4ui4i24");class rt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p,_){let g=this.length;return this.resize(g+1),this.emplace(g,e,n,u,f,p,_)}emplace(e,n,u,f,p,_,g){let b=10*e,w=5*e;return this.int16[b+0]=n,this.int16[b+1]=u,this.int16[b+2]=f,this.float32[w+2]=p,this.float32[w+3]=_,this.float32[w+4]=g,e}}rt.prototype.bytesPerElement=20,yt(rt,"StructArrayLayout3i3f20");class Tt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Tt.prototype.bytesPerElement=4,yt(Tt,"StructArrayLayout1ul4");class Rt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p,_,g,b,w,I,O,M,L){let k=this.length;return this.resize(k+1),this.emplace(k,e,n,u,f,p,_,g,b,w,I,O,M,L)}emplace(e,n,u,f,p,_,g,b,w,I,O,M,L,k){let U=20*e,G=10*e;return this.int16[U+0]=n,this.int16[U+1]=u,this.int16[U+2]=f,this.int16[U+3]=p,this.int16[U+4]=_,this.float32[G+3]=g,this.float32[G+4]=b,this.float32[G+5]=w,this.float32[G+6]=I,this.int16[U+14]=O,this.uint32[G+8]=M,this.uint16[U+18]=L,this.uint16[U+19]=k,e}}Rt.prototype.bytesPerElement=40,yt(Rt,"StructArrayLayout5i4f1i1ul2ui40");class xt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,u,f,p,_,g)}emplace(e,n,u,f,p,_,g,b){let w=8*e;return this.int16[w+0]=n,this.int16[w+1]=u,this.int16[w+2]=f,this.int16[w+4]=p,this.int16[w+5]=_,this.int16[w+6]=g,this.int16[w+7]=b,e}}xt.prototype.bytesPerElement=16,yt(xt,"StructArrayLayout3i2i2i16");class Ot extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,u,f,p)}emplace(e,n,u,f,p,_){let g=4*e,b=8*e;return this.float32[g+0]=n,this.float32[g+1]=u,this.float32[g+2]=f,this.int16[b+6]=p,this.int16[b+7]=_,e}}Ot.prototype.bytesPerElement=16,yt(Ot,"StructArrayLayout2f1f2i16");class Xt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,f){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,u,f)}emplace(e,n,u,f,p){let _=12*e,g=3*e;return this.uint8[_+0]=n,this.uint8[_+1]=u,this.float32[g+1]=f,this.float32[g+2]=p,e}}Xt.prototype.bytesPerElement=12,yt(Xt,"StructArrayLayout2ub2f12");class Wt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,u)}emplace(e,n,u,f){let p=3*e;return this.float32[p+0]=n,this.float32[p+1]=u,this.float32[p+2]=f,e}}Wt.prototype.bytesPerElement=12,yt(Wt,"StructArrayLayout3f12");class wt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,u)}emplace(e,n,u,f){let p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=u,this.uint16[p+2]=f,e}}wt.prototype.bytesPerElement=6,yt(wt,"StructArrayLayout3ui6");class mr extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p,_,g,b,w,I,O,M,L,k,U,G,Y,ae,J,ie,ue){let se=this.length;return this.resize(se+1),this.emplace(se,e,n,u,f,p,_,g,b,w,I,O,M,L,k,U,G,Y,ae,J,ie,ue)}emplace(e,n,u,f,p,_,g,b,w,I,O,M,L,k,U,G,Y,ae,J,ie,ue,se){let Ie=30*e,Te=15*e,De=60*e;return this.int16[Ie+0]=n,this.int16[Ie+1]=u,this.int16[Ie+2]=f,this.float32[Te+2]=p,this.float32[Te+3]=_,this.uint16[Ie+8]=g,this.uint16[Ie+9]=b,this.uint32[Te+5]=w,this.uint32[Te+6]=I,this.uint32[Te+7]=O,this.uint16[Ie+16]=M,this.uint16[Ie+17]=L,this.uint16[Ie+18]=k,this.float32[Te+10]=U,this.float32[Te+11]=G,this.uint8[De+48]=Y,this.uint8[De+49]=ae,this.uint8[De+50]=J,this.uint32[Te+13]=ie,this.int16[Ie+28]=ue,this.uint8[De+58]=se,e}}mr.prototype.bytesPerElement=60,yt(mr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class xr extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p,_,g,b,w,I,O,M,L,k,U,G,Y,ae,J,ie,ue,se,Ie,Te,De,Qe,Ce,Ue,je,Xe){let nt=this.length;return this.resize(nt+1),this.emplace(nt,e,n,u,f,p,_,g,b,w,I,O,M,L,k,U,G,Y,ae,J,ie,ue,se,Ie,Te,De,Qe,Ce,Ue,je,Xe)}emplace(e,n,u,f,p,_,g,b,w,I,O,M,L,k,U,G,Y,ae,J,ie,ue,se,Ie,Te,De,Qe,Ce,Ue,je,Xe,nt){let Me=38*e,lt=19*e;return this.int16[Me+0]=n,this.int16[Me+1]=u,this.int16[Me+2]=f,this.float32[lt+2]=p,this.float32[lt+3]=_,this.int16[Me+8]=g,this.int16[Me+9]=b,this.int16[Me+10]=w,this.int16[Me+11]=I,this.int16[Me+12]=O,this.int16[Me+13]=M,this.uint16[Me+14]=L,this.uint16[Me+15]=k,this.uint16[Me+16]=U,this.uint16[Me+17]=G,this.uint16[Me+18]=Y,this.uint16[Me+19]=ae,this.uint16[Me+20]=J,this.uint16[Me+21]=ie,this.uint16[Me+22]=ue,this.uint16[Me+23]=se,this.uint16[Me+24]=Ie,this.uint16[Me+25]=Te,this.uint16[Me+26]=De,this.uint16[Me+27]=Qe,this.uint16[Me+28]=Ce,this.uint32[lt+15]=Ue,this.float32[lt+16]=je,this.float32[lt+17]=Xe,this.float32[lt+18]=nt,e}}xr.prototype.bytesPerElement=76,yt(xr,"StructArrayLayout3i2f6i15ui1ul3f76");class br extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}br.prototype.bytesPerElement=4,yt(br,"StructArrayLayout1f4");class wr extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,f,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,u,f,p)}emplace(e,n,u,f,p,_){let g=5*e;return this.float32[g+0]=n,this.float32[g+1]=u,this.float32[g+2]=f,this.float32[g+3]=p,this.float32[g+4]=_,e}}wr.prototype.bytesPerElement=20,yt(wr,"StructArrayLayout5f20");class ki extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u,f){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,u,f)}emplace(e,n,u,f,p){let _=6*e;return this.uint32[3*e+0]=n,this.uint16[_+2]=u,this.uint16[_+3]=f,this.uint16[_+4]=p,e}}ki.prototype.bytesPerElement=12,yt(ki,"StructArrayLayout1ul3ui12");class Ei extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let u=this.length;return this.resize(u+1),this.emplace(u,e,n)}emplace(e,n,u){let f=2*e;return this.uint16[f+0]=n,this.uint16[f+1]=u,e}}Ei.prototype.bytesPerElement=4,yt(Ei,"StructArrayLayout2ui4");class In extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}In.prototype.bytesPerElement=2,yt(In,"StructArrayLayout1ui2");class oo extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let u=this.length;return this.resize(u+1),this.emplace(u,e,n)}emplace(e,n,u){let f=2*e;return this.float32[f+0]=n,this.float32[f+1]=u,e}}oo.prototype.bytesPerElement=8,yt(oo,"StructArrayLayout2f8");class Nr extends fe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Nr.prototype.size=40;class Tr extends Rt{get(e){return new Nr(this,e)}}yt(Tr,"CollisionBoxArray");class sr extends fe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}sr.prototype.size=60;class oi extends mr{get(e){return new sr(this,e)}}yt(oi,"PlacedSymbolArray");class $i extends fe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}$i.prototype.size=76;class kr extends xr{get(e){return new $i(this,e)}}yt(kr,"SymbolInstanceArray");class Ki extends br{getoffsetX(e){return this.float32[1*e+0]}}yt(Ki,"GlyphOffsetArray");class Lc extends Je{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}yt(Lc,"SymbolLineVertexArray");class Za extends fe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Za.prototype.size=12;class su extends ki{get(e){return new Za(this,e)}}yt(su,"FeatureIndexArray");class Lo extends Ei{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}yt(Lo,"FillExtrusionCentroidArray");let la=ye([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ha=ye([{name:"a_dash",components:4,type:"Uint16"}]);var kc={exports:{}},lu={exports:{}};lu.exports=function(r,e){var n,u,f,p,_,g,b,w;for(u=r.length-(n=3&r.length),f=e,_=3432918353,g=461845907,w=0;w<u;)b=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24,++w,f=27492+(65535&(p=5*(65535&(f=(f^=b=(65535&(b=(b=(65535&b)*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(b=0,n){case 3:b^=(255&r.charCodeAt(w+2))<<16;case 2:b^=(255&r.charCodeAt(w+1))<<8;case 1:f^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(w)))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*g+(((b>>>16)*g&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Od=lu.exports,mA={exports:{}};mA.exports=function(r,e){for(var n,u=r.length,f=e^u,p=0;u>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(p)|(255&r.charCodeAt(++p))<<8|(255&r.charCodeAt(++p))<<16|(255&r.charCodeAt(++p))<<24))+((1540483477*(n>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:f^=(255&r.charCodeAt(p+2))<<16;case 2:f^=(255&r.charCodeAt(p+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(p)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var _A=Od,wY=mA.exports;kc.exports=_A,kc.exports.murmur3=_A,kc.exports.murmur2=wY;var mx=Ge(kc.exports);class W_{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,u,f){this.ids.push(yA(e)),this.positions.push(n,u,f)}getPositions(e){let n=yA(e),u=0,f=this.ids.length-1;for(;u<f;){let _=u+f>>1;this.ids[_]>=n?f=_:u=_+1}let p=[];for(;this.ids[u]===n;)p.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return p}static serialize(e,n){let u=new Float64Array(e.ids),f=new Uint32Array(e.positions);return _x(u,f,0,u.length-1),n&&n.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(e){let n=new W_;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function yA(r){let e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:mx(String(r))}function _x(r,e,n,u){for(;n<u;){let f=r[n+u>>1],p=n-1,_=u+1;for(;;){do p++;while(r[p]<f);do _--;while(r[_]>f);if(p>=_)break;Z_(r,p,_),Z_(e,3*p,3*_),Z_(e,3*p+1,3*_+1),Z_(e,3*p+2,3*_+2)}_-n<u-_?(_x(r,e,n,_),n=_+1):(_x(r,e,_+1,u),u=_)}}function Z_(r,e,n){let u=r[e];r[e]=r[n],r[n]=u}yt(W_,"FeaturePositionMap");class Xa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class H_ extends Xa{constructor(e){super(e),this.current=0}set(e,n,u){this.fetchUniformLocation(e,n)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class gA extends Xa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,u){this.fetchUniformLocation(e,n)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class vA extends Xa{constructor(e){super(e),this.current=Jr.transparent}set(e,n,u){this.fetchUniformLocation(e,n)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}let TY=new Float32Array(16),EY=new Float32Array(9),SY=new Float32Array(4);function yx(r){return[he(255*r.r,255*r.g),he(255*r.b,255*r.a)]}class Cd{constructor(e,n,u){this.value=e,this.uniformNames=n.map(f=>`u_${f}`),this.type=u}setUniform(e,n,u,f,p){n.set(e,p,f.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new vA(e):new H_(e)}}class Bc{constructor(e,n){this.uniformNames=n.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,u,f,p){let _=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;_&&n.set(e,p,_)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new gA(e):new H_(e)}}class Ka{constructor(e,n,u,f){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=n.map(p=>({name:`a_${p}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,u,f,p,_){let g=this.paintVertexArray.length,b=this.expression.evaluate(new A(0),n,{},p,f,_);this.paintVertexArray.resize(e),this._setPaintValue(g,e,b)}updatePaintArray(e,n,u,f,p){let _=this.expression.evaluate({zoom:0},u,f,void 0,p);this._setPaintValue(e,n,_)}_setPaintValue(e,n,u){if(this.type==="color"){let f=yx(u);for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ko{constructor(e,n,u,f,p,_){this.expression=e,this.uniformNames=n.map(g=>`u_${g}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,n,u,f,p,_){let g=this.expression.evaluate(new A(this.zoom),n,{},p,f,_),b=this.expression.evaluate(new A(this.zoom+1),n,{},p,f,_),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,b)}updatePaintArray(e,n,u,f,p){let _=this.expression.evaluate({zoom:this.zoom},u,f,void 0,p),g=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,p);this._setPaintValue(e,n,_,g)}_setPaintValue(e,n,u,f){if(this.type==="color"){let p=yx(u),_=yx(f);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,p[0],p[1],_[0],_[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,u,f,p){let _=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,g=Ne(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);n.set(e,p,g)}getBinding(e,n){return new H_(e)}}class Gs{constructor(e,n,u,f,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(u==="array"?Ha:la).members;for(let _=0;_<n.length;++_);this.paintVertexArray=new f}populatePaintArray(e,n,u){let f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,n.patterns&&n.patterns[this.layerId],u)}updatePaintArray(e,n,u,f,p,_){this._setPaintValues(e,n,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(e,n,u,f){if(!f||!u)return;let p=f[u];if(!p)return;let{tl:_,br:g,pixelRatio:b}=p;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,_[0],_[1],g[0],g[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ws{constructor(e,n,u=()=>!0){this.binders={},this._buffers=[];let f=[];for(let p in e.paint._values){if(!u(p))continue;let _=e.paint.get(p);if(!(_ instanceof H&&Bs(_.property.specification)))continue;let g=AY(p,e.type),b=_.value,w=_.property.specification.type,I=!!_.property.useIntegerZoom,O=p==="line-dasharray"||p.endsWith("pattern"),M=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||M)if(b.kind==="source"||M||O){let L=xA(p,w,"source");this.binders[p]=O?new Gs(b,g,w,L,e.id):new Ka(b,g,w,L),f.push(`/a_${p}`)}else{let L=xA(p,w,"composite");this.binders[p]=new ko(b,g,w,I,n,L),f.push(`/z_${p}`)}else this.binders[p]=O?new Bc(b.value,g):new Cd(b.value,g,w),f.push(`/u_${p}`)}this.cacheKey=f.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Ka||n instanceof ko?n.maxValue:0}populatePaintArrays(e,n,u,f,p,_){for(let g in this.binders){let b=this.binders[g];(b instanceof Ka||b instanceof ko||b instanceof Gs)&&b.populatePaintArray(e,n,u,f,p,_)}}setConstantPatternPositions(e){for(let n in this.binders){let u=this.binders[n];u instanceof Bc&&u.setConstantPatternPositions(e)}}updatePaintArrays(e,n,u,f,p,_){let g=!1;for(let b in e){let w=n.getPositions(b);for(let I of w){let O=u.feature(I.index);for(let M in this.binders){let L=this.binders[M];if((L instanceof Ka||L instanceof ko||L instanceof Gs)&&L.expression.isStateDependent===!0){let k=f.paint.get(M);L.expression=k.value,L.updatePaintArray(I.start,I.end,O,e[b],p,_),g=!0}}}}return g}defines(){let e=[];for(let n in this.binders){let u=this.binders[n];(u instanceof Cd||u instanceof Bc)&&e.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let u=this.binders[n];if(u instanceof Ka||u instanceof ko||u instanceof Gs)for(let f=0;f<u.paintVertexAttributes.length;f++)e.push(u.paintVertexAttributes[f].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let u=this.binders[n];if(u instanceof Cd||u instanceof Bc||u instanceof ko)for(let f of u.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let u in this.binders){let f=this.binders[u];if(f instanceof Cd||f instanceof Bc||f instanceof ko)for(let p of f.uniformNames)n.push({name:p,property:u,binding:f.getBinding(e,p)})}return n}setUniforms(e,n,u,f,p){for(let{name:_,property:g,binding:b}of u)this.binders[g].setUniform(e,b,p,f.get(g),_)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Ka||n instanceof ko||n instanceof Gs)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let u=this.binders[n];(u instanceof Ka||u instanceof ko||u instanceof Gs)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Ka||n instanceof ko||n instanceof Gs)&&n.destroy()}}}class uu{constructor(e,n,u=()=>!0){this.programConfigurations={};for(let f of e)this.programConfigurations[f.id]=new Ws(f,n,u);this.needsUpload=!1,this._featureMap=new W_,this._bufferOffset=0}populatePaintArrays(e,n,u,f,p,_,g){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,f,p,_,g);n.id!==void 0&&this._featureMap.add(n.id,u,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,u,f,p){for(let _ of u)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,n,_,f,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let IY={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function AY(r,e){return IY[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}let OY={"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee},"line-dasharray":{source:Be,composite:Be}},CY={color:{source:oo,composite:Ye},number:{source:br,composite:oo}};function xA(r,e,n){let u=OY[r];return u&&u[n]||CY[e][n]}yt(Cd,"ConstantBinder"),yt(Bc,"PatternConstantBinder"),yt(Ka,"SourceExpressionBinder"),yt(Gs,"PatternCompositeBinder"),yt(ko,"CompositeExpressionBinder"),yt(Ws,"ProgramConfiguration",{omit:["_buffers"]}),yt(uu,"ProgramConfigurationSet");let bA="-transition";class Bo extends kl{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new X(n.layout)),n.paint)){this._transitionablePaint=new F(n.paint);for(let u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(let u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new K(n.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,u={}){n!=null&&this._validate(cx,`layers.${this.id}.layout.${e}`,e,n,u)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return vn(e,bA)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,u={}){if(n!=null&&this._validate(ux,`layers.${this.id}.paint.${e}`,e,n,u))return!1;if(vn(e,bA))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{let f=this._transitionablePaint._values[e],p=f.value.isDataDriven(),_=f.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);let g=this._transitionablePaint._values[e].value,b=g.isDataDriven(),w=vn(e,"pattern")||e==="line-dasharray";return b||p||w||this._handleOverridablePaintPropertyUpdate(e,_,g)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){let e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),bs(e,(n,u)=>!(n===void 0||u==="layout"&&!Object.keys(n).length||u==="paint"&&!Object.keys(n).length))}_validate(e,n,u,f,p={}){return(!p||p.validate!==!1)&&j_(this,e.call(U_,{key:n,layerType:this.type,objectKey:u,value:f,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof H&&Bs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Mc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}let PY=ye([{name:"a_pos",components:2,type:"Int16"}],4),MY=ye([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ai{constructor(e=[]){this.segments=e}prepareSegment(e,n,u,f){let p=this.segments[this.segments.length-1];return e>ai.MAX_VERTEX_ARRAY_LENGTH&&jr(`Max vertices per segment is ${ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>ai.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==f)&&(p={vertexOffset:n.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},f!==void 0&&(p.sortKey=f),this.segments.push(p)),p}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,u,f){return new ai([{vertexOffset:e,primitiveOffset:n,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt(ai,"SegmentVector");var St=8192;class Zs{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Er?new Er(e.lng,e.lat):Er.convert(e),this}setSouthWest(e){return this._sw=e instanceof Er?new Er(e.lng,e.lat):Er.convert(e),this}extend(e){let n=this._sw,u=this._ne,f,p;if(e instanceof Er)f=e,p=e;else{if(!(e instanceof Zs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Zs.convert(e)):this.extend(Er.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Er.convert(e)):this;if(f=e._sw,p=e._ne,!f||!p)return this}return n||u?(n.lng=Math.min(f.lng,n.lng),n.lat=Math.min(f.lat,n.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new Er(f.lng,f.lat),this._ne=new Er(p.lng,p.lat)),this}getCenter(){return new Er((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Er(this.getWest(),this.getNorth())}getSouthEast(){return new Er(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:u}=Er.convert(e),f=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(e){return!e||e instanceof Zs?e:new Zs(e)}}var X_=1e-6,An=typeof Float32Array<"u"?Float32Array:Array;function wA(){var r=new An(9);return An!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function TA(r,e,n){var u=e[0],f=e[1],p=e[2],_=e[3],g=e[4],b=e[5],w=e[6],I=e[7],O=e[8],M=n[0],L=n[1],k=n[2],U=n[3],G=n[4],Y=n[5],ae=n[6],J=n[7],ie=n[8];return r[0]=M*u+L*_+k*w,r[1]=M*f+L*g+k*I,r[2]=M*p+L*b+k*O,r[3]=U*u+G*_+Y*w,r[4]=U*f+G*g+Y*I,r[5]=U*p+G*b+Y*O,r[6]=ae*u+J*_+ie*w,r[7]=ae*f+J*g+ie*I,r[8]=ae*p+J*b+ie*O,r}function zo(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function gx(r,e){var n=e[0],u=e[1],f=e[2],p=e[3],_=e[4],g=e[5],b=e[6],w=e[7],I=e[8],O=e[9],M=e[10],L=e[11],k=e[12],U=e[13],G=e[14],Y=e[15],ae=n*g-u*_,J=n*b-f*_,ie=n*w-p*_,ue=u*b-f*g,se=u*w-p*g,Ie=f*w-p*b,Te=I*U-O*k,De=I*G-M*k,Qe=I*Y-L*k,Ce=O*G-M*U,Ue=O*Y-L*U,je=M*Y-L*G,Xe=ae*je-J*Ue+ie*Ce+ue*Qe-se*De+Ie*Te;return Xe?(r[0]=(g*je-b*Ue+w*Ce)*(Xe=1/Xe),r[1]=(f*Ue-u*je-p*Ce)*Xe,r[2]=(U*Ie-G*se+Y*ue)*Xe,r[3]=(M*se-O*Ie-L*ue)*Xe,r[4]=(b*Qe-_*je-w*De)*Xe,r[5]=(n*je-f*Qe+p*De)*Xe,r[6]=(G*ie-k*Ie-Y*J)*Xe,r[7]=(I*Ie-M*ie+L*J)*Xe,r[8]=(_*Ue-g*Qe+w*Te)*Xe,r[9]=(u*Qe-n*Ue-p*Te)*Xe,r[10]=(k*se-U*ie+Y*ae)*Xe,r[11]=(O*ie-I*se-L*ae)*Xe,r[12]=(g*De-_*Ce-b*Te)*Xe,r[13]=(n*Ce-u*De+f*Te)*Xe,r[14]=(U*J-k*ue-G*ae)*Xe,r[15]=(I*ue-O*J+M*ae)*Xe,r):null}function cu(r,e,n){var u=e[0],f=e[1],p=e[2],_=e[3],g=e[4],b=e[5],w=e[6],I=e[7],O=e[8],M=e[9],L=e[10],k=e[11],U=e[12],G=e[13],Y=e[14],ae=e[15],J=n[0],ie=n[1],ue=n[2],se=n[3];return r[0]=J*u+ie*g+ue*O+se*U,r[1]=J*f+ie*b+ue*M+se*G,r[2]=J*p+ie*w+ue*L+se*Y,r[3]=J*_+ie*I+ue*k+se*ae,r[4]=(J=n[4])*u+(ie=n[5])*g+(ue=n[6])*O+(se=n[7])*U,r[5]=J*f+ie*b+ue*M+se*G,r[6]=J*p+ie*w+ue*L+se*Y,r[7]=J*_+ie*I+ue*k+se*ae,r[8]=(J=n[8])*u+(ie=n[9])*g+(ue=n[10])*O+(se=n[11])*U,r[9]=J*f+ie*b+ue*M+se*G,r[10]=J*p+ie*w+ue*L+se*Y,r[11]=J*_+ie*I+ue*k+se*ae,r[12]=(J=n[12])*u+(ie=n[13])*g+(ue=n[14])*O+(se=n[15])*U,r[13]=J*f+ie*b+ue*M+se*G,r[14]=J*p+ie*w+ue*L+se*Y,r[15]=J*_+ie*I+ue*k+se*ae,r}function Pd(r,e,n){var u,f,p,_,g,b,w,I,O,M,L,k,U=n[0],G=n[1],Y=n[2];return e===r?(r[12]=e[0]*U+e[4]*G+e[8]*Y+e[12],r[13]=e[1]*U+e[5]*G+e[9]*Y+e[13],r[14]=e[2]*U+e[6]*G+e[10]*Y+e[14],r[15]=e[3]*U+e[7]*G+e[11]*Y+e[15]):(f=e[1],p=e[2],_=e[3],g=e[4],b=e[5],w=e[6],I=e[7],O=e[8],M=e[9],L=e[10],k=e[11],r[0]=u=e[0],r[1]=f,r[2]=p,r[3]=_,r[4]=g,r[5]=b,r[6]=w,r[7]=I,r[8]=O,r[9]=M,r[10]=L,r[11]=k,r[12]=u*U+g*G+O*Y+e[12],r[13]=f*U+b*G+M*Y+e[13],r[14]=p*U+w*G+L*Y+e[14],r[15]=_*U+I*G+k*Y+e[15]),r}function hu(r,e,n){var u=n[0],f=n[1],p=n[2];return r[0]=e[0]*u,r[1]=e[1]*u,r[2]=e[2]*u,r[3]=e[3]*u,r[4]=e[4]*f,r[5]=e[5]*f,r[6]=e[6]*f,r[7]=e[7]*f,r[8]=e[8]*p,r[9]=e[9]*p,r[10]=e[10]*p,r[11]=e[11]*p,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function vx(r,e,n){var u=Math.sin(n),f=Math.cos(n),p=e[4],_=e[5],g=e[6],b=e[7],w=e[8],I=e[9],O=e[10],M=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=p*f+w*u,r[5]=_*f+I*u,r[6]=g*f+O*u,r[7]=b*f+M*u,r[8]=w*f-p*u,r[9]=I*f-_*u,r[10]=O*f-g*u,r[11]=M*f-b*u,r}function K_(r,e,n){var u=Math.sin(n),f=Math.cos(n),p=e[0],_=e[1],g=e[2],b=e[3],w=e[8],I=e[9],O=e[10],M=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*f-w*u,r[1]=_*f-I*u,r[2]=g*f-O*u,r[3]=b*f-M*u,r[8]=p*u+w*f,r[9]=_*u+I*f,r[10]=g*u+O*f,r[11]=b*u+M*f,r}function EA(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function SA(r,e,n){var u,f,p,_=n[0],g=n[1],b=n[2],w=Math.hypot(_,g,b);return w<X_?null:(_*=w=1/w,g*=w,b*=w,u=Math.sin(e),f=Math.cos(e),r[0]=_*_*(p=1-f)+f,r[1]=g*_*p+b*u,r[2]=b*_*p-g*u,r[3]=0,r[4]=_*g*p-b*u,r[5]=g*g*p+f,r[6]=b*g*p+_*u,r[7]=0,r[8]=_*b*p+g*u,r[9]=g*b*p-_*u,r[10]=b*b*p+f,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var qY=cu;function xx(){var r=new An(3);return An!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function IA(r){var e=new An(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Md(r){return Math.hypot(r[0],r[1],r[2])}function zc(r,e,n){var u=new An(3);return u[0]=r,u[1]=e,u[2]=n,u}function Ya(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r}function bx(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r}function AA(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r}function qd(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r}function Rd(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r}function Gn(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r}function Dd(r,e,n,u){return r[0]=e[0]+n[0]*u,r[1]=e[1]+n[1]*u,r[2]=e[2]+n[2]*u,r}function Yi(r,e){var n=e[0],u=e[1],f=e[2],p=n*n+u*u+f*f;return p>0&&(p=1/Math.sqrt(p)),r[0]=e[0]*p,r[1]=e[1]*p,r[2]=e[2]*p,r}function ao(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function wx(r,e,n){var u=e[0],f=e[1],p=e[2],_=n[0],g=n[1],b=n[2];return r[0]=f*b-p*g,r[1]=p*_-u*b,r[2]=u*g-f*_,r}function Qr(r,e,n){var u=e[0],f=e[1],p=e[2],_=n[3]*u+n[7]*f+n[11]*p+n[15];return r[0]=(n[0]*u+n[4]*f+n[8]*p+n[12])/(_=_||1),r[1]=(n[1]*u+n[5]*f+n[9]*p+n[13])/_,r[2]=(n[2]*u+n[6]*f+n[10]*p+n[14])/_,r}function OA(r,e,n){var u=n[0],f=n[1],p=n[2],_=e[0],g=e[1],b=e[2],w=f*b-p*g,I=p*_-u*b,O=u*g-f*_,M=f*O-p*I,L=p*w-u*O,k=u*I-f*w,U=2*n[3];return I*=U,O*=U,L*=2,k*=2,r[0]=_+(w*=U)+(M*=2),r[1]=g+I+L,r[2]=b+O+k,r}var Ld,Fo=bx,RY=AA,DY=Md;function CA(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r}function PA(r,e){var n=e[0],u=e[1],f=e[2],p=e[3],_=n*n+u*u+f*f+p*p;return _>0&&(_=1/Math.sqrt(_)),r[0]=n*_,r[1]=u*_,r[2]=f*_,r[3]=p*_,r}function fu(r,e,n){var u=e[0],f=e[1],p=e[2],_=e[3];return r[0]=n[0]*u+n[4]*f+n[8]*p+n[12]*_,r[1]=n[1]*u+n[5]*f+n[9]*p+n[13]*_,r[2]=n[2]*u+n[6]*f+n[10]*p+n[14]*_,r[3]=n[3]*u+n[7]*f+n[11]*p+n[15]*_,r}function MA(){var r=new An(4);return An!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function qA(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function RA(r,e,n){n*=.5;var u=e[0],f=e[1],p=e[2],_=e[3],g=Math.sin(n),b=Math.cos(n);return r[0]=u*b+_*g,r[1]=f*b+p*g,r[2]=p*b-f*g,r[3]=_*b-u*g,r}function DA(r,e,n){n*=.5;var u=e[0],f=e[1],p=e[2],_=e[3],g=Math.sin(n),b=Math.cos(n);return r[0]=u*b-p*g,r[1]=f*b+_*g,r[2]=p*b+u*g,r[3]=_*b-f*g,r}xx(),Ld=new An(4),An!=Float32Array&&(Ld[0]=0,Ld[1]=0,Ld[2]=0,Ld[3]=0);var LY=PA;xx(),zc(1,0,0),zc(0,1,0),MA(),MA(),wA();let kY=ye([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:LA}=kY,kA=ye([{name:"a_pos_3",components:3,type:"Int16"}]);var kd=ye([{name:"a_pos",type:"Int16",components:2}]);class Tx{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,u){let f=ao(n,this.dir);if(Math.abs(f)<1e-6)return!1;let p=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/f;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,n,u){if(function(L,k){var U=L[0],G=L[1],Y=L[2],ae=k[0],J=k[1],ie=k[2];return Math.abs(U-ae)<=X_*Math.max(1,Math.abs(U),Math.abs(ae))&&Math.abs(G-J)<=X_*Math.max(1,Math.abs(G),Math.abs(J))&&Math.abs(Y-ie)<=X_*Math.max(1,Math.abs(Y),Math.abs(ie))}(this.pos,e)||n===0)return u[0]=u[1]=u[2]=0,!1;let[f,p,_]=this.dir,g=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],I=f*f+p*p+_*_,O=2*(g*f+b*p+w*_),M=O*O-4*I*(g*g+b*b+w*w-n*n);if(M<0){let L=Math.max(-O/2,0),k=g+f*L,U=b+p*L,G=w+_*L,Y=Math.hypot(k,U,G);return u[0]=k*n/Y,u[1]=U*n/Y,u[2]=G*n/Y,!1}{let L=(-O-Math.sqrt(M))/(2*I);if(L<0){let k=Math.hypot(g,b,w);return u[0]=g*n/k,u[1]=b*n/k,u[2]=w*n/k,!1}return u[0]=g+f*L,u[1]=b+p*L,u[2]=w+_*L,!0}}}class Ex{constructor(e,n,u,f,p){this.TL=e,this.TR=n,this.BR=u,this.BL=f,this.horizon=p}static fromInvProjectionMatrix(e,n,u){let f=[-1,1,1],p=[1,1,1],_=[1,-1,1],g=[-1,-1,1],b=Qr(f,f,e),w=Qr(p,p,e),I=Qr(_,_,e),O=Qr(g,g,e);return new Ex(b,w,I,O,n/u)}}class Sx{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,u,f){let p=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let w=fu([],b,e),I=1/w[3]/n*p;return function(O,M,L){return O[0]=M[0]*L[0],O[1]=M[1]*L[1],O[2]=M[2]*L[2],O[3]=M[3]*L[3],O}(w,w,[I,I,f?1/w[3]:I,I])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let w=Yi([],wx([],Fo([],_[b[0]],_[b[1]]),Fo([],_[b[2]],_[b[1]]))),I=-ao(w,_[b[1]]);return w.concat(I)});return new Sx(_,g)}}class Ji{static fromPoints(e){let n=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(let f of e)qd(n,n,f),Rd(u,u,f);return new Ji(n,u)}static applyTransform(e,n){let u=e.getCorners();for(let f=0;f<u.length;++f)Qr(u[f],u[f],n);return Ji.fromPoints(u)}constructor(e,n){this.min=e,this.max=n,this.center=Gn([],Ya([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],u=IA(this.min),f=IA(this.max);for(let p=0;p<n.length;p++)u[p]=n[p]?this.min[p]:this.center[p],f[p]=n[p]?this.center[p]:this.max[p];return f[2]=this.max[2],new Ji(u,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){let n=this.getCorners(),u=!0;for(let f=0;f<e.planes.length;f++){let p=e.planes[f],_=0;for(let g=0;g<n.length;g++)_+=ao(p,n[g])+p[3]>=0;if(_===0)return 0;_!==n.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let g=0;g<e.points.length;g++){let b=e.points[g][f]-this.min[f];p=Math.min(p,b),_=Math.max(_,b)}if(_<0||p>this.max[f]-this.min[f])return 0}return 1}}let Ix=5,BA=6,ua=St/Math.PI/2,BY=16383,du=64,Bd=[du,32,16],so=-ua,lo=ua,zY=[new Ji([so,so,so],[lo,lo,lo]),new Ji([so,so,so],[0,0,lo]),new Ji([0,so,so],[lo,0,lo]),new Ji([so,0,so],[0,lo,lo]),new Ji([0,0,so],[lo,lo,lo])];function Y_(r){return r*ua/Nd}function zA(r,e,n,u=!0){let f=Gn([],r._camera.position,r.worldSize),p=[e,n,1,1];fu(p,p,r.pixelMatrixInverse),CA(p,p,1/p[3]);let _=Yi([],Fo([],p,f)),g=r.globeMatrix,b=[g[12],g[13],g[14]],w=Fo([],b,f),I=Md(w),O=Yi([],w),M=r.worldSize/(2*Math.PI),L=ao(O,_),k=Math.asin(M/I);if(k<Math.acos(L)){if(!u)return null;let Qe=[],Ce=[];Gn(Qe,_,I/L),Yi(Ce,Fo(Ce,Qe,w)),Yi(_,Ya(_,w,Gn(_,Ce,Math.tan(k)*I)))}let U=[];new Tx(f,_).closestPointOnSphere(b,M,U);let G=Yi([],ia(g,0)),Y=Yi([],ia(g,1)),ae=Yi([],ia(g,2)),J=ao(G,U),ie=ao(Y,U),ue=ao(ae,U),se=Or(Math.asin(-ie/M)),Ie=Or(Math.atan2(J,ue));Ie=r.center.lng+function(Qe,Ce){let Ue=(Ce-Qe+180)%360-180;return Ue<-180?Ue+360:Ue}(r.center.lng,Ie);let Te=ha(Ie),De=Ne(fa(se),0,1);return new jc(Te,De)}class FY{constructor(e,n,u){this.a=Fo([],e,u),this.b=Fo([],n,u),this.center=u;let f=Yi([],this.a),p=Yi([],this.b);this.angle=Math.acos(ao(f,p))}}function Ax(r,e){if(r.angle===0)return null;let n;return n=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),n<0||n>1?null:function(u,f,p,_){let g=Math.sin(p);return u*(Math.sin((1-_)*p)/g)+f*(Math.sin(_*p)/g)}(r.a[e],r.b[e],r.angle,Ne(n,0,1))+r.center[e]}function ca(r){if(r.z<=1)return zY[r.z+2*r.y+r.x];let e=Ox(J_(r));return Ji.fromPoints(e)}function pu(r,e,n){return Gn(r,r,1-n),Dd(r,r,e,n)}function FA(r,e){let n=Uc(e.zoom);if(n===0)return ca(r);let u=J_(r),f=Ox(u),p=ha(u.getWest())*e.worldSize,_=ha(u.getEast())*e.worldSize,g=fa(u.getNorth())*e.worldSize,b=fa(u.getSouth())*e.worldSize,w=[p,g,0],I=[_,g,0],O=[p,b,0],M=[_,b,0],L=gx([],e.globeMatrix);return Qr(w,w,L),Qr(I,I,L),Qr(O,O,L),Qr(M,M,L),f[0]=pu(f[0],O,n),f[1]=pu(f[1],M,n),f[2]=pu(f[2],I,n),f[3]=pu(f[3],w,n),Ji.fromPoints(f)}function NA(r,e,n){for(let u of r)Qr(u,u,e),Gn(u,u,n)}function NY(r,e,n){let u=e/r.worldSize,f=r.globeMatrix;if(n.z<=1){let Te=ca(n).getCorners();return NA(Te,f,u),Ji.fromPoints(Te)}let p=J_(n),_=Ox(p);NA(_,f,u);let g=Number.MAX_VALUE,b=[-g,-g,-g],w=[g,g,g];if(p.contains(r.center)){for(let Qe of _)qd(w,w,Qe),Rd(b,b,Qe);b[2]=0;let Te=r.point,De=[Te.x*u,Te.y*u,0];return qd(w,w,De),Rd(b,b,De),new Ji(w,b)}let I=[f[12]*u,f[13]*u,f[14]*u],O=p.getCenter(),M=Ne(r.center.lat,-zi,zi),L=Ne(O.lat,-zi,zi),k=ha(r.center.lng),U=fa(M),G=k-ha(O.lng),Y=U-fa(L);G>.5?G-=1:G<-.5&&(G+=1);let ae=0;Math.abs(G)>Math.abs(Y)?ae=G>=0?1:3:(ae=Y>=0?0:2,Dd(I,I,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(Pt(Y>=0?p.getSouth():p.getNorth()))*ua));let J=_[ae],ie=_[(ae+1)%4],ue=new FY(J,ie,I),se=[Ax(ue,0)||J[0],Ax(ue,1)||J[1],Ax(ue,2)||J[2]],Ie=Uc(r.zoom);if(Ie>0){let Te=function({x:Qe,y:Ce,z:Ue},je,Xe,nt,Me){let lt=1/(1<<Ue),bt=Qe*lt,ut=bt+lt,Lt=Ce*lt,ot=Lt+lt,Et=0,kt=(bt+ut)/2-nt;return kt>.5?Et=-1:kt<-.5&&(Et=1),bt=((bt+Et)*je-(nt*=je))*Xe+nt,ut=((ut+Et)*je-nt)*Xe+nt,Lt=(Lt*je-(Me*=je))*Xe+Me,ot=(ot*je-Me)*Xe+Me,[[bt,ot,0],[ut,ot,0],[ut,Lt,0],[bt,Lt,0]]}(n,e,r._pixelsPerMercatorPixel,k,U);for(let Qe=0;Qe<_.length;Qe++)pu(_[Qe],Te[Qe],Ie);let De=Ya([],Te[ae],Te[(ae+1)%4]);Gn(De,De,.5),pu(se,De,Ie)}for(let Te of _)qd(w,w,Te),Rd(b,b,Te);return w[2]=Math.min(J[2],ie[2]),qd(w,w,se),Rd(b,b,se),new Ji(w,b)}function J_({x:r,y:e,z:n}){let u=1/(1<<n),f=new Er(Wn(r*u),Bi((e+1)*u)),p=new Er(Wn((r+1)*u),Bi(e*u));return new Zs(f,p)}function Ox(r){let e=Pt(r.getNorth()),n=Pt(r.getSouth()),u=Math.cos(e),f=Math.cos(n),p=Math.sin(e),_=Math.sin(n),g=r.getWest(),b=r.getEast();return[Fc(f,_,g),Fc(f,_,b),Fc(u,p,b),Fc(u,p,g)]}function Fc(r,e,n,u=ua){return n=Pt(n),[r*Math.sin(n)*u,-e*u,r*Math.cos(n)*u]}function Nc(r,e,n){return Fc(Math.cos(Pt(r)),Math.sin(Pt(r)),e,n)}function zd(r,e,n,u){let f=1<<n.z,p=(r/St+n.x)/f;return Nc(Bi((e/St+n.y)/f),Wn(p),u)}function Q_({min:r,max:e}){return BY/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}let UA=new Float64Array(16);function Fd(r){let e=Q_(r),n=EA(UA,[e,e,e]);return Pd(n,n,((u=[])[0]=-(f=r.min)[0],u[1]=-f[1],u[2]=-f[2],u));var u,f}function Cx(r){let e=(u=r.min,(n=UA)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=u[0],n[13]=u[1],n[14]=u[2],n[15]=1,n);var n,u;let f=1/Q_(r);return hu(e,e,[f,f,f])}function jA(r,e,n,u,f){let p=function(b){let w=St/(2*Math.PI);return b/(2*Math.PI)/w}(n),_=[r,e,-n/(2*Math.PI)],g=zo(new Float64Array(16));return Pd(g,g,_),hu(g,g,[p,p,p]),vx(g,g,Pt(-f)),K_(g,g,Pt(-u)),g}function Uc(r){return Fe(Ix,BA,r)}function VA(r,e){let n=Nc(e.lat,e.lng),u=function(k){let U=Nc(k._center.lat,k._center.lng),G=wx([],zc(0,1,0),U),Y=SA([],-k.angle,U);G=Qr(G,G,Y),SA(Y,-k._pitch,G);let ae=Yi([],U);return Gn(ae,ae,Y_(k.cameraToCenterDistance/k.pixelsPerMeter)),Qr(ae,ae,Y),Ya([],U,ae)}(r);return _=(f=bx([],u,n))[0],g=f[1],b=f[2],w=(p=n)[0],I=p[1],O=p[2],L=(M=Math.sqrt(_*_+g*g+b*b)*Math.sqrt(w*w+I*I+O*O))&&ao(f,p)/M,Math.acos(Math.min(Math.max(L,-1),1));var f,p,_,g,b,w,I,O,M,L}function Px(r,e){return VA(r,e)>Math.PI/2*1.01}let $A=Pt(85),UY=Math.cos($A),jY=Math.sin($A),Nd=63710088e-1,GA=2*Math.PI*Nd;class Hs{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hs(Le(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,u=this.lat*n,f=e.lat*n,p=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((e.lng-this.lng)*n);return Nd*Math.acos(Math.min(p,1))}toBounds(e=0){let n=360*e/40075017,u=n/Math.cos(Math.PI/180*this.lat);return new Zs(new Hs(this.lng-u,this.lat-n),new Hs(this.lng+u,this.lat+n))}toEcef(e){let n=Y_(e);return Nc(this.lat,this.lng,ua+n)}static convert(e){if(e instanceof Hs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Hs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Hs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Er=Hs;function Mx(r){return GA*Math.cos(r*Math.PI/180)}function ha(r){return(180+r)/360}function fa(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function No(r,e){return r/Mx(e)}function Wn(r){return 360*r-180}function Bi(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function WA(r,e){return r*Mx(Bi(e))}let zi=85.051129;function ZA(r){return 1/Math.cos(r*Math.PI/180)}class jc{constructor(e,n,u=0){this.x=+e,this.y=+n,this.z=+u}static fromLngLat(e,n=0){let u=Er.convert(e);return new jc(ha(u.lng),fa(u.lat),No(n,u.lat))}toLngLat(){return new Er(Wn(this.x),Bi(this.y))}toAltitude(){return WA(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/GA*ZA(Bi(this.y))}}function qx(r,e,n,u,f,p,_,g,b){let w=(e+u)/2,I=(n+f)/2,O=new Ve(w,I);g(O),function(M,L,k,U,G,Y){let ae=k-G,J=U-Y;return Math.abs((U-L)*ae-(k-M)*J)/Math.hypot(ae,J)}(O.x,O.y,p.x,p.y,_.x,_.y)>=b?(qx(r,e,n,w,I,p,O,g,b),qx(r,w,I,u,f,O,_,g,b)):r.push(_)}function HA(r,e,n){let u=r[0],f=u.x,p=u.y;e(u);let _=[u];for(let g=1;g<r.length;g++){let b=r[g],{x:w,y:I}=b;e(b),qx(_,f,p,w,I,u,b,e,n),f=w,p=I,u=b}return _}function Rx(r,e,n,u){if(u(e,n)){let f=e.add(n)._mult(.5);Rx(r,e,f,u),Rx(r,f,n,u)}else r.push(n)}function VY(r,e){let n=r[0],u=[n];for(let f=1;f<r.length;f++){let p=r[f];Rx(u,n,p,e),n=p}return u}let Dx=Math.pow(2,14)-1,XA=-Dx-1;function $Y(r,e){let n=Math.round(r.x*e),u=Math.round(r.y*e);return r.x=Ne(n,XA,Dx),r.y=Ne(u,XA,Dx),(n<r.x||n>r.x+1||u<r.y||u>r.y+1)&&jr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Ja(r,e,n){let u=r.loadGeometry(),f=r.extent,p=St/f;if(e&&n&&n.projection.isReprojectedInTileSpace){let _=1<<e.z,{scale:g,x:b,y:w,projection:I}=n,O=M=>{let L=Wn((e.x+M.x/f)/_),k=Bi((e.y+M.y/f)/_),U=I.project(L,k);M.x=(U.x*g-b)*f,M.y=(U.y*g-w)*f};for(let M=0;M<u.length;M++)if(r.type!==1)u[M]=HA(u[M],O,1);else{let L=[];for(let k of u[M])k.x<0||k.x>=f||k.y<0||k.y>=f||(O(k),L.push(k));u[M]=L}}for(let _ of u)for(let g of _)$Y(g,p);return u}function mu(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Ja(r):[]}}function ey(r,e,n,u,f){r.emplaceBack(2*e+(u+1)/2,2*n+(f+1)/2)}function ty(r,e,n){r.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Lx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Je,this.indexArray=new wt,this.segments=new ai,this.programConfigurations=new uu(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,u,f){let p=this.layers[0],_=[],g=null;p.type==="circle"&&(g=p.layout.get("circle-sort-key"));for(let{feature:w,id:I,index:O,sourceLayerIndex:M}of e){let L=this.layers[0]._featureFilter.needGeometry,k=mu(w,L);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),k,u))continue;let U=g?g.evaluate(k,{},u):void 0,G={id:I,properties:w.properties,type:w.type,sourceLayerIndex:M,index:O,geometry:L?k.geometry:Ja(w,u,f),patterns:{},sortKey:U};_.push(G)}g&&_.sort((w,I)=>w.sortKey-I.sortKey);let b=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new et,b=f.projection);for(let w of _){let{geometry:I,index:O,sourceLayerIndex:M}=w,L=e[O].feature;this.addFeature(w,I,O,n.availableImages,u,b),n.featureIndex.insert(L,I,O,M,this.index)}}update(e,n,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PY.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,MY.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,u,f,p,_){for(let g of n)for(let b of g){let w=b.x,I=b.y;if(w<0||w>=St||I<0||I>=St)continue;if(_){let L=_.projectTilePoint(w,I,p),k=_.upVector(p,w,I),U=this.globeExtVertexArray;ty(U,L,k),ty(U,L,k),ty(U,L,k),ty(U,L,k)}let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=O.vertexLength;ey(this.layoutVertexArray,w,I,-1,-1),ey(this.layoutVertexArray,w,I,1,-1),ey(this.layoutVertexArray,w,I,1,1),ey(this.layoutVertexArray,w,I,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},f,p)}}function KA(r,e){for(let n=0;n<r.length;n++)if(_u(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(_u(r,e[n]))return!0;return!!kx(r,e)}function GY(r,e,n){return!!_u(r,e)||!!Bx(e,r,n)}function YA(r,e){if(r.length===1)return QA(e,r[0]);for(let n=0;n<e.length;n++){let u=e[n];for(let f=0;f<u.length;f++)if(_u(r,u[f]))return!0}for(let n=0;n<r.length;n++)if(QA(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(kx(r,e[n]))return!0;return!1}function WY(r,e,n){if(r.length>1){if(kx(r,e))return!0;for(let u=0;u<e.length;u++)if(Bx(e[u],r,n))return!0}for(let u=0;u<r.length;u++)if(Bx(r[u],e,n))return!0;return!1}function kx(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){let u=r[n],f=r[n+1];for(let p=0;p<e.length-1;p++)if(ZY(u,f,e[p],e[p+1]))return!0}return!1}function ZY(r,e,n,u){return xn(r,n,u)!==xn(e,n,u)&&xn(r,e,n)!==xn(r,e,u)}function Bx(r,e,n){let u=n*n;if(e.length===1)return r.distSqr(e[0])<u;for(let f=1;f<e.length;f++)if(JA(r,e[f-1],e[f])<u)return!0;return!1}function JA(r,e,n){let u=e.distSqr(n);if(u===0)return r.distSqr(e);let f=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/u;return r.distSqr(f<0?e:f>1?n:n.sub(e)._mult(f)._add(e))}function QA(r,e){let n,u,f,p=!1;for(let _=0;_<r.length;_++){n=r[_];for(let g=0,b=n.length-1;g<n.length;b=g++)u=n[g],f=n[b],u.y>e.y!=f.y>e.y&&e.x<(f.x-u.x)*(e.y-u.y)/(f.y-u.y)+u.x&&(p=!p)}return p}function _u(r,e){let n=!1;for(let u=0,f=r.length-1;u<r.length;f=u++){let p=r[u],_=r[f];p.y>e.y!=_.y>e.y&&e.x<(_.x-p.x)*(e.y-p.y)/(_.y-p.y)+p.x&&(n=!n)}return n}function eO(r,e,n,u,f){for(let _ of r)if(e<=_.x&&n<=_.y&&u>=_.x&&f>=_.y)return!0;let p=[new Ve(e,n),new Ve(e,f),new Ve(u,f),new Ve(u,n)];if(r.length>2){for(let _ of p)if(_u(r,_))return!0}for(let _=0;_<r.length-1;_++)if(HY(r[_],r[_+1],p))return!0;return!1}function HY(r,e,n){let u=n[0],f=n[2];if(r.x<u.x&&e.x<u.x||r.x>f.x&&e.x>f.x||r.y<u.y&&e.y<u.y||r.y>f.y&&e.y>f.y)return!1;let p=xn(r,e,n[0]);return p!==xn(r,e,n[1])||p!==xn(r,e,n[2])||p!==xn(r,e,n[3])}function Vc(r,e,n){let u=e.paint.get(r).value;return u.kind==="constant"?u.value:n.programConfigurations.get(e.id).getMaxValue(r)}function ry(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function tO(r,e,n,u,f){if(!e[0]&&!e[1])return r;let p=Ve.convert(e)._mult(f);n==="viewport"&&p._rotate(-u);let _=[];for(let g=0;g<r.length;g++)_.push(r[g].sub(p));return _}function rO(r,e,n,u){let f=Ve.convert(r)._mult(u);return e==="viewport"&&f._rotate(-n),f}yt(Lx,"CircleBucket",{omit:["layers"]});let XY=new ee({"circle-sort-key":new W(Re.layout_circle["circle-sort-key"])});var KY={paint:new ee({"circle-radius":new W(Re.paint_circle["circle-radius"]),"circle-color":new W(Re.paint_circle["circle-color"]),"circle-blur":new W(Re.paint_circle["circle-blur"]),"circle-opacity":new W(Re.paint_circle["circle-opacity"]),"circle-translate":new N(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new N(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new N(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new N(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new W(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new W(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new W(Re.paint_circle["circle-stroke-opacity"])}),layout:XY};function iO(r,e,n,u,f,p,_,g,b){if(p&&r.queryGeometry.isAboveHorizon)return!1;p&&(b*=r.pixelToTileUnitsFactor);let w=r.tileID.canonical,I=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(let O of e)for(let M of O){let L=M.add(g),k=f&&n.elevation?n.elevation.exaggeration()*f.getElevationAt(L.x,L.y,!0):0,U=n.projection.projectTilePoint(L.x,L.y,w);if(k>0){let J=n.projection.upVector(w,L.x,L.y);U.x+=J[0]*I*k,U.y+=J[1]*I*k,U.z+=J[2]*I*k}let G=p?L:YY(U.x,U.y,U.z,u),Y=p?r.tilespaceRays.map(J=>QY(J,k)):r.queryGeometry.screenGeometry,ae=fu([],[U.x,U.y,U.z,1],u);if(!_&&p?b*=ae[3]/n.cameraToCenterDistance:_&&!p&&(b*=n.cameraToCenterDistance/ae[3]),p){let J=Bi((M.y/St+w.y)/(1<<w.z));b/=n.projection.pixelsPerMeter(J,1)/No(1,J)}if(GY(Y,G,b))return!0}return!1}function YY(r,e,n,u){let f=fu([],[r,e,n,1],u);return new Ve(f[0]/f[3],f[1]/f[3])}let nO=zc(0,0,0),JY=zc(0,0,1);function QY(r,e){let n=xx();return nO[2]=e,r.intersectsPlane(nO,JY,n),new Ve(n[0],n[1])}class oO extends Lx{}function aO(r,{width:e,height:n},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*n*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*n*u);return r.width=e,r.height=n,r.data=f,r}function sO(r,e,n){let{width:u,height:f}=e;u===r.width&&f===r.height||(zx(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,u),height:Math.min(r.height,f)},n),r.width=u,r.height=f,r.data=e.data)}function zx(r,e,n,u,f,p){if(f.width===0||f.height===0)return e;if(f.width>r.width||f.height>r.height||n.x>r.width-f.width||n.y>r.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||u.x>e.width-f.width||u.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");let _=r.data,g=e.data;for(let b=0;b<f.height;b++){let w=((n.y+b)*r.width+n.x)*p,I=((u.y+b)*e.width+u.x)*p;for(let O=0;O<f.width*p;O++)g[I+O]=_[w+O]}return e}yt(oO,"HeatmapBucket",{omit:["layers"]});class Qa{constructor(e,n){aO(this,e,1,n)}resize(e){sO(this,new Qa(e),1)}clone(){return new Qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,u,f,p){zx(e,n,u,f,p,1)}}class On{constructor(e,n){aO(this,e,4,n)}resize(e){sO(this,new On(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new On({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,u,f,p){zx(e,n,u,f,p,4)}}yt(Qa,"AlphaImage"),yt(On,"RGBAImage");var eJ={paint:new ee({"heatmap-radius":new W(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new W(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new N(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Q(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new N(Re.paint_heatmap["heatmap-opacity"])})};function Fx(r){let e={},n=r.resolution||256,u=r.clips?r.clips.length:1,f=r.image||new On({width:n,height:u}),p=(_,g,b)=>{e[r.evaluationKey]=b;let w=r.expression.evaluate(e);f.data[_+g+0]=Math.floor(255*w.r/w.a),f.data[_+g+1]=Math.floor(255*w.g/w.a),f.data[_+g+2]=Math.floor(255*w.b/w.a),f.data[_+g+3]=Math.floor(255*w.a)};if(r.clips)for(let _=0,g=0;_<u;++_,g+=4*n)for(let b=0,w=0;b<n;b++,w+=4){let I=b/(n-1),{start:O,end:M}=r.clips[_];p(g,w,O*(1-I)+M*I)}else for(let _=0,g=0;_<n;_++,g+=4)p(0,g,_/(n-1));return f}var tJ={paint:new ee({"hillshade-illumination-direction":new N(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new N(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new N(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new N(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new N(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new N(Re.paint_hillshade["hillshade-accent-color"])})};let rJ=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:iJ}=rJ;var Nx={exports:{}};function iy(r,e,n){n=n||2;var u,f,p,_,g,b,w,I=e&&e.length,O=I?e[0]*n:r.length,M=lO(r,0,O,n,!0),L=[];if(!M||M.next===M.prev)return L;if(I&&(M=function(U,G,Y,ae){var J,ie,ue,se=[];for(J=0,ie=G.length;J<ie;J++)(ue=lO(U,G[J]*ae,J<ie-1?G[J+1]*ae:U.length,ae,!1))===ue.next&&(ue.steiner=!0),se.push(hJ(ue));for(se.sort(lJ),J=0;J<se.length;J++)Y=uJ(se[J],Y);return Y}(r,e,M,n)),r.length>80*n){u=p=r[0],f=_=r[1];for(var k=n;k<O;k+=n)(g=r[k])<u&&(u=g),(b=r[k+1])<f&&(f=b),g>p&&(p=g),b>_&&(_=b);w=(w=Math.max(p-u,_-f))!==0?32767/w:0}return Ud(M,L,n,u,f,w,0),L}function lO(r,e,n,u,f){var p,_;if(f===Vx(r,e,n,u)>0)for(p=e;p<n;p+=u)_=hO(p,r[p],r[p+1],_);else for(p=n-u;p>=e;p-=u)_=hO(p,r[p],r[p+1],_);return _&&ny(_,_.next)&&(Vd(_),_=_.next),_}function yu(r,e){if(!r)return r;e||(e=r);var n,u=r;do if(n=!1,u.steiner||!ny(u,u.next)&&si(u.prev,u,u.next)!==0)u=u.next;else{if(Vd(u),(u=e=u.prev)===u.next)break;n=!0}while(n||u!==e);return e}function Ud(r,e,n,u,f,p,_){if(r){!_&&p&&function(I,O,M,L){var k=I;do k.z===0&&(k.z=Ux(k.x,k.y,O,M,L)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==I);k.prevZ.nextZ=null,k.prevZ=null,function(U){var G,Y,ae,J,ie,ue,se,Ie,Te=1;do{for(Y=U,U=null,ie=null,ue=0;Y;){for(ue++,ae=Y,se=0,G=0;G<Te&&(se++,ae=ae.nextZ);G++);for(Ie=Te;se>0||Ie>0&&ae;)se!==0&&(Ie===0||!ae||Y.z<=ae.z)?(J=Y,Y=Y.nextZ,se--):(J=ae,ae=ae.nextZ,Ie--),ie?ie.nextZ=J:U=J,J.prevZ=ie,ie=J;Y=ae}ie.nextZ=null,Te*=2}while(ue>1)}(k)}(r,u,f,p);for(var g,b,w=r;r.prev!==r.next;)if(g=r.prev,b=r.next,p?oJ(r,u,f,p):nJ(r))e.push(g.i/n|0),e.push(r.i/n|0),e.push(b.i/n|0),Vd(r),r=b.next,w=b.next;else if((r=b)===w){_?_===1?Ud(r=aJ(yu(r),e,n),e,n,u,f,p,2):_===2&&sJ(r,e,n,u,f,p):Ud(yu(r),e,n,u,f,p,1);break}}}function nJ(r){var e=r.prev,n=r,u=r.next;if(si(e,n,u)>=0)return!1;for(var f=e.x,p=n.x,_=u.x,g=e.y,b=n.y,w=u.y,I=f<p?f<_?f:_:p<_?p:_,O=g<b?g<w?g:w:b<w?b:w,M=f>p?f>_?f:_:p>_?p:_,L=g>b?g>w?g:w:b>w?b:w,k=u.next;k!==e;){if(k.x>=I&&k.x<=M&&k.y>=O&&k.y<=L&&$c(f,g,p,b,_,w,k.x,k.y)&&si(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function oJ(r,e,n,u){var f=r.prev,p=r,_=r.next;if(si(f,p,_)>=0)return!1;for(var g=f.x,b=p.x,w=_.x,I=f.y,O=p.y,M=_.y,L=g<b?g<w?g:w:b<w?b:w,k=I<O?I<M?I:M:O<M?O:M,U=g>b?g>w?g:w:b>w?b:w,G=I>O?I>M?I:M:O>M?O:M,Y=Ux(L,k,e,n,u),ae=Ux(U,G,e,n,u),J=r.prevZ,ie=r.nextZ;J&&J.z>=Y&&ie&&ie.z<=ae;){if(J.x>=L&&J.x<=U&&J.y>=k&&J.y<=G&&J!==f&&J!==_&&$c(g,I,b,O,w,M,J.x,J.y)&&si(J.prev,J,J.next)>=0||(J=J.prevZ,ie.x>=L&&ie.x<=U&&ie.y>=k&&ie.y<=G&&ie!==f&&ie!==_&&$c(g,I,b,O,w,M,ie.x,ie.y)&&si(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;J&&J.z>=Y;){if(J.x>=L&&J.x<=U&&J.y>=k&&J.y<=G&&J!==f&&J!==_&&$c(g,I,b,O,w,M,J.x,J.y)&&si(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ie&&ie.z<=ae;){if(ie.x>=L&&ie.x<=U&&ie.y>=k&&ie.y<=G&&ie!==f&&ie!==_&&$c(g,I,b,O,w,M,ie.x,ie.y)&&si(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function aJ(r,e,n){var u=r;do{var f=u.prev,p=u.next.next;!ny(f,p)&&uO(f,u,u.next,p)&&jd(f,p)&&jd(p,f)&&(e.push(f.i/n|0),e.push(u.i/n|0),e.push(p.i/n|0),Vd(u),Vd(u.next),u=r=p),u=u.next}while(u!==r);return yu(u)}function sJ(r,e,n,u,f,p){var _=r;do{for(var g=_.next.next;g!==_.prev;){if(_.i!==g.i&&fJ(_,g)){var b=cO(_,g);return _=yu(_,_.next),b=yu(b,b.next),Ud(_,e,n,u,f,p,0),void Ud(b,e,n,u,f,p,0)}g=g.next}_=_.next}while(_!==r)}function lJ(r,e){return r.x-e.x}function uJ(r,e){var n=function(f,p){var _,g=p,b=f.x,w=f.y,I=-1/0;do{if(w<=g.y&&w>=g.next.y&&g.next.y!==g.y){var O=g.x+(w-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(O<=b&&O>I&&(I=O,_=g.x<g.next.x?g:g.next,O===b))return _}g=g.next}while(g!==p);if(!_)return null;var M,L=_,k=_.x,U=_.y,G=1/0;g=_;do b>=g.x&&g.x>=k&&b!==g.x&&$c(w<U?b:I,w,k,U,w<U?I:b,w,g.x,g.y)&&(M=Math.abs(w-g.y)/(b-g.x),jd(g,f)&&(M<G||M===G&&(g.x>_.x||g.x===_.x&&cJ(_,g)))&&(_=g,G=M)),g=g.next;while(g!==L);return _}(r,e);if(!n)return e;var u=cO(n,r);return yu(u,u.next),yu(n,n.next)}function cJ(r,e){return si(r.prev,r,e.prev)<0&&si(e.next,r,r.next)<0}function Ux(r,e,n,u,f){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hJ(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function $c(r,e,n,u,f,p,_,g){return(f-_)*(e-g)>=(r-_)*(p-g)&&(r-_)*(u-g)>=(n-_)*(e-g)&&(n-_)*(p-g)>=(f-_)*(u-g)}function fJ(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,u){var f=n;do{if(f.i!==n.i&&f.next.i!==n.i&&f.i!==u.i&&f.next.i!==u.i&&uO(f,f.next,n,u))return!0;f=f.next}while(f!==n);return!1}(r,e)&&(jd(r,e)&&jd(e,r)&&function(n,u){var f=n,p=!1,_=(n.x+u.x)/2,g=(n.y+u.y)/2;do f.y>g!=f.next.y>g&&f.next.y!==f.y&&_<(f.next.x-f.x)*(g-f.y)/(f.next.y-f.y)+f.x&&(p=!p),f=f.next;while(f!==n);return p}(r,e)&&(si(r.prev,r,e.prev)||si(r,e.prev,e))||ny(r,e)&&si(r.prev,r,r.next)>0&&si(e.prev,e,e.next)>0)}function si(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function ny(r,e){return r.x===e.x&&r.y===e.y}function uO(r,e,n,u){var f=ay(si(r,e,n)),p=ay(si(r,e,u)),_=ay(si(n,u,r)),g=ay(si(n,u,e));return f!==p&&_!==g||!(f!==0||!oy(r,n,e))||!(p!==0||!oy(r,u,e))||!(_!==0||!oy(n,r,u))||!(g!==0||!oy(n,e,u))}function oy(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function ay(r){return r>0?1:r<0?-1:0}function jd(r,e){return si(r.prev,r,r.next)<0?si(r,e,r.next)>=0&&si(r,r.prev,e)>=0:si(r,e,r.prev)<0||si(r,r.next,e)<0}function cO(r,e){var n=new jx(r.i,r.x,r.y),u=new jx(e.i,e.x,e.y),f=r.next,p=e.prev;return r.next=e,e.prev=r,n.next=f,f.prev=n,u.next=n,n.prev=u,p.next=u,u.prev=p,u}function hO(r,e,n,u){var f=new jx(r,e,n);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function Vd(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function jx(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Vx(r,e,n,u){for(var f=0,p=e,_=n-u;p<n;p+=u)f+=(r[_]-r[p])*(r[p+1]+r[_+1]),_=p;return f}Nx.exports=iy,Nx.exports.default=iy,iy.deviation=function(r,e,n,u){var f=e&&e.length,p=Math.abs(Vx(r,0,f?e[0]*n:r.length,n));if(f)for(var _=0,g=e.length;_<g;_++)p-=Math.abs(Vx(r,e[_]*n,_<g-1?e[_+1]*n:r.length,n));var b=0;for(_=0;_<u.length;_+=3){var w=u[_]*n,I=u[_+1]*n,O=u[_+2]*n;b+=Math.abs((r[w]-r[O])*(r[I+1]-r[w+1])-(r[w]-r[I])*(r[O+1]-r[w+1]))}return p===0&&b===0?0:Math.abs((b-p)/p)},iy.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},u=0,f=0;f<r.length;f++){for(var p=0;p<r[f].length;p++)for(var _=0;_<e;_++)n.vertices.push(r[f][p][_]);f>0&&n.holes.push(u+=r[f-1].length)}return n};var $x=Ge(Nx.exports);function dJ(r,e,n,u,f){fO(r,e,n||0,u||r.length-1,f||pJ)}function fO(r,e,n,u,f){for(;u>n;){if(u-n>600){var p=u-n+1,_=e-n+1,g=Math.log(p),b=.5*Math.exp(2*g/3),w=.5*Math.sqrt(g*b*(p-b)/p)*(_-p/2<0?-1:1);fO(r,e,Math.max(n,Math.floor(e-_*b/p+w)),Math.min(u,Math.floor(e+(p-_)*b/p+w)),f)}var I=r[e],O=n,M=u;for($d(r,n,e),f(r[u],I)>0&&$d(r,n,u);O<M;){for($d(r,O,M),O++,M--;f(r[O],I)<0;)O++;for(;f(r[M],I)>0;)M--}f(r[n],I)===0?$d(r,n,M):$d(r,++M,u),M<=e&&(n=M+1),e<=M&&(u=M-1)}}function $d(r,e,n){var u=r[e];r[e]=r[n],r[n]=u}function pJ(r,e){return r<e?-1:r>e?1:0}function Gx(r,e){let n=r.length;if(n<=1)return[r];let u=[],f,p;for(let _=0;_<n;_++){let g=ic(r[_]);g!==0&&(r[_].area=Math.abs(g),p===void 0&&(p=g<0),p===g<0?(f&&u.push(f),f=[r[_]]):f.push(r[_]))}if(f&&u.push(f),e>1)for(let _=0;_<u.length;_++)u[_].length<=e||(dJ(u[_],e,1,u[_].length-1,mJ),u[_]=u[_].slice(0,e));return u}function mJ(r,e){return e.area-r.area}function Wx(r,e,n){let u=n.patternDependencies,f=!1;for(let p of e){let _=p.paint.get(`${r}-pattern`);_.isConstant()||(f=!0);let g=_.constantOr(null);g&&(f=!0,u[g]=!0)}return f}function Zx(r,e,n,u,f){let p=f.patternDependencies;for(let _ of e){let g=_.paint.get(`${r}-pattern`).value;if(g.kind!=="constant"){let b=g.evaluate({zoom:u},n,{},f.availableImages);b=b&&b.name?b.name:b,p[b]=!0,n.patterns[_.id]=b}}return n}class sy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Je,this.indexArray=new wt,this.indexArray2=new Ei,this.programConfigurations=new uu(e.layers,e.zoom),this.segments=new ai,this.segments2=new ai,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,u,f){this.hasPattern=Wx("fill",this.layers,n);let p=this.layers[0].layout.get("fill-sort-key"),_=[];for(let{feature:g,id:b,index:w,sourceLayerIndex:I}of e){let O=this.layers[0]._featureFilter.needGeometry,M=mu(g,O);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),M,u))continue;let L=p?p.evaluate(M,{},u,n.availableImages):void 0,k={id:b,properties:g.properties,type:g.type,sourceLayerIndex:I,index:w,geometry:O?M.geometry:Ja(g,u,f),patterns:{},sortKey:L};_.push(k)}p&&_.sort((g,b)=>g.sortKey-b.sortKey);for(let g of _){let{geometry:b,index:w,sourceLayerIndex:I}=g;if(this.hasPattern){let O=Zx("fill",this.layers,g,this.zoom,n);this.patternFeatures.push(O)}else this.addFeature(g,b,w,u,{},n.availableImages);n.featureIndex.insert(e[w].feature,b,w,I,this.index)}}update(e,n,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,u,f)}addFeatures(e,n,u,f,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iJ),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,u,f,p,_=[]){for(let g of Gx(n,500)){let b=0;for(let k of g)b+=k.length;let w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=w.vertexLength,O=[],M=[];for(let k of g){if(k.length===0)continue;k!==g[0]&&M.push(O.length/2);let U=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),G=U.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(G+k.length-1,G),O.push(k[0].x),O.push(k[0].y);for(let Y=1;Y<k.length;Y++)this.layoutVertexArray.emplaceBack(k[Y].x,k[Y].y),this.indexArray2.emplaceBack(G+Y-1,G+Y),O.push(k[Y].x),O.push(k[Y].y);U.vertexLength+=k.length,U.primitiveLength+=k.length}let L=$x(O,M);for(let k=0;k<L.length;k+=3)this.indexArray.emplaceBack(I+L[k],I+L[k+1],I+L[k+2]);w.vertexLength+=b,w.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,p,_,f)}}yt(sy,"FillBucket",{omit:["layers","patternFeatures"]});let _J=new ee({"fill-sort-key":new W(Re.layout_fill["fill-sort-key"])});var yJ={paint:new ee({"fill-antialias":new N(Re.paint_fill["fill-antialias"]),"fill-opacity":new W(Re.paint_fill["fill-opacity"]),"fill-color":new W(Re.paint_fill["fill-color"]),"fill-outline-color":new W(Re.paint_fill["fill-outline-color"]),"fill-translate":new N(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new N(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new W(Re.paint_fill["fill-pattern"])}),layout:_J};let gJ=ye([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),vJ=ye([{name:"a_centroid_pos",components:2,type:"Uint16"}]),xJ=ye([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:bJ}=gJ;var ly={},wJ=Kt,dO=Gc;function Gc(r,e,n,u,f){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=u,this._values=f,r.readFields(TJ,this,e)}function TJ(r,e,n){r==1?e.id=n.readVarint():r==2?function(u,f){for(var p=u.readVarint()+u.pos;u.pos<p;){var _=f._keys[u.readVarint()],g=f._values[u.readVarint()];f.properties[_]=g}}(n,e):r==3?e.type=n.readVarint():r==4&&(e._geometry=n.pos)}function EJ(r){for(var e,n,u=0,f=0,p=r.length,_=p-1;f<p;_=f++)u+=((n=r[_]).x-(e=r[f]).x)*(e.y+n.y);return u}Gc.types=["Unknown","Point","LineString","Polygon"],Gc.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,n=r.readVarint()+r.pos,u=1,f=0,p=0,_=0,g=[];r.pos<n;){if(f<=0){var b=r.readVarint();u=7&b,f=b>>3}if(f--,u===1||u===2)p+=r.readSVarint(),_+=r.readSVarint(),u===1&&(e&&g.push(e),e=[]),e.push(new wJ(p,_));else{if(u!==7)throw new Error("unknown command "+u);e&&e.push(e[0].clone())}}return e&&g.push(e),g},Gc.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,n=1,u=0,f=0,p=0,_=1/0,g=-1/0,b=1/0,w=-1/0;r.pos<e;){if(u<=0){var I=r.readVarint();n=7&I,u=I>>3}if(u--,n===1||n===2)(f+=r.readSVarint())<_&&(_=f),f>g&&(g=f),(p+=r.readSVarint())<b&&(b=p),p>w&&(w=p);else if(n!==7)throw new Error("unknown command "+n)}return[_,b,g,w]},Gc.prototype.toGeoJSON=function(r,e,n){var u,f,p=this.extent*Math.pow(2,n),_=this.extent*r,g=this.extent*e,b=this.loadGeometry(),w=Gc.types[this.type];function I(L){for(var k=0;k<L.length;k++){var U=L[k];L[k]=[360*(U.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+g)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<b.length;u++)O[u]=b[u][0];I(b=O);break;case 2:for(u=0;u<b.length;u++)I(b[u]);break;case 3:for(b=function(L){var k=L.length;if(k<=1)return[L];for(var U,G,Y=[],ae=0;ae<k;ae++){var J=EJ(L[ae]);J!==0&&(G===void 0&&(G=J<0),G===J<0?(U&&Y.push(U),U=[L[ae]]):U.push(L[ae]))}return U&&Y.push(U),Y}(b),u=0;u<b.length;u++)for(f=0;f<b[u].length;f++)I(b[u][f])}b.length===1?b=b[0]:w="Multi"+w;var M={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(M.id=this.id),M};var SJ=dO,pO=mO;function mO(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(IJ,this,e),this.length=this._features.length}function IJ(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push(function(u){for(var f=null,p=u.readVarint()+u.pos;u.pos<p;){var _=u.readVarint()>>3;f=_===1?u.readString():_===2?u.readFloat():_===3?u.readDouble():_===4?u.readVarint64():_===5?u.readVarint():_===6?u.readSVarint():_===7?u.readBoolean():null}return f}(n))}mO.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new SJ(this._pbf,e,this.extent,this._keys,this._values)};var AJ=pO;function OJ(r,e,n){if(r===3){var u=new AJ(n,n.readVarint()+n.pos);u.length&&(e[u.name]=u)}}var Hx=ly.VectorTile=function(r,e){this.layers=r.readFields(OJ,{},e)},uy=ly.VectorTileFeature=dO;function cy(r,e,n,u){let f=[],p=u===0?(_,g,b,w,I,O)=>{_.push(new Ve(O,b+(O-g)/(w-g)*(I-b)))}:(_,g,b,w,I,O)=>{_.push(new Ve(g+(O-b)/(I-b)*(w-g),O))};for(let _ of r){let g=[];for(let b of _){if(b.length<=2)continue;let w=[];for(let M=0;M<b.length-1;M++){let L=b[M].x,k=b[M].y,U=b[M+1].x,G=b[M+1].y,Y=u===0?L:k,ae=u===0?U:G;Y<e?ae>e&&p(w,L,k,U,G,e):Y>n?ae<n&&p(w,L,k,U,G,n):w.push(b[M]),ae<e&&Y>=e&&p(w,L,k,U,G,e),ae>n&&Y<=n&&p(w,L,k,U,G,n)}let I=b[b.length-1],O=u===0?I.x:I.y;O>=e&&O<=n&&w.push(I),w.length&&(I=w[w.length-1],w[0].x===I.x&&w[0].y===I.y||w.push(w[0]),g.push(w))}g.length&&f.push(g)}return f}ly.VectorTileLayer=pO;let CJ=uy.types,PJ=Math.pow(2,13);function Gd(r,e,n,u,f,p,_,g){r.emplaceBack((e<<1)+_,(n<<1)+p,(Math.floor(u*PJ)<<1)+f,Math.round(g))}function Wd(r,e,n){r.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class _O{constructor(){this.acc=new Ve(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ve(e.x,e.y),this.max=new Ve(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);let u=this.min,f=this.max;e.x<u.x?u.x=e.x:e.x>f.x&&(f.x=e.x),e.y<u.y?u.y=e.y:e.y>f.y&&(f.y=e.y),((e.x===0||e.x===St)&&e.x===n.x)!=((e.y===0||e.y===St)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,nr(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>St!=e.x>St&&this.addBorderIntersection(1,nr(n.y,e.y,(St-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,nr(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>St!=e.y>St&&this.addBorderIntersection(3,nr(n.x,e.x,(St-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let u=this.borders[e];n<u[0]&&(u[0]=n),n>u[1]&&(u[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let u=e.x===0?0:1;this.addBorderIntersection(u,n.y),this.addBorderIntersection(u,e.y)}else{let u=e.y===0?2:3;this.addBorderIntersection(u,n.x),this.addBorderIntersection(u,e.x)}}centroid(){let e=this.polyCount.reduce((n,u)=>n+u.edges,0);return e!==0?this.acc.div(e)._round():new Ve(0,0)}span(){return new Ve(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Zd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new ze,this.centroidVertexArray=new Lo,this.indexArray=new wt,this.programConfigurations=new uu(e.layers,e.zoom),this.segments=new ai,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,u,f){this.features=[],this.hasPattern=Wx("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){let _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/St/(1<<p.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:p,id:_,index:g,sourceLayerIndex:b}of e){let w=this.layers[0]._featureFilter.needGeometry,I=mu(p,w);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),I,u))continue;let O={id:_,sourceLayerIndex:b,index:g,geometry:w?I.geometry:Ja(p,u,f),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(Zx("fill-extrusion",this.layers,O,this.zoom,n)):this.addFeature(O,O.geometry,g,u,{},n.availableImages,f),n.featureIndex.insert(p,O.geometry,g,b,this.index,M)}this.sortBorders()}addFeatures(e,n,u,f,p){for(let _ of this.features){let{geometry:g}=_;this.addFeature(_,g,_.index,n,u,f,p)}this.sortBorders()}update(e,n,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bJ),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,xJ.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,vJ.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,u,f,p,_,g){let b=[new Ve(0,0),new Ve(St,St)],w=g.projection,I=w.name==="globe",O=this.enableTerrain&&!I?new _O:null,M=CJ[e.type]==="Polygon";I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new et);let L=Gx(n,500);for(let Y=L.length-1;Y>=0;Y--){let ae=L[Y];(ae.length===0||(k=ae[0]).every(J=>J.x<=0)||k.every(J=>J.x>=St)||k.every(J=>J.y<=0)||k.every(J=>J.y>=St))&&L.splice(Y,1)}var k;let U;if(I)U=TO(L,b,f);else{U=[];for(let Y of L)U.push({polygon:Y,bounds:b})}let G=M?this.edgeRadius:0;for(let{polygon:Y,bounds:ae}of U){let J=0,ie=0;for(let se of Y)M&&!se[0].equals(se[se.length-1])&&se.push(se[0]),ie+=M?se.length-1:se.length;let ue=this.segments.prepareSegment((M?5:4)*ie,this.layoutVertexArray,this.indexArray);if(M){let se=[],Ie=[];J=ue.vertexLength;for(let De of Y){let Qe,Ce;De.length&&De!==Y[0]&&Ie.push(se.length/2),Qe=De[1].sub(De[0])._perp()._unit();for(let Ue=1;Ue<De.length;Ue++){let je=De[Ue],Xe=De[Ue===De.length-1?1:Ue+1],{x:nt,y:Me}=je;if(G){Ce=Xe.sub(je)._perp()._unit();let lt=Qe.add(Ce)._unit(),bt=G*Math.min(4,1/(Qe.x*lt.x+Qe.y*lt.y));nt+=bt*lt.x,Me+=bt*lt.y,Qe=Ce}Gd(this.layoutVertexArray,nt,Me,0,0,1,1,0),ue.vertexLength++,se.push(je.x,je.y),I&&Wd(this.layoutVertexExtArray,w.projectTilePoint(nt,Me,f),w.upVector(f,nt,Me))}}let Te=$x(se,Ie);for(let De=0;De<Te.length;De+=3)this.indexArray.emplaceBack(J+Te[De],J+Te[De+2],J+Te[De+1]),ue.primitiveLength++}for(let se of Y){O&&se.length&&O.startRing(se[0]);let Ie,Te,De,Qe=se.length>4&&xO(se[se.length-2],se[0],se[1]),Ce=G?MJ(se[se.length-2],se[0],se[1],G):0;Te=se[1].sub(se[0])._perp()._unit();let Ue=!0;for(let je=1,Xe=0;je<se.length;je++){let nt=se[je-1],Me=se[je],lt=se[je===se.length-1?1:je+1];if(O&&M&&O.currentPolyCount.top++,vO(Me,nt,ae)){G&&(Te=lt.sub(Me)._perp()._unit(),Ue=!Ue);continue}O&&O.append(Me,nt);let bt=Me.sub(nt)._perp(),ut=bt.x/(Math.abs(bt.x)+Math.abs(bt.y)),Lt=bt.y>0?1:0,ot=nt.dist(Me);if(Xe+ot>32768&&(Xe=0),G){De=lt.sub(Me)._perp()._unit();let Bt=gO(nt,Me,lt,yO(Te,De),G);isNaN(Bt)&&(Bt=0);let Ct=Me.sub(nt)._unit();nt=nt.add(Ct.mult(Ce))._round(),Me=Me.add(Ct.mult(-Bt))._round(),Ce=Bt,Te=De}let Et=ue.vertexLength,kt=se.length>4&&xO(nt,Me,lt),ar=bO(Xe,Qe,Ue);if(Gd(this.layoutVertexArray,nt.x,nt.y,ut,Lt,0,0,ar),Gd(this.layoutVertexArray,nt.x,nt.y,ut,Lt,0,1,ar),Xe+=ot,ar=bO(Xe,kt,!Ue),Qe=kt,Gd(this.layoutVertexArray,Me.x,Me.y,ut,Lt,0,0,ar),Gd(this.layoutVertexArray,Me.x,Me.y,ut,Lt,0,1,ar),ue.vertexLength+=4,this.indexArray.emplaceBack(Et+0,Et+1,Et+2),this.indexArray.emplaceBack(Et+1,Et+3,Et+2),ue.primitiveLength+=2,G){let Bt=J+(je===1?se.length-2:je-2),Ct=je===1?J:Bt+1;if(this.indexArray.emplaceBack(Et+1,Bt,Et+3),this.indexArray.emplaceBack(Bt,Ct,Et+3),ue.primitiveLength+=2,Ie===void 0&&(Ie=Et),!vO(lt,se[je],ae)){let Lr=je===se.length-1?Ie:ue.vertexLength;this.indexArray.emplaceBack(Et+2,Et+3,Lr),this.indexArray.emplaceBack(Et+3,Lr+1,Lr),this.indexArray.emplaceBack(Et+3,Ct,Lr+1),ue.primitiveLength+=3}Ue=!Ue}if(I){let Bt=this.layoutVertexExtArray,Ct=w.projectTilePoint(nt.x,nt.y,f),Lr=w.projectTilePoint(Me.x,Me.y,f),Ut=w.upVector(f,nt.x,nt.y),jt=w.upVector(f,Me.x,Me.y);Wd(Bt,Ct,Ut),Wd(Bt,Ct,Ut),Wd(Bt,Lr,jt),Wd(Bt,Lr,jt)}}M&&(J+=se.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;let Y=O.borders,ae=this.featuresOnBorder.push(O)-1;for(let J=0;J<4;J++)Y[J][0]!==Number.MAX_VALUE&&this.borders[J].push(ae)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,p,_,f)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,u)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[u].borders[e][0])}encodeCentroid(e,n,u=!0){let f,p;if(e)if(e.y!==0){let g=n.span()._mult(this.tileToMeter);f=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else f=Math.ceil(7*(e.x+450)),p=0;else f=0,p=+u;let _=u?this.centroidVertexArray.length:n.vertexArrayOffset;for(let g of n.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let b=0;b<g.top;b++)this.centroidVertexArray.emplace(_++,f,p);for(let b=0;b<2*g.edges;b++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,f,p)}}}function yO(r,e){let n=r.add(e)._unit();return r.x*n.x+r.y*n.y}function MJ(r,e,n,u){let f=e.sub(r)._perp()._unit(),p=n.sub(e)._perp()._unit();return gO(r,e,n,yO(f,p),u)}function gO(r,e,n,u,f){let p=Math.sqrt(1-u*u);return Math.min(r.dist(e)/3,e.dist(n)/3,f*p/u)}function vO(r,e,n){return r.x<n[0].x&&e.x<n[0].x||r.x>n[1].x&&e.x>n[1].x||r.y<n[0].y&&e.y<n[0].y||r.y>n[1].y&&e.y>n[1].y}function xO(r,e,n){if(r.x<0||r.x>=St||e.x<0||e.x>=St||n.x<0||n.x>=St)return!1;let u=n.sub(e),f=u.perp(),p=r.sub(e);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&f.x*p.x+f.y*p.y<0}function bO(r,e,n){let u=e?2|r:-3&r;return n?1|u:-2&u}function wO(){let r=Math.PI/32,e=Math.tan(r),n=Nd;return n*Math.sqrt(1+2*e*e)-n}function TO(r,e,n){let u=1<<n.z,f=Wn(n.x/u),p=Wn((n.x+1)/u),_=Bi(n.y/u),g=Bi((n.y+1)/u);return function(b,w,I,O,M=0,L){let k=[];if(!b.length||!I||!O)return k;let U=(se,Ie)=>{for(let Te of se)k.push({polygon:Te,bounds:Ie})},G=Math.ceil(Math.log2(I)),Y=Math.ceil(Math.log2(O)),ae=G-Y,J=[];for(let se=0;se<Math.abs(ae);se++)J.push(ae>0?0:1);for(let se=0;se<Math.min(G,Y);se++)J.push(0),J.push(1);let ie=b;if(ie=cy(ie,w[0].y-M,w[1].y+M,1),ie=cy(ie,w[0].x-M,w[1].x+M,0),!ie.length)return k;let ue=[];for(J.length?ue.push({polygons:ie,bounds:w,depth:0}):U(ie,w);ue.length;){let se=ue.pop(),Ie=se.depth,Te=J[Ie],De=se.bounds[0],Qe=se.bounds[1],Ce=Te===0?De.x:De.y,Ue=Te===0?Qe.x:Qe.y,je=L?L(Te,Ce,Ue):.5*(Ce+Ue),Xe=cy(se.polygons,Ce-M,je+M,Te),nt=cy(se.polygons,je-M,Ue+M,Te);if(Xe.length){let Me=[De,new Ve(Te===0?je:Qe.x,Te===1?je:Qe.y)];J.length>Ie+1?ue.push({polygons:Xe,bounds:Me,depth:Ie+1}):U(Xe,Me)}if(nt.length){let Me=[new Ve(Te===0?je:De.x,Te===1?je:De.y),Qe];J.length>Ie+1?ue.push({polygons:nt,bounds:Me,depth:Ie+1}):U(nt,Me)}}return k}(r,e,Math.ceil((p-f)/11.25),Math.ceil((_-g)/11.25),1,(b,w,I)=>{if(b===0)return .5*(w+I);{let O=Bi((n.y+w/St)/u);return(fa(.5*(Bi((n.y+I/St)/u)+O))*u-n.y)*St}})}yt(Zd,"FillExtrusionBucket",{omit:["layers","features"]}),yt(_O,"PartMetadata");let qJ=new ee({"fill-extrusion-edge-radius":new N(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var RJ={paint:new ee({"fill-extrusion-opacity":new N(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new W(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new N(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new N(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new W(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new W(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new W(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new N(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new N(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new N(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new N(Re["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:qJ};function EO(r,e,n){var u=2*Math.PI*6378137/256/Math.pow(2,n);return[r*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}class hy{constructor(e,n,u){this.z=e,this.x=n,this.y=u,this.key=Hd(0,e,e,n,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let u=function(p,_,g){var b=EO(256*p,256*(_=Math.pow(2,g)-_-1),g),w=EO(256*(p+1),256*(_+1),g);return b[0]+","+b[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),f=function(p,_,g){let b,w="";for(let I=p;I>0;I--)b=1<<I-1,w+=(_&b?1:0)+(g&b?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class SO{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Hd(e,n.z,n.z,n.x,n.y)}}class Qi{constructor(e,n,u,f,p){this.overscaledZ=e,this.wrap=n,this.canonical=new hy(u,+f,+p),this.key=n===0&&e===u?this.canonical.key:Hd(n,e,u,f,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Qi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qi(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Hd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let u=this.canonical.z-e;return Hd(this.wrap*+n,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Qi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Qi(n,this.wrap,n,u,f),new Qi(n,this.wrap,n,u+1,f),new Qi(n,this.wrap,n,u,f+1),new Qi(n,this.wrap,n,u+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Qi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Qi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new SO(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Hd(r,e,n,u,f){let p=1<<Math.min(n,22),_=p*(f%p)+u%p;return r&&n<22&&(_+=p*p*((r<0?-2*r-1:2*r)%(1<<2*(22-n)))),16*(32*_+n)+(e-n)}yt(hy,"CanonicalTileID"),yt(Qi,"OverscaledTileID",{omit:["projMatrix"]});class Wc extends Ve{constructor(e,n,u){super(e,n),this.z=u}}function Xd(r,e){return r.x*e.x+r.y*e.y}function IO(r,e){if(r.length===1){let n=0,u=e[n++],f;for(;!f||u.equals(f);)if(f=e[n++],!f)return 1/0;for(;n<e.length;n++){let p=e[n],_=r[0],g=f.sub(u),b=p.sub(u),w=_.sub(u),I=Xd(g,g),O=Xd(g,b),M=Xd(b,b),L=Xd(w,g),k=Xd(w,b),U=I*M-O*O,G=(M*L-O*k)/U,Y=(I*k-O*L)/U,ae=u.z*(1-G-Y)+f.z*G+p.z*Y;if(isFinite(ae))return ae}return 1/0}{let n=1/0;for(let u of e)n=Math.min(n,u.z);return n}}function AO(r,e,n,u,f,p,_,g){let b=_*f.getElevationAt(r,e,!0,!0),w=p[0]!==0,I=w?p[1]===0?_*(p[0]/7-450):_*function(O,M,L){let k=Math.floor(M[0]/8),U=Math.floor(M[1]/8),G=10*(M[0]-8*k),Y=10*(M[1]-8*U),ae=O.getElevationAt(k,U,!0,!0),J=O.getMeterToDEM(L),ie=Math.floor(.5*(G*J-1)),ue=Math.floor(.5*(Y*J-1)),se=O.tileCoordToPixel(k,U),Ie=2*ie+1,Te=2*ue+1,De=function(nt,Me,lt,bt,ut){return[nt.getElevationAtPixel(Me,lt,!0),nt.getElevationAtPixel(Me+ut,lt,!0),nt.getElevationAtPixel(Me,lt+ut,!0),nt.getElevationAtPixel(Me+bt,lt+ut,!0)]}(O,se.x-ie,se.y-ue,Ie,Te),Qe=Math.abs(De[0]-De[1]),Ce=Math.abs(De[2]-De[3]),Ue=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),je=Math.min(.25,.5*J*(Qe+Ce)/Ie),Xe=Math.min(.25,.5*J*Ue/Te);return ae+Math.max(je*G,Xe*Y)}(f,p,g):b;return{base:b+(n===0)?-1:n,top:w?Math.max(I+u,b+n+2):b+u}}let DJ=ye([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:LJ}=DJ,kJ=ye([{name:"a_packed",components:4,type:"Float32"}]),{members:BJ}=kJ,zJ=uy.types,FJ=Math.cos(Math.PI/180*37.5);class fy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Oe,this.layoutVertexArray2=new Ye,this.indexArray=new wt,this.programConfigurations=new uu(e.layers,e.zoom),this.segments=new ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,u,f){this.hasPattern=Wx("line",this.layers,n);let p=this.layers[0].layout.get("line-sort-key"),_=[];for(let{feature:I,id:O,index:M,sourceLayerIndex:L}of e){let k=this.layers[0]._featureFilter.needGeometry,U=mu(I,k);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),U,u))continue;let G=p?p.evaluate(U,{},u):void 0,Y={id:O,properties:I.properties,type:I.type,sourceLayerIndex:L,index:M,geometry:k?U.geometry:Ja(I,u,f),patterns:{},sortKey:G};_.push(Y)}p&&_.sort((I,O)=>I.sortKey-O.sortKey);let{lineAtlas:g,featureIndex:b}=n,w=this.addConstantDashes(g);for(let I of _){let{geometry:O,index:M,sourceLayerIndex:L}=I;if(w&&this.addFeatureDashes(I,g),this.hasPattern){let k=Zx("line",this.layers,I,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(I,O,M,u,g.positions,n.availableImages);b.insert(e[M].feature,O,M,L,this.index)}}addConstantDashes(e){let n=!1;for(let u of this.layers){let f=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(f.kind!=="constant"||p.kind!=="constant")n=!0;else{let _=p.value,g=f.value;if(!g)continue;e.addDash(g,_)}}return n}addFeatureDashes(e,n){let u=this.zoom;for(let f of this.layers){let p=f.paint.get("line-dasharray").value,_=f.layout.get("line-cap").value;if(p.kind==="constant"&&_.kind==="constant")continue;let g,b;if(p.kind==="constant"){if(g=p.value,!g)continue}else g=p.evaluate({zoom:u},e);b=_.kind==="constant"?_.value:_.evaluate({zoom:u},e),n.addDash(g,b),e.patterns[f.id]=n.getKey(g,b)}}update(e,n,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,u,f)}addFeatures(e,n,u,f,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,BJ)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LJ),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,u,f,p,_){let g=this.layers[0].layout,b=g.get("line-join").evaluate(e,{}),w=g.get("line-cap").evaluate(e,{}),I=g.get("line-miter-limit"),O=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let M of n)this.addLine(M,e,b,w,I,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,p,_,f)}addLine(e,n,u,f,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let g=zJ[n.type]==="Polygon",b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(g?3:2))return;u==="bevel"&&(p=1.05);let I=this.overscaling<=16?15*St/(512*this.overscaling):0,O=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray),M,L,k,U,G;this.e1=this.e2=-1,g&&(M=e[b-2],G=e[w].sub(M)._unit()._perp());for(let Y=w;Y<b;Y++){if(k=Y===b-1?g?e[w+1]:void 0:e[Y+1],k&&e[Y].equals(k))continue;G&&(U=G),M&&(L=M),M=e[Y],G=k?k.sub(M)._unit()._perp():U,U=U||G;let ae=U.add(G);ae.x===0&&ae.y===0||ae._unit();let J=U.x*G.x+U.y*G.y,ie=ae.x*G.x+ae.y*G.y,ue=ie!==0?1/ie:1/0,se=2*Math.sqrt(2-2*ie),Ie=ie<FJ&&L&&k,Te=U.x*G.y-U.y*G.x>0;if(Ie&&Y>w){let Ce=M.dist(L);if(Ce>2*I){let Ue=M.sub(M.sub(L)._mult(I/Ce)._round());this.updateDistance(L,Ue),this.addCurrentVertex(Ue,U,0,0,O),L=Ue}}let De=L&&k,Qe=De?u:g?"butt":f;if(De&&Qe==="round"&&(ue<_?Qe="miter":ue<=2&&(Qe="fakeround")),Qe==="miter"&&ue>p&&(Qe="bevel"),Qe==="bevel"&&(ue>2&&(Qe="flipbevel"),ue<p&&(Qe="miter")),L&&this.updateDistance(L,M),Qe==="miter")ae._mult(ue),this.addCurrentVertex(M,ae,0,0,O);else if(Qe==="flipbevel"){if(ue>100)ae=G.mult(-1);else{let Ce=ue*U.add(G).mag()/U.sub(G).mag();ae._perp()._mult(Ce*(Te?-1:1))}this.addCurrentVertex(M,ae,0,0,O),this.addCurrentVertex(M,ae.mult(-1),0,0,O)}else if(Qe==="bevel"||Qe==="fakeround"){let Ce=-Math.sqrt(ue*ue-1),Ue=Te?Ce:0,je=Te?0:Ce;if(L&&this.addCurrentVertex(M,U,Ue,je,O),Qe==="fakeround"){let Xe=Math.round(180*se/Math.PI/20);for(let nt=1;nt<Xe;nt++){let Me=nt/Xe;if(Me!==.5){let bt=Me-.5;Me+=Me*bt*(Me-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*bt*bt+(.848013+J*(.215638*J-1.06021)))}let lt=G.sub(U)._mult(Me)._add(U)._unit()._mult(Te?-1:1);this.addHalfVertex(M,lt.x,lt.y,!1,Te,0,O)}}k&&this.addCurrentVertex(M,G,-Ue,-je,O)}else if(Qe==="butt")this.addCurrentVertex(M,ae,0,0,O);else if(Qe==="square"){let Ce=L?1:-1;L||this.addCurrentVertex(M,ae,Ce,Ce,O),this.addCurrentVertex(M,ae,0,0,O),L&&this.addCurrentVertex(M,ae,Ce,Ce,O)}else Qe==="round"&&(L&&(this.addCurrentVertex(M,U,0,0,O),this.addCurrentVertex(M,U,1,1,O,!0)),k&&(this.addCurrentVertex(M,G,-1,-1,O,!0),this.addCurrentVertex(M,G,0,0,O)));if(Ie&&Y<b-1){let Ce=M.dist(k);if(Ce>2*I){let Ue=M.add(k.sub(M)._mult(I/Ce)._round());this.updateDistance(M,Ue),this.addCurrentVertex(Ue,G,0,0,O),M=Ue}}}}addCurrentVertex(e,n,u,f,p,_=!1){let g=n.y*f-n.x,b=-n.y-n.x*f;this.addHalfVertex(e,n.x+n.y*u,n.y-n.x*u,_,!1,u,p),this.addHalfVertex(e,g,b,_,!0,-f,p)}addHalfVertex({x:e,y:n},u,f,p,_,g,b){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),_?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}yt(fy,"LineBucket",{omit:["layers","patternFeatures"]});let NJ=new ee({"line-cap":new W(Re.layout_line["line-cap"]),"line-join":new W(Re.layout_line["line-join"]),"line-miter-limit":new N(Re.layout_line["line-miter-limit"]),"line-round-limit":new N(Re.layout_line["line-round-limit"]),"line-sort-key":new W(Re.layout_line["line-sort-key"])});var OO={paint:new ee({"line-opacity":new W(Re.paint_line["line-opacity"]),"line-color":new W(Re.paint_line["line-color"]),"line-translate":new N(Re.paint_line["line-translate"]),"line-translate-anchor":new N(Re.paint_line["line-translate-anchor"]),"line-width":new W(Re.paint_line["line-width"]),"line-gap-width":new W(Re.paint_line["line-gap-width"]),"line-offset":new W(Re.paint_line["line-offset"]),"line-blur":new W(Re.paint_line["line-blur"]),"line-dasharray":new W(Re.paint_line["line-dasharray"]),"line-pattern":new W(Re.paint_line["line-pattern"]),"line-gradient":new Q(Re.paint_line["line-gradient"]),"line-trim-offset":new N(Re.paint_line["line-trim-offset"])}),layout:NJ};let CO=new class extends W{possiblyEvaluate(r,e){return e=new A(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,n,u){return e=vt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,n,u)}}(OO.paint.properties["line-width"].specification);function PO(r,e){return e>0?e+2*r:r}CO.useIntegerZoom=!0;let UJ=ye([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jJ=ye([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),VJ=ye([{name:"a_projected_pos",components:4,type:"Float32"}],4);ye([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let $J=ye([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),GJ=ye([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let MO=ye([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WJ=ye([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ye([{name:"triangle",components:3,type:"Uint16"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ye([{type:"Float32",name:"offsetX"}]),ye([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Pi=24;let Uo=128;function Xx(r,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new A(r+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:u,interpolationType:f}=n,p=0;for(;p<u.length&&u[p]<=r;)p++;p=Math.max(0,p-1);let _=p;for(;_<u.length&&u[_]<r+1;)_++;_=Math.min(u.length-1,_);let g=u[p],b=u[_];return n.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:b,interpolationType:f}:{kind:"camera",minZoom:g,maxZoom:b,minSize:n.evaluate(new A(g)),maxSize:n.evaluate(new A(b)),interpolationType:f}}}function dy(r,{uSize:e,uSizeT:n},{lowerSize:u,upperSize:f}){return r.kind==="source"?u/Uo:r.kind==="composite"?nr(u/Uo,f/Uo,n):e}function Zc(r,e){let n=0,u=0;if(r.kind==="constant")u=r.layoutSize;else if(r.kind!=="source"){let{interpolationType:f,minZoom:p,maxZoom:_}=r,g=f?Ne(io.interpolationFactor(f,e,p,_),0,1):0;r.kind==="camera"?u=nr(r.minSize,r.maxSize,g):n=g}return{uSizeT:n,uSize:u}}var ZJ=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Uo,evaluateSizeForFeature:dy,evaluateSizeForZoom:Zc,getSizeData:Xx});function HJ(r,e,n){return r.sections.forEach(u=>{u.text=function(f,p,_){let g=p.layout.get("text-transform").evaluate(_,{});return g==="uppercase"?f=f.toLocaleUpperCase():g==="lowercase"&&(f=f.toLocaleLowerCase()),E.applyArabicShaping&&(f=E.applyArabicShaping(f)),f}(u.text,e,n)}),r}let Kd={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function XJ(r){return r==="\uFE36"||r==="\uFE48"||r==="\uFE38"||r==="\uFE44"||r==="\uFE42"||r==="\uFE3E"||r==="\uFE3C"||r==="\uFE3A"||r==="\uFE18"||r==="\uFE40"||r==="\uFE10"||r==="\uFE13"||r==="\uFE14"||r==="\uFF40"||r==="\uFFE3"||r==="\uFE11"||r==="\uFE12"}function KJ(r){return r==="\uFE35"||r==="\uFE47"||r==="\uFE37"||r==="\uFE43"||r==="\uFE41"||r==="\uFE3D"||r==="\uFE3B"||r==="\uFE39"||r==="\uFE17"||r==="\uFE3F"}var qO=Cr,RO=function(r,e,n,u,f){var p,_,g=8*f-u-1,b=(1<<g)-1,w=b>>1,I=-7,O=n?f-1:0,M=n?-1:1,L=r[e+O];for(O+=M,p=L&(1<<-I)-1,L>>=-I,I+=g;I>0;p=256*p+r[e+O],O+=M,I-=8);for(_=p&(1<<-I)-1,p>>=-I,I+=u;I>0;_=256*_+r[e+O],O+=M,I-=8);if(p===0)p=1-w;else{if(p===b)return _?NaN:1/0*(L?-1:1);_+=Math.pow(2,u),p-=w}return(L?-1:1)*_*Math.pow(2,p-u)},DO=function(r,e,n,u,f,p){var _,g,b,w=8*p-f-1,I=(1<<w)-1,O=I>>1,M=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=u?0:p-1,k=u?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,_=I):(_=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-_))<1&&(_--,b*=2),(e+=_+O>=1?M/b:M*Math.pow(2,1-O))*b>=2&&(_++,b/=2),_+O>=I?(g=0,_=I):_+O>=1?(g=(e*b-1)*Math.pow(2,f),_+=O):(g=e*Math.pow(2,O-1)*Math.pow(2,f),_=0));f>=8;r[n+L]=255&g,L+=k,g/=256,f-=8);for(_=_<<f|g,w+=f;w>0;r[n+L]=255&_,L+=k,_/=256,w-=8);r[n+L-k]|=128*U};function Cr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Cr.Varint=0,Cr.Fixed64=1,Cr.Bytes=2,Cr.Fixed32=5;var Kx=4294967296,LO=1/Kx,kO=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function es(r){return r.type===Cr.Bytes?r.readVarint()+r.pos:r.pos+1}function Hc(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function BO(r,e,n){var u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(u);for(var f=n.pos-1;f>=r;f--)n.buf[f+u]=n.buf[f]}function YJ(r,e){for(var n=0;n<r.length;n++)e.writeVarint(r[n])}function JJ(r,e){for(var n=0;n<r.length;n++)e.writeSVarint(r[n])}function QJ(r,e){for(var n=0;n<r.length;n++)e.writeFloat(r[n])}function eQ(r,e){for(var n=0;n<r.length;n++)e.writeDouble(r[n])}function tQ(r,e){for(var n=0;n<r.length;n++)e.writeBoolean(r[n])}function rQ(r,e){for(var n=0;n<r.length;n++)e.writeFixed32(r[n])}function iQ(r,e){for(var n=0;n<r.length;n++)e.writeSFixed32(r[n])}function nQ(r,e){for(var n=0;n<r.length;n++)e.writeFixed64(r[n])}function oQ(r,e){for(var n=0;n<r.length;n++)e.writeSFixed64(r[n])}function py(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function Xc(r,e,n){r[n]=e,r[n+1]=e>>>8,r[n+2]=e>>>16,r[n+3]=e>>>24}function zO(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Cr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,n){for(n=n||this.length;this.pos<n;){var u=this.readVarint(),f=u>>3,p=this.pos;this.type=7&u,r(f,e,this),this.pos===p&&this.skip(u)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=py(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=zO(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=py(this.buf,this.pos)+py(this.buf,this.pos+4)*Kx;return this.pos+=8,r},readSFixed64:function(){var r=py(this.buf,this.pos)+zO(this.buf,this.pos+4)*Kx;return this.pos+=8,r},readFloat:function(){var r=RO(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=RO(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,n,u=this.buf;return e=127&(n=u[this.pos++]),n<128?e:(e|=(127&(n=u[this.pos++]))<<7,n<128?e:(e|=(127&(n=u[this.pos++]))<<14,n<128?e:(e|=(127&(n=u[this.pos++]))<<21,n<128?e:function(f,p,_){var g,b,w=_.buf;if(g=(112&(b=w[_.pos++]))>>4,b<128||(g|=(127&(b=w[_.pos++]))<<3,b<128)||(g|=(127&(b=w[_.pos++]))<<10,b<128)||(g|=(127&(b=w[_.pos++]))<<17,b<128)||(g|=(127&(b=w[_.pos++]))<<24,b<128)||(g|=(1&(b=w[_.pos++]))<<31,b<128))return Hc(f,g,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=u[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&kO?function(n,u,f){return kO.decode(n.subarray(u,f))}(this.buf,e,r):function(n,u,f){for(var p="",_=u;_<f;){var g,b,w,I=n[_],O=null,M=I>239?4:I>223?3:I>191?2:1;if(_+M>f)break;M===1?I<128&&(O=I):M===2?(192&(g=n[_+1]))==128&&(O=(31&I)<<6|63&g)<=127&&(O=null):M===3?(b=n[_+2],(192&(g=n[_+1]))==128&&(192&b)==128&&((O=(15&I)<<12|(63&g)<<6|63&b)<=2047||O>=55296&&O<=57343)&&(O=null)):M===4&&(b=n[_+2],w=n[_+3],(192&(g=n[_+1]))==128&&(192&b)==128&&(192&w)==128&&((O=(15&I)<<18|(63&g)<<12|(63&b)<<6|63&w)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,M=1):O>65535&&(O-=65536,p+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),p+=String.fromCharCode(O),_+=M}return p}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Cr.Bytes)return r.push(this.readVarint(e));var n=es(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Cr.Bytes)return r.push(this.readSVarint());var e=es(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Cr.Bytes)return r.push(this.readBoolean());var e=es(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Cr.Bytes)return r.push(this.readFloat());var e=es(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Cr.Bytes)return r.push(this.readDouble());var e=es(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Cr.Bytes)return r.push(this.readFixed32());var e=es(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Cr.Bytes)return r.push(this.readSFixed32());var e=es(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Cr.Bytes)return r.push(this.readFixed64());var e=es(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Cr.Bytes)return r.push(this.readSFixed64());var e=es(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Cr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Cr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Cr.Fixed32)this.pos+=4;else{if(e!==Cr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Xc(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Xc(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Xc(this.buf,-1&r,this.pos),Xc(this.buf,Math.floor(r*LO),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Xc(this.buf,-1&r,this.pos),Xc(this.buf,Math.floor(r*LO),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,n){var u,f;if(e>=0?(u=e%4294967296|0,f=e/4294967296|0):(f=~(-e/4294967296),4294967295^(u=~(-e%4294967296))?u=u+1|0:(u=0,f=f+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(p,_,g){g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,g.buf[g.pos]=127&(p>>>=7)}(u,0,n),function(p,_){var g=(7&p)<<4;_.buf[_.pos++]|=g|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(f,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(u,f,p){for(var _,g,b=0;b<f.length;b++){if((_=f.charCodeAt(b))>55295&&_<57344){if(!g){_>56319||b+1===f.length?(u[p++]=239,u[p++]=191,u[p++]=189):g=_;continue}if(_<56320){u[p++]=239,u[p++]=191,u[p++]=189,g=_;continue}_=g-55296<<10|_-56320|65536,g=null}else g&&(u[p++]=239,u[p++]=191,u[p++]=189,g=null);_<128?u[p++]=_:(_<2048?u[p++]=_>>6|192:(_<65536?u[p++]=_>>12|224:(u[p++]=_>>18|240,u[p++]=_>>12&63|128),u[p++]=_>>6&63|128),u[p++]=63&_|128)}return p}(this.buf,r,this.pos);var n=this.pos-e;n>=128&&BO(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),DO(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),DO(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,e){this.pos++;var n=this.pos;r(e,this);var u=this.pos-n;u>=128&&BO(n,u,this),this.pos=n-1,this.writeVarint(u),this.pos+=u},writeMessage:function(r,e,n){this.writeTag(r,Cr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,YJ,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,JJ,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,tQ,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,QJ,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,eQ,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,rQ,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,iQ,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,nQ,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,oQ,e)},writeBytesField:function(r,e){this.writeTag(r,Cr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Cr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Cr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Cr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Cr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Cr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Cr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Cr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Cr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Cr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var my=Ge(qO);let Yx=3;function aQ(r,e,n){e.glyphs=[],r===1&&n.readMessage(sQ,e)}function sQ(r,e,n){if(r===3){let{id:u,bitmap:f,width:p,height:_,left:g,top:b,advance:w}=n.readMessage(lQ,{});e.glyphs.push({id:u,bitmap:new Qa({width:p+2*Yx,height:_+2*Yx},f),metrics:{width:p,height:_,left:g,top:b,advance:w}})}else r===4?e.ascender=n.readSVarint():r===5&&(e.descender=n.readSVarint())}function lQ(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}let FO=Yx;function Jx(r){let e=0,n=0;for(let _ of r)e+=_.w*_.h,n=Math.max(n,_.w);r.sort((_,g)=>g.h-_.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],f=0,p=0;for(let _ of r)for(let g=u.length-1;g>=0;g--){let b=u[g];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,p=Math.max(p,_.y+_.h),f=Math.max(f,_.x+_.w),_.w===b.w&&_.h===b.h){let w=u.pop();g<u.length&&(u[g]=w)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(u.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:f,h:p,fill:e/(f*p)||0}}let hn=1;class Qx{constructor(e,{pixelRatio:n,version:u,stretchX:f,stretchY:p,content:_}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=f,this.stretchY=p,this.content=_,this.version=u}get tl(){return[this.paddedRect.x+hn,this.paddedRect.y+hn]}get br(){return[this.paddedRect.x+this.paddedRect.w-hn,this.paddedRect.y+this.paddedRect.h-hn]}get displaySize(){return[(this.paddedRect.w-2*hn)/this.pixelRatio,(this.paddedRect.h-2*hn)/this.pixelRatio]}}class NO{constructor(e,n){let u={},f={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,u,p),this.addImages(n,f,p);let{w:_,h:g}=Jx(p),b=new On({width:_||1,height:g||1});for(let w in e){let I=e[w],O=u[w].paddedRect;On.copy(I.data,b,{x:0,y:0},{x:O.x+hn,y:O.y+hn},I.data)}for(let w in n){let I=n[w],O=f[w].paddedRect,M=O.x+hn,L=O.y+hn,k=I.data.width,U=I.data.height;On.copy(I.data,b,{x:0,y:0},{x:M,y:L},I.data),On.copy(I.data,b,{x:0,y:U-1},{x:M,y:L-1},{width:k,height:1}),On.copy(I.data,b,{x:0,y:0},{x:M,y:L+U},{width:k,height:1}),On.copy(I.data,b,{x:k-1,y:0},{x:M-1,y:L},{width:1,height:U}),On.copy(I.data,b,{x:0,y:0},{x:M+k,y:L},{width:1,height:U})}this.image=b,this.iconPositions=u,this.patternPositions=f}addImages(e,n,u){for(let f in e){let p=e[f],_={x:0,y:0,w:p.data.width+2*hn,h:p.data.height+2*hn};u.push(_),n[f]=new Qx(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let u in e.updatedImages)this.patchUpdatedImage(this.iconPositions[u],e.getImage(u),n),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u),n)}patchUpdatedImage(e,n,u){if(!e||!n||e.version===n.version)return;e.version=n.version;let[f,p]=e.tl;u.update(n.data,void 0,{x:f,y:p})}}yt(Qx,"ImagePosition"),yt(NO,"ImageAtlas");let Zn={horizontal:1,vertical:2,horizontalOnly:3},UO=-17;class Yd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let u=new Yd;return u.scale=e||1,u.fontStack=n,u}static forImage(e){let n=new Yd;return n.imageName=e,n}}class Kc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let u=new Kc;for(let f=0;f<e.sections.length;f++){let p=e.sections[f];p.image?u.addImageSection(p):u.addTextSection(p,n)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,u){let f="";for(let p=0;p<n.length;p++){let _=n.charCodeAt(p+1)||null,g=n.charCodeAt(p-1)||null;f+=!u&&(_&&$_(_)&&!Kd[n[p+1]]||g&&$_(g)&&!Kd[n[p-1]])||!Kd[n[p]]?n[p]:Kd[n[p]]}return f}(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&_y[this.text.charCodeAt(u)];u++)e++;let n=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&_y[this.text.charCodeAt(u)];u--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let u=new Kc;return u.text=this.text.substring(e,n),u.sectionIndex=this.sectionIndex.slice(e,n),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Yd.forText(e.scale,e.fontStack||n));let u=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(u)}addImageSection(e){let n=e.image?e.image.name:"";if(n.length===0)return void jr("Can't add FormattedSection with an empty image.");let u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Yd.forImage(n)),this.sectionIndex.push(this.sections.length-1)):jr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function e1(r,e,n,u,f,p,_,g,b,w,I,O,M,L,k){let U=Kc.fromFeature(r,f);O===Zn.vertical&&U.verticalizePunctuation(M);let G=[],Y=function(se,Ie,Te,De,Qe,Ce){if(!se)return[];let Ue=[],je=function(lt,bt,ut,Lt,ot,Et){let kt=0;for(let ar=0;ar<lt.length();ar++){let Bt=lt.getSection(ar);kt+=jO(lt.getCharCode(ar),Bt,Lt,ot,bt,Et)}return kt/Math.max(1,Math.ceil(kt/ut))}(se,Ie,Te,De,Qe,Ce),Xe=se.text.indexOf("\u200B")>=0,nt=0;for(let lt=0;lt<se.length();lt++){let bt=se.getSection(lt),ut=se.getCharCode(lt);if(_y[ut]||(nt+=jO(ut,bt,De,Qe,Ie,Ce)),lt<se.length()-1){let Lt=!((Me=ut)<11904||!(ht["Bopomofo Extended"](Me)||ht.Bopomofo(Me)||ht["CJK Compatibility Forms"](Me)||ht["CJK Compatibility Ideographs"](Me)||ht["CJK Compatibility"](Me)||ht["CJK Radicals Supplement"](Me)||ht["CJK Strokes"](Me)||ht["CJK Symbols and Punctuation"](Me)||ht["CJK Unified Ideographs Extension A"](Me)||ht["CJK Unified Ideographs"](Me)||ht["Enclosed CJK Letters and Months"](Me)||ht["Halfwidth and Fullwidth Forms"](Me)||ht.Hiragana(Me)||ht["Ideographic Description Characters"](Me)||ht["Kangxi Radicals"](Me)||ht["Katakana Phonetic Extensions"](Me)||ht.Katakana(Me)||ht["Vertical Forms"](Me)||ht["Yi Radicals"](Me)||ht["Yi Syllables"](Me)));(uQ[ut]||Lt||bt.imageName)&&Ue.push($O(lt+1,nt,je,Ue,cQ(ut,se.getCharCode(lt+1),Lt&&Xe),!1))}}var Me;return GO($O(se.length(),nt,je,Ue,0,!0))}(U,w,p,e,u,L),{processBidirectionalText:ae,processStyledBidirectionalText:J}=E;if(ae&&U.sections.length===1){let se=ae(U.toString(),Y);for(let Ie of se){let Te=new Kc;Te.text=Ie,Te.sections=U.sections;for(let De=0;De<Ie.length;De++)Te.sectionIndex.push(0);G.push(Te)}}else if(J){let se=J(U.text,U.sectionIndex,Y);for(let Ie of se){let Te=new Kc;Te.text=Ie[0],Te.sectionIndex=Ie[1],Te.sections=U.sections,G.push(Te)}}else G=function(se,Ie){let Te=[],De=se.text,Qe=0;for(let Ce of Ie)Te.push(se.substring(Qe,Ce)),Qe=Ce;return Qe<De.length&&Te.push(se.substring(Qe,De.length)),Te}(U,Y);let ie=[],ue={positionedLines:ie,text:U.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,Ie,Te,De,Qe,Ce,Ue,je,Xe,nt,Me,lt){let bt=0,ut=0,Lt=0,ot=je==="right"?1:je==="left"?0:.5,Et=!1;for(let Ut of Qe){let jt=Ut.getSections();for(let Sr of jt){if(Sr.imageName)continue;let Pr=Ie[Sr.fontStack];if(Pr&&(Et=Pr.ascender!==void 0&&Pr.descender!==void 0,!Et))break}if(!Et)break}let kt=0;for(let Ut of Qe){Ut.trim();let jt=Ut.getMaxScale(),Sr=(jt-1)*Pi,Pr={positionedGlyphs:[],lineOffset:0};se.positionedLines[kt]=Pr;let Mr=Pr.positionedGlyphs,Ir=0;if(!Ut.length()){ut+=Ce,++kt;continue}let $r=0,Xr=0;for(let Ar=0;Ar<Ut.length();Ar++){let mi=Ut.getSection(Ar),ui=Ut.getSectionIndex(Ar),Gr=Ut.getCharCode(Ar),lr=mi.scale,ci=null,qr=null,en=null,hi=Pi,Mi=0,Si=!(Xe===Zn.horizontal||!Me&&!Ed(Gr)||Me&&(_y[Gr]||(ar=Gr,ht.Arabic(ar)||ht["Arabic Supplement"](ar)||ht["Arabic Extended-A"](ar)||ht["Arabic Presentation Forms-A"](ar)||ht["Arabic Presentation Forms-B"](ar))));if(mi.imageName){let tn=De[mi.imageName];if(!tn)continue;en=mi.imageName,se.iconsInText=se.iconsInText||!0,qr=tn.paddedRect;let Ii=tn.displaySize;lr=lr*Pi/lt,ci={width:Ii[0],height:Ii[1],left:hn,top:-FO,advance:Si?Ii[1]:Ii[0],localGlyph:!1},Mi=Et?-ci.height*lr:UO+jt*Pi-Ii[1]*lr,hi=ci.advance;let $o=(Si?Ii[0]:Ii[1])*lr-Pi*jt;$o>0&&$o>Ir&&(Ir=$o)}else{let tn=Te[mi.fontStack];if(!tn)continue;tn[Gr]&&(qr=tn[Gr]);let Ii=Ie[mi.fontStack];if(!Ii)continue;let $o=Ii.glyphs[Gr];if(!$o)continue;if(ci=$o.metrics,hi=Gr!==8203?Pi:0,Et){let ih=Ii.ascender!==void 0?Math.abs(Ii.ascender):0,sp=Ii.descender!==void 0?Math.abs(Ii.descender):0,lp=(ih+sp)*lr;$r<lp&&($r=lp,Xr=(ih-sp)/2*lr),Mi=-ih*lr}else Mi=UO+(jt-lr)*Pi}Si?(se.verticalizable=!0,Mr.push({glyph:Gr,imageName:en,x:bt,y:ut+Mi,vertical:Si,scale:lr,localGlyph:ci.localGlyph,fontStack:mi.fontStack,sectionIndex:ui,metrics:ci,rect:qr}),bt+=hi*lr+nt):(Mr.push({glyph:Gr,imageName:en,x:bt,y:ut+Mi,vertical:Si,scale:lr,localGlyph:ci.localGlyph,fontStack:mi.fontStack,sectionIndex:ui,metrics:ci,rect:qr}),bt+=ci.advance*lr+nt)}Mr.length!==0&&(Lt=Math.max(bt-nt,Lt),Et?WO(Mr,ot,Ir,Xr,Ce*jt/2):WO(Mr,ot,Ir,0,Ce/2)),bt=0;let li=Ce*jt+Ir;Pr.lineOffset=Math.max(Ir,Sr),ut+=li,++kt}var ar;let Bt=ut,{horizontalAlign:Ct,verticalAlign:Lr}=t1(Ue);(function(Ut,jt,Sr,Pr,Mr,Ir){let $r=(jt-Sr)*Mr,Xr=-Ir*Pr;for(let li of Ut)for(let Ar of li.positionedGlyphs)Ar.x+=$r,Ar.y+=Xr})(se.positionedLines,ot,Ct,Lr,Lt,Bt),se.top+=-Lr*Bt,se.bottom=se.top+Bt,se.left+=-Ct*Lt,se.right=se.left+Lt,se.hasBaseline=Et}(ue,e,n,u,G,_,g,b,O,w,M,k),!function(se){for(let Ie of se)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(ie)&&ue}let _y={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uQ={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jO(r,e,n,u,f,p){if(e.imageName){let _=u[e.imageName];return _?_.displaySize[0]*e.scale*Pi/p+f:0}{let _=n[e.fontStack],g=_&&_.glyphs[r];return g?g.metrics.advance*e.scale+f:0}}function VO(r,e,n,u){let f=Math.pow(r-e,2);return u?r<e?f/2:2*f:f+Math.abs(n)*n}function cQ(r,e,n){let u=0;return r===10&&(u-=1e4),n&&(u+=150),r!==40&&r!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function $O(r,e,n,u,f,p){let _=null,g=VO(e,n,f,p);for(let b of u){let w=VO(e-b.x,n,f,p)+b.badness;w<=g&&(_=b,g=w)}return{index:r,x:e,priorBreak:_,badness:g}}function GO(r){return r?GO(r.priorBreak).concat(r.index):[]}function t1(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function WO(r,e,n,u,f){if(!(e||n||u||f))return;let p=r.length-1,_=r[p],g=(_.x+_.metrics.advance*_.scale)*e;for(let b=0;b<=p;b++)r[b].x-=g,r[b].y+=n+u+f}function hQ(r,e,n){let{horizontalAlign:u,verticalAlign:f}=t1(n),p=e[0]-r.displaySize[0]*u,_=e[1]-r.displaySize[1]*f;return{image:r,top:_,bottom:_+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function ZO(r,e,n,u,f,p){let _=r.image,g;if(_.content){let G=_.content,Y=_.pixelRatio||1;g=[G[0]/Y,G[1]/Y,_.displaySize[0]-G[2]/Y,_.displaySize[1]-G[3]/Y]}let b=e.left*p,w=e.right*p,I,O,M,L;n==="width"||n==="both"?(L=f[0]+b-u[3],O=f[0]+w+u[1]):(L=f[0]+(b+w-_.displaySize[0])/2,O=L+_.displaySize[0]);let k=e.top*p,U=e.bottom*p;return n==="height"||n==="both"?(I=f[1]+k-u[0],M=f[1]+U+u[2]):(I=f[1]+(k+U-_.displaySize[1])/2,M=I+_.displaySize[1]),{image:_,top:I,right:O,bottom:M,left:L,collisionPadding:g}}class ts extends Ve{constructor(e,n,u,f,p){super(e,n),this.angle=f,this.z=u,p!==void 0&&(this.segment=p)}clone(){return new ts(this.x,this.y,this.z,this.angle,this.segment)}}function HO(r,e,n,u,f){if(e.segment===void 0)return!0;let p=e,_=e.segment+1,g=0;for(;g>-n/2;){if(_--,_<0)return!1;g-=r[_].dist(p),p=r[_]}g+=r[_].dist(r[_+1]),_++;let b=[],w=0;for(;g<n/2;){let I=r[_],O=r[_+1];if(!O)return!1;let M=r[_-1].angleTo(I)-I.angleTo(O);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:g,angleDelta:M}),w+=M;g-b[0].distance>u;)w-=b.shift().angleDelta;if(w>f)return!1;_++,g+=I.dist(O)}return!0}function XO(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function KO(r,e,n){return r?.6*e*n:0}function YO(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function fQ(r,e,n,u,f,p){let _=KO(n,f,p),g=YO(n,u)*p,b=0,w=XO(r)/2;for(let I=0;I<r.length-1;I++){let O=r[I],M=r[I+1],L=O.dist(M);if(b+L>w){let k=(w-b)/L,U=nr(O.x,M.x,k),G=nr(O.y,M.y,k),Y=new ts(U,G,0,M.angleTo(O),I);return!_||HO(r,Y,g,_,e)?Y:void 0}b+=L}}function dQ(r,e,n,u,f,p,_,g,b){let w=KO(u,p,_),I=YO(u,f),O=I*_,M=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-O<e/4&&(e=O+e/4),JO(r,M?e/2*g%e:(I/2+2*p)*_*g%e,e,w,n,O,M,!1,b)}function JO(r,e,n,u,f,p,_,g,b){let w=p/2,I=XO(r),O=0,M=e-n,L=[];for(let k=0;k<r.length-1;k++){let U=r[k],G=r[k+1],Y=U.dist(G),ae=G.angleTo(U);for(;M+n<O+Y;){M+=n;let J=(M-O)/Y,ie=nr(U.x,G.x,J),ue=nr(U.y,G.y,J);if(ie>=0&&ie<b&&ue>=0&&ue<b&&M-w>=0&&M+w<=I){let se=new ts(ie,ue,0,ae,k);se._round(),u&&!HO(r,se,p,u,f)||L.push(se)}}O+=Y}return g||L.length||_||(L=JO(r,O/2,n,u,f,p,_,!0,b)),L}function QO(r,e,n,u,f){let p=[];for(let _=0;_<r.length;_++){let g=r[_],b;for(let w=0;w<g.length-1;w++){let I=g[w],O=g[w+1];I.x<e&&O.x<e||(I.x<e?I=new Ve(e,I.y+(e-I.x)/(O.x-I.x)*(O.y-I.y))._round():O.x<e&&(O=new Ve(e,I.y+(e-I.x)/(O.x-I.x)*(O.y-I.y))._round()),I.y<n&&O.y<n||(I.y<n?I=new Ve(I.x+(n-I.y)/(O.y-I.y)*(O.x-I.x),n)._round():O.y<n&&(O=new Ve(I.x+(n-I.y)/(O.y-I.y)*(O.x-I.x),n)._round()),I.x>=u&&O.x>=u||(I.x>=u?I=new Ve(u,I.y+(u-I.x)/(O.x-I.x)*(O.y-I.y))._round():O.x>=u&&(O=new Ve(u,I.y+(u-I.x)/(O.x-I.x)*(O.y-I.y))._round()),I.y>=f&&O.y>=f||(I.y>=f?I=new Ve(I.x+(f-I.y)/(O.y-I.y)*(O.x-I.x),f)._round():O.y>=f&&(O=new Ve(I.x+(f-I.y)/(O.y-I.y)*(O.x-I.x),f)._round()),b&&I.equals(b[b.length-1])||(b=[I],p.push(b)),b.push(O)))))}}return p}yt(ts,"Anchor");let Jd=1e20;function eC(r,e,n,u,f,p,_,g,b){for(let w=e;w<e+u;w++)tC(r,n*p+w,p,f,_,g,b);for(let w=n;w<n+f;w++)tC(r,w*p+e,1,u,_,g,b)}function tC(r,e,n,u,f,p,_){p[0]=0,_[0]=-Jd,_[1]=Jd,f[0]=r[e];for(let g=1,b=0,w=0;g<u;g++){f[g]=r[e+g*n];let I=g*g;do{let O=p[b];w=(f[g]-f[O]+I-O*O)/(g-O)/2}while(w<=_[b]&&--b>-1);b++,p[b]=g,_[b]=w,_[b+1]=Jd}for(let g=0,b=0;g<u;g++){for(;_[b+1]<g;)b++;let w=p[b],I=g-w;r[e+g*n]=f[w]+I*I}}let jo=2,r1={none:0,ideographs:1,all:2};class Yc{constructor(e,n,u){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){let u=[];for(let f in e)for(let p of e[f])u.push({stack:f,id:p});Ke(u,({stack:f,id:p},_)=>{let g=this.entries[f];g||(g=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=g.glyphs[p];if(b!==void 0)return void _(null,{stack:f,id:p,glyph:b});if(b=this._tinySDF(g,f,p),b)return g.glyphs[p]=b,void _(null,{stack:f,id:p,glyph:b});let w=Math.floor(p/256);if(256*w>65535)return void _(new Error("glyphs > 65535 not supported"));if(g.ranges[w])return void _(null,{stack:f,id:p,glyph:b});let I=g.requests[w];I||(I=g.requests[w]=[],Yc.loadGlyphRange(f,w,this.url,this.requestManager,(O,M)=>{if(M){g.ascender=M.ascender,g.descender=M.descender;for(let L in M.glyphs)this._doesCharSupportLocalGlyph(+L)||(g.glyphs[+L]=M.glyphs[+L]);g.ranges[w]=!0}for(let L of I)L(O,M);delete g.requests[w]})),I.push((O,M)=>{O?_(O):M&&_(null,{stack:f,id:p,glyph:M.glyphs[p]||null})})},(f,p)=>{if(f)n(f);else if(p){let _={};for(let{stack:g,id:b,glyph:w}of p)_[g]===void 0&&(_[g]={}),_[g].glyphs===void 0&&(_[g].glyphs={}),_[g].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},_[g].ascender=this.entries[g].ascender,_[g].descender=this.entries[g].descender;n(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==r1.none&&(this.localGlyphMode===r1.all?!!this.localFontFamily:!!this.localFontFamily&&(ht["CJK Unified Ideographs"](e)||ht["Hangul Syllables"](e)||ht.Hiragana(e)||ht.Katakana(e)||ht["CJK Symbols and Punctuation"](e)))}_tinySDF(e,n,u){let f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let p=e.tinySDF;if(!p){let U="400";/bold/i.test(n)?U="900":/medium/i.test(n)?U="500":/light/i.test(n)&&(U="200"),p=e.tinySDF=new Yc.TinySDF({fontFamily:f,fontWeight:U,fontSize:24*jo,buffer:3*jo,radius:8*jo}),p.fontWeight=U}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];let _=String.fromCharCode(u),{data:g,width:b,height:w,glyphWidth:I,glyphHeight:O,glyphLeft:M,glyphTop:L,glyphAdvance:k}=p.draw(_);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new Qa({width:b,height:w},g),metrics:{width:I/jo,height:O/jo,left:M/jo,top:L/jo-27,advance:k/jo,localGlyph:!0}}}}Yc.loadGlyphRange=function(r,e,n,u,f){let p=256*e,_=p+255,g=u.transformRequest(u.normalizeGlyphsURL(n).replace("{fontstack}",r).replace("{range}",`${p}-${_}`),La.Glyphs);Ss(g,(b,w)=>{if(b)f(b);else if(w){let I={},O=function(M){return new my(M).readFields(aQ,{})}(w);for(let M of O.glyphs)I[M.id]=M;f(null,{glyphs:I,ascender:O.ascender,descender:O.descender})}})},Yc.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:n=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=n;let g=this.size=r+4*e,b=this._createCanvas(g),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${_} ${p} ${r}px ${f}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(r){let e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:p}=this.ctx.measureText(r),_=Math.ceil(n),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-f))),b=Math.min(this.size-this.buffer,_+Math.ceil(u)),w=g+2*this.buffer,I=b+2*this.buffer,O=Math.max(w*I,0),M=new Uint8ClampedArray(O),L={data:M,width:w,height:I,glyphWidth:g,glyphHeight:b,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(g===0||b===0)return L;let{ctx:k,buffer:U,gridInner:G,gridOuter:Y}=this;k.clearRect(U,U,g,b),k.fillText(r,U,U+_);let ae=k.getImageData(U,U,g,b);Y.fill(Jd,0,O),G.fill(0,0,O);for(let J=0;J<b;J++)for(let ie=0;ie<g;ie++){let ue=ae.data[4*(J*g+ie)+3]/255;if(ue===0)continue;let se=(J+U)*w+ie+U;if(ue===1)Y[se]=0,G[se]=Jd;else{let Ie=.5-ue;Y[se]=Ie>0?Ie*Ie:0,G[se]=Ie<0?Ie*Ie:0}}eC(Y,0,0,w,I,w,this.f,this.v,this.z),eC(G,U,U,g,b,w,this.f,this.v,this.z);for(let J=0;J<O;J++){let ie=Math.sqrt(Y[J])-Math.sqrt(G[J]);M[J]=Math.round(255-255*(ie/this.radius+this.cutoff))}return L}};let Jc=hn;function rC(r,e,n,u){let f=[],p=r.image,_=p.pixelRatio,g=p.paddedRect.w-2*Jc,b=p.paddedRect.h-2*Jc,w=r.right-r.left,I=r.bottom-r.top,O=p.stretchX||[[0,g]],M=p.stretchY||[[0,b]],L=(Ce,Ue)=>Ce+Ue[1]-Ue[0],k=O.reduce(L,0),U=M.reduce(L,0),G=g-k,Y=b-U,ae=0,J=k,ie=0,ue=U,se=0,Ie=G,Te=0,De=Y;if(p.content&&u){let Ce=p.content;ae=yy(O,0,Ce[0]),ie=yy(M,0,Ce[1]),J=yy(O,Ce[0],Ce[2]),ue=yy(M,Ce[1],Ce[3]),se=Ce[0]-ae,Te=Ce[1]-ie,Ie=Ce[2]-Ce[0]-J,De=Ce[3]-Ce[1]-ue}let Qe=(Ce,Ue,je,Xe)=>{let nt=gy(Ce.stretch-ae,J,w,r.left),Me=vy(Ce.fixed-se,Ie,Ce.stretch,k),lt=gy(Ue.stretch-ie,ue,I,r.top),bt=vy(Ue.fixed-Te,De,Ue.stretch,U),ut=gy(je.stretch-ae,J,w,r.left),Lt=vy(je.fixed-se,Ie,je.stretch,k),ot=gy(Xe.stretch-ie,ue,I,r.top),Et=vy(Xe.fixed-Te,De,Xe.stretch,U),kt=new Ve(nt,lt),ar=new Ve(ut,lt),Bt=new Ve(ut,ot),Ct=new Ve(nt,ot),Lr=new Ve(Me/_,bt/_),Ut=new Ve(Lt/_,Et/_),jt=e*Math.PI/180;if(jt){let Mr=Math.sin(jt),Ir=Math.cos(jt),$r=[Ir,-Mr,Mr,Ir];kt._matMult($r),ar._matMult($r),Ct._matMult($r),Bt._matMult($r)}let Sr=Ce.stretch+Ce.fixed,Pr=Ue.stretch+Ue.fixed;return{tl:kt,tr:ar,bl:Ct,br:Bt,tex:{x:p.paddedRect.x+Jc+Sr,y:p.paddedRect.y+Jc+Pr,w:je.stretch+je.fixed-Sr,h:Xe.stretch+Xe.fixed-Pr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Lr,pixelOffsetBR:Ut,minFontScaleX:Ie/_/w,minFontScaleY:De/_/I,isSDF:n}};if(u&&(p.stretchX||p.stretchY)){let Ce=iC(O,G,k),Ue=iC(M,Y,U);for(let je=0;je<Ce.length-1;je++){let Xe=Ce[je],nt=Ce[je+1];for(let Me=0;Me<Ue.length-1;Me++)f.push(Qe(Xe,Ue[Me],nt,Ue[Me+1]))}}else f.push(Qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:b+1}));return f}function yy(r,e,n){let u=0;for(let f of r)u+=Math.max(e,Math.min(n,f[1]))-Math.max(e,Math.min(n,f[0]));return u}function iC(r,e,n){let u=[{fixed:-Jc,stretch:0}];for(let[f,p]of r){let _=u[u.length-1];u.push({fixed:f-_.stretch,stretch:_.stretch}),u.push({fixed:f-_.stretch,stretch:_.stretch+(p-f)})}return u.push({fixed:e+Jc,stretch:n}),u}function gy(r,e,n,u){return r/e*n+u}function vy(r,e,n,u){return r-e*n/u}function pQ(r,e,n,u){let f=e+r.positionedLines[u].lineOffset;return u===0?n+f/2:n+(f+(e+r.positionedLines[u-1].lineOffset))/2}class mQ{constructor(e=[],n=_Q){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:n,compare:u}=this,f=n[e];for(;e>0;){let p=e-1>>1,_=n[p];if(u(f,_)>=0)break;n[e]=_,e=p}n[e]=f}_down(e){let{data:n,compare:u}=this,f=this.length>>1,p=n[e];for(;e<f;){let _=1+(e<<1),g=n[_],b=_+1;if(b<this.length&&u(n[b],g)<0&&(_=b,g=n[b]),u(g,p)>=0)break;n[e]=g,e=_}n[e]=p}}function _Q(r,e){return r<e?-1:r>e?1:0}function yQ(r,e=1,n=!1){let u=1/0,f=1/0,p=-1/0,_=-1/0,g=r[0];for(let L=0;L<g.length;L++){let k=g[L];(!L||k.x<u)&&(u=k.x),(!L||k.y<f)&&(f=k.y),(!L||k.x>p)&&(p=k.x),(!L||k.y>_)&&(_=k.y)}let b=Math.min(p-u,_-f),w=b/2,I=new mQ([],gQ);if(b===0)return new Ve(u,f);for(let L=u;L<p;L+=b)for(let k=f;k<_;k+=b)I.push(new Qc(L+w,k+w,w,r));let O=function(L){let k=0,U=0,G=0,Y=L[0];for(let ae=0,J=Y.length,ie=J-1;ae<J;ie=ae++){let ue=Y[ae],se=Y[ie],Ie=ue.x*se.y-se.x*ue.y;U+=(ue.x+se.x)*Ie,G+=(ue.y+se.y)*Ie,k+=3*Ie}return new Qc(U/k,G/k,0,L)}(r),M=I.length;for(;I.length;){let L=I.pop();(L.d>O.d||!O.d)&&(O=L,n&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-O.d<=e||(w=L.h/2,I.push(new Qc(L.p.x-w,L.p.y-w,w,r)),I.push(new Qc(L.p.x+w,L.p.y-w,w,r)),I.push(new Qc(L.p.x-w,L.p.y+w,w,r)),I.push(new Qc(L.p.x+w,L.p.y+w,w,r)),M+=4)}return n&&(console.log(`num probes: ${M}`),console.log(`best distance: ${O.d}`)),O.p}function gQ(r,e){return e.max-r.max}class Qc{constructor(e,n,u,f){this.p=new Ve(e,n),this.h=u,this.d=function(p,_){let g=!1,b=1/0;for(let w=0;w<_.length;w++){let I=_[w];for(let O=0,M=I.length,L=M-1;O<M;L=O++){let k=I[O],U=I[L];k.y>p.y!=U.y>p.y&&p.x<(U.x-k.x)*(p.y-k.y)/(U.y-k.y)+k.x&&(g=!g),b=Math.min(b,JA(p,k,U))}}return(g?1:-1)*Math.sqrt(b)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}let eh=7,i1=Number.POSITIVE_INFINITY,vQ=Math.sqrt(2);function nC(r,[e,n]){let u=0,f=0;if(n===i1){e<0&&(e=0);let p=e/vQ;switch(r){case"top-right":case"top-left":f=p-eh;break;case"bottom-right":case"bottom-left":f=-p+eh;break;case"bottom":f=-e+eh;break;case"top":f=e-eh}switch(r){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),r){case"top-right":case"top-left":case"top":f=n-eh;break;case"bottom-right":case"bottom-left":case"bottom":f=-n+eh}switch(r){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,f]}function xQ(r,e,n,u,f,p,_,g,b,w){r.createArrays(),r.tilePixelRatio=St/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;let I=r.layers[0].layout,O=r.layers[0]._unevaluatedLayout._values,M={};if(r.textSizeData.kind==="composite"){let{minZoom:U,maxZoom:G}=r.textSizeData;M.compositeTextSizes=[O["text-size"].possiblyEvaluate(new A(U),g),O["text-size"].possiblyEvaluate(new A(G),g)]}if(r.iconSizeData.kind==="composite"){let{minZoom:U,maxZoom:G}=r.iconSizeData;M.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new A(U),g),O["icon-size"].possiblyEvaluate(new A(G),g)]}M.layoutTextSize=O["text-size"].possiblyEvaluate(new A(b+1),g),M.layoutIconSize=O["icon-size"].possiblyEvaluate(new A(b+1),g),M.textMaxSize=O["text-size"].possiblyEvaluate(new A(18),g);let L=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",k=I.get("text-size");for(let U of r.features){let G=I.get("text-font").evaluate(U,{},g).join(","),Y=k.evaluate(U,{},g),ae=M.layoutTextSize.evaluate(U,{},g),J=(M.layoutIconSize.evaluate(U,{},g),{horizontal:{},vertical:void 0}),ie=U.text,ue,se=[0,0];if(ie){let De=ie.toString(),Qe=I.get("text-letter-spacing").evaluate(U,{},g)*Pi,Ce=I.get("text-line-height").evaluate(U,{},g)*Pi,Ue=fx(De)?Qe:0,je=I.get("text-anchor").evaluate(U,{},g),Xe=I.get("text-variable-anchor");if(!Xe){let ut=I.get("text-radial-offset").evaluate(U,{},g);se=ut?nC(je,[ut*Pi,i1]):I.get("text-offset").evaluate(U,{},g).map(Lt=>Lt*Pi)}let nt=L?"center":I.get("text-justify").evaluate(U,{},g),Me=I.get("symbol-placement")==="point",lt=Me?I.get("text-max-width").evaluate(U,{},g)*Pi:1/0,bt=ut=>{r.allowVerticalPlacement&&Td(De)&&(J.vertical=e1(ie,e,n,f,G,lt,Ce,je,ut,Ue,se,Zn.vertical,!0,ae,Y))};if(!L&&Xe){let ut=nt==="auto"?Xe.map(ot=>n1(ot)):[nt],Lt=!1;for(let ot=0;ot<ut.length;ot++){let Et=ut[ot];if(!J.horizontal[Et])if(Lt)J.horizontal[Et]=J.horizontal[0];else{let kt=e1(ie,e,n,f,G,lt,Ce,"center",Et,Ue,se,Zn.horizontal,!1,ae,Y);kt&&(J.horizontal[Et]=kt,Lt=kt.positionedLines.length===1)}}bt("left")}else{if(nt==="auto"&&(nt=n1(je)),Me||I.get("text-writing-mode").indexOf("horizontal")>=0||!Td(De)){let ut=e1(ie,e,n,f,G,lt,Ce,je,nt,Ue,se,Zn.horizontal,!1,ae,Y);ut&&(J.horizontal[nt]=ut)}bt(Me?"left":nt)}}let Ie=!1;if(U.icon&&U.icon.name){let De=u[U.icon.name];De&&(ue=hQ(f[U.icon.name],I.get("icon-offset").evaluate(U,{},g),I.get("icon-anchor").evaluate(U,{},g)),Ie=De.sdf,r.sdfIcons===void 0?r.sdfIcons=De.sdf:r.sdfIcons!==De.sdf&&jr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==r.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}let Te=aC(J.horizontal)||J.vertical;r.iconsInText||(r.iconsInText=!!Te&&Te.iconsInText),(Te||ue)&&bQ(r,U,J,ue,u,M,ae,0,se,Ie,_,g,w)}p&&r.generateCollisionDebugBuffers(b,r.collisionBoxArray)}function n1(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bQ(r,e,n,u,f,p,_,g,b,w,I,O,M){let L=p.textMaxSize.evaluate(e,{},O);L===void 0&&(L=_);let k=r.layers[0].layout,U=k.get("icon-offset").evaluate(e,{},O),G=aC(n.horizontal)||n.vertical,Y=M.name==="globe",ae=Pi,J=_/ae,ie=r.tilePixelRatio*L/ae,ue=(je=r.overscaling,r.zoom>18&&je>2&&(je>>=1),Math.max(St/(512*je),1)*k.get("symbol-spacing")),se=k.get("text-padding")*r.tilePixelRatio,Ie=k.get("icon-padding")*r.tilePixelRatio,Te=Pt(k.get("text-max-angle")),De=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Qe=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Ce=k.get("symbol-placement"),Ue=ue/2;var je;let Xe=k.get("icon-text-fit"),nt;u&&Xe!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(nt=ZO(u,n.vertical,Xe,k.get("icon-text-fit-padding"),U,J)),G&&(u=ZO(u,G,Xe,k.get("icon-text-fit-padding"),U,J)));let Me=(lt,bt,ut)=>{if(bt.x<0||bt.x>=St||bt.y<0||bt.y>=St)return;let Lt=null;if(Y){let{x:ot,y:Et,z:kt}=M.projectTilePoint(bt.x,bt.y,ut);Lt={anchor:new ts(ot,Et,kt,0,void 0),up:M.upVector(ut,bt.x,bt.y)}}(function(ot,Et,kt,ar,Bt,Ct,Lr,Ut,jt,Sr,Pr,Mr,Ir,$r,Xr,li,Ar,mi,ui,Gr,lr,ci,qr,en,hi){let Mi=ot.addToLineVertexArray(Et,ar),Si,tn,Ii,$o,ih,sp,lp,FC=0,NC=0,UC=0,jC=0,v1=-1,x1=-1,_a={},VC=mx(""),xu=kt?kt.anchor:Et,b1=0,w1=0;if(jt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[b1,w1]=jt.layout.get("text-offset").evaluate(lr,{},hi).map(Cn=>Cn*Pi):(b1=jt.layout.get("text-radial-offset").evaluate(lr,{},hi)*Pi,w1=i1),ot.allowVerticalPlacement&&Bt.vertical){let Cn=Bt.vertical;if(Xr)sp=o1(Cn),Ut&&(lp=o1(Ut));else{let Pn=jt.layout.get("text-rotate").evaluate(lr,{},hi)+90;Ii=xy(Sr,xu,Et,Pr,Mr,Ir,Cn,$r,Pn,li),Ut&&($o=xy(Sr,xu,Et,Pr,Mr,Ir,Ut,mi,Pn))}}if(Ct){let Cn=jt.layout.get("icon-rotate").evaluate(lr,{},hi),Pn=jt.layout.get("icon-text-fit")!=="none",up=rC(Ct,Cn,qr,Pn),E1=Ut?rC(Ut,Cn,qr,Pn):void 0;tn=xy(Sr,xu,Et,Pr,Mr,Ir,Ct,mi,Cn),FC=4*up.length;let $C=ot.iconSizeData,bu=null;$C.kind==="source"?(bu=[Uo*jt.layout.get("icon-size").evaluate(lr,{},hi)],bu[0]>Xs&&jr(`${ot.layerIds[0]}: Value for "icon-size" is >= ${Qd}. Reduce your "icon-size".`)):$C.kind==="composite"&&(bu=[Uo*ci.compositeIconSizes[0].evaluate(lr,{},hi),Uo*ci.compositeIconSizes[1].evaluate(lr,{},hi)],(bu[0]>Xs||bu[1]>Xs)&&jr(`${ot.layerIds[0]}: Value for "icon-size" is >= ${Qd}. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,up,bu,Gr,ui,lr,!1,kt,Et,Mi.lineStartIndex,Mi.lineLength,-1,en,hi),v1=ot.icon.placedSymbolArray.length-1,E1&&(NC=4*E1.length,ot.addSymbols(ot.icon,E1,bu,Gr,ui,lr,Zn.vertical,kt,Et,Mi.lineStartIndex,Mi.lineLength,-1,en,hi),x1=ot.icon.placedSymbolArray.length-1)}for(let Cn in Bt.horizontal){let Pn=Bt.horizontal[Cn];Si||(VC=mx(Pn.text),Xr?ih=o1(Pn):Si=xy(Sr,xu,Et,Pr,Mr,Ir,Pn,$r,jt.layout.get("text-rotate").evaluate(lr,{},hi),li));let up=Pn.positionedLines.length===1;if(UC+=oC(ot,kt,Et,Pn,Lr,jt,Xr,lr,li,Mi,Bt.vertical?Zn.horizontal:Zn.horizontalOnly,up?Object.keys(Bt.horizontal):[Cn],_a,v1,ci,en,hi),up)break}Bt.vertical&&(jC+=oC(ot,kt,Et,Bt.vertical,Lr,jt,Xr,lr,li,Mi,Zn.vertical,["vertical"],_a,x1,ci,en,hi));let tl=-1,T1=(Cn,Pn)=>Cn?Math.max(Cn,Pn):Pn;tl=T1(ih,tl),tl=T1(sp,tl),tl=T1(lp,tl);let XQ=tl>-1?1:0;ot.glyphOffsetArray.length>=Ys.MAX_GLYPHS&&jr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),lr.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,lr.sortKey),ot.symbolInstances.emplaceBack(xu.x,xu.y,xu.z,Et.x,Et.y,_a.right>=0?_a.right:-1,_a.center>=0?_a.center:-1,_a.left>=0?_a.left:-1,_a.vertical>=0?_a.vertical:-1,v1,x1,VC,Si!==void 0?Si:ot.collisionBoxArray.length,Si!==void 0?Si+1:ot.collisionBoxArray.length,Ii!==void 0?Ii:ot.collisionBoxArray.length,Ii!==void 0?Ii+1:ot.collisionBoxArray.length,tn!==void 0?tn:ot.collisionBoxArray.length,tn!==void 0?tn+1:ot.collisionBoxArray.length,$o||ot.collisionBoxArray.length,$o?$o+1:ot.collisionBoxArray.length,Pr,UC,jC,FC,NC,XQ,0,b1,w1,tl)})(r,bt,Lt,lt,n,u,f,nt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,se,De,b,0,Ie,Qe,U,e,p,w,I,O)};if(Ce==="line")for(let lt of QO(e.geometry,0,0,St,St)){let bt=dQ(lt,ue,Te,n.vertical||G,u,ae,ie,r.overscaling,St);for(let ut of bt)G&&wQ(r,G.text,Ue,ut)||Me(lt,ut,O)}else if(Ce==="line-center"){for(let lt of e.geometry)if(lt.length>1){let bt=fQ(lt,Te,n.vertical||G,u,ae,ie);bt&&Me(lt,bt,O)}}else if(e.type==="Polygon")for(let lt of Gx(e.geometry,0)){let bt=yQ(lt,16);Me(lt[0],new ts(bt.x,bt.y,0,0,void 0),O)}else if(e.type==="LineString")for(let lt of e.geometry)Me(lt,new ts(lt[0].x,lt[0].y,0,0,void 0),O);else if(e.type==="Point")for(let lt of e.geometry)for(let bt of lt)Me([bt],new ts(bt.x,bt.y,0,0,void 0),O)}let Qd=255,Xs=Qd*Uo;function oC(r,e,n,u,f,p,_,g,b,w,I,O,M,L,k,U,G){let Y=function(ie,ue,se,Ie,Te,De,Qe,Ce){let Ue=[];if(ue.positionedLines.length===0)return Ue;let je=Ie.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,Xe=function(ut){let Lt=ut[0],ot=ut[1],Et=Lt*ot;return Et>0?[Lt,-ot]:Et<0?[-Lt,ot]:Lt===0?[ot,Lt]:[ot,-Lt]}(se),nt=Math.abs(ue.top-ue.bottom);for(let ut of ue.positionedLines)nt-=ut.lineOffset;let Me=ue.positionedLines.length,lt=nt/Me,bt=ue.top-se[1];for(let ut=0;ut<Me;++ut){let Lt=ue.positionedLines[ut];bt=pQ(ue,lt,bt,ut);for(let ot of Lt.positionedGlyphs){if(!ot.rect)continue;let Et=ot.rect||{},kt=FO+1,ar=!0,Bt=1,Ct=0;if(ot.imageName){let qr=Qe[ot.imageName];if(!qr)continue;if(qr.sdf){jr("SDF images are not supported in formatted text and will be ignored.");continue}ar=!1,Bt=qr.pixelRatio,kt=hn/Bt}let Lr=(Te||Ce)&&ot.vertical,Ut=ot.metrics.advance*ot.scale/2,jt=ot.metrics,Sr=ot.rect;if(Sr===null)continue;Ce&&ue.verticalizable&&(Ct=ot.imageName?Ut-ot.metrics.width*ot.scale/2:0);let Pr=Te?[ot.x+Ut,ot.y]:[0,0],Mr=[0,0],Ir=[0,0],$r=!1;Te||(Lr?(Ir=[ot.x+Ut+Xe[0],ot.y+Xe[1]-Ct],$r=!0):Mr=[ot.x+Ut+se[0],ot.y+se[1]-Ct]);let Xr=Sr.w*ot.scale/(Bt*(ot.localGlyph?jo:1)),li=Sr.h*ot.scale/(Bt*(ot.localGlyph?jo:1)),Ar,mi,ui,Gr;if(Lr){let qr=ot.y-bt,en=new Ve(-Ut,Ut-qr),hi=-Math.PI/2,Mi=new Ve(...Ir);Ar=new Ve(-Ut+Mr[0],Mr[1]),Ar._rotateAround(hi,en)._add(Mi),Ar.x+=-qr+Ut,Ar.y-=(jt.left-kt)*ot.scale;let Si=ot.imageName?jt.advance*ot.scale:Pi*ot.scale,tn=String.fromCharCode(ot.glyph);XJ(tn)?Ar.x+=(1-kt)*ot.scale:KJ(tn)?Ar.x+=Si-jt.height*ot.scale+(-kt-1)*ot.scale:Ar.x+=ot.imageName||jt.width+2*kt===Sr.w&&jt.height+2*kt===Sr.h?(Si-li)/2:(Si-(jt.height+2*kt)*ot.scale)/2,mi=new Ve(Ar.x,Ar.y-Xr),ui=new Ve(Ar.x+li,Ar.y),Gr=new Ve(Ar.x+li,Ar.y-Xr)}else{let qr=(jt.left-kt)*ot.scale-Ut+Mr[0],en=(-jt.top-kt)*ot.scale+Mr[1],hi=qr+Xr,Mi=en+li;Ar=new Ve(qr,en),mi=new Ve(hi,en),ui=new Ve(qr,Mi),Gr=new Ve(hi,Mi)}if(je){let qr;qr=Te?new Ve(0,0):$r?new Ve(Xe[0],Xe[1]):new Ve(se[0],se[1]),Ar._rotateAround(je,qr),mi._rotateAround(je,qr),ui._rotateAround(je,qr),Gr._rotateAround(je,qr)}let lr=new Ve(0,0),ci=new Ve(0,0);Ue.push({tl:Ar,tr:mi,bl:ui,br:Gr,tex:Et,writingMode:ue.writingMode,glyphOffset:Pr,sectionIndex:ot.sectionIndex,isSDF:ar,pixelOffsetTL:lr,pixelOffsetBR:ci,minFontScaleX:0,minFontScaleY:0})}}return Ue}(0,u,b,p,_,g,f,r.allowVerticalPlacement),ae=r.textSizeData,J=null;ae.kind==="source"?(J=[Uo*p.layout.get("text-size").evaluate(g,{},G)],J[0]>Xs&&jr(`${r.layerIds[0]}: Value for "text-size" is >= ${Qd}. Reduce your "text-size".`)):ae.kind==="composite"&&(J=[Uo*k.compositeTextSizes[0].evaluate(g,{},G),Uo*k.compositeTextSizes[1].evaluate(g,{},G)],(J[0]>Xs||J[1]>Xs)&&jr(`${r.layerIds[0]}: Value for "text-size" is >= ${Qd}. Reduce your "text-size".`)),r.addSymbols(r.text,Y,J,b,_,g,I,e,n,w.lineStartIndex,w.lineLength,L,U,G);for(let ie of O)M[ie]=r.text.placedSymbolArray.length-1;return 4*Y.length}function aC(r){for(let e in r)return r[e];return null}function xy(r,e,n,u,f,p,_,g,b,w){let I=_.top,O=_.bottom,M=_.left,L=_.right,k=_.collisionPadding;if(k&&(M-=k[0],I-=k[1],L+=k[2],O+=k[3]),b){let U=new Ve(M,I),G=new Ve(L,I),Y=new Ve(M,O),ae=new Ve(L,O),J=Pt(b),ie=new Ve(0,0);w&&(ie=new Ve(w[0],w[1])),U._rotateAround(J,ie),G._rotateAround(J,ie),Y._rotateAround(J,ie),ae._rotateAround(J,ie),M=Math.min(U.x,G.x,Y.x,ae.x),L=Math.max(U.x,G.x,Y.x,ae.x),I=Math.min(U.y,G.y,Y.y,ae.y),O=Math.max(U.y,G.y,Y.y,ae.y)}return r.emplaceBack(e.x,e.y,e.z,n.x,n.y,M,I,L,O,g,u,f,p),r.length-1}function o1(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);let e=r.bottom-r.top;return e>0?Math.max(10,e):null}function wQ(r,e,n,u){let f=r.compareText;if(e in f){let p=f[e];for(let _=p.length-1;_>=0;_--)if(u.dist(p[_])<n)return!0}else f[e]=[];return f[e].push(u),!1}function sC(r,e){let n=r.fovAboveCenter,u=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,f=(r._camera.position[2]*r.worldSize-u)/Math.cos(r._pitch),p=Math.sin(n)*f/Math.sin(Math.max(Math.PI/2-r._pitch-n,.01)),_=Math.sin(r._pitch)*p+f;return Math.min(1.01*_,f*(1/r._horizonShift))}function gu(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};let n=Math.pow(2,-r.z),u=r.x*n,f=(r.x+1)*n,p=r.y*n,_=(r.y+1)*n,g=Wn(u),b=Wn(f),w=Bi(p),I=Bi(_),O=e.project(g,w),M=e.project(b,w),L=e.project(b,I),k=e.project(g,I),U=Math.min(O.x,M.x,L.x,k.x),G=Math.min(O.y,M.y,L.y,k.y),Y=Math.max(O.x,M.x,L.x,k.x),ae=Math.max(O.y,M.y,L.y,k.y),J=n/16;function ie(se,Ie,Te,De,Qe,Ce){let Ue=(Te+Qe)/2,je=(De+Ce)/2,Xe=e.project(Wn(Ue),Bi(je)),nt=Math.max(0,U-Xe.x,G-Xe.y,Xe.x-Y,Xe.y-ae);U=Math.min(U,Xe.x),Y=Math.max(Y,Xe.x),G=Math.min(G,Xe.y),ae=Math.max(ae,Xe.y),nt>J&&(ie(se,Xe,Te,De,Ue,je),ie(Xe,Ie,Ue,je,Qe,Ce))}ie(O,M,u,p,f,p),ie(M,L,f,p,f,_),ie(L,k,f,_,u,_),ie(k,O,u,_,u,p),U-=J,G-=J,Y+=J,ae+=J;let ue=1/Math.max(Y-U,ae-G);return{scale:ue,x:U*ue,y:G*ue,x2:Y*ue,y2:ae*ue,projection:e}}let TQ=zo(new Float32Array(16));class Ks{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Er(0,0)}projectTilePoint(e,n,u){return{x:e,y:n,z:0}}locationPoint(e,n,u=!0){return e._coordinatePoint(e.locationCoordinate(n),u)}pixelsPerMeter(e,n){return No(1,e)*n}pixelSpaceConversion(e,n,u){return 1}farthestPixelDistance(e){return sC(e,e.pixelsPerMeter)}pointCoordinate(e,n,u,f){let p=e.horizonLineFromTop(!1),_=new Ve(n,Math.max(p,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,f))}pointCoordinate3D(e,n,u){let f=new Ve(n,u);if(e.elevation)return e.elevation.pointCoordinate(f);{let p=this.pointCoordinate(e,f.x,f.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let u=e.horizonLineFromTop();return n.y<u}createInversionMatrix(e,n){return TQ}createTileMatrix(e,n,u){let f,p,_,g=u.canonical,b=zo(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=gu(g,this);f=1,p=w.x+u.wrap*w.scale,_=w.y,hu(b,b,[f/w.scale,f/w.scale,e.pixelsPerMeter/n])}else f=n/e.zoomScale(g.z),p=(g.x+Math.pow(2,g.z)*u.wrap)*f,_=g.y*f;return Pd(b,b,[p,_,0]),hu(b,b,[f/St,f/St,1]),b}upVector(e,n,u){return[0,0,1]}upVectorScale(e,n,u){return{metersToTile:1}}}class EQ extends Ks{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,u]=this.parallels=e.parallels||[29.5,45.5],f=Math.sin(Pt(n));this.n=(f+Math.sin(Pt(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:u,c:f,r0:p}=this,_=Pt(e-this.center[0]),g=Pt(n),b=Math.sqrt(f-2*u*Math.sin(g))/u;return{x:b*Math.sin(_*u),y:b*Math.cos(_*u)-p,z:0}}unproject(e,n){let{n:u,c:f,r0:p}=this,_=p+n,g=Math.atan2(e,Math.abs(_))*Math.sign(_);_*u<0&&(g-=Math.PI*Math.sign(e)*Math.sign(_));let b=Pt(this.center[0])*u;g=Le(g,-Math.PI-b,Math.PI-b);let w=Ne(Or(g/u)+this.center[0],-180,180),I=Math.asin(Ne((f-(e*e+_*_)*u*u)/(2*u),-1,1)),O=Ne(Or(I),-zi,zi);return new Er(w,O)}}let ep=1.340264,tp=-.081106,rp=893e-6,ip=.003796,by=Math.sqrt(3)/2;class SQ extends Ks{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let u=Math.asin(by*Math.sin(n)),f=u*u,p=f*f*f;return{x:.5*(e*Math.cos(u)/(by*(ep+3*tp*f+p*(7*rp+9*ip*f)))/Math.PI+.5),y:1-.5*(u*(ep+tp*f+p*(rp+ip*f))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let u=n=(2*(1-n)-1)*Math.PI,f=u*u,p=f*f*f;for(let I,O,M,L=0;L<12&&(O=u*(ep+tp*f+p*(rp+ip*f))-n,M=ep+3*tp*f+p*(7*rp+9*ip*f),I=O/M,u=Ne(u-I,-Math.PI/3,Math.PI/3),f=u*u,p=f*f*f,!(Math.abs(I)<1e-12));++L);let _=by*e*(ep+3*tp*f+p*(7*rp+9*ip*f))/Math.cos(u),g=Math.asin(Math.sin(u)/by),b=Ne(180*_/Math.PI,-180,180),w=Ne(180*g/Math.PI,-zi,zi);return new Er(b,w)}}class IQ extends Ks{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let u=360*(e-.5),f=Ne(360*(.5-n),-zi,zi);return new Er(u,f)}}let th=Math.PI/2;function wy(r){return Math.tan((th+r)/2)}class AQ extends Ks{constructor(e){super(e),this.center=e.center||[0,30];let[n,u]=this.parallels=e.parallels||[30,30],f=Pt(n),p=Pt(u);this.southernCenter=f+p<0,this.southernCenter&&(f=-f,p=-p);let _=Math.cos(f),g=wy(f);this.n=f===p?Math.sin(f):Math.log(_/Math.cos(p))/Math.log(wy(p)/g),this.f=_*Math.pow(wy(f),this.n)/this.n}project(e,n){n=Pt(n),this.southernCenter&&(n=-n),e=Pt(e-this.center[0]);let u=1e-6,{n:f,f:p}=this;p>0?n<-th+u&&(n=-th+u):n>th-u&&(n=th-u);let _=p/Math.pow(wy(n),f),g=_*Math.sin(f*e),b=p-_*Math.cos(f*e);return g=.5*(g/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:g,y:this.southernCenter?b:1-b,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:u,f}=this,p=f-n,_=Math.sign(p),g=Math.sign(u)*Math.sqrt(e*e+p*p),b=Math.atan2(e,Math.abs(p))*_;p*u<0&&(b-=Math.PI*Math.sign(e)*_);let w=Ne(Or(b/u)+this.center[0],-180,180),I=Ne(Or(2*Math.atan(Math.pow(f/g,1/u))-th),-zi,zi);return new Er(w,this.southernCenter?-I:I)}}class lC extends Ks{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:ha(e),y:fa(n),z:0}}unproject(e,n){let u=Wn(e),f=Bi(n);return new Er(u,f)}}let uC=Pt(zi);class OQ extends Ks{project(e,n){let u=(n=Pt(n))*n,f=u*u;return{x:.5*((e=Pt(e))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let u=n=(2*(1-n)-1)*Math.PI,f=25,p=0,_=u*u;do{_=u*u;let w=_*_;p=(u*(1.007226+_*(.015085+w*(.028874*_-.044475-.005916*w)))-n)/(1.007226+_*(.045255+w*(.259866*_-.311325-.005916*11*w))),u=Ne(u-p,-uC,uC)}while(Math.abs(p)>1e-6&&--f>0);_=u*u;let g=Ne(Or(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),b=Or(u);return new Er(g,b)}}let cC=Pt(zi);class CQ extends Ks{project(e,n){n=Pt(n),e=Pt(e);let u=Math.cos(n),f=2/Math.PI,p=Math.acos(u*Math.cos(e/2)),_=Math.sin(p)/p,g=.5*(e*f+2*u*Math.sin(e/2)/_)||0,b=.5*(n+Math.sin(n)/_)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,n){let u=e=(2*e-.5)*Math.PI,f=n=(2*(1-n)-1)*Math.PI,p=25,_=1e-6,g=0,b=0;do{let w=Math.cos(f),I=Math.sin(f),O=2*I*w,M=I*I,L=w*w,k=Math.cos(u/2),U=Math.sin(u/2),G=2*k*U,Y=U*U,ae=1-L*k*k,J=ae?1/ae:0,ie=ae?Math.acos(w*k)*Math.sqrt(1/ae):0,ue=.5*(2*ie*w*U+2*u/Math.PI)-e,se=.5*(ie*I+f)-n,Ie=.5*J*(L*Y+ie*w*k*M)+1/Math.PI,Te=J*(G*O/4-ie*I*U),De=.125*J*(O*U-ie*I*L*G),Qe=.5*J*(M*k+ie*Y*w)+.5,Ce=Te*De-Qe*Ie;g=(se*Te-ue*Qe)/Ce,b=(ue*De-se*Ie)/Ce,u=Ne(u-g,-Math.PI,Math.PI),f=Ne(f-b,-cC,cC)}while((Math.abs(g)>_||Math.abs(b)>_)&&--p>0);return new Er(Or(u),Or(f))}}class hC extends Ks{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Pt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:u,cosPhi:f}=this;return{x:Pt(e)*f*u+.5,y:-Math.sin(Pt(n))/f*u+.5,z:0}}unproject(e,n){let{scale:u,cosPhi:f}=this,p=-(n-.5)/u,_=Ne(Or((e-.5)/u)/f,-180,180),g=Math.asin(Ne(p*f,-1,1)),b=Ne(Or(g),-zi,zi);return new Er(_,b)}}class PQ extends lC{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,u){let f=zd(e,n,u);return Qr(f,f,Fd(ca(u))),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,n){let u=Nc(n.lat,n.lng),f=Yi([],u),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Dd(u,u,f,No(1,0)*St*p);let _=zo(new Float64Array(16));return cu(_,e.pixelMatrix,e.globeMatrix),Qr(u,u,_),new Ve(u[0],u[1])}pixelsPerMeter(e,n){return No(1,0)*n}pixelSpaceConversion(e,n,u){let f=No(1,e)*n,p=nr(No(1,45)*n,f,u);return this.pixelsPerMeter(e,n)/p}createTileMatrix(e,n,u){let f=Cx(ca(u.canonical));return cu(new Float64Array(16),e.globeMatrix,f)}createInversionMatrix(e,n){let{center:u}=e,f=Fd(ca(n));return K_(f,f,Pt(u.lng)),vx(f,f,Pt(u.lat)),hu(f,f,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(e,n,u,f){return zA(e,n,u,!0)||new jc(0,0)}pointCoordinate3D(e,n,u){let f=this.pointCoordinate(e,n,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(e,n){return!zA(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(f,p){let _=f.cameraToCenterDistance,g=f._centerAltitude*p,b=f._camera,w=f._camera.forward(),I=Ya([],Gn([],w,-_),[0,0,g]),O=f.worldSize/(2*Math.PI),M=[0,0,-O],L=f.width/f.height,k=Math.tan(f.fovAboveCenter),U=Gn([],b.up(),k),G=Gn([],b.right(),k*L),Y=Yi([],Ya([],Ya([],w,U),G)),ae=[],J;if(new Tx(I,Y).closestPointOnSphere(M,O,ae)){let ie=Ya([],ae,M),ue=Fo([],ie,I);J=Math.cos(f.fovAboveCenter)*Md(ue)}else{let ie=Fo([],I,M),ue=Fo([],M,I);Yi(ue,ue);let se=Md(ie)-O;J=Math.sqrt(se*(se+2*O));let Ie=Math.acos(J/(O+se))-Math.acos(ao(w,ue));J*=Math.cos(Ie)}return 1.01*J}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=Uc(e.zoom);if(u>0){let f=sC(e,No(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return nr(n,f+p*(1-Math.cos(_)),Math.pow(u,10))}return n}upVector(e,n,u){return zd(n,u,e,1)}upVectorScale(e){return{metersToTile:Y_(Q_(ca(e)))}}}function fC(r){let e=r.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new lC(r);case"equirectangular":return new IQ(r);case"naturalEarth":return new OQ(r);case"equalEarth":return new SQ(r);case"winkelTripel":return new CQ(r);case"albers":return n?new hC(r):new EQ(r);case"lambertConformalConic":return n?new hC(r):new AQ(r);case"globe":return new PQ(r)}throw new Error(`Invalid projection name: ${r.name}`)}let MQ=uy.types,qQ=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ty(r,e,n,u,f,p,_,g,b,w,I,O,M){let L=g?Math.min(Xs,Math.round(g[0])):0,k=g?Math.min(Xs,Math.round(g[1])):0;r.emplaceBack(e,n,Math.round(32*u),Math.round(32*f),p,_,(L<<1)+(b?1:0),k,16*w,16*I,256*O,256*M)}function Ey(r,e,n,u,f,p,_){r.emplaceBack(e,n,u,f,p,_)}function Sy(r,e,n,u,f){r.emplaceBack(e,n,u,f),r.emplaceBack(e,n,u,f),r.emplaceBack(e,n,u,f),r.emplaceBack(e,n,u,f)}function RQ(r){for(let e of r.sections)if(px(e.text))return!0;return!1}class a1{constructor(e){this.layoutVertexArray=new He,this.indexArray=new wt,this.programConfigurations=e,this.segments=new ai,this.dynamicLayoutVertexArray=new Ye,this.opacityVertexArray=new Tt,this.placedSymbolArray=new oi,this.globeExtVertexArray=new rt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UJ.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,VJ.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,qQ,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,jJ.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}yt(a1,"SymbolBuffers");class s1{constructor(e,n,u){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new u,this.segments=new ai,this.collisionVertexArray=new Xt,this.collisionVertexArrayExt=new Wt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$J.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,GJ.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yt(s1,"CollisionBuffers");class Ys{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zo([]),this.placementViewportMatrix=zo([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xx(this.zoom,n["text-size"]),this.iconSizeData=Xx(this.zoom,n["icon-size"]);let u=this.layers[0].layout,f=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(_=>Zn[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new a1(new uu(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new a1(new uu(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ki,this.lineVertexArray=new Lc,this.symbolInstances=new kr}calculateGlyphDependencies(e,n,u,f,p){for(let _=0;_<e.length;_++)if(n[e.charCodeAt(_)]=!0,f&&p){let g=Kd[e.charAt(_)];g&&(n[g.charCodeAt(0)]=!0)}}populate(e,n,u,f){let p=this.layers[0],_=p.layout,g=this.projection.name==="globe",b=_.get("text-font"),w=_.get("text-field"),I=_.get("icon-image"),O=(w.value.kind!=="constant"||w.value.value instanceof Xi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),M=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!O&&!M)return;let k=n.iconDependencies,U=n.glyphDependencies,G=n.availableImages,Y=new A(this.zoom);for(let{feature:ae,id:J,index:ie,sourceLayerIndex:ue}of e){let se=p._featureFilter.needGeometry,Ie=mu(ae,se);if(!p._featureFilter.filter(Y,Ie,u))continue;if(se||(Ie.geometry=Ja(ae,u,f)),g&&ae.type!==1&&u.z<=5){let Ce=Ie.geometry,Ue=.98078528056,je=(Xe,nt)=>ao(zd(Xe.x,Xe.y,u,1),zd(nt.x,nt.y,u,1))<Ue;for(let Xe=0;Xe<Ce.length;Xe++)Ce[Xe]=VY(Ce[Xe],je)}let Te,De;if(O){let Ce=p.getValueAndResolveTokens("text-field",Ie,u,G),Ue=Xi.factory(Ce);RQ(Ue)&&(this.hasRTLText=!0),(!this.hasRTLText||x()==="unavailable"||this.hasRTLText&&E.isParsed())&&(Te=HJ(Ue,p,Ie))}if(M){let Ce=p.getValueAndResolveTokens("icon-image",Ie,u,G);De=Ce instanceof Tn?Ce:Tn.fromString(Ce)}if(!Te&&!De)continue;let Qe=this.sortFeaturesByKey?L.evaluate(Ie,{},u):void 0;if(this.features.push({id:J,text:Te,icon:De,index:ie,sourceLayerIndex:ue,geometry:Ie.geometry,properties:ae.properties,type:MQ[ae.type],sortKey:Qe}),De&&(k[De.name]=!0),Te){let Ce=b.evaluate(Ie,{},u).join(","),Ue=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zn.vertical)>=0;for(let je of Te.sections)if(je.image)k[je.image.name]=!0;else{let Xe=Td(Te.toString()),nt=je.fontStack||Ce,Me=U[nt]=U[nt]||{};this.calculateGlyphDependencies(je.text,Me,Ue,this.allowVerticalPlacement,Xe)}}}_.get("symbol-placement")==="line"&&(this.features=function(ae){let J={},ie={},ue=[],se=0;function Ie(Ce){ue.push(ae[Ce]),se++}function Te(Ce,Ue,je){let Xe=ie[Ce];return delete ie[Ce],ie[Ue]=Xe,ue[Xe].geometry[0].pop(),ue[Xe].geometry[0]=ue[Xe].geometry[0].concat(je[0]),Xe}function De(Ce,Ue,je){let Xe=J[Ue];return delete J[Ue],J[Ce]=Xe,ue[Xe].geometry[0].shift(),ue[Xe].geometry[0]=je[0].concat(ue[Xe].geometry[0]),Xe}function Qe(Ce,Ue,je){let Xe=je?Ue[0][Ue[0].length-1]:Ue[0][0];return`${Ce}:${Xe.x}:${Xe.y}`}for(let Ce=0;Ce<ae.length;Ce++){let Ue=ae[Ce],je=Ue.geometry,Xe=Ue.text?Ue.text.toString():null;if(!Xe){Ie(Ce);continue}let nt=Qe(Xe,je),Me=Qe(Xe,je,!0);if(nt in ie&&Me in J&&ie[nt]!==J[Me]){let lt=De(nt,Me,je),bt=Te(nt,Me,ue[lt].geometry);delete J[nt],delete ie[Me],ie[Qe(Xe,ue[bt].geometry,!0)]=bt,ue[lt].geometry=null}else nt in ie?Te(nt,Me,je):Me in J?De(nt,Me,je):(Ie(Ce),J[nt]=se-1,ie[Me]=se-1)}return ue.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,J)=>ae.sortKey-J.sortKey)}update(e,n,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,u,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=fC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let u=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:f,y:p}of n)this.lineVertexArray.emplaceBack(f,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,n,u,f,p,_,g,b,w,I,O,M,L,k){let U=e.indexArray,G=e.layoutVertexArray,Y=e.globeExtVertexArray,ae=e.segments.prepareSegment(4*n.length,G,U,this.canOverlap?_.sortKey:void 0),J=this.glyphOffsetArray.length,ie=ae.vertexLength,ue=this.allowVerticalPlacement&&g===Zn.vertical?Math.PI/2:0,se=_.text&&_.text.sections;for(let Te=0;Te<n.length;Te++){let{tl:De,tr:Qe,bl:Ce,br:Ue,tex:je,pixelOffsetTL:Xe,pixelOffsetBR:nt,minFontScaleX:Me,minFontScaleY:lt,glyphOffset:bt,isSDF:ut,sectionIndex:Lt}=n[Te],ot=ae.vertexLength,Et=bt[1];if(Ty(G,w.x,w.y,De.x,Et+De.y,je.x,je.y,u,ut,Xe.x,Xe.y,Me,lt),Ty(G,w.x,w.y,Qe.x,Et+Qe.y,je.x+je.w,je.y,u,ut,nt.x,Xe.y,Me,lt),Ty(G,w.x,w.y,Ce.x,Et+Ce.y,je.x,je.y+je.h,u,ut,Xe.x,nt.y,Me,lt),Ty(G,w.x,w.y,Ue.x,Et+Ue.y,je.x+je.w,je.y+je.h,u,ut,nt.x,nt.y,Me,lt),b){let{x:kt,y:ar,z:Bt}=b.anchor,[Ct,Lr,Ut]=b.up;Ey(Y,kt,ar,Bt,Ct,Lr,Ut),Ey(Y,kt,ar,Bt,Ct,Lr,Ut),Ey(Y,kt,ar,Bt,Ct,Lr,Ut),Ey(Y,kt,ar,Bt,Ct,Lr,Ut),Sy(e.dynamicLayoutVertexArray,kt,ar,Bt,ue)}else Sy(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ue);U.emplaceBack(ot,ot+1,ot+2),U.emplaceBack(ot+1,ot+2,ot+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bt[0]),Te!==n.length-1&&Lt===n[Te+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,_,_.index,{},L,k,se&&se[Lt])}let Ie=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Ie.x,Ie.y,Ie.z,w.x,w.y,J,this.glyphOffsetArray.length-J,ie,I,O,w.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],g,0,!1,0,M,0)}_commitLayoutVertex(e,n,u,f,p,_,g){e.emplaceBack(n,u,f,p,_,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,n,u,f,p,_,g){let b=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),w=b.vertexLength,I=g.tileAnchorX,O=g.tileAnchorY;for(let L=0;L<4;L++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),u.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),u.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),u.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(u.layoutVertexArray,f,p,_,I,O,new Ve(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,p,_,I,O,new Ve(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,p,_,I,O,new Ve(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,p,_,I,O,new Ve(e.x1,e.y2)),b.vertexLength+=4;let M=u.indexArray;M.emplaceBack(w,w+1),M.emplaceBack(w+1,w+2),M.emplaceBack(w+2,w+3),M.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,u,f,p,_){for(let g=f;g<p;g++){let b=u.get(g),w=this.getSymbolInstanceTextSize(e,_,n,g);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,n,u,f,p,_){for(let g=f;g<p;g++){let b=u.get(g),w=this.getSymbolInstanceIconSize(e,n,_.placedIconSymbolIndex);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new s1(xt,MO.members,Ei),this.iconCollisionBox=new s1(xt,MO.members,Ei);let u=Zc(this.iconSizeData,e),f=Zc(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){let _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,e,n,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(f,e,n,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(u,e,n,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(u,e,n,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,n,u,f){let p=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:f),_=dy(this.textSizeData,e,p)/Pi;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,n,u){let f=this.icon.placedSymbolArray.get(u),p=dy(this.iconSizeData,e,f);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,n,u){e.emplaceBack(n,-u,-u),e.emplaceBack(n,u,-u),e.emplaceBack(n,u,u),e.emplaceBack(n,-u,u)}_updateTextDebugCollisionBoxes(e,n,u,f,p,_){for(let g=f;g<p;g++){let b=u.get(g),w=this.getSymbolInstanceTextSize(e,_,n,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(e,n,u,f,p,_){for(let g=f;g<p;g++){let b=u.get(g),w=this.getSymbolInstanceIconSize(e,n,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,b.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let u=Zc(this.iconSizeData,e),f=Zc(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){let _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(f,e,n,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(f,e,n,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(u,e,n,_.iconBoxStartIndex,_.iconBoxEndIndex,_.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,e,n,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,u,f,p,_,g,b,w){let I={};if(n<u){let{x1:O,y1:M,x2:L,y2:k,padding:U,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ae,tileAnchorX:J,tileAnchorY:ie,featureIndex:ue}=e.get(n);I.textBox={x1:O,y1:M,x2:L,y2:k,padding:U,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ae,tileAnchorX:J,tileAnchorY:ie},I.textFeatureIndex=ue}if(f<p){let{x1:O,y1:M,x2:L,y2:k,padding:U,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ae,tileAnchorX:J,tileAnchorY:ie,featureIndex:ue}=e.get(f);I.verticalTextBox={x1:O,y1:M,x2:L,y2:k,padding:U,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ae,tileAnchorX:J,tileAnchorY:ie},I.verticalTextFeatureIndex=ue}if(_<g){let{x1:O,y1:M,x2:L,y2:k,padding:U,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ae,tileAnchorX:J,tileAnchorY:ie,featureIndex:ue}=e.get(_);I.iconBox={x1:O,y1:M,x2:L,y2:k,padding:U,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ae,tileAnchorX:J,tileAnchorY:ie},I.iconFeatureIndex=ue}if(b<w){let{x1:O,y1:M,x2:L,y2:k,padding:U,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ae,tileAnchorX:J,tileAnchorY:ie,featureIndex:ue}=e.get(b);I.verticalIconBox={x1:O,y1:M,x2:L,y2:k,padding:U,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ae,tileAnchorX:J,tileAnchorY:ie},I.verticalIconFeatureIndex=ue}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let u=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){let u=e.placedSymbolArray.get(n),f=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<f;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),u=Math.cos(e),f=[],p=[],_=[];for(let g=0;g<this.symbolInstances.length;++g){_.push(g);let b=this.symbolInstances.get(g);f.push(0|Math.round(n*b.tileAnchorX+u*b.tileAnchorY)),p.push(b.featureIndex)}return _.sort((g,b)=>f[g]-f[b]||p[b]-p[g]),_}addToSortKeyRanges(e,n){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===n?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let u=this.symbolInstances.get(n);this.featureSortOrder.push(u.featureIndex);let{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:w}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),p>=0&&p!==f&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}yt(Ys,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ys.MAX_GLYPHS=65535,Ys.addDynamicAttributes=Sy;let DQ=new ee({"symbol-placement":new N(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new N(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new N(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new W(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new N(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new N(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new N(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new N(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new N(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new W(Re.layout_symbol["icon-size"]),"icon-text-fit":new N(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new N(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new W(Re.layout_symbol["icon-image"]),"icon-rotate":new W(Re.layout_symbol["icon-rotate"]),"icon-padding":new N(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new N(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new W(Re.layout_symbol["icon-offset"]),"icon-anchor":new W(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new N(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new N(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new N(Re.layout_symbol["text-rotation-alignment"]),"text-field":new W(Re.layout_symbol["text-field"]),"text-font":new W(Re.layout_symbol["text-font"]),"text-size":new W(Re.layout_symbol["text-size"]),"text-max-width":new W(Re.layout_symbol["text-max-width"]),"text-line-height":new W(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new W(Re.layout_symbol["text-letter-spacing"]),"text-justify":new W(Re.layout_symbol["text-justify"]),"text-radial-offset":new W(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new N(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new W(Re.layout_symbol["text-anchor"]),"text-max-angle":new N(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new N(Re.layout_symbol["text-writing-mode"]),"text-rotate":new W(Re.layout_symbol["text-rotate"]),"text-padding":new N(Re.layout_symbol["text-padding"]),"text-keep-upright":new N(Re.layout_symbol["text-keep-upright"]),"text-transform":new W(Re.layout_symbol["text-transform"]),"text-offset":new W(Re.layout_symbol["text-offset"]),"text-allow-overlap":new N(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new N(Re.layout_symbol["text-ignore-placement"]),"text-optional":new N(Re.layout_symbol["text-optional"])});var l1={paint:new ee({"icon-opacity":new W(Re.paint_symbol["icon-opacity"]),"icon-color":new W(Re.paint_symbol["icon-color"]),"icon-halo-color":new W(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new W(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new W(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new N(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new N(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new W(Re.paint_symbol["text-opacity"]),"text-color":new W(Re.paint_symbol["text-color"],{runtimeType:un,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new W(Re.paint_symbol["text-halo-color"]),"text-halo-width":new W(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new W(Re.paint_symbol["text-halo-blur"]),"text-translate":new N(Re.paint_symbol["text-translate"]),"text-translate-anchor":new N(Re.paint_symbol["text-translate-anchor"])}),layout:DQ};class dC{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:As,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt(dC,"FormatSectionOverride",{omit:["defaultValue"]});class Iy extends Bo{constructor(e){super(e,l1)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let u=this.layout.get("text-writing-mode");if(u){let f=[];for(let p of u)f.indexOf(p)<0&&f.push(p);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,u,f){let p=this.layout.get(e).evaluate(n,{},u,f),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Fs(_.value)||!p?p:function(g,b){return b.replace(/{([^{}]+)}/g,(w,I)=>I in g?String(g[I]):"")}(n.properties,p)}createBucket(e){return new Ys(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of l1.paint.overridableProperties){if(!Iy.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),u=new dC(n),f=new Ac(u,n.property.specification),p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new fd("source",f):new eu("composite",f,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new H(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,u){return!(!this.layout||n.isDataDriven()||u.isDataDriven())&&Iy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let u=e.get("text-field"),f=l1.paint.properties[n],p=!1,_=g=>{for(let b of g)if(f.overrides&&f.overrides.hasOverride(b))return void(p=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Xi)_(u.value.value.sections);else if(u.value.kind==="source"){let g=w=>{p||(w instanceof Na&&Hr(w.value)===Bl?_(w.value.sections):w instanceof aa?_(w.sections):w.eachChild(g))},b=u.value;b._styleExpression&&g(b._styleExpression.expression)}return p}getProgramConfiguration(e){return new Ws(this,e)}}var LQ={paint:new ee({"background-color":new N(Re.paint_background["background-color"]),"background-pattern":new N(Re.paint_background["background-pattern"]),"background-opacity":new N(Re.paint_background["background-opacity"])})},kQ={paint:new ee({"raster-opacity":new N(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new N(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new N(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new N(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new N(Re.paint_raster["raster-saturation"]),"raster-contrast":new N(Re.paint_raster["raster-contrast"]),"raster-resampling":new N(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new N(Re.paint_raster["raster-fade-duration"])})};class BQ extends Bo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var zQ={paint:new ee({"sky-type":new N(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new N(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new N(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new N(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new N(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new Q(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new N(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new N(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new N(Re.paint_sky["sky-opacity"])})};function u1(r,e,n){let u=[0,0,1],f=qA([]);return DA(f,f,n?-Pt(r)+Math.PI:Pt(r)),RA(f,f,-Pt(e)),OA(u,u,f),Yi(u,u)}let FQ={circle:class extends Bo{constructor(r){super(r,KY)}createBucket(r){return new Lx(r)}queryRadius(r){let e=r;return Vc("circle-radius",this,e)+Vc("circle-stroke-width",this,e)+ry(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,n,u,f,p,_,g){let b=rO(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return iO(r,u,p,_,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new Ws(this,r)}},heatmap:class extends Bo{createBucket(r){return new oO(r)}constructor(r){super(r,eJ),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Vc("heatmap-radius",this,r)}queryIntersectsFeature(r,e,n,u,f,p,_,g){let b=this.paint.get("heatmap-radius").evaluate(e,n);return iO(r,u,p,_,g,!0,!0,new Ve(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new Ws(this,r)}},hillshade:class extends Bo{constructor(r){super(r,tJ)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Bo{constructor(r){super(r,yJ)}getProgramIds(){let r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(r){return new Ws(this,r)}recalculate(r,e){super.recalculate(r,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new sy(r)}queryRadius(){return ry(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,n,u,f,p){return!r.queryGeometry.isAboveHorizon&&YA(tO(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Bo{constructor(r){super(r,RJ)}createBucket(r){return new Zd(r)}queryRadius(){return ry(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new Ws(this,r)}queryIntersectsFeature(r,e,n,u,f,p,_,g,b){let w=rO(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,n),O=this.paint.get("fill-extrusion-base").evaluate(e,n),M=[0,0],L=g&&p.elevation,k=p.elevation?p.elevation.exaggeration():1,U=r.tile.getBucket(this);if(L&&U instanceof Zd){let ie=U.centroidVertexArray,ue=b+1;ue<ie.length&&(M[0]=ie.geta_centroid_pos0(ue),M[1]=ie.geta_centroid_pos1(ue))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(u=TO([u],[new Ve(0,0),new Ve(St,St)],r.tileID.canonical).map(ie=>ie.polygon).flat());let G=L?g:null,[Y,ae]=function(ie,ue,se,Ie,Te,De,Qe,Ce,Ue,je,Xe){return ie.projection.name==="globe"?function(nt,Me,lt,bt,ut,Lt,ot,Et,kt,ar,Bt){let Ct=[],Lr=[],Ut=nt.projection.upVectorScale(Bt,nt.center.lat,nt.worldSize).metersToTile,jt=[0,0,0,1],Sr=[0,0,0,1],Pr=(Ir,$r,Xr,li)=>{Ir[0]=$r,Ir[1]=Xr,Ir[2]=li,Ir[3]=1},Mr=wO();lt>0&&(lt+=Mr),bt+=Mr;for(let Ir of Me){let $r=[],Xr=[];for(let li of Ir){let Ar=li.x+ut.x,mi=li.y+ut.y,ui=nt.projection.projectTilePoint(Ar,mi,Bt),Gr=nt.projection.upVector(Bt,li.x,li.y),lr=lt,ci=bt;if(ot){let qr=AO(Ar,mi,lt,bt,ot,Et,kt,ar);lr+=qr.base,ci+=qr.top}lt!==0?Pr(jt,ui.x+Gr[0]*Ut*lr,ui.y+Gr[1]*Ut*lr,ui.z+Gr[2]*Ut*lr):Pr(jt,ui.x,ui.y,ui.z),Pr(Sr,ui.x+Gr[0]*Ut*ci,ui.y+Gr[1]*Ut*ci,ui.z+Gr[2]*Ut*ci),Qr(jt,jt,Lt),Qr(Sr,Sr,Lt),$r.push(new Wc(jt[0],jt[1],jt[2])),Xr.push(new Wc(Sr[0],Sr[1],Sr[2]))}Ct.push($r),Lr.push(Xr)}return[Ct,Lr]}(ie,ue,se,Ie,Te,De,Qe,Ce,Ue,je,Xe):Qe?function(nt,Me,lt,bt,ut,Lt,ot,Et,kt){let ar=[],Bt=[],Ct=[0,0,0,1];for(let Lr of nt){let Ut=[],jt=[];for(let Sr of Lr){let Pr=Sr.x+bt.x,Mr=Sr.y+bt.y,Ir=AO(Pr,Mr,Me,lt,Lt,ot,Et,kt);Ct[0]=Pr,Ct[1]=Mr,Ct[2]=Ir.base,Ct[3]=1,fu(Ct,Ct,ut),Ct[3]=Math.max(Ct[3],1e-5);let $r=new Wc(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Ct[0]=Pr,Ct[1]=Mr,Ct[2]=Ir.top,Ct[3]=1,fu(Ct,Ct,ut),Ct[3]=Math.max(Ct[3],1e-5);let Xr=new Wc(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Ut.push($r),jt.push(Xr)}ar.push(Ut),Bt.push(jt)}return[ar,Bt]}(ue,se,Ie,Te,De,Qe,Ce,Ue,je):function(nt,Me,lt,bt,ut){let Lt=[],ot=[],Et=ut[8]*Me,kt=ut[9]*Me,ar=ut[10]*Me,Bt=ut[11]*Me,Ct=ut[8]*lt,Lr=ut[9]*lt,Ut=ut[10]*lt,jt=ut[11]*lt;for(let Sr of nt){let Pr=[],Mr=[];for(let Ir of Sr){let $r=Ir.x+bt.x,Xr=Ir.y+bt.y,li=ut[0]*$r+ut[4]*Xr+ut[12],Ar=ut[1]*$r+ut[5]*Xr+ut[13],mi=ut[2]*$r+ut[6]*Xr+ut[14],ui=ut[3]*$r+ut[7]*Xr+ut[15],Gr=li+Et,lr=Ar+kt,ci=mi+ar,qr=Math.max(ui+Bt,1e-5),en=li+Ct,hi=Ar+Lr,Mi=mi+Ut,Si=Math.max(ui+jt,1e-5);Pr.push(new Wc(Gr/qr,lr/qr,ci/qr)),Mr.push(new Wc(en/Si,hi/Si,Mi/Si))}Lt.push(Pr),ot.push(Mr)}return[Lt,ot]}(ue,se,Ie,Te,De)}(p,u,O,I,w,_,G,M,k,p.center.lat,r.tileID.canonical),J=r.queryGeometry;return function(ie,ue,se){let Ie=1/0;YA(se,ue)&&(Ie=IO(se,ue[0]));for(let Te=0;Te<ue.length;Te++){let De=ue[Te],Qe=ie[Te];for(let Ce=0;Ce<De.length-1;Ce++){let Ue=De[Ce],je=[Ue,De[Ce+1],Qe[Ce+1],Qe[Ce],Ue];KA(se,je)&&(Ie=Math.min(Ie,IO(se,je)))}}return Ie!==1/0&&Ie}(Y,ae,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends Bo{constructor(r){super(r,OO),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Qf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=CO.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new fy(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new Ws(this,r)}queryRadius(r){let e=r,n=PO(Vc("line-width",this,e),Vc("line-gap-width",this,e)),u=Vc("line-offset",this,e);return n/2+Math.abs(u)+ry(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,n,u,f,p){if(r.queryGeometry.isAboveHorizon)return!1;let _=tO(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),g=r.pixelToTileUnitsFactor/2*PO(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),b=this.paint.get("line-offset").evaluate(e,n);return b&&(u=function(w,I){let O=[],M=new Ve(0,0);for(let L=0;L<w.length;L++){let k=w[L],U=[];for(let G=0;G<k.length;G++){let Y=k[G],ae=k[G+1],J=G===0?M:Y.sub(k[G-1])._unit()._perp(),ie=G===k.length-1?M:ae.sub(Y)._unit()._perp(),ue=J._add(ie)._unit();ue._mult(1/(ue.x*ie.x+ue.y*ie.y)),U.push(ue._mult(I)._add(Y))}O.push(U)}return O}(u,b*r.pixelToTileUnitsFactor)),function(w,I,O){for(let M=0;M<I.length;M++){let L=I[M];if(w.length>=3){for(let k=0;k<L.length;k++)if(_u(w,L[k]))return!0}if(WY(w,L,O))return!0}return!1}(_,u,g)}isTileClipped(){return!0}},symbol:Iy,background:class extends Bo{constructor(r){super(r,LQ)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Bo{constructor(r){super(r,kQ)}getProgramIds(){return["raster"]}},sky:class extends Bo{constructor(r){super(r,zQ),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Fx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){let u=this.paint.get("sky-atmosphere-sun"),f=!u,p=r.style.light,_=p.properties.get("position");return f&&p.properties.get("anchor")==="viewport"&&jr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?u1(_.azimuthal,90-_.polar,e):u1(u[0],90-u[1],e)}let n=this.paint.get("sky-gradient-center");return u1(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}}};class np{constructor(e,n,u,f){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(n,f)}update(e,n,u){let{width:f,height:p}=e,{context:_}=this,{gl:g}=_,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:I,ImageData:O,ImageBitmap:M}=v;if(g.bindTexture(g.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!n||n.premultiply!==!1)),u||this.size&&this.size[0]===f&&this.size[1]===p){let{x:L,y:k}=u||{x:0,y:0};e instanceof b||e instanceof w||e instanceof I||e instanceof O||M&&e instanceof M?g.texSubImage2D(g.TEXTURE_2D,0,L,k,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,L,k,f,p,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[f,p],e instanceof b||e instanceof w||e instanceof I||e instanceof O||M&&e instanceof M?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,f,p,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=!!(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,n){let{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class NQ{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class UQ{constructor(){this.tasks={},this.taskQueue=[],Un(["process"],this),this.invoker=new NQ(this.process),this.nextId=0}add(e,n){let u=this.nextId++,f=function({type:p,isSymbolTile:_,zoom:g}){return g=g||0,p==="message"?0:p!=="maybePrepare"||_?p!=="parseTile"||_?p==="parseTile"&&_?300-g:p==="maybePrepare"&&_?400-g:500:200-g:100-g}(n);if(f===0){Eo();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:e,metadata:n,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Eo();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let f=0;f<this.taskQueue.length;f++){let p=this.tasks[this.taskQueue[f]];p.priority<n&&(n=p.priority,e=f)}if(e===null)return null;let u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class pC{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let u=e[n];this._stringToNumber[u]=n,this._numberToString[n]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let jQ=["tile","layer","source","sourceLayer","state"];class mC{constructor(e,n,u,f,p){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=u,this._y=f,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of jQ)this[n]!==void 0&&(e[n]=this[n]);return e}}let uo=32,da=33,Js=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,n=0,u=0,f=0,p=0,_=0,g=0;for(1&e?f=p=_=uo:n=u=g=uo;(e>>=1)>1;){let w=n+f>>1,I=u+p>>1;1&e?(f=n,p=u,n=_,u=g):(n=f,u=p,f=_,p=g),_=w,g=I}let b=4*r;Js[b+0]=n,Js[b+1]=u,Js[b+2]=f,Js[b+3]=p}let pa=new Uint16Array(2178),Qs=new Uint8Array(1089),Ay=new Uint16Array(1089);function _C(r){return r===0?-.03125:r===32?.03125:0}var yC=ye([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let gC={type:2,extent:St,loadGeometry:()=>[[new Ve(0,0),new Ve(St+1,0),new Ve(St+1,St+1),new Ve(0,St+1),new Ve(0,0)]]};class c1{constructor(e,n,u,f,p){this.tileID=e,this.uid=hr(),this.uses=0,this.tileSize=n,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<So.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=gu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,u){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(f,p){let _={};if(!p)return _;for(let g of f){let b=g.layerIds.map(w=>p.getLayer(w)).filter(Boolean);if(b.length!==0){g.layers=b,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>b.filter(I=>I.id===w)[0]));for(let w of b)_[w.id]=g}}return _}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let f in this.buckets){let p=this.buckets[f];if(p instanceof Ys){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let f in this.buckets){let p=this.buckets[f];if(p instanceof Ys&&p.hasRTLText){this.hasRTLText=!0,E.isLoading()||E.isLoaded()||x()!=="deferred"||T();break}}this.queryPadding=0;for(let f in this.buckets){let p=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(f).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Tr}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(let u in this.buckets){let f=this.buckets[u];f.uploadPending()&&f.upload(e)}let n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new np(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new np(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new np(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,u,f,p,_,g,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:g,transform:_,params:p,tileTransform:this.tileTransform},e,n,u):{}}querySourceFeatures(e,n){let u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;let f=u.loadVTLayers(),p=n?n.sourceLayer:"",_=f._geojsonTileLayer||f[p];if(!_)return;let g=Mc(n&&n.filter),{z:b,x:w,y:I}=this.tileID.canonical,O={z:b,x:w,y:I};for(let M=0;M<_.length;M++){let L=_.feature(M);if(g.needGeometry){let G=mu(L,!0);if(!g.filter(new A(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!g.filter(new A(this.tileID.overscaledZ),L))continue;let k=u.getId(L,p),U=new mC(L,b,w,I,k);U.tile=O,e.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let u=ln(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let u=Date.now(),f=!1;if(this.expirationTime>u)f=!1;else if(n)if(this.expirationTime<n)f=!0;else{let p=this.expirationTime-n;p?this.expirationTime=u+Math.max(p,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;let u=this.latestFeatureIndex.loadVTLayers(),f=n.style.listImages();for(let p in this.buckets){if(!n.style.hasLayer(p))continue;let _=this.buckets[p],g=_.layers[0].sourceLayer||"_geojsonTileLayer",b=u[g],w=e[g];if(!b||!w||Object.keys(w).length===0)continue;if(_.update(w,b,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof fy||_ instanceof sy){let O=n.style._getSourceCache(_.layers[0].source);n._terrain&&n._terrain.enabled&&O&&_.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(O.id,this.tileID)}let I=n&&n.style&&n.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<So.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=So.now()+e}setTexture(e,n){let u=n.context,f=u.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new np(u,e,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(e,n){let u={};for(let f of n)u[f]=!0;this.dependencies[e]=u}hasDependency(e,n){for(let u of e){let f=this.dependencies[u];if(f){for(let p of n)if(f[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let u=Ja(gC,this.tileID.canonical,this.tileTransform)[0],f=new Je,p=new In;for(let _=0;_<u.length;_++){let{x:g,y:b}=u[_];f.emplaceBack(g,b),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(f,kd.members),this._tileDebugSegments=ai.simpleSegment(0,0,f.length,p.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let u=Ja(gC,this.tileID.canonical,this.tileTransform)[0],f,p;if(this.isRaster){let _=function(g,b){let w=gu(g,b),I=Math.pow(2,g.z);for(let G=0;G<da;G++)for(let Y=0;Y<da;Y++){let ae=Wn((g.x+(Y+_C(Y))/uo)/I),J=Bi((g.y+(G+_C(G))/uo)/I),ie=b.project(ae,J),ue=G*da+Y;pa[2*ue+0]=Math.round((ie.x*w.scale-w.x)*St),pa[2*ue+1]=Math.round((ie.y*w.scale-w.y)*St)}Qs.fill(0),Ay.fill(0);for(let G=2045;G>=0;G--){let Y=4*G,ae=Js[Y+0],J=Js[Y+1],ie=Js[Y+2],ue=Js[Y+3],se=ae+ie>>1,Ie=J+ue>>1,Te=se+Ie-J,De=Ie+ae-se,Qe=J*da+ae,Ce=ue*da+ie,Ue=Ie*da+se,je=Math.hypot((pa[2*Qe+0]+pa[2*Ce+0])/2-pa[2*Ue+0],(pa[2*Qe+1]+pa[2*Ce+1])/2-pa[2*Ue+1])>=16;Qs[Ue]=Qs[Ue]||(je?1:0),G<1022&&(Qs[Ue]=Qs[Ue]||Qs[(J+De>>1)*da+(ae+Te>>1)]||Qs[(ue+De>>1)*da+(ie+Te>>1)])}let O=new ze,M=new wt,L=0;function k(G,Y){let ae=Y*da+G;return Ay[ae]===0&&(O.emplaceBack(pa[2*ae+0],pa[2*ae+1],G*St/uo,Y*St/uo),Ay[ae]=++L),Ay[ae]-1}function U(G,Y,ae,J,ie,ue){let se=G+ae>>1,Ie=Y+J>>1;if(Math.abs(G-ie)+Math.abs(Y-ue)>1&&Qs[Ie*da+se])U(ie,ue,G,Y,se,Ie),U(ae,J,ie,ue,se,Ie);else{let Te=k(G,Y),De=k(ae,J),Qe=k(ie,ue);M.emplaceBack(Te,De,Qe)}}return U(0,0,uo,uo,uo,0),U(uo,uo,0,0,0,uo),{vertices:O,indices:M}}(this.tileID.canonical,n);f=_.vertices,p=_.indices}else{f=new ze,p=new wt;for(let{x:g,y:b}of u)f.emplaceBack(g,b,0,0);let _=$x(f.int16,void 0,4);for(let g=0;g<_.length;g+=3)p.emplaceBack(_[g],_[g+1],_[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(f,yC.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=ai.simpleSegment(0,0,f.length,p.length)}_makeGlobeTileDebugBuffers(e,n){let u=n.projection;if(!u||u.name!=="globe"||n.freezeTileCoverage)return;let f=this.tileID.canonical,p=Fd(FA(f,n)),_=Uc(n.zoom),g;_>0&&(g=gx(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,f,n,p,g,_),this._makeGlobeTileDebugTextBuffer(e,f,n,p,g,_)}_globePoint(e,n,u,f,p,_,g){let b=zd(e,n,u);if(_){let w=1<<u.z,I=ha(f.center.lng),O=fa(f.center.lat),M=(u.x+.5)/w-I,L=0;M>.5?L=-1:M<-.5&&(L=1);let k=(e/St+u.x)/w+L,U=(n/St+u.y)/w;k=(k-I)*f._pixelsPerMercatorPixel+I,U=(U-O)*f._pixelsPerMercatorPixel+O;let G=[k*f.worldSize,U*f.worldSize,0];Qr(G,G,_),b=pu(b,G,g)}return Qr(b,b,p)}_makeGlobeTileDebugBorderBuffer(e,n,u,f,p,_){let g=new Je,b=new In,w=new we,I=(M,L,k,U,G)=>{let Y=(k-M)/(G-1),ae=(U-L)/(G-1),J=g.length;for(let ie=0;ie<G;ie++){let ue=M+ie*Y,se=L+ie*ae;g.emplaceBack(ue,se);let Ie=this._globePoint(ue,se,n,u,f,p,_);w.emplaceBack(Ie[0],Ie[1],Ie[2]),b.emplaceBack(J+ie)}},O=St;I(0,0,O,0,16),I(O,0,O,O,16),I(O,O,0,O,16),I(0,O,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(g,kd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,kA.members),this._tileDebugSegments=ai.simpleSegment(0,0,g.length,b.length)}_makeGlobeTileDebugTextBuffer(e,n,u,f,p,_){let g=St/4,b=new Je,w=new wt,I=new we,O=25;w.reserve(32),b.reserve(O),I.reserve(O);let M=(L,k)=>O*L+k;for(let L=0;L<O;L++){let k=L*g;for(let U=0;U<O;U++){let G=U*g;b.emplaceBack(G,k);let Y=this._globePoint(G,k,n,u,f,p,_);I.emplaceBack(Y[0],Y[1],Y[2])}}for(let L=0;L<4;L++)for(let k=0;k<4;k++){let U=M(L,k),G=M(L,k+1),Y=M(L+1,k),ae=M(L+1,k+1);w.emplaceBack(U,G,Y),w.emplaceBack(Y,G,ae)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(b,kd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(I,kA.members),this._tileDebugTextSegments=ai.simpleSegment(0,0,O,32)}}class VQ{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,u){let f=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},vt(this.stateChanges[e][f],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(let p in this.state[e])p!==f&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(let p in this.state[e][f])u[p]||(this.deletedStates[e][f][p]=null)}else for(let p in u)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][p]===null&&delete this.deletedStates[e][f][p]}removeFeatureState(e,n,u){if(this.deletedStates[e]===null)return;let f=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&n!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][u]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(u in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][u]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,n){let u=String(n),f=vt({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let p=this.deletedStates[e][n];if(p===null)return{};for(let _ in p)delete f[_]}return f}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let u={};for(let f in this.stateChanges){this.state[f]=this.state[f]||{};let p={};for(let _ in this.stateChanges[f])this.state[f][_]||(this.state[f][_]={}),vt(this.state[f][_],this.stateChanges[f][_]),p[_]=this.state[f][_];u[f]=p}for(let f in this.deletedStates){this.state[f]=this.state[f]||{};let p={};if(this.deletedStates[f]===null)for(let _ in this.state[f])p[_]={},this.state[f][_]={};else for(let _ in this.deletedStates[f]){if(this.deletedStates[f][_]===null)this.state[f][_]={};else if(this.state[f][_])for(let g of Object.keys(this.deletedStates[f][_]))delete this.state[f][_][g];p[_]=this.state[f][_]}u[f]=u[f]||{},vt(u[f],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(let f in e)e[f].setFeatureState(u,n)}}class vC{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let u=this.toIdx(e,n);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function xC(r,e,n,u){let f=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(u[_])<1e-15){if(n[_]<r[_]||n[_]>e[_])return null}else{let g=1/u[_],b=(r[_]-n[_])*g,w=(e[_]-n[_])*g;if(b>w){let I=b;b=w,w=I}if(b>f&&(f=b),w<p&&(p=w),f>p)return null}return f}function bC(r,e,n,u,f,p,_,g,b,w,I){let O=u-r,M=f-e,L=p-n,k=_-r,U=g-e,G=b-n,Y=I[1]*G-I[2]*U,ae=I[2]*k-I[0]*G,J=I[0]*U-I[1]*k,ie=O*Y+M*ae+L*J;if(Math.abs(ie)<1e-15)return null;let ue=1/ie,se=w[0]-r,Ie=w[1]-e,Te=w[2]-n,De=(se*Y+Ie*ae+Te*J)*ue;if(De<0||De>1)return null;let Qe=Ie*L-Te*M,Ce=Te*O-se*L,Ue=se*M-Ie*O,je=(I[0]*Qe+I[1]*Ce+I[2]*Ue)*ue;return je<0||De+je>1?null:(k*Qe+U*Ce+G*Ue)*ue}function wC(r,e,n){return(r-e)/(n-e)}function TC(r,e,n,u,f,p,_,g,b){let w=1<<n,I=p-u,O=_-f,M=(r+1)/w*I+u,L=(e+0)/w*O+f,k=(e+1)/w*O+f;g[0]=(r+0)/w*I+u,g[1]=L,b[0]=M,b[1]=k}class EC{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(p){let _=Math.ceil(Math.log2(p.dim/8)),g=[],b=Math.ceil(Math.pow(2,_)),w=1/b,I=(L,k,U,G,Y)=>{let ae=G?1:0,J=(L+1)*U-ae,ie=k*U,ue=(k+1)*U-ae;Y[0]=L*U,Y[1]=ie,Y[2]=J,Y[3]=ue},O=new vC(b),M=[];for(let L=0;L<b*b;L++){I(L%b,Math.floor(L/b),w,!1,M);let k=el(M[0],M[1],p),U=el(M[2],M[1],p),G=el(M[2],M[3],p),Y=el(M[0],M[3],p);O.minimums.push(Math.min(k,U,G,Y)),O.maximums.push(Math.max(k,U,G,Y)),O.leaves.push(1)}for(g.push(O),b/=2;b>=1;b/=2){let L=g[g.length-1];O=new vC(b);for(let k=0;k<b*b;k++){I(k%b,Math.floor(k/b),2,!0,M);let U=L.getElevation(M[0],M[1]),G=L.getElevation(M[2],M[1]),Y=L.getElevation(M[2],M[3]),ae=L.getElevation(M[0],M[3]),J=L.isLeaf(M[0],M[1]),ie=L.isLeaf(M[2],M[1]),ue=L.isLeaf(M[2],M[3]),se=L.isLeaf(M[0],M[3]),Ie=Math.min(U.min,G.min,Y.min,ae.min),Te=Math.max(U.max,G.max,Y.max,ae.max),De=J&&ie&&ue&&se;O.maximums.push(Te),O.minimums.push(Ie),O.leaves.push(Te-Ie<=5&&De?1:0)}g.push(O)}return g}(this.dem),u=n.length-1,f=n[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(n,0,0,u,0)}raycastRoot(e,n,u,f,p,_,g=1){return xC([e,n,-100],[u,f,this.maximums[0]*g],p,_)}raycast(e,n,u,f,p,_,g=1){if(!this.nodeCount)return null;let b=this.raycastRoot(e,n,u,f,p,_,g);if(b==null)return null;let w=[],I=[],O=[],M=[],L=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;L.length>0;){let{idx:k,t:U,nodex:G,nodey:Y,depth:ae}=L.pop();if(this.leaves[k]){TC(G,Y,ae,e,n,u,f,O,M);let ie=1<<ae,ue=(G+0)/ie,se=(G+1)/ie,Ie=(Y+0)/ie,Te=(Y+1)/ie,De=el(ue,Ie,this.dem)*g,Qe=el(se,Ie,this.dem)*g,Ce=el(se,Te,this.dem)*g,Ue=el(ue,Te,this.dem)*g,je=bC(O[0],O[1],De,M[0],O[1],Qe,M[0],M[1],Ce,p,_),Xe=bC(M[0],M[1],Ce,O[0],M[1],Ue,O[0],O[1],De,p,_),nt=Math.min(je!==null?je:Number.MAX_VALUE,Xe!==null?Xe:Number.MAX_VALUE);if(nt!==Number.MAX_VALUE)return nt;{let Me=Dd([],p,_,U);if(SC(De,Qe,Ue,Ce,wC(Me[0],O[0],M[0]),wC(Me[1],O[1],M[1]))>=Me[2])return U}continue}let J=0;for(let ie=0;ie<this._siblingOffset.length;ie++){TC((G<<1)+this._siblingOffset[ie][0],(Y<<1)+this._siblingOffset[ie][1],ae+1,e,n,u,f,O,M),O[2]=-100,M[2]=this.maximums[this.childOffsets[k]+ie]*g;let ue=xC(O,M,p,_);if(ue!=null){let se=ue;w[ie]=se;let Ie=!1;for(let Te=0;Te<J&&!Ie;Te++)se>=w[I[Te]]&&(I.splice(Te,0,ie),Ie=!0);Ie||(I[J]=ie),J++}}for(let ie=0;ie<J;ie++){let ue=I[ie];L.push({idx:this.childOffsets[k]+ue,t:w[ue],nodex:(G<<1)+this._siblingOffset[ue][0],nodey:(Y<<1)+this._siblingOffset[ue][1],depth:ae+1})}}return null}_addNode(e,n,u){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,u,f,p){if(e[f].isLeaf(n,u)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);let _=f-1,g=e[_],b=0,w=0;for(let I=0;I<this._siblingOffset.length;I++){let O=2*n+this._siblingOffset[I][0],M=2*u+this._siblingOffset[I][1],L=g.getElevation(O,M),k=g.isLeaf(O,M),U=this._addNode(L.min,L.max,k);k&&(b|=1<<I),w||(w=U)}for(let I=0;I<this._siblingOffset.length;I++)b&1<<I||this._construct(e,2*n+this._siblingOffset[I][0],2*u+this._siblingOffset[I][1],_,w+I)}}function SC(r,e,n,u,f,p){return nr(nr(r,n,p),nr(e,u,p),f)}function el(r,e,n){let u=n.dim,f=Ne(r*u-.5,0,u-1),p=Ne(e*u-.5,0,u-1),_=Math.floor(f),g=Math.floor(p),b=Math.min(_+1,u-1),w=Math.min(g+1,u-1);return SC(n.get(_,g),n.get(b,g),n.get(_,w),n.get(b,w),f-_,p-g)}let IC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function $Q(r,e,n){return(256*r*256+256*e+n)/10-1e4}function GQ(r,e,n){return 256*r+e+n/256-32768}class Oy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,u,f=!1,p=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return jr(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let _=this.dim=n.height-2,g=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let b=0;b<_;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(_,b)]=g[this._idx(_-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,_)]=g[this._idx(b,_-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(_,-1)]=g[this._idx(_-1,0)],g[this._idx(-1,_)]=g[this._idx(0,_-1)],g[this._idx(_,_)]=g[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new EC(this)}get(e,n,u=!1){u&&(e=Ne(e,-1,this.dim),n=Ne(n,-1,this.dim));let f=4*this._idx(e,n);return(this.encoding==="terrarium"?GQ:$Q)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(e){return IC[e]}get unpackVector(){return IC[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let u=[0,0,0,0],f=Oy.getUnpackVector(n),p=Math.floor((e+f[3])/f[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new On({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=n*this.dim,p=n*this.dim+this.dim,_=u*this.dim,g=u*this.dim+this.dim;switch(n){case-1:f=p-1;break;case 1:p=f+1}switch(u){case-1:_=g-1;break;case 1:g=_+1}let b=-n*this.dim,w=-u*this.dim;for(let I=_;I<g;I++)for(let O=f;O<p;O++){let M=4*this._idx(O,I),L=4*this._idx(O+b,I+w);this.pixels[M+0]=e.pixels[L+0],this.pixels[M+1]=e.pixels[L+1],this.pixels[M+2]=e.pixels[L+2],this.pixels[M+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}yt(Oy,"DEMData"),yt(EC,"DemMinMaxQuadTree",{omit:["dem"]});class WQ{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,u){let f=e.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);let p={value:n,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},u)),this.data[f].push(p),this.order.push(f),this.order.length>this.max){let _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let u=e.wrapped().key,f=n===void 0?0:this.data[u].indexOf(n),p=this.data[u][f];return this.data[u].splice(f,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let u in this.data)for(let f of this.data[u])e(f.value)||n.push(f);for(let u of n)this.remove(u.value.tileID,u)}}class rh{constructor(e,n,u){this.func=e,this.mask=n,this.range=u}}rh.ReadOnly=!1,rh.ReadWrite=!0,rh.disabled=new rh(519,rh.ReadOnly,[0,1]);let h1=7680;class f1{constructor(e,n,u,f,p,_){this.test=e,this.ref=n,this.mask=u,this.fail=f,this.depthFail=p,this.pass=_}}f1.disabled=new f1({func:519,mask:0},0,0,h1,h1,h1);class ma{constructor(e,n,u){this.blendFunction=e,this.blendColor=n,this.mask=u}}ma.Replace=[1,0],ma.disabled=new ma(ma.Replace,Jr.transparent,[!1,!1,!1,!1]),ma.unblended=new ma(ma.Replace,Jr.transparent,[!0,!0,!0,!0]),ma.alphaBlended=new ma([1,771],Jr.transparent,[!0,!0,!0,!0]);let d1=1029,p1=2305;class Vo{constructor(e,n,u){this.enable=e,this.mode=n,this.frontFace=u}}Vo.disabled=new Vo(!1,d1,p1),Vo.backCCW=new Vo(!0,d1,p1),Vo.backCW=new Vo(!0,d1,2304),Vo.frontCW=new Vo(!0,1028,2304),Vo.frontCCW=new Vo(!0,1028,p1);class vu extends kl{constructor(e,n,u){super(),this.id=e,this._onlySymbols=u,n.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new WQ(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new VQ,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let u=this._tiles[n];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return gt(this._tiles).map(e=>e.tileID).sort(AC).map(e=>e.key)}getRenderableIds(e){let n=[];for(let u in this._tiles)this._isIdRenderable(+u,e)&&n.push(this._tiles[u]);return e?n.sort((u,f)=>{let p=u.tileID,_=f.tileID,g=new Ve(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new Ve(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||b.y-g.y||b.x-g.x}).map(u=>u.tileID.key):n.map(u=>u.tileID).sort(AC).map(u=>u.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=n),this._loadTile(u,this._tileLoaded.bind(this,u,e,n)))}_tileLoaded(e,n,u,f){if(f)if(e.state="errored",f.status!==404)this._source.fire(new Io(f,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=So.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new za("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let f=0;f<n.length;f++){let p=n[f];if(e.neighboringTiles&&e.neighboringTiles[p]){let _=this.getTileByID(p);u(e,_),u(_,e)}}function u(f,p){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-f.tileID.canonical.x,g=p.tileID.canonical.y-f.tileID.canonical.y,b=Math.pow(2,f.tileID.canonical.z),w=p.tileID.key;_===0&&g===0||Math.abs(g)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),p.dem&&f.dem&&(f.dem.backfillBorder(p.dem,_,g),f.neighboringTiles&&f.neighboringTiles[w]&&(f.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,u,f){for(let p in this._tiles){let _=this._tiles[p];if(f[p]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>u)continue;let g=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){let w=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[w.key],_&&_.hasData()&&(g=w)}let b=g;for(;b.overscaledZ>n;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){f[g.key]=g;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=n?u:null}for(let u=e.overscaledZ-1;u>=n;u--){let f=e.scaledTo(u),p=this._getLoadedTile(f);if(p)return p}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let u=Math.ceil(e.width/n)+1,f=Math.ceil(e.height/n)+1,p=Math.floor(u*f*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(g)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let u={};for(let f in this._tiles){let p=this._tiles[f];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+n),u[p.tileID.key]=p}this._tiles=u;for(let f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(let f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(e,n,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new Qi(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(f=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(g=>this._source.hasTile(g)))):f=[];let p=this._updateRetainedTiles(f);if(OC(this._source.type)&&f.length!==0){let g={},b={},w=Object.keys(p);for(let O of w){let M=p[O],L=this._tiles[O];if(!L||L.fadeEndTime&&L.fadeEndTime<=So.now())continue;let k=this.findLoadedParent(M,Math.max(M.overscaledZ-vu.maxOverzooming,this._source.minzoom));k&&(this._addTile(k.tileID),g[k.tileID.key]=k.tileID),b[O]=M}let I=f[f.length-1].overscaledZ;for(let O in this._tiles){let M=this._tiles[O];if(p[O]||!M.hasData())continue;let L=M.tileID;for(;L.overscaledZ>I;){L=L.scaledTo(L.overscaledZ-1);let k=this._tiles[L.key];if(k&&k.hasData()&&b[L.key]){p[O]=M.tileID;break}}}for(let O in g)p[O]||(this._coveredTiles[O]=!0,p[O]=g[O])}for(let g in p)this._tiles[g].clearFadeHold();let _=function(g,b){let w=[];for(let I in g)I in b||w.push(I);return w}(this._tiles,p);for(let g of _){let b=this._tiles[g];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let u={},f=e.reduce((w,I)=>Math.min(w,I.overscaledZ),1/0),p=e[0].overscaledZ,_=Math.max(p-vu.maxOverzooming,this._source.minzoom),g=Math.max(p+vu.maxUnderzooming,this._source.minzoom),b={};for(let w of e){let I=this._addTile(w);n[w.key]=w,I.hasData()||f<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,f,g,n);for(let w of e){let I=this._tiles[w.key];if(I.hasData())continue;if(w.canonical.z>=this._source.maxzoom){let M=w.children(this._source.maxzoom)[0],L=this.getTile(M);if(L&&L.hasData()){n[M.key]=M;continue}}else{let M=w.children(this._source.maxzoom);if(n[M[0].key]&&n[M[1].key]&&n[M[2].key]&&n[M[3].key])continue}let O=I.wasRequested();for(let M=w.overscaledZ-1;M>=_;--M){let L=w.scaledTo(M);if(u[L.key]||(u[L.key]=!0,I=this.getTile(L),!I&&O&&(I=this._addTile(L)),I&&(n[L.key]=L,O=I.wasRequested(),I.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],u,f=this._tiles[e].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}n.push(f.key);let p=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;f=p}for(let p of n)this._loadedParentTiles[p]=u}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let u=!!n;if(!u){let f=this.map?this.map.painter:null;n=new c1(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,u||this._source.fire(new za("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let u=n.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,u){let f=[],p=this.transform;if(!p)return f;let _=p.projection.name==="globe",g=ha(p.center.lng);for(let b in this._tiles){let w=this._tiles[b];if(u&&w.clearQueryDebugViz(),w.holdingForFade())continue;let I;if(_){let O=w.tileID.canonical;if(O.z===0){let M=[Math.abs(Ne(g,...op(O,-1))-g),Math.abs(Ne(g,...op(O,1))-g)];I=[0,2*M.indexOf(Math.min(...M))-1]}else{let M=[Math.abs(Ne(g,...op(O,-1))-g),Math.abs(Ne(g,...op(O,0))-g),Math.abs(Ne(g,...op(O,1))-g)];I=[M.indexOf(Math.min(...M))-1]}}else I=[0];for(let O of I){let M=e.containsTile(w,p,n,O);M&&f.push(M)}}return f}getVisibleCoordinates(e){let n=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(let u of n)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(OC(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=So.now())return!0}return!1}setFeatureState(e,n,u){this._state.updateState(e=e||"_geojsonTileLayer",n,u)}removeFeatureState(e,n,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,u)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,u){let f=this._tiles[e];f&&f.setDependencies(n,u)}reloadTilesForDependencies(e,n){for(let u in this._tiles)this._tiles[u].hasDependency(e,n)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let g=()=>{this._sourceLoaded&&(this._source.off("data",g),this._preloadTiles(e,n))};return void this._source.on("data",g)}let u=new Map,f=Array.isArray(e)?e:[e],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(let g of f){let b=g.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let w of b)u.set(w.key,w);this.usedForTerrain&&g.updateElevation(!1)}Ke(Array.from(u.values()),(g,b)=>{let w=new c1(g,this._source.tileSize*g.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,I=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),b(I,w)})},n)}}function AC(r,e){let n=Math.abs(2*r.wrap)-+(r.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||u-n||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function OC(r){return r==="raster"||r==="image"||r==="video"||r==="custom"}function op(r,e){let n=1<<r.z;return[r.x/n+e,(r.x+1)/n+e]}vu.maxOverzooming=10,vu.maxUnderzooming=3;class Cy{constructor(e,n,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=u}static create(e,n,u){let f=u||e.findDEMTileFor(n);if(!f||!f.dem)return;let p=f.dem,_=f.tileID,g=1<<n.canonical.z-_.canonical.z;return new Cy(f,f.tileSize/St/g,[(n.canonical.x/g-_.canonical.x)*p.dim,(n.canonical.y/g-_.canonical.y)*p.dim])}tileCoordToPixel(e,n){let u=n*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(u);return new Ve(f,p)}getElevationAt(e,n,u,f){let p=e*this._scale+this._offset[0],_=n*this._scale+this._offset[1],g=Math.floor(p),b=Math.floor(_),w=this._dem;return f=!!f,u?nr(nr(w.get(g,b,f),w.get(g,b+1,f),_-b),nr(w.get(g+1,b,f),w.get(g+1,b+1,f),_-b),p-g):w.get(g,b,f)}getElevationAtPixel(e,n,u){return this._dem.get(e,n,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*No(1,e)*this._dem.stride}}class CC{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ga(St,16,0),this.featureIndexArray=new su,this.promoteId=n}insert(e,n,u,f,p,_=0){let g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,p,_);let b=this.grid;for(let w=0;w<n.length;w++){let I=n[w],O=[1/0,1/0,-1/0,-1/0];for(let M=0;M<I.length;M++){let L=I[M];O[0]=Math.min(O[0],L.x),O[1]=Math.min(O[1],L.y),O[2]=Math.max(O[2],L.x),O[3]=Math.max(O[3],L.y)}O[0]<St&&O[1]<St&&O[2]>=0&&O[3]>=0&&b.insert(g,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Hx(new my(this.rawTileData)).layers,this.sourceLayerCoder=new pC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,u,f){this.loadVTLayers();let p=e.params||{},_=Mc(p.filter),g=e.tileResult,b=e.transform,w=g.bufferedTilespaceBounds,I=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(k,U,G,Y)=>eO(g.bufferedTilespaceGeometry,k,U,G,Y));I.sort(ZQ);let O=null;b.elevation&&I.length>0&&(O=Cy.create(b.elevation,this.tileID));let M={},L;for(let k=0;k<I.length;k++){let U=I[k];if(U===L)continue;L=U;let G=this.featureIndexArray.get(U),Y=null;this.loadMatchingFeature(M,G,_,p.layers,p.availableImages,n,u,f,(ae,J,ie,ue=0)=>(Y||(Y=Ja(ae,this.tileID.canonical,e.tileTransform)),J.queryIntersectsFeature(g,ae,ie,Y,this.z,e.transform,e.pixelPosMatrix,O,ue)))}return M}loadMatchingFeature(e,n,u,f,p,_,g,b,w){let{featureIndex:I,bucketIndex:O,sourceLayerIndex:M,layoutVertexArrayOffset:L}=n,k=this.bucketLayerIDs[O];if(f&&!function(ae,J){for(let ie=0;ie<ae.length;ie++)if(J.indexOf(ae[ie])>=0)return!0;return!1}(f,k))return;let U=this.sourceLayerCoder.decode(M),G=this.vtLayers[U].feature(I);if(u.needGeometry){let ae=mu(G,!0);if(!u.filter(new A(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!u.filter(new A(this.tileID.overscaledZ),G))return;let Y=this.getId(G,U);for(let ae=0;ae<k.length;ae++){let J=k[ae];if(f&&f.indexOf(J)<0)continue;let ie=_[J];if(!ie)continue;let ue={};Y!==void 0&&b&&(ue=b.getState(ie.sourceLayer||"_geojsonTileLayer",Y));let se=vt({},g[J]);se.paint=PC(se.paint,ie.paint,G,ue,p),se.layout=PC(se.layout,ie.layout,G,ue,p);let Ie=!w||w(G,ie,ue,L);if(!Ie)continue;let Te=new mC(G,this.z,this.x,this.y,Y);Te.layer=se;let De=e[J];De===void 0&&(De=e[J]=[]),De.push({featureIndex:I,feature:Te,intersectionZ:Ie})}}lookupSymbolFeatures(e,n,u,f,p,_,g,b){let w={};this.loadVTLayers();let I=Mc(p);for(let O of e)this.loadMatchingFeature(w,{bucketIndex:u,sourceLayerIndex:f,featureIndex:O,layoutVertexArrayOffset:0},I,_,g,b,n);return w}loadFeature(e){let{featureIndex:n,sourceLayerIndex:u}=e;this.loadVTLayers();let f=this.sourceLayerCoder.decode(u),p=this.vtFeatures[f];if(p[n])return p[n];let _=this.vtLayers[f].feature(n);return p[n]=_,_}hasLayer(e){for(let n of this.bucketLayerIDs)for(let u of n)if(e===u)return!0;return!1}getId(e,n){let u=e.id;if(this.promoteId){let f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];f!=null&&(u=e.properties[f]),typeof u=="boolean"&&(u=Number(u))}return u}}function PC(r,e,n,u,f){return zt(r,(p,_)=>{let g=e instanceof K?e.get(_):null;return g&&g.evaluate?g.evaluate(n,u,f):g})}function ZQ(r,e){return e-r}yt(CC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class MC{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Qa({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let u=this.getKey(e,n);return this.positions[u]}trim(){let e=this.width,n=this.height=Yr(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,u){let f=[],p=e.length%2==1?-e[e.length-1]*u:0,_=e[0]*u,g=!0;f.push({left:p,right:_,isDash:g,zeroLength:e[0]===0});let b=e[0];for(let w=1;w<e.length;w++){g=!g;let I=e[w];p=b*u,b+=I,_=b*u,f.push({left:p,right:_,isDash:g,zeroLength:I===0})}return f}addRoundDash(e,n,u){let f=n/2;for(let p=-u;p<=u;p++){let _=this.width*(this.nextRow+u+p),g=0,b=e[g];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++g]);let I=Math.abs(w-b.left),O=Math.abs(w-b.right),M=Math.min(I,O),L,k=p/u*(f+1);if(b.isDash){let U=f-Math.abs(k);L=Math.sqrt(M*M+U*U)}else L=f-Math.sqrt(M*M+k*k);this.image.data[_+w]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,n){for(let b=e.length-1;b>=0;--b){let w=e[b],I=e[b+1];w.zeroLength?e.splice(b,1):I&&I.isDash===w.isDash&&(I.left=w.left,e.splice(b,1))}let u=e[0],f=e[e.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);let p=this.width*this.nextRow,_=0,g=e[_];for(let b=0;b<this.width;b++){b/g.right>1&&(g=e[++_]);let w=Math.abs(b-g.left),I=Math.abs(b-g.right),O=Math.min(w,I);this.image.data[p+b]=Math.max(0,Math.min(255,(g.isDash?O:-O)+n+128))}}addDash(e,n){let u=this.getKey(e,n);if(this.positions[u])return this.positions[u];let f=n==="round",p=f?7:0,_=2*p+1;if(this.nextRow+_>this.height)return jr("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let I=0;I<e.length;I++)e[I]<0&&(jr("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),g+=e[I];if(g!==0){let I=this.width/g,O=this.getDashRanges(e,this.width,I);f?this.addRoundDash(O,I,p):this.addRegularDash(O,n==="square"?.5*I:0)}let b=this.nextRow+p;this.nextRow+=_;let w={tl:[b,p],br:[g,0]};return this.positions[u]=w,w}}yt(MC,"LineAtlas");let qC=1*jo;class RC{constructor(e){let n={},u=[];for(let g in e){let b=e[g],w=n[g]={};for(let I in b.glyphs){let O=b.glyphs[+I];if(!O||O.bitmap.width===0||O.bitmap.height===0)continue;let M=O.metrics.localGlyph?qC:1,L={x:0,y:0,w:O.bitmap.width+2*M,h:O.bitmap.height+2*M};u.push(L),w[I]=L}}let{w:f,h:p}=Jx(u),_=new Qa({width:f||1,height:p||1});for(let g in e){let b=e[g];for(let w in b.glyphs){let I=b.glyphs[+w];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;let O=n[g][w],M=I.metrics.localGlyph?qC:1;Qa.copy(I.bitmap,_,{x:0,y:0},{x:O.x+M,y:O.y+M},I.bitmap)}}this.image=_,this.positions=n}}yt(RC,"GlyphAtlas");class HQ{constructor(e){this.tileID=new Qi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=gu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,u,f,p){this.status="parsing",this.data=e,this.collisionBoxArray=new Tr;let _=new pC(Object.keys(e.layers).sort()),g=new CC(this.tileID,this.promoteId);g.bucketLayerIDs=[];let b={},w=new MC(256,256),I={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:u},O=n.familiesBySource[this.source];for(let ue in O){let se=e.layers[ue];if(!se)continue;let Ie=!1,Te=!1;for(let Ce of O[ue])Ce[0].type==="symbol"?Ie=!0:Te=!0;if(this.isSymbolTile===!0&&!Ie||this.isSymbolTile===!1&&!Te)continue;se.version===1&&jr(`Vector tile source "${this.source}" layer "${ue}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let De=_.encode(ue),Qe=[];for(let Ce=0;Ce<se.length;Ce++){let Ue=se.feature(Ce),je=g.getId(Ue,ue);Qe.push({feature:Ue,id:je,index:Ce,sourceLayerIndex:De})}for(let Ce of O[ue]){let Ue=Ce[0];this.isSymbolTile!==void 0&&Ue.type==="symbol"!==this.isSymbolTile||Ue.minzoom&&this.zoom<Math.floor(Ue.minzoom)||Ue.maxzoom&&this.zoom>=Ue.maxzoom||Ue.visibility!=="none"&&(m1(Ce,this.zoom,u),(b[Ue.id]=Ue.createBucket({index:g.bucketLayerIDs.length,layers:Ce,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:De,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Qe,I,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(Ce.map(je=>je.id)))}}let M,L,k,U;w.trim();let G={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Y=()=>{if(M)return p(M);if(L&&k&&U){let ue=new RC(L),se=new NO(k,U);for(let Ie in b){let Te=b[Ie];Te instanceof Ys?(m1(Te.layers,this.zoom,u),xQ(Te,L,ue.positions,k,se.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Te.hasPattern&&(Te instanceof fy||Te instanceof sy||Te instanceof Zd)&&(m1(Te.layers,this.zoom,u),Te.addFeatures(I,this.tileID.canonical,se.patternPositions,u,this.tileTransform))}this.status="done",p(null,{buckets:gt(b).filter(Ie=>!Ie.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ue.image,lineAtlas:w,imageAtlas:se,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?k:null,glyphPositions:this.returnDependencies?ue.positions:null})}},ae=zt(I.glyphDependencies,ue=>Object.keys(ue).map(Number));Object.keys(ae).length?f.send("getGlyphs",{uid:this.uid,stacks:ae},(ue,se)=>{M||(M=ue,L=se,Y())},void 0,!1,G):L={};let J=Object.keys(I.iconDependencies);J.length?f.send("getImages",{icons:J,source:this.source,tileID:this.tileID,type:"icons"},(ue,se)=>{M||(M=ue,k=se,Y())},void 0,!1,G):k={};let ie=Object.keys(I.patternDependencies);ie.length?f.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(ue,se)=>{M||(M=ue,U=se,Y())},void 0,!1,G):U={},Y()}}function m1(r,e,n){let u=new A(e);for(let f of r)f.recalculate(u,n)}class DC{constructor(e){this.entries={},this.scheduler=e}request(e,n,u,f){let p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){let[_,g]=p.result;return this.scheduler?this.scheduler.add(()=>{f(_,g)},n):f(_,g),()=>{}}return p.callbacks.push(f),p.cancel||(p.cancel=u((_,g)=>{p.result=[_,g];for(let b of p.callbacks)this.scheduler?this.scheduler.add(()=>{b(_,g)},n):b(_,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==f),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function LC(r,e,n){let u=JSON.stringify(r.request);return r.data&&(this.deduped.entries[u]={result:[null,r.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},f=>{let p=Ss(r.request,(_,g,b,w)=>{_?f(_):g&&f(null,{vectorTile:n?void 0:new Hx(new my(g)),rawData:g,cacheControl:b,expires:w})});return()=>{p.cancel(),f()}},e)}let kC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,u]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let f=u>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);let p=kC[15&u];if(!p)throw new Error("Unrecognized array type.");let[_]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new _1(g,_,p,e)}constructor(e,n=64,u=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let p=kC.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-g%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+g+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=n,u}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return y1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:_,nodeSize:g}=this,b=[0,p.length-1,0],w=[];for(;b.length;){let I=b.pop()||0,O=b.pop()||0,M=b.pop()||0;if(O-M<=g){for(let G=M;G<=O;G++){let Y=_[2*G],ae=_[2*G+1];Y>=e&&Y<=u&&ae>=n&&ae<=f&&w.push(p[G])}continue}let L=M+O>>1,k=_[2*L],U=_[2*L+1];k>=e&&k<=u&&U>=n&&U<=f&&w.push(p[L]),(I===0?e<=k:n<=U)&&(b.push(M),b.push(L-1),b.push(1-I)),(I===0?u>=k:f>=U)&&(b.push(L+1),b.push(O),b.push(1-I))}return w}within(e,n,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:f,coords:p,nodeSize:_}=this,g=[0,f.length-1,0],b=[],w=u*u;for(;g.length;){let I=g.pop()||0,O=g.pop()||0,M=g.pop()||0;if(O-M<=_){for(let G=M;G<=O;G++)zC(p[2*G],p[2*G+1],e,n)<=w&&b.push(f[G]);continue}let L=M+O>>1,k=p[2*L],U=p[2*L+1];zC(k,U,e,n)<=w&&b.push(f[L]),(I===0?e-u<=k:n-u<=U)&&(g.push(M),g.push(L-1),g.push(1-I)),(I===0?e+u>=k:n+u>=U)&&(g.push(L+1),g.push(O),g.push(1-I))}return b}}function y1(r,e,n,u,f,p){if(f-u<=n)return;let _=u+f>>1;BC(r,e,_,u,f,p),y1(r,e,n,u,_-1,1-p),y1(r,e,n,_+1,f,1-p)}function BC(r,e,n,u,f,p){for(;f>u;){if(f-u>600){let w=f-u+1,I=n-u+1,O=Math.log(w),M=.5*Math.exp(2*O/3),L=.5*Math.sqrt(O*M*(w-M)/w)*(I-w/2<0?-1:1);BC(r,e,n,Math.max(u,Math.floor(n-I*M/w+L)),Math.min(f,Math.floor(n+(w-I)*M/w+L)),p)}let _=e[2*n+p],g=u,b=f;for(ap(r,e,u,n),e[2*f+p]>_&&ap(r,e,u,f);g<b;){for(ap(r,e,g,b),g++,b--;e[2*g+p]<_;)g++;for(;e[2*b+p]>_;)b--}e[2*u+p]===_?ap(r,e,u,b):(b++,ap(r,e,b,f)),b<=n&&(u=b+1),n<=b&&(f=b-1)}}function ap(r,e,n,u){g1(r,n,u),g1(e,2*n,2*u),g1(e,2*n+1,2*u+1)}function g1(r,e,n){let u=r[e];r[e]=r[n],r[n]=u}function zC(r,e,n,u){let f=r-n,p=e-u;return f*f+p*p}t.ARRAY_TYPE=An,t.AUTH_ERR_MSG=ce,t.Aabb=Ji,t.Actor=class{constructor(r,e,n){this.target=r,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Un(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Eo()?r:v,this.scheduler=new UQ}send(r,e,n,u,f=!1,p){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=p,this.callbacks[_]=n);let g=ws(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:r,hasCallback:!!n,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Vs(e,g)},g),{cancel:()=>{n&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(r){let e=r.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){let u=this.cancelCallbacks[n];delete this.cancelCallbacks[n],u&&u.cancel()}else if(e.mustQueue||Eo()){let u=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),u&&u.metadata||{type:"message"})}else this.processTask(n,e)}processTask(r,e){if(e.type==="<response>"){let n=this.callbacks[r];delete this.callbacks[r],n&&(e.error?n(Wa(e.error)):n(null,Wa(e.data)))}else{let n=ws(this.globalScope)?void 0:[],u=e.hasCallback?(p,_)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:p?Vs(p):null,data:Vs(_,n)},n)}:p=>{},f=Wa(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,f,u);else if(this.parent.getWorkerSource){let p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],f.source)[p[1]](f,u)}else u(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=hy,t.Color=Jr,t.ColorMode=ma,t.CullFaceMode=Vo,t.DEMData=Oy,t.DataConstantProperty=N,t.DedupedRequest=DC,t.DepthMode=rh,t.EXTENT=St,t.Elevation=class{isDataAvailableAtPoint(r){let e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;let n=e.getSource().maxzoom,u=1<<n,f=Math.floor(r.x),p=Math.floor((r.x-f)*u),_=Math.floor(r.y*u),g=this.findDEMTileFor(new Qi(n,f,n,p,_));return!(!g||!g.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let u=this._source();if(!u||r.y<0||r.y>1)return e;let f=u.getSource().maxzoom,p=1<<f,_=Math.floor(r.x),g=r.x-_,b=new Qi(f,_,f,Math.floor(g*p),Math.floor(r.y*p)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;let I=w.dem,O=1<<w.tileID.canonical.z,M=(g*O-w.tileID.canonical.x)*I.dim,L=(r.y*O-w.tileID.canonical.y)*I.dim,k=Math.floor(M),U=Math.floor(L);return(n?this.exaggeration():1)*nr(nr(I.get(k,U),I.get(k,U+1),L-U),nr(I.get(k+1,U),I.get(k+1,U+1),L-U),M-k)}getAtTileOffset(r,e,n){let u=1<<r.canonical.z;return this.getAtPointOrZero(new jc(r.wrap+(r.canonical.x+e/St)/u,(r.canonical.y+n/St)/u))}getAtTileOffsetFunc(r,e,n,u){return f=>{let p=this.getAtTileOffset(r,f.x,f.y),_=u.upVector(r.canonical,f.x,f.y);return Gn(_,_,p*u.upVectorScale(r.canonical,e,n).metersToTile),_}}getForTilePoints(r,e,n,u){if(this.isUsingMockSource())return!1;let f=Cy.create(this,r,u);return!!f&&(e.forEach(p=>{p[2]=this.exaggeration()*f.getElevationAt(p[0],p[1],n)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(r);if(!e||!e.dem)return null;let n=e.dem.tree,u=e.tileID,f=1<<r.canonical.z-u.canonical.z,p=r.canonical.x/f-u.canonical.x,_=r.canonical.y/f-u.canonical.y,g=0;for(let b=0;b<r.canonical.z-u.canonical.z&&!n.leaves[g];b++){p*=2,_*=2;let w=2*Math.floor(_)+Math.floor(p);g=n.childOffsets[g]+w,p%=1,_%=1}return{min:this.exaggeration()*n.minimums[g],max:this.exaggeration()*n.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=Io,t.EvaluationParameters=A,t.Event=za,t.Evented=kl,t.FillExtrusionBucket=Zd,t.Frustum=Sx,t.FrustumCorners=Ex,t.GLOBE_RADIUS=ua,t.GLOBE_SCALE_MATCH_LATITUDE=45,t.GLOBE_ZOOM_THRESHOLD_MAX=BA,t.GLOBE_ZOOM_THRESHOLD_MIN=Ix,t.GlobeSharedBuffers=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let r of this._poleSegments)r.destroy();for(let r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(let r of this._wireframeSegments)r.destroy()}}_fillGridMeshWithLods(r,e){let n=new Je,u=new wt,f=[],p=r+1+2,_=e[0]+1,g=e[0]+1+(1+e.length),b=(w,I,O)=>{let M=w===p-1?w-2:w===0?w:w-1;return M+=O?24575:0,[M,I]};for(let w=0;w<p;++w)n.emplaceBack(...b(w,0,!0));for(let w=0;w<_;++w)for(let I=0;I<p;++I)n.emplaceBack(...b(I,w,(I===0||I===p-1)&&!0));for(let w=0;w<e.length;++w){let I=e[w];for(let O=0;O<p;++O)n.emplaceBack(...b(O,I,!0))}for(let w=0;w<e.length;++w){let I=u.length,O=e[w]+1+2,M=new wt;for(let U=0;U<O-1;U++){let G=U===O-2,Y=G?p*(g-e.length+w-U):p;for(let ae=0;ae<p-1;ae++){let J=U*p+ae;U===0||G||ae===0||ae===p-2?(M.emplaceBack(J+1,J,J+Y),M.emplaceBack(J+Y,J+Y+1,J+1)):(u.emplaceBack(J+1,J,J+Y),u.emplaceBack(J+Y,J+Y+1,J+1))}}let L=ai.simpleSegment(0,I,n.length,u.length-I);for(let U=0;U<M.uint16.length;U+=3)u.emplaceBack(M.uint16[U],M.uint16[U+1],M.uint16[U+2]);let k=ai.simpleSegment(0,I,n.length,u.length-I);f.push({withoutSkirts:L,withSkirts:k})}return{vertices:n,indices:u,segments:f}}_createGrid(r){let e=this._fillGridMeshWithLods(du,Bd);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,kd.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){let e=new wt;for(let f=0;f<=du;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);let n=new wr,u=new wr;this._poleSegments=[];for(let f=0,p=0;f<Ix;f++){let _=360/(1<<f);n.emplaceBack(0,-ua,0,.5,0),u.emplaceBack(0,-ua,0,.5,1);for(let g=0;g<=du;g++){let b=g/du,w=nr(0,_,b),[I,O,M]=Fc(UY,jY,w,ua);n.emplaceBack(I,O,M,b,0),u.emplaceBack(I,O,M,b,1)}this._poleSegments.push(ai.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(n,LA,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(u,LA,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}getWirefameBuffers(r,e){if(!this._wireframeSegments){let n=new Ei,u=du,f=u+1+2,p=1;this._wireframeSegments=[];for(let _=0,g=0;_<Bd.length;_++){let b=Bd[_];for(let I=p;I<b+p;I++)for(let O=p;O<u+p;O++){let M=I*f+O;n.emplaceBack(M,M+1),n.emplaceBack(M,M+f),n.emplaceBack(M,M+f+1)}let w=b*u*3;this._wireframeSegments.push(ai.simpleSegment(0,g,(b+1)*f,w)),g+=w}this._wireframeIndexBuffer=r.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},t.GlyphManager=Yc,t.ImagePosition=Qx,t.KDBush=_1,t.LivePerformanceUtils=W0,t.LngLat=Er,t.LngLatBounds=Zs,t.LocalGlyphMode=r1,t.MAX_MERCATOR_LATITUDE=zi,t.MercatorCoordinate=jc,t.ONE_EM=Pi,t.OverscaledTileID=Qi,t.PerformanceMarkers=Is,t.Point=Ve,t.Properties=ee,t.RGBAImage=On,t.Ray=Tx,t.RequestManager=class{constructor(r,e,n){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let r=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ke,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!_e(r))return r;let n=st(r);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!_e(r))return r;let n=st(r);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(r,e,n,u){if(!_e(r))return r;let f=st(r);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),n&&f.params.push(`language=${n}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||e)}normalizeSpriteURL(r,e,n,u){let f=st(r);return _e(r)?(f.path=`/styles/v1${f.path}/sprite${e}${n}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${e}${n}`,it(f))}normalizeTileURL(r,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!_e(r))return r;let u=st(r);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&u.authority!=="raster"&&n===512?"@2x":""}${z.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${D.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${D.TILE_URL_VERSION}${u.path}`);let f=this._customAccessToken||function(p){for(let _ of p){let g=_.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(u.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(r,e){let n=st(r);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return r;let u="mapbox://";n.path.match(/^\/raster\/v1\//)?u+=`raster/${n.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${n.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let f=n.params;return e&&(f=f.filter(p=>!p.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(r,e){let n=!!e&&_e(e),u=[];for(let f of r.tiles||[])be(f)?u.push(this.canonicalizeTileURL(f,n)):u.push(f);return u}_makeAPIURL(r,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=st(D.API_URL);if(r.protocol=u.protocol,r.authority=u.authority,r.protocol==="http"){let f=r.params.indexOf("secure");f>=0&&r.params.splice(f,1)}if(u.path!=="/"&&(r.path=`${u.path}${r.path}`),!D.REQUIRE_ACCESS_TOKEN)return it(r);if(e=e||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return r.params=r.params.filter(f=>f.indexOf("access_token")===-1),r.params.push(`access_token=${e||""}`),it(r)}},t.ResourceType=La,t.SegmentVector=ai,t.SourceCache=vu,t.StencilMode=f1,t.StructArrayLayout1ui2=In,t.StructArrayLayout2f1f2i16=Ot,t.StructArrayLayout2i4=Je,t.StructArrayLayout2ui4=Ei,t.StructArrayLayout3f12=Wt,t.StructArrayLayout3ui6=wt,t.StructArrayLayout4i8=ze,t.StructArrayLayout5f20=wr,t.Texture=np,t.Tile=c1,t.Transitionable=F,t.Uniform1f=H_,t.Uniform1i=class extends Xa{constructor(r){super(r),this.current=0}set(r,e,n){this.fetchUniformLocation(r,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},t.Uniform2f=class extends Xa{constructor(r){super(r),this.current=[0,0]}set(r,e,n){this.fetchUniformLocation(r,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},t.Uniform3f=class extends Xa{constructor(r){super(r),this.current=[0,0,0]}set(r,e,n){this.fetchUniformLocation(r,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},t.Uniform4f=gA,t.UniformColor=vA,t.UniformMatrix2f=class extends Xa{constructor(r){super(r),this.current=SY}set(r,e,n){if(this.fetchUniformLocation(r,e)){for(let u=0;u<4;u++)if(n[u]!==this.current[u]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}},t.UniformMatrix3f=class extends Xa{constructor(r){super(r),this.current=EY}set(r,e,n){if(this.fetchUniformLocation(r,e)){for(let u=0;u<9;u++)if(n[u]!==this.current[u]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},t.UniformMatrix4f=class extends Xa{constructor(r){super(r),this.current=TY}set(r,e,n){if(this.fetchUniformLocation(r,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let u=1;u<16;u++)if(n[u]!==this.current[u]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},t.UnwrappedTileID=SO,t.ValidationError=dt,t.VectorTileFeature=uy,t.VectorTileWorkerSource=class extends kl{constructor(r,e,n,u,f){super(),this.actor=r,this.layerIndex=e,this.availableImages=n,this.loadVectorData=f||LC,this.loading={},this.loaded={},this.deduped=new DC(r.scheduler),this.isSpriteLoaded=u,this.scheduler=r.scheduler}loadTile(r,e){let n=r.uid,u=r&&r.request,f=u&&u.collectResourceTiming,p=this.loading[n]=new HQ(r);p.abort=this.loadVectorData(r,(_,g)=>{let b=!this.loading[n];if(delete this.loading[n],b||_||!g)return p.status="done",b||(this.loaded[n]=p),e(_);let w=g.rawData,I={};g.expires&&(I.expires=g.expires),g.cacheControl&&(I.cacheControl=g.cacheControl),p.vectorTile=g.vectorTile||new Hx(new my(w));let O=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,L)=>{if(M||!L)return e(M);let k={};if(f){let U=Rf(u);U.length>0&&(k.resourceTiming=JSON.parse(JSON.stringify(U)))}e(null,vt({rawTileData:w.slice(0)},L,I,k))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[n]=p})}reloadTile(r,e){let n=this.loaded,u=r.uid,f=this;if(n&&n[u]){let p=n[u];p.showCollisionBoxes=r.showCollisionBoxes,p.enableTerrain=!!r.enableTerrain,p.projection=r.projection,p.tileTransform=gu(r.tileID.canonical,r.projection);let _=(g,b)=>{let w=p.reloadCallback;w&&(delete p.reloadCallback,p.parse(p.vectorTile,f.layerIndex,this.availableImages,f.actor,w)),e(g,b)};p.status==="parsing"?p.reloadCallback=_:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(r,e){let n=r.uid,u=this.loading[n];u&&(u.abort&&u.abort(),delete this.loading[n]),e()}removeTile(r,e){let n=this.loaded,u=r.uid;n&&n[u]&&delete n[u],e()}},t.WritingMode=Zn,t.ZoomDependentExpression=eu,t.add=Ya,t.addDynamicAttributes=Sy,t.adjoint=function(r,e){var n=e[0],u=e[1],f=e[2],p=e[3],_=e[4],g=e[5],b=e[6],w=e[7],I=e[8];return r[0]=_*I-g*w,r[1]=f*w-u*I,r[2]=u*g-f*_,r[3]=g*b-p*I,r[4]=n*I-f*b,r[5]=f*p-n*g,r[6]=p*w-_*b,r[7]=u*b-n*w,r[8]=n*_-u*p,r},t.asyncAll=Ke,t.bezier=xi,t.bindAll=Un,t.boundsAttributes=yC,t.bufferConvexPolygon=function(r,e){let n=[];for(let u=0;u<r.length;u++){let f=Le(u-1,-1,r.length-1),p=Le(u+1,-1,r.length-1),_=r[u],g=r[p],b=r[f].sub(_).unit(),w=g.sub(_).unit(),I=w.angleWithSep(b.x,b.y),O=b.add(w).unit().mult(-1*e/Math.sin(I/2));n.push(_.add(O))}return n},t.cacheEntryPossiblyAdded=function(r){Dl++,Dl>oc&&(r.getActor().send("enforceCacheSizeLimit",nc),Dl=0)},t.calculateGlobeLabelMatrix=function(r,e){let{x:n,y:u}=r.point,f=jA(n,u,r.worldSize/r._pixelsPerMercatorPixel,0,0);return cu(f,f,Cx(ca(e)))},t.calculateGlobeMatrix=function(r){let{x:e,y:n}=r.point,{lng:u,lat:f}=r._center;return jA(e,n,r.worldSize,u,f)},t.calculateGlobeMercatorMatrix=function(r){let e=r.pixelsPerMeter,n=e/No(1,r.center.lat),u=zo(new Float64Array(16));return Pd(u,u,[r.point.x,r.point.y,0]),hu(u,u,[n,n,e]),Float32Array.from(u)},t.circumferenceAtLatitude=Mx,t.clamp=Ne,t.clearTileCache=function(r){if(!Rl())return;let e=v.caches.delete(Ts);r&&e.catch(r).then(()=>r())},t.clipLine=QO,t.clone=function(r){var e=new An(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},t.clone$1=sn,t.collisionCircleLayout=WJ,t.config=D,t.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},t.create=function(){var r=new An(16);return An!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},t.create$1=wA,t.createExpression=Ns,t.createLayout=ye,t.createStyleLayer=function(r){return r.type==="custom"?new BQ(r):new FQ[r.type](r)},t.cross=wx,t.degToRad=Pt,t.distance=function(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])},t.div=function(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r[2]=e[2]/n[2],r},t.dot=ao,t.earthRadius=Nd,t.ease=qe,t.easeCubicInOut=di,t.ecefToLatLng=function([r,e,n]){let u=Math.hypot(r,e,n),f=Math.atan2(r,n),p=.5*Math.PI-Math.acos(-e/u);return new Er(Or(f),Or(p))},t.emitValidationErrors=j_,t.endsWith=vn,t.enforceCacheSizeLimit=function(r){Da(),bn&&bn.then(e=>{e.keys().then(n=>{for(let u=0;u<n.length-r;u++)e.delete(n[u])})})},t.evaluateSizeForFeature=dy,t.evaluateSizeForZoom=Zc,t.evaluateVariableOffset=nC,t.evented=y,t.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},t.exactEquals$1=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},t.exported=So,t.exported$1=z,t.extend=vt,t.extend$1=Ao,t.fillExtrusionHeightLift=wO,t.filterObject=bs,t.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},t.fromQuat=function(r,e){var n=e[0],u=e[1],f=e[2],p=e[3],_=n+n,g=u+u,b=f+f,w=n*_,I=u*_,O=u*g,M=f*_,L=f*g,k=f*b,U=p*_,G=p*g,Y=p*b;return r[0]=1-O-k,r[1]=I+Y,r[2]=M-G,r[3]=0,r[4]=I-Y,r[5]=1-w-k,r[6]=L+U,r[7]=0,r[8]=M+G,r[9]=L-U,r[10]=1-w-O,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},t.fromRotation=function(r,e){var n=Math.sin(e),u=Math.cos(e);return r[0]=u,r[1]=n,r[2]=0,r[3]=-n,r[4]=u,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},t.fromScaling=EA,t.furthestTileCorner=function(r){let e=Math.round((r+45+360)%360/90)%4;return vr[e]},t.getAABBPointSquareDist=function(r,e,n){let u=0;for(let f=0;f<2;++f){let p=n?n[f]:0;r[f]>p&&(u+=(r[f]-p)*(r[f]-p)),e[f]<p&&(u+=(p-e[f])*(p-e[f]))}return u},t.getAnchorAlignment=t1,t.getAnchorJustification=n1,t.getBounds=function(r){let e=1/0,n=1/0,u=-1/0,f=-1/0;for(let p of r)e=Math.min(e,p.x),n=Math.min(n,p.y),u=Math.max(u,p.x),f=Math.max(f,p.y);return{min:new Ve(e,n),max:new Ve(u,f)}},t.getColumn=ia,t.getDefaultExportFromCjs=Ge,t.getGridMatrix=function(r,e,n,u){let f=e.getNorth(),p=e.getSouth(),_=e.getWest(),g=e.getEast(),b=1<<r.z,w=g-_,I=f-p,O=w/du,M=-I/Bd[n],L=[0,O,0,M,0,0,f,_,0];if(r.z>0){let k=180/u;TA(L,L,[k/w+1,0,0,0,k/I+1,0,-.5*k/O,.5*k/M,1])}return L[2]=b,L[5]=r.x,L[8]=r.y,L},t.getImage=te,t.getJSON=function(r,e){return Ba(vt(r,{type:"json"}),e)},t.getLatitudinalLod=function(r){let e=zi-5;r=Ne(r,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(Pt(r))),3);return Math.round(n*(Bd.length-1))},t.getMapSessionAPI=bi,t.getPerformanceMeasurement=Rf,t.getProjection=fC,t.getRTLTextPluginStatus=x,t.getReferrer=ka,t.getTilePoint=function(r,{x:e,y:n},u=0){return new Ve(((e-u)*r.scale-r.x)*St,(n*r.scale-r.y)*St)},t.getTileVec3=function(r,e,n=0){return zc(((e.x-n)*r.scale-r.x)*St,(e.y*r.scale-r.y)*St,WA(e.z,e.y))},t.getVideo=function(r,e){let n=v.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let u=0;u<r.length;u++){let f=v.document.createElement("source");ac(r[u])||(n.crossOrigin="Anonymous"),f.src=r[u],n.appendChild(f)}return{cancel:()=>{}}},t.globeCenterToScreenPoint=function(r){let e=[0,0,0],n=zo(new Float64Array(16));return cu(n,r.pixelMatrix,r.globeMatrix),Qr(e,e,n),new Ve(e[0],e[1])},t.globeDenormalizeECEF=Cx,t.globeECEFOrigin=function(r,e){let n=[0,0,0];return Qr(n,n,Fd(ca(e.canonical))),Qr(n,n,r),n},t.globeMetersToEcef=Y_,t.globeNormalizeECEF=Fd,t.globePixelsToTileUnits=function(r,e){return St/(512*Math.pow(2,r))*Q_(ca(e))},t.globePoleMatrixForTile=function(r,e,n){let u=zo(new Float64Array(16)),f=(e/(1<<r)-.5)*Math.PI*2;return K_(u,n.globeMatrix,f),Float32Array.from(u)},t.globeTileBounds=ca,t.globeTiltAtLngLat=VA,t.globeToMercatorTransition=Uc,t.globeUseCustomAntiAliasing=function(r,e,n){let u=Uc(n.zoom),f=r.style.map._antialias,p=!!e.extStandardDerivatives,_=e.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return u===0&&!f&&!_&&p},t.identity=zo,t.identity$1=qA,t.invert=gx,t.isFullscreen=function(){return!!v.document.fullscreenElement||!!v.document.webkitFullscreenElement},t.isLngLatBehindGlobe=Px,t.isMapAuthenticated=function(r){return Vi.has(r)},t.isMapboxURL=_e,t.isSafariWithAntialiasingBug=function(r){let e=r.navigator?r.navigator.userAgent:null;return!!ws(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.latFromMercatorY=Bi,t.latLngToECEF=Nc,t.len=DY,t.length=Md,t.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},t.lngFromMercatorX=Wn,t.loadVectorTile=LC,t.makeRequest=Ba,t.mapValue=function(r,e,n,u,f){return Ne((r-e)/(n-e)*(f-u)+u,u,f)},t.mercatorScale=ZA,t.mercatorXfromLng=ha,t.mercatorYfromLat=fa,t.mercatorZfromAltitude=No,t.mul=qY,t.mul$1=RY,t.multiply=cu,t.multiply$1=TA,t.multiply$2=AA,t.nextPowerOfTwo=Yr,t.normalize=Yi,t.normalize$1=LY,t.normalize$2=PA,t.number=nr,t.ortho=function(r,e,n,u,f,p,_){var g=1/(e-n),b=1/(u-f),w=1/(p-_);return r[0]=-2*g,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*w,r[11]=0,r[12]=(e+n)*g,r[13]=(f+u)*b,r[14]=(_+p)*w,r[15]=1,r},t.pbf=qO,t.perspective=function(r,e,n,u,f){var p,_=1/Math.tan(e/2);return r[0]=_/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=_,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,f!=null&&f!==1/0?(r[10]=(f+u)*(p=1/(u-f)),r[14]=2*f*u*p):(r[10]=-1,r[14]=-2*u),r},t.pick=function(r,e){let n={};for(let u=0;u<e.length;u++){let f=e[u];f in r&&(n[f]=r[f])}return n},t.plugin=E,t.pointGeometry=Kt,t.polesInViewport=function(r){let e=zo(new Float64Array(16));cu(e,r.pixelMatrix,r.globeMatrix);let n=[0,so,0],u=[0,lo,0];return Qr(n,n,e),Qr(u,u,e),[n[0]>0&&n[0]<=r.width&&n[1]>0&&n[1]<=r.height&&!Px(r,new Er(r.center.lat,90)),u[0]>0&&u[0]<=r.width&&u[1]>0&&u[1]<=r.height&&!Px(r,new Er(r.center.lat,-90))]},t.polygonContainsPoint=_u,t.polygonIntersectsBox=eO,t.polygonIntersectsPolygon=KA,t.polygonizeBounds=function(r,e,n=0,u=!0){let f=new Ve(n,n),p=r.sub(f),_=e.add(f),g=[p,new Ve(_.x,p.y),_,new Ve(p.x,_.y)];return u&&g.push(p.clone()),g},t.posAttributes=kd,t.postMapLoadEvent=ii,t.postPerformanceEvent=pi,t.postTurnstileEvent=Jt,t.potpack=Jx,t.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},t.radToDeg=Or,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(r){return r({pluginStatus:d,pluginURL:s}),y.on("pluginStateChange",r),r},t.removeAuthState=function(r){Vi.delete(r)},t.renderColorRamp=Fx,t.resample=HA,t.rotateX=vx,t.rotateX$1=RA,t.rotateY=K_,t.rotateY$1=DA,t.rotateZ=function(r,e,n){var u=Math.sin(n),f=Math.cos(n),p=e[0],_=e[1],g=e[2],b=e[3],w=e[4],I=e[5],O=e[6],M=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*f+w*u,r[1]=_*f+I*u,r[2]=g*f+O*u,r[3]=b*f+M*u,r[4]=w*f-p*u,r[5]=I*f-_*u,r[6]=O*f-g*u,r[7]=M*f-b*u,r},t.rotateZ$1=function(r,e,n){n*=.5;var u=e[0],f=e[1],p=e[2],_=e[3],g=Math.sin(n),b=Math.cos(n);return r[0]=u*b+f*g,r[1]=f*b-u*g,r[2]=p*b+_*g,r[3]=_*b-p*g,r},t.scale=hu,t.scale$1=CA,t.scale$2=Gn,t.scaleAndAdd=Dd,t.set=function(r,e,n,u){return r[0]=e,r[1]=n,r[2]=u,r},t.setCacheLimits=function(r,e){nc=r,oc=e},t.setColumn=function(r,e,n){r[4*e+0]=n[0],r[4*e+1]=n[1],r[4*e+2]=n[2],r[4*e+3]=n[3]},t.setRTLTextPlugin=function(r,e,n=!1){if(d===Sd||d===Id||d===Ad)throw new Error("setRTLTextPlugin cannot be called multiple times.");s=So.resolveURL(r),d=Sd,$s=e,m(),n||T()},t.smoothstep=Fe,t.spec=Re,t.squaredLength=function(r){var e=r[0],n=r[1],u=r[2];return e*e+n*n+u*u},t.storeAuthState=function(r,e){e?Vi.add(r):Vi.delete(r)},t.sub=Fo,t.subtract=bx,t.symbolSize=ZJ,t.tileAABB=function(r,e,n,u,f,p,_,g,b){if(b.name==="globe")return NY(r,e,new hy(n,u,f));let w=gu({z:n,x:u,y:f},b);return new Ji([(p+w.x/w.scale)*e,e*(w.y/w.scale),_],[(p+w.x2/w.scale)*e,e*(w.y2/w.scale),g])},t.tileCornersToBounds=J_,t.tileTransform=gu,t.transformMat3=function(r,e,n){var u=e[0],f=e[1],p=e[2];return r[0]=u*n[0]+f*n[3]+p*n[6],r[1]=u*n[1]+f*n[4]+p*n[7],r[2]=u*n[2]+f*n[5]+p*n[8],r},t.transformMat4=Qr,t.transformMat4$1=fu,t.transformQuat=OA,t.transitionTileAABBinECEF=FA,t.translate=Pd,t.transpose=function(r,e){if(r===e){var n=e[1],u=e[2],f=e[5];r[1]=e[3],r[2]=e[6],r[3]=n,r[5]=e[7],r[6]=u,r[7]=f}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r},t.triggerPluginCompletionEvent=h,t.uniqueId=hr,t.updateGlobeVertexNormal=function(r,e,n,u,f){let p=5*e+2;r.float32[p+0]=n,r.float32[p+1]=u,r.float32[p+2]=f},t.validateCustomStyleLayer=function(r){let e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFilter=r=>Sn(ou(r)),t.validateFog=r=>Sn(F_(r)),t.validateLayer=r=>Sn(L_(r)),t.validateLight=r=>Sn(z_(r)),t.validateSource=r=>Sn(B_(r)),t.validateStyle=U_,t.validateTerrain=r=>Sn(xd(r)),t.values=gt,t.vectorTile=ly,t.version=S,t.warnOnce=jr,t.window=v,t.wrap=Le}),o(["./shared"],function(t){"use strict";function v(oe){if(typeof oe=="number"||typeof oe=="boolean"||typeof oe=="string"||oe==null)return JSON.stringify(oe);if(Array.isArray(oe)){let V="[";for(let te of oe)V+=`${v(te)},`;return`${V}]`}let j="{";for(let V of Object.keys(oe).sort())j+=`${V}:${v(oe[V])},`;return`${j}}`}function S(oe){let j="";for(let V of t.refProperties)j+=`/${v(oe[V])}`;return j}class C{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,V){for(let ce of j)this._layerConfigs[ce.id]=ce,(this._layers[ce.id]=t.createStyleLayer(ce)).compileFilter(),this.keyCache[ce.id]&&delete this.keyCache[ce.id];for(let ce of V)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};let te=function(ce,_e){let be={};for(let me=0;me<ce.length;me++){let Pe=_e&&_e[ce[me].id]||S(ce[me]);_e&&(_e[ce[me].id]=Pe);let at=be[Pe];at||(at=be[Pe]=[]),at.push(ce[me])}let xe=[];for(let me in be)xe.push(be[me]);return xe}(t.values(this._layerConfigs),this.keyCache);for(let ce of te){let _e=ce.map(st=>this._layers[st.id]),be=_e[0];if(be.visibility==="none")continue;let xe=be.source||"",me=this.familiesBySource[xe];me||(me=this.familiesBySource[xe]={});let Pe=be.sourceLayer||"_geojsonTileLayer",at=me[Pe];at||(at=me[Pe]=[]),at.push(_e)}}}class D{loadTile(j,V){let{uid:te,encoding:ce,rawImageData:_e,padding:be,buildQuadTree:xe}=j,me=t.window.ImageBitmap&&_e instanceof t.window.ImageBitmap?this.getImageData(_e,be):_e;V(null,new t.DEMData(te,me,ce,be<1,xe))}getImageData(j,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(j.width,j.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=j.width,this.offscreenCanvas.height=j.height,this.offscreenCanvasContext.drawImage(j,0,0,j.width,j.height);let te=this.offscreenCanvasContext.getImageData(-V,-V,j.width+2*V,j.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),te}}function z(oe,j){if(oe.length!==0){B(oe[0],j);for(var V=1;V<oe.length;V++)B(oe[V],!j)}}function B(oe,j){for(var V=0,te=0,ce=0,_e=oe.length,be=_e-1;ce<_e;be=ce++){var xe=(oe[ce][0]-oe[be][0])*(oe[be][1]+oe[ce][1]),me=V+xe;te+=Math.abs(V)>=Math.abs(xe)?V-me+xe:xe-me+V,V=me}V+te>=0!=!!j&&oe.reverse()}var ne=t.getDefaultExportFromCjs(function oe(j,V){var te,ce=j&&j.type;if(ce==="FeatureCollection")for(te=0;te<j.features.length;te++)oe(j.features[te],V);else if(ce==="GeometryCollection")for(te=0;te<j.geometries.length;te++)oe(j.geometries[te],V);else if(ce==="Feature")oe(j.geometry,V);else if(ce==="Polygon")z(j.coordinates,V);else if(ce==="MultiPolygon")for(te=0;te<j.coordinates.length;te++)z(j.coordinates[te],V);return j});let pe=t.VectorTileFeature.prototype.toGeoJSON;var $e={exports:{}},Ae=t.pointGeometry,ke=t.vectorTile.VectorTileFeature,Ge=tt;function tt(oe,j){this.options=j||{},this.features=oe,this.length=oe.length}function mt(oe,j){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=j||4096}tt.prototype.feature=function(oe){return new mt(this.features[oe],this.options.extent)},mt.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var j=0;j<oe.length;j++){for(var V=oe[j],te=[],ce=0;ce<V.length;ce++)te.push(new Ae(V[ce][0],V[ce][1]));this.geometry.push(te)}return this.geometry},mt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,j=1/0,V=-1/0,te=1/0,ce=-1/0,_e=0;_e<oe.length;_e++)for(var be=oe[_e],xe=0;xe<be.length;xe++){var me=be[xe];j=Math.min(j,me.x),V=Math.max(V,me.x),te=Math.min(te,me.y),ce=Math.max(ce,me.y)}return[j,te,V,ce]},mt.prototype.toGeoJSON=ke.prototype.toGeoJSON;var Mt=t.pbf,Kt=Ge;function At(oe){var j=new Mt;return function(V,te){for(var ce in V.layers)te.writeMessage(3,Ve,V.layers[ce])}(oe,j),j.finish()}function Ve(oe,j){var V;j.writeVarintField(15,oe.version||1),j.writeStringField(1,oe.name||""),j.writeVarintField(5,oe.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<oe.length;V++)te.feature=oe.feature(V),j.writeMessage(2,er,te);var ce=te.keys;for(V=0;V<ce.length;V++)j.writeStringField(3,ce[V]);var _e=te.values;for(V=0;V<_e.length;V++)j.writeMessage(4,di,_e[V])}function er(oe,j){var V=oe.feature;V.id!==void 0&&j.writeVarintField(1,V.id),j.writeMessage(2,Dt,oe),j.writeVarintField(3,V.type),j.writeMessage(4,vr,V)}function Dt(oe,j){var V=oe.feature,te=oe.keys,ce=oe.values,_e=oe.keycache,be=oe.valuecache;for(var xe in V.properties){var me=V.properties[xe],Pe=_e[xe];if(me!==null){Pe===void 0&&(te.push(xe),_e[xe]=Pe=te.length-1),j.writeVarint(Pe);var at=typeof me;at!=="string"&&at!=="boolean"&&at!=="number"&&(me=JSON.stringify(me));var st=at+":"+me,it=be[st];it===void 0&&(ce.push(me),be[st]=it=ce.length-1),j.writeVarint(it)}}}function Pt(oe,j){return(j<<3)+(7&oe)}function Or(oe){return oe<<1^oe>>31}function vr(oe,j){for(var V=oe.loadGeometry(),te=oe.type,ce=0,_e=0,be=V.length,xe=0;xe<be;xe++){var me=V[xe],Pe=1;te===1&&(Pe=me.length),j.writeVarint(Pt(1,Pe));for(var at=te===3?me.length-1:me.length,st=0;st<at;st++){st===1&&te!==1&&j.writeVarint(Pt(2,at-1));var it=me[st].x-ce,Ft=me[st].y-_e;j.writeVarint(Or(it)),j.writeVarint(Or(Ft)),ce+=it,_e+=Ft}te===3&&j.writeVarint(Pt(7,1))}}function di(oe,j){var V=typeof oe;V==="string"?j.writeStringField(1,oe):V==="boolean"?j.writeBooleanField(7,oe):V==="number"&&(oe%1!=0?j.writeDoubleField(3,oe):oe<0?j.writeSVarintField(6,oe):j.writeVarintField(5,oe))}$e.exports=At,$e.exports.fromVectorTileJs=At,$e.exports.fromGeojsonVt=function(oe,j){j=j||{};var V={};for(var te in oe)V[te]=new Kt(oe[te].features,j),V[te].name=te,V[te].version=j.version,V[te].extent=j.extent;return At({layers:V})},$e.exports.GeoJSONWrapper=Kt;var xi=t.getDefaultExportFromCjs($e.exports);let qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},Ne=Math.fround||(Fe=new Float32Array(1),oe=>(Fe[0]=+oe,Fe[0]));var Fe;let Le=3,Ke=5,gt=6;class vt{constructor(j){this.options=Object.assign(Object.create(qe),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){let{log:V,minZoom:te,maxZoom:ce}=this.options;V&&console.time("total time");let _e=`prepare ${j.length} points`;V&&console.time(_e),this.points=j;let be=[];for(let me=0;me<j.length;me++){let Pe=j[me];if(!Pe.geometry)continue;let[at,st]=Pe.geometry.coordinates,it=Ne(Dr(at)),Ft=Ne(Yr(st));be.push(it,Ft,1/0,me,-1,1),this.options.reduce&&be.push(0)}let xe=this.trees[ce+1]=this._createTree(be);V&&console.timeEnd(_e);for(let me=ce;me>=te;me--){let Pe=+Date.now();xe=this.trees[me]=this._createTree(this._cluster(xe,me)),V&&console.log("z%d: %d clusters in %dms",me,xe.numItems,+Date.now()-Pe)}return V&&console.timeEnd("total time"),this}getClusters(j,V){let te=((j[0]+180)%360+360)%360-180,ce=Math.max(-90,Math.min(90,j[1])),_e=j[2]===180?180:((j[2]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)te=-180,_e=180;else if(te>_e){let st=this.getClusters([te,ce,180,be],V),it=this.getClusters([-180,ce,_e,be],V);return st.concat(it)}let xe=this.trees[this._limitZoom(V)],me=xe.range(Dr(te),Yr(be),Dr(_e),Yr(ce)),Pe=xe.data,at=[];for(let st of me){let it=this.stride*st;at.push(Pe[it+Ke]>1?tr(Pe,it,this.clusterProps):this.points[Pe[it+Le]])}return at}getChildren(j){let V=this._getOriginId(j),te=this._getOriginZoom(j),ce="No cluster with the specified id.",_e=this.trees[te];if(!_e)throw new Error(ce);let be=_e.data;if(V*this.stride>=be.length)throw new Error(ce);let xe=this.options.radius/(this.options.extent*Math.pow(2,te-1)),me=_e.within(be[V*this.stride],be[V*this.stride+1],xe),Pe=[];for(let at of me){let st=at*this.stride;be[st+4]===j&&Pe.push(be[st+Ke]>1?tr(be,st,this.clusterProps):this.points[be[st+Le]])}if(Pe.length===0)throw new Error(ce);return Pe}getLeaves(j,V,te){let ce=[];return this._appendLeaves(ce,j,V=V||10,te=te||0,0),ce}getTile(j,V,te){let ce=this.trees[this._limitZoom(j)],_e=Math.pow(2,j),{extent:be,radius:xe}=this.options,me=xe/be,Pe=(te-me)/_e,at=(te+1+me)/_e,st={features:[]};return this._addTileFeatures(ce.range((V-me)/_e,Pe,(V+1+me)/_e,at),ce.data,V,te,_e,st),V===0&&this._addTileFeatures(ce.range(1-me/_e,Pe,1,at),ce.data,_e,te,_e,st),V===_e-1&&this._addTileFeatures(ce.range(0,Pe,me/_e,at),ce.data,-1,te,_e,st),st.features.length?st:null}getClusterExpansionZoom(j){let V=this._getOriginZoom(j)-1;for(;V<=this.options.maxZoom;){let te=this.getChildren(j);if(V++,te.length!==1)break;j=te[0].properties.cluster_id}return V}_appendLeaves(j,V,te,ce,_e){let be=this.getChildren(V);for(let xe of be){let me=xe.properties;if(me&&me.cluster?_e+me.point_count<=ce?_e+=me.point_count:_e=this._appendLeaves(j,me.cluster_id,te,ce,_e):_e<ce?_e++:j.push(xe),j.length===te)break}return _e}_createTree(j){let V=new t.KDBush(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<j.length;te+=this.stride)V.add(j[te],j[te+1]);return V.finish(),V.data=j,V}_addTileFeatures(j,V,te,ce,_e,be){for(let xe of j){let me=xe*this.stride,Pe=V[me+Ke]>1,at,st,it;if(Pe)at=hr(V,me,this.clusterProps),st=V[me],it=V[me+1];else{let Nt=this.points[V[me+Le]];at=Nt.properties;let[Gt,Jt]=Nt.geometry.coordinates;st=Dr(Gt),it=Yr(Jt)}let Ft={type:1,geometry:[[Math.round(this.options.extent*(st*_e-te)),Math.round(this.options.extent*(it*_e-ce))]],tags:at},$t;$t=Pe||this.options.generateId?V[me+Le]:this.points[V[me+Le]].id,$t!==void 0&&(Ft.id=$t),be.features.push(Ft)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,V){let{radius:te,extent:ce,reduce:_e,minPoints:be}=this.options,xe=te/(ce*Math.pow(2,V)),me=j.data,Pe=[],at=this.stride;for(let st=0;st<me.length;st+=at){if(me[st+2]<=V)continue;me[st+2]=V;let it=me[st],Ft=me[st+1],$t=j.within(me[st],me[st+1],xe),Nt=me[st+Ke],Gt=Nt;for(let Jt of $t){let Vr=Jt*at;me[Vr+2]>V&&(Gt+=me[Vr+Ke])}if(Gt>Nt&&Gt>=be){let Jt,Vr=it*Nt,ii=Ft*Nt,Di=-1,pi=((st/at|0)<<5)+(V+1)+this.points.length;for(let Qn of $t){let bi=Qn*at;if(me[bi+2]<=V)continue;me[bi+2]=V;let Vi=me[bi+Ke];Vr+=me[bi]*Vi,ii+=me[bi+1]*Vi,me[bi+4]=pi,_e&&(Jt||(Jt=this._map(me,st,!0),Di=this.clusterProps.length,this.clusterProps.push(Jt)),_e(Jt,this._map(me,bi)))}me[st+4]=pi,Pe.push(Vr/Gt,ii/Gt,1/0,pi,-1,Gt),_e&&Pe.push(Di)}else{for(let Jt=0;Jt<at;Jt++)Pe.push(me[st+Jt]);if(Gt>1)for(let Jt of $t){let Vr=Jt*at;if(!(me[Vr+2]<=V)){me[Vr+2]=V;for(let ii=0;ii<at;ii++)Pe.push(me[Vr+ii])}}}}return Pe}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,V,te){if(j[V+Ke]>1){let be=this.clusterProps[j[V+gt]];return te?Object.assign({},be):be}let ce=this.points[j[V+Le]].properties,_e=this.options.map(ce);return te&&_e===ce?Object.assign({},_e):_e}}function tr(oe,j,V){return{type:"Feature",id:oe[j+Le],properties:hr(oe,j,V),geometry:{type:"Point",coordinates:[(te=oe[j],360*(te-.5)),yi(oe[j+1])]}};var te}function hr(oe,j,V){let te=oe[j+Ke],ce=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,_e=oe[j+gt],be=_e===-1?{}:Object.assign({},V[_e]);return Object.assign(be,{cluster:!0,cluster_id:oe[j+Le],point_count:te,point_count_abbreviated:ce})}function Dr(oe){return oe/360+.5}function Yr(oe){let j=Math.sin(oe*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function yi(oe){let j=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function Un(oe,j,V,te){for(var ce,_e=te,be=V-j>>1,xe=V-j,me=oe[j],Pe=oe[j+1],at=oe[V],st=oe[V+1],it=j+3;it<V;it+=3){var Ft=vn(oe[it],oe[it+1],me,Pe,at,st);if(Ft>_e)ce=it,_e=Ft;else if(Ft===_e){var $t=Math.abs(it-be);$t<xe&&(ce=it,xe=$t)}}_e>te&&(ce-j>3&&Un(oe,j,ce,te),oe[ce+2]=_e,V-ce>3&&Un(oe,ce,V,te))}function vn(oe,j,V,te,ce,_e){var be=ce-V,xe=_e-te;if(be!==0||xe!==0){var me=((oe-V)*be+(j-te)*xe)/(be*be+xe*xe);me>1?(V=ce,te=_e):me>0&&(V+=be*me,te+=xe*me)}return(be=oe-V)*be+(xe=j-te)*xe}function zt(oe,j,V,te){var ce={id:oe===void 0?null:oe,type:j,geometry:V,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var be=_e.geometry,xe=_e.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")bs(_e,be);else if(xe==="Polygon"||xe==="MultiLineString")for(var me=0;me<be.length;me++)bs(_e,be[me]);else if(xe==="MultiPolygon")for(me=0;me<be.length;me++)for(var Pe=0;Pe<be[me].length;Pe++)bs(_e,be[me][Pe])}(ce),ce}function bs(oe,j){for(var V=0;V<j.length;V+=3)oe.minX=Math.min(oe.minX,j[V]),oe.minY=Math.min(oe.minY,j[V+1]),oe.maxX=Math.max(oe.maxX,j[V]),oe.maxY=Math.max(oe.maxY,j[V+1])}function sn(oe,j,V,te){if(j.geometry){var ce=j.geometry.coordinates,_e=j.geometry.type,be=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),xe=[],me=j.id;if(V.promoteId?me=j.properties[V.promoteId]:V.generateId&&(me=te||0),_e==="Point")Pl(ce,xe);else if(_e==="MultiPoint")for(var Pe=0;Pe<ce.length;Pe++)Pl(ce[Pe],xe);else if(_e==="LineString")jr(ce,xe,be,!1);else if(_e==="MultiLineString"){if(V.lineMetrics){for(Pe=0;Pe<ce.length;Pe++)jr(ce[Pe],xe=[],be,!1),oe.push(zt(me,"LineString",xe,j.properties));return}xn(ce,xe,be,!1)}else if(_e==="Polygon")xn(ce,xe,be,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(Pe=0;Pe<j.geometry.geometries.length;Pe++)sn(oe,{id:me,geometry:j.geometry.geometries[Pe],properties:j.properties},V,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Pe=0;Pe<ce.length;Pe++){var at=[];xn(ce[Pe],at,be,!0),xe.push(at)}}oe.push(zt(me,_e,xe,j.properties))}}function Pl(oe,j){j.push(ic(oe[0])),j.push(Eo(oe[1])),j.push(0)}function jr(oe,j,V,te){for(var ce,_e,be=0,xe=0;xe<oe.length;xe++){var me=ic(oe[xe][0]),Pe=Eo(oe[xe][1]);j.push(me),j.push(Pe),j.push(0),xe>0&&(be+=te?(ce*Pe-me*_e)/2:Math.sqrt(Math.pow(me-ce,2)+Math.pow(Pe-_e,2))),ce=me,_e=Pe}var at=j.length-3;j[2]=1,Un(j,0,at,V),j[at+2]=1,j.size=Math.abs(be),j.start=0,j.end=j.size}function xn(oe,j,V,te){for(var ce=0;ce<oe.length;ce++){var _e=[];jr(oe[ce],_e,V,te),j.push(_e)}}function ic(oe){return oe/360+.5}function Eo(oe){var j=Math.sin(oe*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function ln(oe,j,V,te,ce,_e,be,xe){if(te/=j,_e>=(V/=j)&&be<te)return oe;if(be<V||_e>=te)return null;for(var me=[],Pe=0;Pe<oe.length;Pe++){var at=oe[Pe],st=at.geometry,it=at.type,Ft=ce===0?at.minX:at.minY,$t=ce===0?at.maxX:at.maxY;if(Ft>=V&&$t<te)me.push(at);else if(!($t<V||Ft>=te)){var Nt=[];if(it==="Point"||it==="MultiPoint")Ml(st,Nt,V,te,ce);else if(it==="LineString")ws(st,Nt,V,te,ce,!1,xe.lineMetrics);else if(it==="MultiLineString")ia(st,Nt,V,te,ce,!1);else if(it==="Polygon")ia(st,Nt,V,te,ce,!0);else if(it==="MultiPolygon")for(var Gt=0;Gt<st.length;Gt++){var Jt=[];ia(st[Gt],Jt,V,te,ce,!0),Jt.length&&Nt.push(Jt)}if(Nt.length){if(xe.lineMetrics&&it==="LineString"){for(Gt=0;Gt<Nt.length;Gt++)me.push(zt(at.id,it,Nt[Gt],at.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(Nt.length===1?(it="LineString",Nt=Nt[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=Nt.length===3?"Point":"MultiPoint"),me.push(zt(at.id,it,Nt,at.tags))}}}return me.length?me:null}function Ml(oe,j,V,te,ce){for(var _e=0;_e<oe.length;_e+=3){var be=oe[_e+ce];be>=V&&be<=te&&(j.push(oe[_e]),j.push(oe[_e+1]),j.push(oe[_e+2]))}}function ws(oe,j,V,te,ce,_e,be){for(var xe,me,Pe=ql(oe),at=ce===0?nc:oc,st=oe.start,it=0;it<oe.length-3;it+=3){var Ft=oe[it],$t=oe[it+1],Nt=oe[it+2],Gt=oe[it+3],Jt=oe[it+4],Vr=ce===0?Ft:$t,ii=ce===0?Gt:Jt,Di=!1;be&&(xe=Math.sqrt(Math.pow(Ft-Gt,2)+Math.pow($t-Jt,2))),Vr<V?ii>V&&(me=at(Pe,Ft,$t,Gt,Jt,V),be&&(Pe.start=st+xe*me)):Vr>te?ii<te&&(me=at(Pe,Ft,$t,Gt,Jt,te),be&&(Pe.start=st+xe*me)):Ts(Pe,Ft,$t,Nt),ii<V&&Vr>=V&&(me=at(Pe,Ft,$t,Gt,Jt,V),Di=!0),ii>te&&Vr<=te&&(me=at(Pe,Ft,$t,Gt,Jt,te),Di=!0),!_e&&Di&&(be&&(Pe.end=st+xe*me),j.push(Pe),Pe=ql(oe)),be&&(st+=xe)}var pi=oe.length-3;Ft=oe[pi],$t=oe[pi+1],Nt=oe[pi+2],(Vr=ce===0?Ft:$t)>=V&&Vr<=te&&Ts(Pe,Ft,$t,Nt),pi=Pe.length-3,_e&&pi>=3&&(Pe[pi]!==Pe[0]||Pe[pi+1]!==Pe[1])&&Ts(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&j.push(Pe)}function ql(oe){var j=[];return j.size=oe.size,j.start=oe.start,j.end=oe.end,j}function ia(oe,j,V,te,ce,_e){for(var be=0;be<oe.length;be++)ws(oe[be],j,V,te,ce,_e,!1)}function Ts(oe,j,V,te){oe.push(j),oe.push(V),oe.push(te)}function nc(oe,j,V,te,ce,_e){var be=(_e-j)/(te-j);return oe.push(_e),oe.push(V+(ce-V)*be),oe.push(1),be}function oc(oe,j,V,te,ce,_e){var be=(_e-V)/(ce-V);return oe.push(j+(te-j)*be),oe.push(_e),oe.push(1),be}function bn(oe,j){for(var V=[],te=0;te<oe.length;te++){var ce,_e=oe[te],be=_e.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")ce=na(_e.geometry,j);else if(be==="MultiLineString"||be==="Polygon"){ce=[];for(var xe=0;xe<_e.geometry.length;xe++)ce.push(na(_e.geometry[xe],j))}else if(be==="MultiPolygon")for(ce=[],xe=0;xe<_e.geometry.length;xe++){for(var me=[],Pe=0;Pe<_e.geometry[xe].length;Pe++)me.push(na(_e.geometry[xe][Pe],j));ce.push(me)}V.push(zt(_e.id,be,ce,_e.tags))}return V}function na(oe,j){var V=[];V.size=oe.size,oe.start!==void 0&&(V.start=oe.start,V.end=oe.end);for(var te=0;te<oe.length;te+=3)V.push(oe[te]+j,oe[te+1],oe[te+2]);return V}function Rl(oe,j){if(oe.transformed)return oe;var V,te,ce,_e=1<<oe.z,be=oe.x,xe=oe.y;for(V=0;V<oe.features.length;V++){var me=oe.features[V],Pe=me.geometry,at=me.type;if(me.geometry=[],at===1)for(te=0;te<Pe.length;te+=2)me.geometry.push(Da(Pe[te],Pe[te+1],j,_e,be,xe));else for(te=0;te<Pe.length;te++){var st=[];for(ce=0;ce<Pe[te].length;ce+=2)st.push(Da(Pe[te][ce],Pe[te][ce+1],j,_e,be,xe));me.geometry.push(st)}}return oe.transformed=!0,oe}function Da(oe,j,V,te,ce,_e){return[Math.round(V*(oe*te-ce)),Math.round(V*(j*te-_e))]}function Es(oe,j,V,te,ce){for(var _e=j===ce.maxZoom?0:ce.tolerance/((1<<j)*ce.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:te,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<oe.length;xe++){be.numFeatures++,Dl(be,oe[xe],_e,ce);var me=oe[xe].minX,Pe=oe[xe].minY,at=oe[xe].maxX,st=oe[xe].maxY;me<be.minX&&(be.minX=me),Pe<be.minY&&(be.minY=Pe),at>be.maxX&&(be.maxX=at),st>be.maxY&&(be.maxY=st)}return be}function Dl(oe,j,V,te){var ce=j.geometry,_e=j.type,be=[];if(_e==="Point"||_e==="MultiPoint")for(var xe=0;xe<ce.length;xe+=3)be.push(ce[xe]),be.push(ce[xe+1]),oe.numPoints++,oe.numSimplified++;else if(_e==="LineString")La(be,ce,oe,V,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(xe=0;xe<ce.length;xe++)La(be,ce[xe],oe,V,_e==="Polygon",xe===0);else if(_e==="MultiPolygon")for(var me=0;me<ce.length;me++){var Pe=ce[me];for(xe=0;xe<Pe.length;xe++)La(be,Pe[xe],oe,V,!0,xe===0)}if(be.length){var at=j.tags||null;if(_e==="LineString"&&te.lineMetrics){for(var st in at={},j.tags)at[st]=j.tags[st];at.mapbox_clip_start=ce.start/ce.size,at.mapbox_clip_end=ce.end/ce.size}var it={geometry:be,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:at};j.id!==null&&(it.id=j.id),oe.features.push(it)}}function La(oe,j,V,te,ce,_e){var be=te*te;if(te>0&&j.size<(ce?be:te))V.numPoints+=j.length/3;else{for(var xe=[],me=0;me<j.length;me+=3)(te===0||j[me+2]>be)&&(V.numSimplified++,xe.push(j[me]),xe.push(j[me+1])),V.numPoints++;ce&&function(Pe,at){for(var st=0,it=0,Ft=Pe.length,$t=Ft-2;it<Ft;$t=it,it+=2)st+=(Pe[it]-Pe[$t])*(Pe[it+1]+Pe[$t+1]);if(st>0===at)for(it=0,Ft=Pe.length;it<Ft/2;it+=2){var Nt=Pe[it],Gt=Pe[it+1];Pe[it]=Pe[Ft-2-it],Pe[it+1]=Pe[Ft-1-it],Pe[Ft-2-it]=Nt,Pe[Ft-1-it]=Gt}}(xe,_e),oe.push(xe)}}function oa(oe,j){var V=(j=this.options=function(ce,_e){for(var be in _e)ce[be]=_e[be];return ce}(Object.create(this.options),j)).debug;if(V&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(ce,_e){var be=[];if(ce.type==="FeatureCollection")for(var xe=0;xe<ce.features.length;xe++)sn(be,ce.features[xe],_e,xe);else sn(be,ce.type==="Feature"?ce:{geometry:ce},_e);return be}(oe,j);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(ce,_e){var be=_e.buffer/_e.extent,xe=ce,me=ln(ce,1,-1-be,be,0,-1,2,_e),Pe=ln(ce,1,1-be,2+be,0,-1,2,_e);return(me||Pe)&&(xe=ln(ce,1,-be,1+be,0,-1,2,_e)||[],me&&(xe=bn(me,1).concat(xe)),Pe&&(xe=xe.concat(bn(Pe,-1)))),xe}(te,j),te.length&&this.splitTile(te,0,0,0),V&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ka(oe,j,V){return 32*((1<<oe)*V+j)+oe}function Ba(oe,j){let V=oe.tileID.canonical;if(!this._geoJSONIndex)return j(null,null);let te=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!te)return j(null,null);let ce=new class{constructor(be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=be.length,this._features=be}feature(be){return new class{constructor(xe){this._feature=xe,this.extent=t.EXTENT,this.type=xe.type,this.properties=xe.tags,"id"in xe&&!isNaN(xe.id)&&(this.id=parseInt(xe.id,10))}loadGeometry(){if(this._feature.type===1){let xe=[];for(let me of this._feature.geometry)xe.push([new t.Point(me[0],me[1])]);return xe}{let xe=[];for(let me of this._feature.geometry){let Pe=[];for(let at of me)Pe.push(new t.Point(at[0],at[1]));xe.push(Pe)}return xe}}toGeoJSON(xe,me,Pe){return pe.call(this,xe,me,Pe)}}(this._features[be])}}(te.features),_e=xi(ce);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),j(null,{vectorTile:ce,rawData:_e.buffer})}oa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},oa.prototype.splitTile=function(oe,j,V,te,ce,_e,be){for(var xe=[oe,j,V,te],me=this.options,Pe=me.debug;xe.length;){te=xe.pop(),V=xe.pop(),j=xe.pop(),oe=xe.pop();var at=1<<j,st=ka(j,V,te),it=this.tiles[st];if(!it&&(Pe>1&&console.time("creation"),it=this.tiles[st]=Es(oe,j,V,te,me),this.tileCoords.push({z:j,x:V,y:te}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,V,te,it.numFeatures,it.numPoints,it.numSimplified),console.timeEnd("creation"));var Ft="z"+j;this.stats[Ft]=(this.stats[Ft]||0)+1,this.total++}if(it.source=oe,ce){if(j===me.maxZoom||j===ce)continue;var $t=1<<ce-j;if(V!==Math.floor(_e/$t)||te!==Math.floor(be/$t))continue}else if(j===me.indexMaxZoom||it.numPoints<=me.indexMaxPoints)continue;if(it.source=null,oe.length!==0){Pe>1&&console.time("clipping");var Nt,Gt,Jt,Vr,ii,Di,pi=.5*me.buffer/me.extent,Qn=.5-pi,bi=.5+pi,Vi=1+pi;Nt=Gt=Jt=Vr=null,ii=ln(oe,at,V-pi,V+bi,0,it.minX,it.maxX,me),Di=ln(oe,at,V+Qn,V+Vi,0,it.minX,it.maxX,me),oe=null,ii&&(Nt=ln(ii,at,te-pi,te+bi,1,it.minY,it.maxY,me),Gt=ln(ii,at,te+Qn,te+Vi,1,it.minY,it.maxY,me),ii=null),Di&&(Jt=ln(Di,at,te-pi,te+bi,1,it.minY,it.maxY,me),Vr=ln(Di,at,te+Qn,te+Vi,1,it.minY,it.maxY,me),Di=null),Pe>1&&console.timeEnd("clipping"),xe.push(Nt||[],j+1,2*V,2*te),xe.push(Gt||[],j+1,2*V,2*te+1),xe.push(Jt||[],j+1,2*V+1,2*te),xe.push(Vr||[],j+1,2*V+1,2*te+1)}}},oa.prototype.getTile=function(oe,j,V){var te=this.options,ce=te.extent,_e=te.debug;if(oe<0||oe>24)return null;var be=1<<oe,xe=ka(oe,j=(j%be+be)%be,V);if(this.tiles[xe])return Rl(this.tiles[xe],ce);_e>1&&console.log("drilling down to z%d-%d-%d",oe,j,V);for(var me,Pe=oe,at=j,st=V;!me&&Pe>0;)Pe--,at=Math.floor(at/2),st=Math.floor(st/2),me=this.tiles[ka(Pe,at,st)];return me&&me.source?(_e>1&&console.log("found parent tile z%d-%d-%d",Pe,at,st),_e>1&&console.time("drilling down"),this.splitTile(me.source,Pe,at,st,oe,j,V),_e>1&&console.timeEnd("drilling down"),this.tiles[xe]?Rl(this.tiles[xe],ce):null):null};class Ss extends t.VectorTileWorkerSource{constructor(j,V,te,ce,_e){super(j,V,te,ce,Ba),_e&&(this.loadGeoJSON=_e)}loadData(j,V){let te=j&&j.request,ce=te&&te.collectResourceTiming;this.loadGeoJSON(j,(_e,be)=>{if(_e||!be)return V(_e);if(typeof be!="object")return V(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{ne(be,!0);try{if(j.filter){let me=t.createExpression(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(me.result==="error")throw new Error(me.value.map(at=>`${at.key}: ${at.message}`).join(", "));be={type:"FeatureCollection",features:be.features.filter(at=>me.value.evaluate({zoom:0},at))}}this._geoJSONIndex=j.cluster?new vt(function({superclusterOptions:me,clusterProperties:Pe}){if(!Pe||!me)return me;let at={},st={},it={accumulated:null,zoom:0},Ft={properties:null},$t=Object.keys(Pe);for(let Nt of $t){let[Gt,Jt]=Pe[Nt],Vr=t.createExpression(Jt),ii=t.createExpression(typeof Gt=="string"?[Gt,["accumulated"],["get",Nt]]:Gt);at[Nt]=Vr.value,st[Nt]=ii.value}return me.map=Nt=>{Ft.properties=Nt;let Gt={};for(let Jt of $t)Gt[Jt]=at[Jt].evaluate(it,Ft);return Gt},me.reduce=(Nt,Gt)=>{Ft.properties=Gt;for(let Jt of $t)it.accumulated=Nt[Jt],Nt[Jt]=st[Jt].evaluate(it,Ft)},me}(j)).load(be.features):function(me,Pe){return new oa(me,Pe)}(be,j.geojsonVtOptions)}catch(me){return V(me)}this.loaded={};let xe={};if(ce){let me=t.getPerformanceMeasurement(te);me&&(xe.resourceTiming={},xe.resourceTiming[j.source]=JSON.parse(JSON.stringify(me)))}V(null,xe)}})}reloadTile(j,V){let te=this.loaded;return te&&te[j.uid]?super.reloadTile(j,V):this.loadTile(j,V)}loadGeoJSON(j,V){if(j.request)t.getJSON(j.request,V);else{if(typeof j.data!="string")return V(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(j.data))}catch{return V(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(j,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(te){V(te)}}getClusterChildren(j,V){try{V(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(te){V(te)}}getClusterLeaves(j,V){try{V(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(te){V(te)}}}class ac{constructor(j){this.self=j,this.actor=new t.Actor(j,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.getProjection({name:"mercator"}),this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:Ss},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,te)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=te},this.self.registerRTLTextPlugin=V=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=V.applyArabicShaping,t.plugin.processBidirectionalText=V.processBidirectionalText,t.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(j,V,te){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],te()}checkIfReady(j,V,te){te()}setReferrer(j,V){this.referrer=V}spriteLoaded(j,V){this.isSpriteLoaded[j]=V;for(let te in this.workerSources[j]){let ce=this.workerSources[j][te];for(let _e in ce)ce[_e]instanceof t.VectorTileWorkerSource&&(ce[_e].isSpriteLoaded=V,ce[_e].fire(new t.Event("isSpriteLoaded")))}}setImages(j,V,te){this.availableImages[j]=V;for(let ce in this.workerSources[j]){let _e=this.workerSources[j][ce];for(let be in _e)_e[be].availableImages=V}te()}enableTerrain(j,V,te){this.terrain=V,te()}setProjection(j,V){this.projections[j]=t.getProjection(V)}setLayers(j,V,te){this.getLayerIndex(j).replace(V),te()}updateLayers(j,V,te){this.getLayerIndex(j).update(V.layers,V.removedIds),te()}loadTile(j,V,te){let ce=this.enableTerrain?t.extend({enableTerrain:this.terrain},V):V;ce.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,V.type,V.source).loadTile(ce,te)}loadDEMTile(j,V,te){let ce=this.enableTerrain?t.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(j,V.source).loadTile(ce,te)}reloadTile(j,V,te){let ce=this.enableTerrain?t.extend({enableTerrain:this.terrain},V):V;ce.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,V.type,V.source).reloadTile(ce,te)}abortTile(j,V,te){this.getWorkerSource(j,V.type,V.source).abortTile(V,te)}removeTile(j,V,te){this.getWorkerSource(j,V.type,V.source).removeTile(V,te)}removeSource(j,V,te){if(!this.workerSources[j]||!this.workerSources[j][V.type]||!this.workerSources[j][V.type][V.source])return;let ce=this.workerSources[j][V.type][V.source];delete this.workerSources[j][V.type][V.source],ce.removeSource!==void 0?ce.removeSource(V,te):te()}loadWorkerSource(j,V,te){try{this.self.importScripts(V.url),te()}catch(ce){te(ce.toString())}}syncRTLPluginState(j,V,te){try{t.plugin.setState(V);let ce=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&ce!=null){this.self.importScripts(ce);let _e=t.plugin.isParsed();te(_e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ce}`),_e)}}catch(ce){te(ce.toString())}}getAvailableImages(j){let V=this.availableImages[j];return V||(V=[]),V}getLayerIndex(j){let V=this.layerIndexes[j];return V||(V=this.layerIndexes[j]=new C),V}getWorkerSource(j,V,te){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][V]||(this.workerSources[j][V]={}),!this.workerSources[j][V][te]){let ce={send:(_e,be,xe,me,Pe,at)=>{this.actor.send(_e,be,xe,j,Pe,at)},scheduler:this.actor.scheduler};this.workerSources[j][V][te]=new this.workerSourceTypes[V](ce,this.getLayerIndex(j),this.getAvailableImages(j),this.isSpriteLoaded[j])}return this.workerSources[j][V][te]}getDEMWorkerSource(j,V){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][V]||(this.demWorkerSources[j][V]=new D),this.demWorkerSources[j][V]}enforceCacheSizeLimit(j,V){t.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(j,V,te){te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ac(self)),ac}),o(["./shared"],function(t){"use strict";function v(d,s){if(Array.isArray(d)){if(!Array.isArray(s)||d.length!==s.length)return!1;for(let h=0;h<d.length;h++)if(!v(d[h],s[h]))return!1;return!0}if(typeof d=="object"&&d!==null&&s!==null){if(typeof s!="object"||Object.keys(d).length!==Object.keys(s).length)return!1;for(let h in d)if(!v(d[h],s[h]))return!1;return!0}return d===s}var S=C;function C(d){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{y=new Worker(T),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(T),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===m.width}()?(D[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(D[h]=function(m){var y,x=function(T){var E=document.createElement("canvas"),A=Object.create(C.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=T,E.getContext("webgl",A)||E.getContext("experimental-webgl",A)}(m);if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),x.getShaderParameter(y,x.COMPILE_STATUS)===!0)}(h)),D[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(d)}var D={};function z(d,s,h){let m=t.window.document.createElement(d);return s!==void 0&&(m.className=s),h&&h.appendChild(m),m}function B(d,s,h){let m=t.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(let y of Object.keys(s))m.setAttributeNS(null,y,s[y]);return h&&h.appendChild(m),m}C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ne=t.window.document&&t.window.document.documentElement.style,pe=ne&&ne.userSelect!==void 0?"userSelect":"WebkitUserSelect",$e;function Ae(){ne&&pe&&($e=ne[pe],ne[pe]="none")}function ke(){ne&&pe&&(ne[pe]=$e)}function Ge(d){d.preventDefault(),d.stopPropagation(),t.window.removeEventListener("click",Ge,!0)}function tt(){t.window.addEventListener("click",Ge,!0),t.window.setTimeout(()=>{t.window.removeEventListener("click",Ge,!0)},0)}function mt(d,s){let h=d.getBoundingClientRect();return At(d,h,s)}function Mt(d,s){let h=d.getBoundingClientRect(),m=[];for(let y=0;y<s.length;y++)m.push(At(d,h,s[y]));return m}function Kt(d){return t.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function At(d,s,h){let m=d.offsetWidth===s.width?1:d.offsetWidth/s.width;return new t.Point((h.clientX-s.left)*m,(h.clientY-s.top)*m)}function Ve(d,s){var h=s[0],m=s[1],y=s[2],x=s[3],T=h*x-y*m;return T?(d[0]=x*(T=1/T),d[1]=-m*T,d[2]=-y*T,d[3]=h*T,d):null}function er(d){let{userImage:s}=d;return!!(s&&s.render&&s.render())&&(d.data.replace(new Uint8Array(s.data.buffer)),!0)}class Dt extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(let{ids:h,callback:m}of this.requestors)this._notify(h,m);this.requestors=[]}}hasImage(s){return!!this.getImage(s)}getImage(s){return this.images[s]}addImage(s,h){this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let m=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new t.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,h){if(!s)return!0;let m=0;for(let y of s){if(y[0]<m||y[1]<y[0]||h<y[1])return!1;m=y[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){h.version=this.images[s].version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){let h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let m=!0;if(!this.isLoaded())for(let y of s)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){let m={};for(let y of s){this.images[y]||this.fire(new t.Event("styleimagemissing",{id:y}));let x=this.images[y];x?m[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:t.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,m)}getPixelSize(){let{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){let h=this.patterns[s],m=this.getImage(s);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{let y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new t.ImagePosition(y,m);this.patterns[s]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){let h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(s,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){let s=[];for(let x in this.patterns)s.push(this.patterns[x].bin);let{w:h,h:m}=t.potpack(s),y=this.atlasImage;y.resize({width:h||1,height:m||1});for(let x in this.patterns){let{bin:T}=this.patterns[x],E=T.x+1,A=T.y+1,R=this.images[x].data,q=R.width,F=R.height;t.RGBAImage.copy(R,y,{x:0,y:0},{x:E,y:A},{width:q,height:F}),t.RGBAImage.copy(R,y,{x:0,y:F-1},{x:E,y:A-1},{width:q,height:1}),t.RGBAImage.copy(R,y,{x:0,y:0},{x:E,y:A+F},{width:q,height:1}),t.RGBAImage.copy(R,y,{x:q-1,y:0},{x:E-1,y:A},{width:1,height:F}),t.RGBAImage.copy(R,y,{x:0,y:0},{x:E+q,y:A},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(let h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;let m=this.images[h];er(m)&&this.updateImage(h,m)}}}let Pt=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(d,s){return function([h,m,y]){let x=t.degToRad(m+90),T=t.degToRad(y);return{x:h*Math.cos(x)*Math.sin(T),y:h*Math.sin(x)*Math.sin(T),z:h*Math.cos(T),azimuthal:m,polar:y}}(d.expression.evaluate(s))}interpolate(d,s,h){return{x:t.number(d.x,s.x,h),y:t.number(d.y,s.y,h),z:t.number(d.z,s.z,h),azimuthal:t.number(d.azimuthal,s.azimuthal,h),polar:t.number(d.polar,s.polar,h)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)});class Or extends t.Evented{constructor(s){super(),this._transitionable=new t.Transitionable(Pt),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(t.validateLight,s,h))for(let m in s){let y=s[m];t.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,m){return(!m||m.validate!==!1)&&t.emitValidationErrors(this,s.call(t.validateStyle,t.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}let vr=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)}),di=class extends t.Evented{constructor(d,s){super(),this._transitionable=new t.Transitionable(vr),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(d){for(let s in d){let h=d[s];t.endsWith(s,"-transition")?this._transitionable.setTransition(s.slice(0,-11),h):this._transitionable.setValue(s,h)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function xi(d,s,h,m){let y=t.smoothstep(45,65,h),[x,T]=qe(d,m),E=t.length(s),A=1-Math.min(1,Math.exp((E-x)/(T-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*y*d.alpha}function qe(d,s){let h=.5/Math.tan(.5*s);return[d.range[0]+h,d.range[1]+h]}let Ne=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"high-color":new t.DataConstantProperty(t.spec.fog["high-color"]),"space-color":new t.DataConstantProperty(t.spec.fog["space-color"]),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"]),"star-intensity":new t.DataConstantProperty(t.spec.fog["star-intensity"])});class Fe extends t.Evented{constructor(s,h){super(),this._transitionable=new t.Transitionable(Ne),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){let s=this._transform,h=s.projection.name==="globe",m=t.globeToMercatorTransition(s.zoom),y=this.properties.get("range"),x=[.5,3];return{range:h?[t.number(x[0],y[0],m),t.number(x[1],y[1],m)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h={}){if(!this._validate(t.validateFog,s,h)){for(let m of Object.keys(t.spec.fog))s&&s[m]===void 0&&(s[m]=t.spec.fog[m].default);for(let m in s){let y=s[m];t.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.smoothstep(45,65,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(m,y,x){let T=t.MercatorCoordinate.fromLngLat(y),E=x.elevation?x.elevation.getAtPointOrZero(T):0,A=[T.x,T.y,E];return t.transformMat4(A,A,x.mercatorFogMatrix),xi(m,A,x.pitch,x._fov)}(this.state,s,h):0}getFovAdjustedRange(s){return this._transform.projection.supportsFog?qe(this.state,s):[0,1]}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,m){return(!m||m.validate!==!1)&&t.emitValidationErrors(this,s.call(t.validateStyle,t.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class Le{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=t.uniqueId();let m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){let x=new Le.Actor(m[y],h,this.id);x.name=`Worker ${y}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,h,m){t.asyncAll(this.actors,(y,x)=>{y.send(s,h,x)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ke(d,s,h){return s*(t.EXTENT/(d.tileSize*Math.pow(2,h-d.tileID.overscaledZ)))}Le.Actor=t.Actor;class gt{constructor(s,h,m,y){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(s,h){let m,y;if(s instanceof t.Point||typeof s[0]=="number"){let x=t.Point.convert(s);m=[x],y=h.isPointAboveHorizon(x)}else{let x=t.Point.convert(s[0]),T=t.Point.convert(s[1]);m=[x,T],y=t.polygonizeBounds(x,T).every(E=>h.isPointAboveHorizon(E))}return new gt(m,h.getCameraPoint(),y,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return t.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){let h=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new t.Point(1,1)):this.screenBounds[1],y=t.polygonizeBounds(h,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(y[3]=this.cameraPoint)),t.bufferConvexPolygon(y,s)}bufferedCameraGeometryGlobe(s){let h=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new t.Point(1,1)):this.screenBounds[1],y=t.polygonizeBounds(h,m,s),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>m.y))+((x.x>h.x)+(x.x>m.x))){case 0:y[0]=x,y[4]=x.clone();break;case 1:y.splice(1,0,x);break;case 2:y[1]=x;break;case 3:y.splice(4,0,x);break;case 5:y.splice(2,0,x);break;case 6:y[3]=x;break;case 7:y.splice(3,0,x);break;case 8:y[2]=x}return y}containsTile(s,h,m,y=0){let x=s.queryPadding/h._pixelsPerMercatorPixel+1,T=m?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),E=s.tileID.wrap+(T.unwrapped?y:0),A=T.polygon.map(K=>t.getTilePoint(s.tileTransform,K,E));if(!t.polygonIntersectsBox(A,0,0,t.EXTENT,t.EXTENT))return;E=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);let R=this.screenGeometryMercator.polygon.map(K=>t.getTileVec3(s.tileTransform,K,E)),q=R.map(K=>new t.Point(K[0],K[1])),F=h.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),$=t.getTileVec3(s.tileTransform,F,E),Z=R.map(K=>{let N=t.sub(K,K,$);return t.normalize(N,N),new t.Ray($,N)}),X=Ke(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:q,tilespaceRays:Z,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(H=t.getBounds(A),H.min.x=t.clamp(H.min.x,0,t.EXTENT),H.min.y=t.clamp(H.min.y,0,t.EXTENT),H.max.x=t.clamp(H.max.x,0,t.EXTENT),H.max.y=t.clamp(H.max.y,0,t.EXTENT),H),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:X};var H}_bufferedScreenMercator(s,h){let m=hr(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let y;return y=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(s,h){let m=hr(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let y;return y=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[m]=y,y}}_projectAndResample(s,h){let m=function(x,T){let E=t.multiply([],T.pixelMatrix,T.globeMatrix),A=[0,-t.GLOBE_RADIUS,0,1],R=[0,t.GLOBE_RADIUS,0,1],q=[0,0,0,1];t.transformMat4$1(A,A,E),t.transformMat4$1(R,R,E),t.transformMat4$1(q,q,E);let F=new t.Point(A[0]/A[3],A[1]/A[3]),$=new t.Point(R[0]/R[3],R[1]/R[3]),Z=t.polygonContainsPoint(x,F)&&A[3]<q[3],X=t.polygonContainsPoint(x,$)&&R[3]<q[3];if(!Z&&!X)return null;let H=function(fe,ve,ye){for(let Se=1;Se<fe.length;Se++){let Je=tr(ve.pointCoordinate3D(fe[Se-1]).x),we=tr(ve.pointCoordinate3D(fe[Se]).x);if(ye<0){if(Je<we)return{idx:Se,t:-Je/(we-1-Je)}}else if(we<Je)return{idx:Se,t:(1-Je)/(we+1-Je)}}return null}(x,T,Z?-1:1);if(!H)return null;let{idx:K,t:N}=H,W=K>1?vt(x.slice(0,K),T):[],Q=K<x.length?vt(x.slice(K),T):[];W=W.map(fe=>new t.Point(tr(fe.x),fe.y)),Q=Q.map(fe=>new t.Point(tr(fe.x),fe.y));let ee=[...W];ee.length===0&&ee.push(Q[Q.length-1]);let he=t.number(ee[ee.length-1].y,(Q.length===0?W[0]:Q[0]).y,N),de;return de=Z?[new t.Point(0,he),new t.Point(0,0),new t.Point(1,0),new t.Point(1,he)]:[new t.Point(1,he),new t.Point(1,1),new t.Point(0,1),new t.Point(0,he)],ee.push(...de),Q.length===0?ee.push(W[0]):ee.push(...Q),{polygon:ee.map(fe=>new t.MercatorCoordinate(fe.x,fe.y)),unwrapped:!1}}(s,h);if(m)return m;let y=function(x,T){let E=!1,A=-1/0,R=0;for(let F=0;F<x.length-1;F++)x[F].x>A&&(A=x[F].x,R=F);for(let F=0;F<x.length-1;F++){let $=(R+F)%(x.length-1),Z=x[$],X=x[$+1];Math.abs(Z.x-X.x)>.5&&(Z.x<X.x?(Z.x+=1,$===0&&(x[x.length-1].x+=1)):(X.x+=1,$+1===x.length-1&&(x[0].x+=1)),E=!0)}let q=t.mercatorXfromLng(T.center.lng);return E&&q<Math.abs(q-1)&&x.forEach(F=>{F.x-=1}),{polygon:x,unwrapped:E}}(vt(s,h).map(x=>new t.Point(tr(x.x),x.y)),h);return{polygon:y.polygon.map(x=>new t.MercatorCoordinate(x.x,x.y)),unwrapped:y.unwrapped}}}function vt(d,s){return t.resample(d,h=>{let m=s.pointCoordinate3D(h);h.x=m.x,h.y=m.y},1/256)}function tr(d){return d<0?1+d%1:d%1}function hr(d){return 100*d|0}function Dr(d,s,h,m,y){let x=function(T,E){if(T)return y(T);if(E){d.url&&E.tiles&&d.tiles&&delete d.tiles;let A=t.pick(t.extend(E,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(A.vectorLayers=E.vector_layers,A.vectorLayerIds=A.vectorLayers.map(R=>R.id)),A.tiles=s.canonicalizeTileset(A,d.url),y(null,A)}};return d.url?t.getJSON(s.transformRequest(s.normalizeSourceURL(d.url,null,h,m),t.ResourceType.Source),x):t.exported.frame(()=>x(null,d))}class Yr{constructor(s,h,m){this.bounds=t.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){let h=Math.pow(2,s.z),m=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*h),y=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*h),x=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*h),T=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=m&&s.x<x&&s.y>=y&&s.y<T}}class yi{constructor(s,h,m){this.context=s;let y=s.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){let h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Un={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class vn{constructor(s,h,m,y){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=s;let x=s.gl;this.buffer=x.createBuffer(),s.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let m=0;m<this.attributes.length;m++){let y=h.attributes[this.attributes[m].name];y!==void 0&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,h,m){for(let y=0;y<this.attributes.length;y++){let x=this.attributes[y],T=h.attributes[x.name];T!==void 0&&s.vertexAttribPointer(T,x.components,s[Un[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bs extends zt{getDefault(){return t.Color.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class sn extends zt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Pl extends zt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class jr extends zt{getDefault(){return[!0,!0,!0,!0]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class xn extends zt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class ic extends zt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Eo extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){let h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class ln extends zt{getDefault(){let s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Ml extends zt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class ws extends zt{getDefault(){return[0,1]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class ql extends zt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class ia extends zt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ts extends zt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class nc extends zt{getDefault(){let s=this.gl;return[s.ONE,s.ZERO]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class oc extends zt{getDefault(){return t.Color.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class bn extends zt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class na extends zt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Rl extends zt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Da extends zt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let Es,Dl=class extends zt{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class La extends zt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class oa extends zt{getDefault(){let s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ka extends zt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Ba extends zt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ss extends zt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class ac extends zt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class oe extends zt{getDefault(){return null}set(s){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class j extends zt{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class V extends zt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class te extends zt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ce extends zt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class _e extends zt{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class be extends _e{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class xe extends _e{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class me extends xe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Pe{constructor(s,h,m,y){this.context=s,this.width=h,this.height=m;let x=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new be(s,x),y&&(this.depthAttachment=new xe(s,x))}destroy(){let s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){let m=this.depthAttachment.get();m&&s.deleteRenderbuffer(m)}s.deleteFramebuffer(this.framebuffer)}}class at{constructor(s,h=!1){if(this.gl=s,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){let m=s;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(s),deleteVertexArrayOES:m.deleteVertexArray.bind(s),bindVertexArrayOES:m.bindVertexArray.bind(s)}}this.clearColor=new bs(this),this.clearDepth=new sn(this),this.clearStencil=new Pl(this),this.colorMask=new jr(this),this.depthMask=new xn(this),this.stencilMask=new ic(this),this.stencilFunc=new Eo(this),this.stencilOp=new ln(this),this.stencilTest=new Ml(this),this.depthRange=new ws(this),this.depthTest=new ql(this),this.depthFunc=new ia(this),this.blend=new Ts(this),this.blendFunc=new nc(this),this.blendColor=new oc(this),this.blendEquation=new bn(this),this.cullFace=new na(this),this.cullFaceSide=new Rl(this),this.frontFace=new Da(this),this.program=new Dl(this),this.activeTexture=new La(this),this.viewport=new oa(this),this.bindFramebuffer=new ka(this),this.bindRenderbuffer=new Ba(this),this.bindTexture=new Ss(this),this.bindVertexBuffer=new ac(this),this.bindElementBuffer=new oe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new j(this),this.pixelStoreUnpack=new V(this),this.pixelStoreUnpackPremultiplyAlpha=new te(this),this.pixelStoreUnpackFlipY=new ce(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=s.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&s.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||s.getExtension("OES_standard_derivatives"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new yi(this,s,h)}createVertexBuffer(s,h,m){return new vn(this,s,h,m)}createRenderbuffer(s,h,m){let y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,s,h,m),this.bindRenderbuffer.set(null),x}createFramebuffer(s,h,m){return new Pe(this,s,h,m)}clear({color:s,depth:h,stencil:m}){let y=this.gl,x=0;s&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(x)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){v(s.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class st extends t.Evented{constructor(s,h,m,y){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(h,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(s){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=Dr(this._options,this.map._requestManager,h,m,(y,x)=>{this._tileJSONRequest=null,this._loaded=!0,y?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new t.ErrorEvent(y))):x&&(t.extend(this,x),x.bounds&&(this.tileBounds=new Yr(x.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(y)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.extend({},this._options)}loadTile(s,h){let m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(m,t.ResourceType.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",y,x.bind(this));else if(s.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",y,x.bind(this),void 0,!0);else{let T=t.loadVectorTile.call({deduped:this._deduped},y,(E,A)=>{E||!A?x.call(this,E):(y.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},s.actor&&s.actor.send("loadTile",y,x.bind(this),void 0,!0))},!0);s.request={cancel:T}}function x(T,E){return delete s.request,s.aborted?h(null):T&&T.status!==404?h(T):(E&&E.resourceTiming&&(s.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&s.setExpiryData(E),s.loadVectorData(E,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id})}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class it extends t.Evented{constructor(s,h,m,y){super(),this.id=s,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},h),t.extend(this,t.pick(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Dr(this._options,this.map._requestManager,null,null,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new t.ErrorEvent(h)):m&&(t.extend(this,m),m.bounds&&(this.tileBounds=new Yr(m.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(m.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(h)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){let m=t.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=t.getImage(this.map._requestManager.transformRequest(y,t.ResourceType.Tile),(x,T,E,A)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):x?(s.state="errored",h(x)):T?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:E,expires:A}),s.setTexture(T,this.map.painter),s.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(s,h,m){s.setTexture(h,m)}static unloadTileData(s,h){s.texture&&h.saveTileTexture(s.texture)}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ft(d,s,h,m,y,x,T,E){let A=[d,h,y,s,m,x,1,1,1],R=[T,E,1],q=t.adjoint([],A),[F,$,Z]=t.transformMat3(R,R,t.transpose(q,q));return t.multiply$1(A,[F,0,0,0,$,0,0,0,Z],A)}class $t extends t.Evented{constructor(s,h,m,y){super(),this.id=s,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h,this._dirty=!1}load(s,h){this._loaded=h||!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(m,y)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new t.ErrorEvent(m));else if(y){let{HTMLImageElement:x}=t.window;this.image=y instanceof x?t.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading()}})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(s){this.coordinates=s,this._boundsArray=void 0;let h=s.map(t.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,x=1/0,T=-1/0,E=-1/0;for(let F of m)y=Math.min(y,F.x),x=Math.min(x,F.y),T=Math.max(T,F.x),E=Math.max(E,F.y);let A=Math.max(T-y,E-x),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),q=Math.pow(2,R);return new t.CanonicalTileID(R,Math.floor((y+T)/2*q),Math.floor((x+E)/2*q))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(s){for(let A in this.tiles){let R=this.tiles[A];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;let h=t.tileTransform(this.tileID,this.map.transform.projection),[m,y,x,T]=this.coordinates.map(A=>{let R=h.projection.project(A[0],A[1]);return t.getTilePoint(h,R)._round()});this.perspectiveTransform=function(A,R,q,F,$,Z,X,H,K,N){let W=Ft(0,0,A,0,0,R,A,R),Q=Ft(q,F,$,Z,X,H,K,N);return t.multiply$1(Q,t.adjoint(W,W),Q),[Q[6]/Q[8]*A/t.EXTENT,Q[7]/Q[8]*R/t.EXTENT]}(this.width,this.height,m.x,m.y,y.x,y.y,T.x,T.y,x.x,x.y);let E=this._boundsArray=new t.StructArrayLayout4i8;E.emplaceBack(m.x,m.y,0,0),E.emplaceBack(y.x,y.y,t.EXTENT,0),E.emplaceBack(T.x,T.y,0,t.EXTENT),E.emplaceBack(x.x,x.y,t.EXTENT,t.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=s.createVertexBuffer(E,t.boundsAttributes.members),this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let s=this.map.painter.context,h=s.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new t.Texture(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(s)}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}let Nt={vector:st,raster:it,"raster-dem":class extends it{constructor(d,s,h,m){super(d,s,h,m),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(d,s){let h=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,x){y&&(d.state="errored",s(y)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",s(null))}d.request=t.getImage(this.map._requestManager.transformRequest(h,t.ResourceType.Tile),(function(y,x,T,E){if(delete d.request,d.aborted)d.state="unloaded",s(null);else if(y)d.state="errored",s(y);else if(x){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:T,expires:E});let A=t.window.ImageBitmap&&x instanceof t.window.ImageBitmap&&(Es==null&&(Es=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&typeof t.window.createImageBitmap=="function"),Es),R=1-(x.width-t.prevPowerOfTwo(x.width))/2;R<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let q=A?x:t.exported.getImageData(x,R),F={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:q,encoding:this.encoding,padding:R};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",F,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){let s=d.canonical,h=Math.pow(2,s.z),m=(s.x-1+h)%h,y=s.x===0?d.wrap-1:d.wrap,x=(s.x+1+h)%h,T=s.x+1===h?d.wrap+1:d.wrap,E={};return E[new t.OverscaledTileID(d.overscaledZ,y,s.z,m,s.y).key]={backfilled:!1},E[new t.OverscaledTileID(d.overscaledZ,T,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(E[new t.OverscaledTileID(d.overscaledZ,y,s.z,m,s.y-1).key]={backfilled:!1},E[new t.OverscaledTileID(d.overscaledZ,d.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new t.OverscaledTileID(d.overscaledZ,T,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<h&&(E[new t.OverscaledTileID(d.overscaledZ,y,s.z,m,s.y+1).key]={backfilled:!1},E[new t.OverscaledTileID(d.overscaledZ,d.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new t.OverscaledTileID(d.overscaledZ,T,s.z,x,s.y+1).key]={backfilled:!1}),E}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends t.Evented{constructor(d,s,h,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(m),this._data=s.data,this._options=t.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;let y=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*y,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*y,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:t.EXTENT,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*y,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},s),this}getClusterChildren(d,s){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},s),this}getClusterLeaves(d,s,h,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:s,offset:h},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;let d=t.extend({},this.workerOptions),s=this._data;typeof s=="string"?(d.request=this.map._requestManager.transformRequest(t.exported.resolveURL(s),t.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(h,m)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new t.ErrorEvent(h));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new t.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,s){let h=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(h,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete d.request,d.unloadVectorData(),d.aborted?s(null):m?s(m):(d.loadVectorData(y,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends $t{constructor(d,s,h,m){super(d,s,h,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let s of d.urls)this.urls.push(this.map._requestManager.transformRequest(s,t.ResourceType.Source).url);t.getVideo(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new t.ErrorEvent(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let s=this.video.seekable;d<s.start(0)||d>s.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,s=d.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(d,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:$t,canvas:class extends $t{constructor(d,s,h,m){super(d,s,h,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(x=>typeof x!="number"))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let s=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends t.Evented{constructor(d,s,h,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Yr(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),t.extend(this,t.pick(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:s,y:h,z:m}=d.canonical;return this._implementation.hasTile({x:s,y:h,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,s){let{x:h,y:m,z:y}=d.tileID.canonical,x=new t.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:h,y:m,z:y},{signal:x.signal})).then((function(T){return delete d.request,d.aborted?(d.state="unloaded",s(null)):T===void 0?(d.state="errored",s(null)):T===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",s(null)):function(E){return E instanceof t.window.ImageData||E instanceof t.window.HTMLCanvasElement||E instanceof t.window.ImageBitmap||E instanceof t.window.HTMLImageElement}(T)?(this.loadTileData(d,T),d.state="loaded",void s(null)):(d.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(d.state="errored",s(T))}),d.request.cancel=()=>x.abort()}loadTileData(d,s){it.loadTileData(d,s,this._map.painter)}unloadTileData(d){it.unloadTileData(d,this._map.painter)}unloadTile(d,s){if(this.unloadTileData(d),this._implementation.unloadTile){let{x:h,y:m,z:y}=d.tileID.canonical;this._implementation.unloadTile({x:h,y:m,z:y})}s()}abortTile(d,s){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Gt=function(d,s,h,m){let y=new Nt[s.type](d,s,h,m);if(y.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${y.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],y),y};function Jt(d,s){let h=t.identity([]);return t.scale(h,h,[.5*d.width,.5*-d.height,1]),t.translate(h,h,[1,-1,0]),t.multiply(h,h,d.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function Vr(d,s,h,m,y,x,T,E=!1){let A=d.tilesIn(m,T,E);A.sort(Di);let R=[];for(let F of A)R.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(s,h,d._state,F,y,x,Jt(d.transform,F.tile.tileID),E)});let q=function(F){let $={},Z={};for(let X of F){let H=X.queryResults,K=X.wrappedTileID,N=Z[K]=Z[K]||{};for(let W in H){let Q=H[W],ee=N[W]=N[W]||{},he=$[W]=$[W]||[];for(let de of Q)ee[de.featureIndex]||(ee[de.featureIndex]=!0,he.push(de))}}return $}(R);for(let F in q)q[F].forEach($=>{let Z=$.feature,X=Z.layer;X&&X.type!=="background"&&X.type!=="sky"&&(Z.source=X.source,X["source-layer"]&&(Z.sourceLayer=X["source-layer"]),Z.state=Z.id!==void 0?d.getFeatureState(X["source-layer"],Z.id):{})});return q}function ii(d,s){let h=d.getRenderableIds().map(x=>d.getTileByID(x)),m=[],y={};for(let x=0;x<h.length;x++){let T=h[x],E=T.tileID.canonical.key;y[E]||(y[E]=!0,T.querySourceFeatures(m,s))}return m}function Di(d,s){let h=d.tileID,m=s.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}function pi(){return $s.workerClass!=null?new $s.workerClass:new t.window.Worker($s.workerUrl)}let Qn="mapboxgl_preloaded_worker_pool";class bi{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<bi.workerCount;)this.workers.push(new pi);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Qn]}numActive(){return Object.keys(this.active).length}}let Vi;function Is(){return Vi||(Vi=new bi),Vi}function W0(d,s){let h={};for(let m in d)m!=="ref"&&(h[m]=d[m]);return t.refProperties.forEach(m=>{m in s&&(h[m]=s[m])}),h}function o_(d){d=d.slice();let s=Object.create(null);for(let h=0;h<d.length;h++)s[d[h].id]=d[h];for(let h=0;h<d.length;h++)"ref"in d[h]&&(d[h]=W0(d[h],s[d[h].ref]));return d}bi.workerCount=2;let fr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Rf(d,s,h){h.push({command:fr.addSource,args:[d,s[d]]})}function Ll(d,s,h){s.push({command:fr.removeSource,args:[d]}),h[d]=!0}function Df(d,s,h,m){Ll(d,h,m),Rf(d,s,h)}function sc(d,s,h){let m;for(m in d[h])if(d[h].hasOwnProperty(m)&&m!=="data"&&!v(d[h][m],s[h][m]))return!1;for(m in s[h])if(s[h].hasOwnProperty(m)&&m!=="data"&&!v(d[h][m],s[h][m]))return!1;return!0}function eo(d,s,h,m,y,x){let T;for(T in s=s||{},d=d||{})d.hasOwnProperty(T)&&(v(d[T],s[T])||h.push({command:x,args:[m,T,s[T],y]}));for(T in s)s.hasOwnProperty(T)&&!d.hasOwnProperty(T)&&(v(d[T],s[T])||h.push({command:x,args:[m,T,s[T],y]}))}function So(d){return d.id}function Lf(d,s){return d[s.id]=s,d}class kf{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=t.clamp(s,0,1);let h=1,m=this._distances[h],y=s*this.paddedLength+this.padding;for(;m<y&&h<this._distances.length;)m=this._distances[++h];let x=h-1,T=this._distances[x],E=m-T,A=E>0?(y-T)/E:0;return this.points[x].mult(1-A).add(this.points[h].mult(A))}}class za{constructor(s,h,m){let y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(h/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,m,y,x){this._forEachCell(h,m,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(s,h,m,y){this._forEachCell(h-y,m-y,h+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(m),this.circles.push(y)}_insertBoxCell(s,h,m,y,x,T){this.boxCells[x].push(T)}_insertCircleCell(s,h,m,y,x,T){this.circleCells[x].push(T)}_query(s,h,m,y,x,T){if(m<0||s>this.width||y<0||h>this.height)return!x&&[];let E=[];if(s<=0&&h<=0&&this.width<=m&&this.height<=y){if(x)return!0;for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let R=this.circles[3*A],q=this.circles[3*A+1],F=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:R-F,y1:q-F,x2:R+F,y2:q+F})}return T?E.filter(T):E}return this._forEachCell(s,h,m,y,this._queryCell,E,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?E.length>0:E}_queryCircle(s,h,m,y,x){let T=s-m,E=s+m,A=h-m,R=h+m;if(E<0||T>this.width||R<0||A>this.height)return!y&&[];let q=[];return this._forEachCell(T,A,E,R,this._queryCellCircle,q,{hitTest:y,circle:{x:s,y:h,radius:m},seenUids:{box:{},circle:{}}},x),y?q.length>0:q}query(s,h,m,y,x){return this._query(s,h,m,y,!1,x)}hitTest(s,h,m,y,x){return this._query(s,h,m,y,!0,x)}hitTestCircle(s,h,m,y){return this._queryCircle(s,h,m,!0,y)}_queryCell(s,h,m,y,x,T,E,A){let R=E.seenUids,q=this.boxCells[x];if(q!==null){let $=this.bboxes;for(let Z of q)if(!R.box[Z]){R.box[Z]=!0;let X=4*Z;if(s<=$[X+2]&&h<=$[X+3]&&m>=$[X+0]&&y>=$[X+1]&&(!A||A(this.boxKeys[Z]))){if(E.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Z],x1:$[X],y1:$[X+1],x2:$[X+2],y2:$[X+3]})}}}let F=this.circleCells[x];if(F!==null){let $=this.circles;for(let Z of F)if(!R.circle[Z]){R.circle[Z]=!0;let X=3*Z;if(this._circleAndRectCollide($[X],$[X+1],$[X+2],s,h,m,y)&&(!A||A(this.circleKeys[Z]))){if(E.hitTest)return T.push(!0),!0;{let H=$[X],K=$[X+1],N=$[X+2];T.push({key:this.circleKeys[Z],x1:H-N,y1:K-N,x2:H+N,y2:K+N})}}}}}_queryCellCircle(s,h,m,y,x,T,E,A){let R=E.circle,q=E.seenUids,F=this.boxCells[x];if(F!==null){let Z=this.bboxes;for(let X of F)if(!q.box[X]){q.box[X]=!0;let H=4*X;if(this._circleAndRectCollide(R.x,R.y,R.radius,Z[H+0],Z[H+1],Z[H+2],Z[H+3])&&(!A||A(this.boxKeys[X])))return T.push(!0),!0}}let $=this.circleCells[x];if($!==null){let Z=this.circles;for(let X of $)if(!q.circle[X]){q.circle[X]=!0;let H=3*X;if(this._circlesCollide(Z[H],Z[H+1],Z[H+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[X])))return T.push(!0),!0}}}_forEachCell(s,h,m,y,x,T,E,A){let R=this._convertToXCellCoord(s),q=this._convertToYCellCoord(h),F=this._convertToXCellCoord(m),$=this._convertToYCellCoord(y);for(let Z=R;Z<=F;Z++)for(let X=q;X<=$;X++)if(x.call(this,s,h,m,y,this.xCellCount*X+Z,T,E,A))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,m,y,x,T){let E=y-s,A=x-h,R=m+T;return R*R>E*E+A*A}_circleAndRectCollide(s,h,m,y,x,T,E){let A=(T-y)/2,R=Math.abs(s-(y+A));if(R>A+m)return!1;let q=(E-x)/2,F=Math.abs(h-(x+q));if(F>q+m)return!1;if(R<=A||F<=q)return!0;let $=R-A,Z=F-q;return $*$+Z*Z<=m*m}}let Io={unknown:0,flipRequired:1,flipNotRequired:2},kl=Math.tan(85*Math.PI/180);function Re(d,s,h,m,y,x,T){let E=t.create();if(h)if(x.name==="globe"){let A=t.calculateGlobeLabelMatrix(y,s);t.multiply(E,E,A)}else{let A=Ve([],T);E[0]=A[0],E[1]=A[1],E[4]=A[2],E[5]=A[3],m||t.rotateZ(E,E,y.angle)}else t.multiply(E,y.labelPlaneMatrix,d);return E}function Ao(d,s,h,m,y,x,T){let E=Re(d,s,h,m,y,x,T);return x.name==="globe"&&h||(E[2]=E[6]=E[10]=E[14]=0),E}function ni(d,s,h,m,y,x,T){if(h){if(x.name==="globe"){let E=Re(d,s,h,m,y,x,T);return t.invert(E,E),t.multiply(E,d,E),E}{let E=t.clone(d),A=t.identity([]);return A[0]=T[0],A[1]=T[1],A[4]=T[2],A[5]=T[3],t.multiply(E,E,A),m||t.rotateZ(E,E,-y.angle),E}}return y.glCoordMatrix}function wi(d,s,h,m){let y=[d,s,h,1];h?t.transformMat4$1(y,y,m):Ht(y,y,m);let x=y[3];return y[0]/=x,y[1]/=x,y[2]/=x,y}function a_(d,s){return Math.min(.5+d/s*.5,1.5)}function to(d,s){let h=d[0]/d[3],m=d[1]/d[3];return h>=-s[0]&&h<=s[0]&&m>=-s[1]&&m<=s[1]}function Bf(d,s,h,m,y,x,T,E,A,R){let q=h.transform,F=m?d.textSizeData:d.iconSizeData,$=t.evaluateSizeForZoom(F,h.transform.zoom),Z=q.projection.name==="globe",X=[256/h.width*2+1,256/h.height*2+1],H=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;H.clear();let K=null;Z&&(K=m?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);let N=d.lineVertexArray,W=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,Q=h.transform.width/h.transform.height,ee,he=!1;for(let de=0;de<W.length;de++){let fe=W.get(de),{numGlyphs:ve,writingMode:ye}=fe;if(ye!==t.WritingMode.vertical||he||ee===t.WritingMode.horizontal||(he=!0),ee=ye,(fe.hidden||ye===t.WritingMode.vertical)&&!he){jn(ve,H);continue}he=!1;let Se=new t.Point(fe.tileAnchorX,fe.tileAnchorY),{x:Je,y:we,z:ze}=q.projection.projectTilePoint(Se.x,Se.y,R.canonical);if(A){let[Rt,xt,Ot]=A(Se);Je+=Rt,we+=xt,ze+=Ot}let Oe=[Je,we,ze,1];if(t.transformMat4$1(Oe,Oe,s),!to(Oe,X)){jn(ve,H);continue}let Ye=a_(h.transform.cameraToCenterDistance,Oe[3]),Ee=t.evaluateSizeForFeature(F,$,fe),Be=T?Ee/Ye:Ee*Ye,et=wi(Je,we,ze,y);if(et[3]<=0){jn(ve,H);continue}let He={},rt=T?null:A,Tt=ft(fe,Be,!1,E,s,y,x,d.glyphOffsetArray,N,H,K,et,Se,He,Q,rt,q.projection,R,T);he=Tt.useVertical,rt&&Tt.needsFlipping&&(He={}),(Tt.notEnoughRoom||he||Tt.needsFlipping&&ft(fe,Be,!0,E,s,y,x,d.glyphOffsetArray,N,H,K,et,Se,He,Q,rt,q.projection,R,T).notEnoughRoom)&&jn(ve,H)}m?(d.text.dynamicLayoutVertexBuffer.updateData(H),K&&d.text.globeExtVertexBuffer.updateData(K)):(d.icon.dynamicLayoutVertexBuffer.updateData(H),K&&d.icon.globeExtVertexBuffer.updateData(K))}function s_(d,s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H){let{lineStartIndex:K,glyphStartIndex:N,segment:W}=E,Q=N+E.numGlyphs,ee=K+E.lineLength,he=s.getoffsetX(N),de=s.getoffsetX(Q-1),fe=un(d*he,h,m,y,x,T,W,K,ee,A,R,q,F,$,!0,Z,X,H);if(!fe)return null;let ve=un(d*de,h,m,y,x,T,W,K,ee,A,R,q,F,$,!0,Z,X,H);return ve?{first:fe,last:ve}:null}function As(d,s,h,m){return d===t.WritingMode.horizontal&&Math.abs(m)>Math.abs(h)?{useVertical:!0}:d===t.WritingMode.vertical?m>0?{needsFlipping:!0}:null:s!==Io.unknown&&function(y,x){return y===0||Math.abs(x/y)>kl}(h,m)?s===Io.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function ft(d,s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H,K,N,W){let Q=s/24,ee=d.lineOffsetX*Q,he=d.lineOffsetY*Q,{lineStartIndex:de,glyphStartIndex:fe,numGlyphs:ve,segment:ye,writingMode:Se,flipState:Je}=d,we=de+d.lineLength,ze=Oe=>{if(q){let[et,He,rt]=Oe.up,Tt=R.length;t.updateGlobeVertexNormal(q,Tt+0,et,He,rt),t.updateGlobeVertexNormal(q,Tt+1,et,He,rt),t.updateGlobeVertexNormal(q,Tt+2,et,He,rt),t.updateGlobeVertexNormal(q,Tt+3,et,He,rt)}let[Ye,Ee,Be]=Oe.point;t.addDynamicAttributes(R,Ye,Ee,Be,Oe.angle)};if(ve>1){let Oe=s_(Q,E,ee,he,h,F,$,d,A,x,Z,H,!1,K,N,W);if(!Oe)return{notEnoughRoom:!0};if(m&&!h){let[Ye,Ee,Be]=Oe.first.point,[et,He,rt]=Oe.last.point;[Ye,Ee]=wi(Ye,Ee,Be,T),[et,He]=wi(et,He,rt,T);let Tt=As(Se,Je,(et-Ye)*X,He-Ee);if(d.flipState=Tt&&Tt.needsFlipping?Io.flipRequired:Io.flipNotRequired,Tt)return Tt}ze(Oe.first);for(let Ye=fe+1;Ye<fe+ve-1;Ye++){let Ee=un(Q*E.getoffsetX(Ye),ee,he,h,F,$,ye,de,we,A,x,Z,H,!1,!1,K,N,W);if(!Ee)return R.length-=4*(Ye-fe),{notEnoughRoom:!0};ze(Ee)}ze(Oe.last)}else{if(m&&!h){let Ye=wi($.x,$.y,0,y),Ee=de+ye+1,Be=new t.Point(A.getx(Ee),A.gety(Ee)),et=wi(Be.x,Be.y,0,y),He=et[3]>0?et:Zt($,Be,Ye,1,y,void 0,K,N.canonical),rt=As(Se,Je,(He[0]-Ye[0])*X,He[1]-Ye[1]);if(d.flipState=rt&&rt.needsFlipping?Io.flipRequired:Io.flipNotRequired,rt)return rt}let Oe=un(Q*E.getoffsetX(fe),ee,he,h,F,$,ye,de,we,A,x,Z,H,!1,!1,K,N,W);if(!Oe)return{notEnoughRoom:!0};ze(Oe)}return{}}function Yt(d,s,h,m,y){let{x,y:T,z:E}=m.projectTilePoint(d.x,d.y,s);if(!y)return wi(x,T,E,h);let[A,R,q]=y(d);return wi(x+A,T+R,E+q,h)}function Zt(d,s,h,m,y,x,T,E){let A=Yt(d.sub(s)._unit()._add(d),E,y,T,x);return t.sub(A,h,A),t.normalize(A,A),t.scaleAndAdd(A,h,A,m)}function un(d,s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H,K,N){let W=m?d-s:d+s,Q=W>0?1:-1,ee=0;m&&(Q*=-1,ee=Math.PI),Q<0&&(ee+=Math.PI);let he=E+T+(Q>0?0:1)|0,de=y,fe=y,ve=0,ye=0,Se=Math.abs(W),Je=[],we=[],ze=x,Oe=ze,Ye=()=>Zt(Oe,ze,fe,Se-ve+1,q,$,H,K.canonical);for(;ve+ye<=Se;){if(he+=Q,he<E||he>=A)return null;if(fe=de,Oe=ze,Je.push(fe),Z&&we.push(Oe),ze=new t.Point(R.getx(he),R.gety(he)),de=F[he],!de){let Ot=Yt(ze,K.canonical,q,H,$);de=Ot[3]>0?F[he]=Ot:Ye()}ve+=ye,ye=t.distance(fe,de)}X&&$&&(F[he]&&(de=Ye(),ye=t.distance(fe,de)),F[he]=de);let Ee=(Se-ve)/ye,Be=ze.sub(Oe)._mult(Ee)._add(Oe),et=t.sub([],de,fe),He=t.scaleAndAdd([],fe,et,Ee),rt=[0,0,1],Tt=et[0],Rt=et[1];if(N&&(rt=H.upVector(K.canonical,Be.x,Be.y),rt[0]!==0||rt[1]!==0||rt[2]!==1)){let Ot=[rt[2],0,-rt[0]],Xt=t.cross([],rt,Ot);t.normalize(Ot,Ot),t.normalize(Xt,Xt),Tt=t.dot(et,Ot),Rt=t.dot(et,Xt)}if(h){let Ot=t.cross([],rt,et);t.normalize(Ot,Ot),t.scaleAndAdd(He,He,Ot,h*Q)}let xt=ee+Math.atan2(Rt,Tt);return Je.push(He),Z&&we.push(Be),{point:He,angle:xt,path:Je,tilePath:we,up:rt}}function jn(d,s){let h=s.length,m=h+4*d;s.resize(m),s.float32.fill(-1/0,4*h,4*m)}function Ht(d,s,h){let m=s[0],y=s[1];return d[0]=h[0]*m+h[4]*y+h[12],d[1]=h[1]*m+h[5]*y+h[13],d[3]=h[3]*m+h[7]*y+h[15],d}let cn=100;class Bl{constructor(s,h,m=new za(s.width+200,s.height+200,25),y=new za(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+cn,this.screenBottomBoundary=s.height+cn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,m,y,x,T,E,A){let R=m.projectedAnchorX,q=m.projectedAnchorY,F=m.projectedAnchorZ,$=m.elevation,Z=m.tileID,X=s.getProjection();if($&&Z){let[de,fe,ve]=X.upVector(Z.canonical,m.tileAnchorX,m.tileAnchorY),ye=X.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=de*$*ye,q+=fe*$*ye,F+=ve*$*ye}let H=this.projectAndGetPerspectiveRatio(E,R,q,F,m.tileID,X.name==="globe"||!!$||this.transform.pitch>0,X),K=T*H.perspectiveRatio,N=(m.x1*h+y.x-m.padding)*K+H.point.x,W=(m.y1*h+y.y-m.padding)*K+H.point.y,Q=(m.x2*h+y.x+m.padding)*K+H.point.x,ee=(m.y2*h+y.y+m.padding)*K+H.point.y,he=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(N,W,Q,ee)||!x&&this.grid.hitTest(N,W,Q,ee,A)||he?{box:[],offscreen:!1,occluded:H.occluded}:{box:[N,W,Q,ee],offscreen:this.isOffscreen(N,W,Q,ee),occluded:!1}}placeCollisionCircles(s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H){let K=[],N=this.transform.elevation,W=s.getProjection(),Q=N?N.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,W):null,ee=new t.Point(m.tileAnchorX,m.tileAnchorY),{x:he,y:de,z:fe}=W.projectTilePoint(ee.x,ee.y,H.canonical);if(Q){let[Be,et,He]=Q(ee);he+=Be,de+=et,fe+=He}let ve=W.name==="globe",ye=this.projectAndGetPerspectiveRatio(E,he,de,fe,H,ve||!!N||this.transform.pitch>0,W),{perspectiveRatio:Se}=ye,Je=(F?T/Se:T*Se)/t.ONE_EM,we=wi(he,de,fe,A),ze=ye.signedDistanceFromCamera>0?s_(Je,x,m.lineOffsetX*Je,m.lineOffsetY*Je,!1,we,ee,m,y,A,{},N&&!F?Q:null,F&&!!N,W,H,F):null,Oe=!1,Ye=!1,Ee=!0;if(ze&&!ye.occluded){let Be=.5*Z*Se+X,et=new t.Point(-100,-100),He=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),rt=new kf,{first:Tt,last:Rt}=ze,xt=Tt.path.length,Ot=[];for(let wt=xt-1;wt>=1;wt--)Ot.push(Tt.path[wt]);for(let wt=1;wt<Rt.path.length;wt++)Ot.push(Rt.path[wt]);let Xt=2.5*Be;R&&(Ot=Ot.map(([wt,mr,xr],br)=>(Q&&!ve&&(xr=Q(br<xt-1?Tt.tilePath[xt-1-br]:Rt.tilePath[br-xt+2])[2]),wi(wt,mr,xr,R))),Ot.some(wt=>wt[3]<=0)&&(Ot=[]));let Wt=[];if(Ot.length>0){let wt=1/0,mr=-1/0,xr=1/0,br=-1/0;for(let wr of Ot)wt=Math.min(wt,wr[0]),xr=Math.min(xr,wr[1]),mr=Math.max(mr,wr[0]),br=Math.max(br,wr[1]);mr>=et.x&&wt<=He.x&&br>=et.y&&xr<=He.y&&(Wt=[Ot.map(wr=>new t.Point(wr[0],wr[1]))],(wt<et.x||mr>He.x||xr<et.y||br>He.y)&&(Wt=t.clipLine(Wt,et.x,et.y,He.x,He.y)))}for(let wt of Wt){rt.reset(wt,.25*Be);let mr=0;mr=rt.length<=.5*Be?1:Math.ceil(rt.paddedLength/Xt)+1;for(let xr=0;xr<mr;xr++){let br=xr/Math.max(mr-1,1),wr=rt.lerp(br),ki=wr.x+cn,Ei=wr.y+cn;K.push(ki,Ei,Be,0);let In=ki-Be,oo=Ei-Be,Nr=ki+Be,Tr=Ei+Be;if(Ee=Ee&&this.isOffscreen(In,oo,Nr,Tr),Ye=Ye||this.isInsideGrid(In,oo,Nr,Tr),!h&&this.grid.hitTestCircle(ki,Ei,Be,$)&&(Oe=!0,!q))return{circles:[],offscreen:!1,collisionDetected:Oe,occluded:!1}}}}return{circles:!q&&Oe||!Ye?[]:K,offscreen:Ee,collisionDetected:Oe,occluded:ye.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],m=1/0,y=1/0,x=-1/0,T=-1/0;for(let q of s){let F=new t.Point(q.x+cn,q.y+cn);m=Math.min(m,F.x),y=Math.min(y,F.y),x=Math.max(x,F.x),T=Math.max(T,F.y),h.push(F)}let E=this.grid.query(m,y,x,T).concat(this.ignoredGrid.query(m,y,x,T)),A={},R={};for(let q of E){let F=q.key;if(A[F.bucketInstanceId]===void 0&&(A[F.bucketInstanceId]={}),A[F.bucketInstanceId][F.featureIndex])continue;let $=[new t.Point(q.x1,q.y1),new t.Point(q.x2,q.y1),new t.Point(q.x2,q.y2),new t.Point(q.x1,q.y2)];t.polygonIntersectsPolygon(h,$)&&(A[F.bucketInstanceId][F.featureIndex]=!0,R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]=[]),R[F.bucketInstanceId].push(F.featureIndex))}return R}insertCollisionBox(s,h,m,y,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,m,y,x){let T=h?this.ignoredGrid:this.grid,E={bucketInstanceId:m,featureIndex:y,collisionGroupID:x};for(let A=0;A<s.length;A+=4)T.insertCircle(E,s[A],s[A+1],s[A+2])}projectAndGetPerspectiveRatio(s,h,m,y,x,T,E){let A=[h,m,y,1],R=!1;y||this.transform.pitch>0?(t.transformMat4$1(A,A,s),this.fogState&&x&&E.name!=="globe"&&(R=function($,Z,X,H,K,N){let W=N.calculateFogTileMatrix(K),Q=[Z,X,H];return t.transformMat4(Q,Q,W),xi($,Q,N.pitch,N._fov)}(this.fogState,h,m,y,x.toUnwrapped(),this.transform)>.9)):Ht(A,A,s);let q=A[3];return{point:new t.Point((A[0]/q+1)/2*this.transform.width+cn,(-A[1]/q+1)/2*this.transform.height+cn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/q*.5,1.5),signedDistanceFromCamera:q,occluded:T&&A[2]>q||R}}isOffscreen(s,h,m,y){return m<cn||s>=this.screenRightBoundary||y<cn||h>this.screenBottomBoundary}isInsideGrid(s,h,m,y){return m>=0&&s<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let s=t.identity([]);return t.translate(s,s,[-100,-100,0]),s}}function Fa(d,s,h){let m=s.createTileMatrix(d,d.worldSize,h.toUnwrapped());return t.multiply(new Float32Array(16),d.projMatrix,m)}function wn(d,s,h){if(s.projection.name===h.projection.name)return d.projMatrix;let m=h.clone();return m.setProjection(s.projection),Fa(m,s.getProjection(),d)}function Fr(d,s,h){return s.name===h.projection.name?d.projMatrix:Fa(h,s,d)}class l_{constructor(s,h,m,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Oo{constructor(s,h,m,y,x,T=!1){this.text=new l_(s?s.text:null,h,m,x),this.icon=new l_(s?s.icon:null,h,y,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zl{constructor(s,h,m,y=!1){this.text=s,this.icon=h,this.skipFade=m,this.clipped=y}}class Fl{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class zf{constructor(s,h,m,y,x){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=x}}class u_{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){let h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[s]}}function Nl(d,s,h,m,y){let{horizontalAlign:x,verticalAlign:T}=t.getAnchorAlignment(d),E=-(x-.5)*s,A=-(T-.5)*h,R=t.evaluateVariableOffset(d,m);return new t.Point(E+R[0]*y,A+R[1]*y)}function Ul(d,s,h,m,y){let x=new t.Point(d,s);return h&&x._rotate(m?y:-y),x}class lc{constructor(s,h,m,y,x){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Bl(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new u_(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,m,y){let x=m.getBucket(h),T=m.latestFeatureIndex;if(!x||!T||h.id!==x.layerIds[0])return;let E=x.layers[0].layout,A=m.collisionBoxArray,R=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),q=m.tileSize/t.EXTENT,F=m.tileID.toUnwrapped();this.transform.setProjection(x.projection);let $=(Z=m.tileID,X=x.getProjection(),H=this.transform,X.name===this.projection?H.calculateProjMatrix(Z.toUnwrapped()):Fa(H,X,Z));var Z,X,H;let K=E.get("text-pitch-alignment")==="map",N=E.get("text-rotation-alignment")==="map";h.compileFilter();let W=h.dynamicFilter(),Q=h.dynamicFilterNeedsFeature(),ee=this.transform.calculatePixelsToTileUnitsMatrix(m),he=Ao($,m.tileID.canonical,K,N,this.transform,x.getProjection(),ee),de=null;if(K){let ye=ni($,m.tileID.canonical,K,N,this.transform,x.getProjection(),ee);de=t.multiply([],this.transform.labelPlaneMatrix,ye)}let fe=null;W&&m.latestFeatureIndex&&(fe={unwrappedTileID:F,dynamicFilter:W,dynamicFilterNeedsFeature:Q,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new zf(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,m.tileID);let ve={bucket:x,layout:E,posMatrix:$,textLabelPlaneMatrix:he,labelToScreenMatrix:de,clippingData:fe,scale:R,textPixelRatio:q,holdingForFade:m.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(let ye of x.sortKeyRanges){let{sortKey:Se,symbolInstanceStart:Je,symbolInstanceEnd:we}=ye;s.push({sortKey:Se,symbolInstanceStart:Je,symbolInstanceEnd:we,parameters:ve})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H,K,N,W){let{textOffset0:Q,textOffset1:ee,crossTileID:he}=$,de=[Q,ee],fe=Nl(s,m,y,de,x),ve=this.collisionIndex.placeCollisionBox(X,x,h,Ul(fe.x,fe.y,T,E,this.transform.angle),F,A,R,q.predicate);if(K){let ye=X.getSymbolInstanceIconSize(W,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,ye,K,Ul(fe.x,fe.y,T,E,this.transform.angle),F,A,R,q.predicate).box.length===0)return}if(ve.box.length>0){let ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[he]&&this.prevPlacement.placements[he]&&this.prevPlacement.placements[he].text&&(ye=this.prevPlacement.variableOffsets[he].anchor),this.variableOffsets[he]={textOffset:de,width:m,height:y,anchor:s,textScale:x,prevAnchor:ye},this.markUsedJustification(X,s,$,H),X.allowVerticalPlacement&&(this.markUsedOrientation(X,H,$),this.placedOrientations[he]=H),{shift:fe,placedGlyphBoxes:ve}}}placeLayerBucketPart(s,h,m,y){let{bucket:x,layout:T,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:R,clippingData:q,textPixelRatio:F,holdingForFade:$,collisionBoxArray:Z,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:H,collisionGroup:K}=s.parameters,N=T.get("text-optional"),W=T.get("icon-optional"),Q=T.get("text-allow-overlap"),ee=T.get("icon-allow-overlap"),he=T.get("text-rotation-alignment")==="map",de=T.get("text-pitch-alignment")==="map",fe=T.get("icon-text-fit")!=="none",ve=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(x.projection);let ye=Q&&(ee||!x.hasIconData()||W),Se=ee&&(Q||!x.hasTextData()||N);!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),m&&y&&x.updateCollisionDebugBuffers(this.transform.zoom,Z);let Je=(we,ze,Oe)=>{let{crossTileID:Ye,numVerticalGlyphVertices:Ee}=we;if(q){let Nr={zoom:this.transform.zoom,pitch:this.transform.pitch},Tr=null;if(q.dynamicFilterNeedsFeature){let sr=this.retainedQueryData[x.bucketInstanceId];Tr=q.featureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:sr.bucketIndex,sourceLayerIndex:sr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,q.dynamicFilter)(Nr,Tr,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new t.Point(we.tileAnchorX,we.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[Ye]=new zl(!1,!1,!1,!0),void h.add(Ye)}if(h.has(Ye))return;if($)return void(this.placements[Ye]=new zl(!1,!1,!1));let Be=!1,et=!1,He=!0,rt=!1,Tt=!1,Rt=null,xt={box:null,offscreen:null,occluded:null},Ot={box:null,offscreen:null,occluded:null},Xt=null,Wt=null,wt=null,mr=0,xr=0,br=0;Oe.textFeatureIndex?mr=Oe.textFeatureIndex:we.useRuntimeCollisionCircles&&(mr=we.featureIndex),Oe.verticalTextFeatureIndex&&(xr=Oe.verticalTextFeatureIndex);let wr=Nr=>{Nr.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Tr=this.transform.elevation;(Tr||Nr.elevation)&&(Nr.elevation=Tr?Tr.getAtTileOffset(Nr.tileID,Nr.tileAnchorX,Nr.tileAnchorY):0)},ki=Oe.textBox;if(ki){wr(ki);let Nr=sr=>{let oi=t.WritingMode.horizontal;if(x.allowVerticalPlacement&&!sr&&this.prevPlacement){let $i=this.prevPlacement.placedOrientations[Ye];$i&&(this.placedOrientations[Ye]=$i,oi=$i,this.markUsedOrientation(x,oi,we))}return oi},Tr=(sr,oi)=>{if(x.allowVerticalPlacement&&Ee>0&&Oe.verticalTextBox){for(let $i of x.writingModes)if($i===t.WritingMode.vertical?(xt=oi(),Ot=xt):xt=sr(),xt&&xt.box&&xt.box.length)break}else xt=sr()};if(T.get("text-variable-anchor")){let sr=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ye]){let kr=this.prevPlacement.variableOffsets[Ye];sr.indexOf(kr.anchor)>0&&(sr=sr.filter(Ki=>Ki!==kr.anchor),sr.unshift(kr.anchor))}let oi=(kr,Ki,Lc)=>{let Za=x.getSymbolInstanceTextSize(X,we,this.transform.zoom,ze),su=(kr.x2-kr.x1)*Za+2*kr.padding,Lo=(kr.y2-kr.y1)*Za+2*kr.padding,la=fe&&!ee?Ki:null;la&&wr(la);let Ha={box:[],offscreen:!1,occluded:!1},kc=Q?2*sr.length:sr.length;for(let lu=0;lu<kc;++lu){let Od=this.attemptAnchorPlacement(sr[lu%sr.length],kr,su,Lo,Za,he,de,F,E,K,lu>=sr.length,we,ze,x,Lc,la,X,H);if(Od&&(Ha=Od.placedGlyphBoxes,Ha&&Ha.box&&Ha.box.length)){Be=!0,Rt=Od.shift;break}}return Ha};Tr(()=>oi(ki,Oe.iconBox,t.WritingMode.horizontal),()=>{let kr=Oe.verticalTextBox;return kr&&wr(kr),x.allowVerticalPlacement&&!(xt&&xt.box&&xt.box.length)&&Ee>0&&kr?oi(kr,Oe.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),xt&&(Be=xt.box,He=xt.offscreen,rt=xt.occluded);let $i=Nr(!(!xt||!xt.box));if(!Be&&this.prevPlacement){let kr=this.prevPlacement.variableOffsets[Ye];kr&&(this.variableOffsets[Ye]=kr,this.markUsedJustification(x,kr.anchor,we,$i))}}else{let sr=(oi,$i)=>{let kr=x.getSymbolInstanceTextSize(X,we,this.transform.zoom,ze),Ki=this.collisionIndex.placeCollisionBox(x,kr,oi,new t.Point(0,0),Q,F,E,K.predicate);return Ki&&Ki.box&&Ki.box.length&&(this.markUsedOrientation(x,$i,we),this.placedOrientations[Ye]=$i),Ki};Tr(()=>sr(ki,t.WritingMode.horizontal),()=>{let oi=Oe.verticalTextBox;return x.allowVerticalPlacement&&Ee>0&&oi?(wr(oi),sr(oi,t.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Nr(!!(xt&&xt.box&&xt.box.length))}}if(Xt=xt,Be=Xt&&Xt.box&&Xt.box.length>0,He=Xt&&Xt.offscreen,rt=Xt&&Xt.occluded,we.useRuntimeCollisionCircles){let Nr=x.text.placedSymbolArray.get(we.centerJustifiedTextSymbolIndex>=0?we.centerJustifiedTextSymbolIndex:we.verticalPlacedTextSymbolIndex),Tr=t.evaluateSizeForFeature(x.textSizeData,X,Nr),sr=T.get("text-padding");Wt=this.collisionIndex.placeCollisionCircles(x,Q,Nr,x.lineVertexArray,x.glyphOffsetArray,Tr,E,A,R,m,de,K.predicate,we.collisionCircleDiameter*Tr/t.ONE_EM,sr,this.retainedQueryData[x.bucketInstanceId].tileID),Be=Q||Wt.circles.length>0&&!Wt.collisionDetected,He=He&&Wt.offscreen,rt=Wt.occluded}if(Oe.iconFeatureIndex&&(br=Oe.iconFeatureIndex),Oe.iconBox){let Nr=Tr=>{wr(Tr);let sr=fe&&Rt?Ul(Rt.x,Rt.y,he,de,this.transform.angle):new t.Point(0,0),oi=x.getSymbolInstanceIconSize(H,this.transform.zoom,we.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,oi,Tr,sr,ee,F,E,K.predicate)};Ot&&Ot.box&&Ot.box.length&&Oe.verticalIconBox?(wt=Nr(Oe.verticalIconBox),et=wt.box.length>0):(wt=Nr(Oe.iconBox),et=wt.box.length>0),He=He&&wt.offscreen,Tt=wt.occluded}let Ei=N||we.numHorizontalGlyphVertices===0&&Ee===0,In=W||we.numIconVertices===0;if(Ei||In?In?Ei||(et=et&&Be):Be=et&&Be:et=Be=et&&Be,Be&&Xt&&Xt.box&&this.collisionIndex.insertCollisionBox(Xt.box,T.get("text-ignore-placement"),x.bucketInstanceId,Ot&&Ot.box&&xr?xr:mr,K.ID),et&&wt&&this.collisionIndex.insertCollisionBox(wt.box,T.get("icon-ignore-placement"),x.bucketInstanceId,br,K.ID),Wt&&(Be&&this.collisionIndex.insertCollisionCircles(Wt.circles,T.get("text-ignore-placement"),x.bucketInstanceId,mr,K.ID),m)){let Nr=x.bucketInstanceId,Tr=this.collisionCircleArrays[Nr];Tr===void 0&&(Tr=this.collisionCircleArrays[Nr]=new Fl);for(let sr=0;sr<Wt.circles.length;sr+=4)Tr.circles.push(Wt.circles[sr+0]),Tr.circles.push(Wt.circles[sr+1]),Tr.circles.push(Wt.circles[sr+2]),Tr.circles.push(Wt.collisionDetected?1:0)}let oo=x.projection.name!=="globe";ye=ye&&(oo||!rt),Se=Se&&(oo||!Tt),this.placements[Ye]=new zl(Be||ye,et||Se,He||x.justReloaded),h.add(Ye)};if(ve){let we=x.getSortedSymbolIndexes(this.transform.angle);for(let ze=we.length-1;ze>=0;--ze){let Oe=we[ze];Je(x.symbolInstances.get(Oe),Oe,x.collisionArrays[Oe])}}else for(let we=s.symbolInstanceStart;we<s.symbolInstanceEnd;we++)Je(x.symbolInstances.get(we),we,x.collisionArrays[we]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){let we=this.collisionCircleArrays[x.bucketInstanceId];t.invert(we.invProjMatrix,E),we.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,h,m,y){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:A,crossTileID:R}=m,q=t.getAnchorJustification(h),F=y===t.WritingMode.vertical?A:q==="left"?x:q==="center"?T:q==="right"?E:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:R),T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=F>=0&&T!==F?0:R),E>=0&&(s.text.placedSymbolArray.get(E).crossTileID=F>=0&&E!==F?0:R),A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=F>=0&&A!==F?0:R)}markUsedOrientation(s,h,m){let y=h===t.WritingMode.horizontal||h===t.WritingMode.horizontalOnly?h:0,x=h===t.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R}=m,q=s.text.placedSymbolArray;T>=0&&(q.get(T).placedOrientation=y),E>=0&&(q.get(E).placedOrientation=y),A>=0&&(q.get(A).placedOrientation=y),R>=0&&(q.get(R).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let y=h?h.symbolFadeChange(s):1,x=h?h.opacities:{},T=h?h.variableOffsets:{},E=h?h.placedOrientations:{};for(let A in this.placements){let R=this.placements[A],q=x[A];q?(this.opacities[A]=new Oo(q,y,R.text,R.icon,null,R.clipped),m=m||R.text!==q.text.placed||R.icon!==q.icon.placed):(this.opacities[A]=new Oo(null,y,R.text,R.icon,R.skipFade,R.clipped),m=m||R.text||R.icon)}for(let A in x){let R=x[A];if(!this.opacities[A]){let q=new Oo(R,y,!1,!1);q.isHidden()||(this.opacities[A]=q,m=m||R.text.placed||R.icon.placed)}}for(let A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(let A in E)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=E[A]);m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){let m=new Set;for(let y of h){let x=y.getBucket(s);x&&y.latestFeatureIndex&&s.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,y.collisionBoxArray)}}updateBucketOpacities(s,h,m){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();let y=s.layers[0].layout,x=!!s.layers[0].dynamicFilter(),T=new Oo(null,0,!1,!1,!0),E=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),R=y.get("text-variable-anchor"),q=y.get("text-rotation-alignment")==="map",F=y.get("text-pitch-alignment")==="map",$=y.get("icon-text-fit")!=="none",Z=new Oo(null,0,E&&(A||!s.hasIconData()||y.get("icon-optional")),A&&(E||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);let X=(K,N,W)=>{for(let Q=0;Q<N/4;Q++)K.opacityVertexArray.emplaceBack(W)},H=0;for(let K=0;K<s.symbolInstances.length;K++){let N=s.symbolInstances.get(K),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:Q,crossTileID:ee,numIconVertices:he}=N,de=h.has(ee),fe=this.opacities[ee];de?fe=T:fe||(fe=Z,this.opacities[ee]=fe),h.add(ee);let ve=W>0||Q>0,ye=he>0,Se=this.placedOrientations[ee],Je=Se===t.WritingMode.vertical,we=Se===t.WritingMode.horizontal||Se===t.WritingMode.horizontalOnly;if(!ve&&!ye||fe.isHidden()||H++,ve){let ze=jl(fe.text);X(s.text,W,Je?Hr:ze),X(s.text,Q,we?Hr:ze);let Oe=fe.text.isHidden(),{leftJustifiedTextSymbolIndex:Ye,centerJustifiedTextSymbolIndex:Ee,rightJustifiedTextSymbolIndex:Be,verticalPlacedTextSymbolIndex:et}=N,He=s.text.placedSymbolArray,rt=Oe||Je?1:0;Ye>=0&&(He.get(Ye).hidden=rt),Ee>=0&&(He.get(Ee).hidden=rt),Be>=0&&(He.get(Be).hidden=rt),et>=0&&(He.get(et).hidden=Oe||we?1:0);let Tt=this.variableOffsets[ee];Tt&&this.markUsedJustification(s,Tt.anchor,N,Se);let Rt=this.placedOrientations[ee];Rt&&(this.markUsedJustification(s,"left",N,Rt),this.markUsedOrientation(s,Rt,N))}if(ye){let ze=jl(fe.icon),{placedIconSymbolIndex:Oe,verticalPlacedIconSymbolIndex:Ye}=N,Ee=s.icon.placedSymbolArray,Be=fe.icon.isHidden()?1:0;Oe>=0&&(X(s.icon,he,Je?Hr:ze),Ee.get(Oe).hidden=Be),Ye>=0&&(X(s.icon,N.numVerticalIconVertices,we?Hr:ze),Ee.get(Ye).hidden=Be)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){let ze=s.collisionArrays[K];if(ze){let Oe=new t.Point(0,0),Ye=!0;if(ze.textBox||ze.verticalTextBox){if(R){let Be=this.variableOffsets[ee];Be?(Oe=Nl(Be.anchor,Be.width,Be.height,Be.textOffset,Be.textScale),q&&Oe._rotate(F?this.transform.angle:-this.transform.angle)):Ye=!1}x&&(Ye=!fe.clipped),ze.textBox&&Os(s.textCollisionBox.collisionVertexArray,fe.text.placed,!Ye||Je,Oe.x,Oe.y),ze.verticalTextBox&&Os(s.textCollisionBox.collisionVertexArray,fe.text.placed,!Ye||we,Oe.x,Oe.y)}let Ee=Ye&&!!(!we&&ze.verticalIconBox);ze.iconBox&&Os(s.iconCollisionBox.collisionVertexArray,fe.icon.placed,Ee,$?Oe.x:0,$?Oe.y:0),ze.verticalIconBox&&Os(s.iconCollisionBox.collisionVertexArray,fe.icon.placed,!Ee,$?Oe.x:0,$?Oe.y:0)}}}if(s.fullyClipped=H===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){let K=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=K.invProjMatrix,s.placementViewportMatrix=K.viewportMatrix,s.collisionCircleArray=K.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){let m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function Os(d,s,h,m,y){d.emplaceBack(s?1:0,h?1:0,m||0,y||0),d.emplaceBack(s?1:0,h?1:0,m||0,y||0),d.emplaceBack(s?1:0,h?1:0,m||0,y||0),d.emplaceBack(s?1:0,h?1:0,m||0,y||0)}let Hi=Math.pow(2,25),Jr=Math.pow(2,24),Ff=Math.pow(2,17),Nf=Math.pow(2,16),Xi=Math.pow(2,9),Tn=Math.pow(2,8),c_=Math.pow(2,1);function jl(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let s=d.placed?1:0,h=Math.floor(127*d.opacity);return h*Hi+s*Jr+h*Ff+s*Nf+h*Xi+s*Tn+h*c_+s}let Hr=0;class Vl{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,m,y,x){let T=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(T,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((E,A)=>E.sortKey-A.sortKey));this._currentPartIndex<T.length;){let E=T[this._currentPartIndex];if(h.placeLayerBucketPart(E,this._seenCrossTileIDs,m,E.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Uf{constructor(s,h,m,y,x,T,E,A){this.placement=new lc(s,x,T,E,A),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,h,m){let y=t.exported.now(),x=()=>{let T=t.exported.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){let T=h[s[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=E)&&(!T.maxzoom||T.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Vl(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}let Na=512/t.EXTENT/2;class Ci{constructor(s,h,m){this.tileID=s,this.bucketInstanceId=m,this.index=new t.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let y=s.canonical.x*t.EXTENT,x=s.canonical.y*t.EXTENT;for(let T=0;T<h.length;T++){let{key:E,crossTileID:A,tileAnchorX:R,tileAnchorY:q}=h.get(T),F=Math.floor((y+R)*Na),$=Math.floor((x+q)*Na);this.index.add(F,$),this.keys.push(E),this.crossTileIDs.push(A)}this.index.finish()}findMatches(s,h,m){let y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=Na/Math.pow(2,h.canonical.z-this.tileID.canonical.z),T=h.canonical.x*t.EXTENT,E=h.canonical.y*t.EXTENT;for(let A=0;A<s.length;A++){let R=s.get(A);if(R.crossTileID)continue;let{key:q,tileAnchorX:F,tileAnchorY:$}=R,Z=Math.floor((T+F)*x),X=Math.floor((E+$)*x),H=this.index.range(Z-y,X-y,Z+y,X+y);for(let K of H){let N=this.crossTileIDs[K];if(this.keys[K]===q&&!m.has(N)){m.add(N),R.crossTileID=N;break}}}}}class jf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){let h=Math.round((s-this.lng)/360);if(h!==0)for(let m in this.indexes){let y=this.indexes[m],x={};for(let T in y){let E=y[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),x[E.tileID.key]=E}this.indexes[m]=x}this.lng=s}addBucket(s,h,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);let y=this.usedCrossTileIDs[s.overscaledZ];for(let x in this.indexes){let T=this.indexes[x];if(Number(x)>s.overscaledZ)for(let E in T){let A=T[E];A.tileID.isChildOf(s)&&A.findMatches(h.symbolInstances,s,y)}else{let E=T[s.scaledTo(Number(x)).key];E&&E.findMatches(h.symbolInstances,s,y)}}for(let x=0;x<h.symbolInstances.length;x++){let T=h.symbolInstances.get(x);T.crossTileID||(T.crossTileID=m.generate(),y.add(T.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Ci(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(let m of h.crossTileIDs)this.usedCrossTileIDs[s].delete(m)}removeStaleBuckets(s){let h=!1;for(let m in this.indexes){let y=this.indexes[m];for(let x in y)s[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[x]),delete y[x],h=!0)}return h}}class Co{constructor(){this.layerIndexes={},this.crossTileIDs=new jf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,m,y){let x=this.layerIndexes[s.id];x===void 0&&(x=this.layerIndexes[s.id]=new Vf);let T=!1,E={};y.name!=="globe"&&x.handleWrapJump(m);for(let A of h){let R=A.getBucket(s);R&&s.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(A.tileID,R,this.crossTileIDs)&&(T=!0),E[R.bucketInstanceId]=!0)}return x.removeStaleBuckets(E)&&(T=!0),T}pruneUnusedLayers(s){let h={};s.forEach(m=>{h[m]=!0});for(let m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}let aa=(d,s)=>t.emitValidationErrors(d,s&&s.filter(h=>h.identifier!=="source.canvas")),uc=t.pick(fr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Z0=t.pick(fr,["setCenter","setZoom","setBearing","setPitch"]),$f={version:8,layers:[],sources:{}},Cs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ro extends t.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Le(Is(),this),this.imageManager=new Dt,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(s._requestManager,h.localFontFamily?t.LocalGlyphMode.all:h.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Co,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());let m=this;this._rtlTextPluginCallback=ro.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,T)=>{if(t.triggerPluginCompletionEvent(x),T&&T.every(E=>E))for(let E in m._sourceCaches){let A=m._sourceCaches[E],R=A.getSource().type;R!=="vector"&&R!=="geojson"||A.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;let x=this.getSource(y.sourceId);if(x&&x.vectorLayerIds)for(let T in this._layers){let E=this._layers[T];E.source===x.id&&this._validateLayer(E)}})}loadURL(s,h={}){this.fire(new t.Event("dataloading",{dataType:"style"}));let m=typeof h.validate=="boolean"?h.validate:!t.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,h.accessToken);let y=this.map._requestManager.transformRequest(s,t.ResourceType.Style);this._request=t.getJSON(y,(x,T)=>{this._request=null,x?this.fire(new t.ErrorEvent(x)):T&&this._load(T,m)})}loadJSON(s,h={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load($f,!1)}_updateLayerCount(s,h){let m=h?1:-1;s.is3D()&&(this._num3DLayers+=m),s.type==="circle"&&(this._numCircleLayers+=m),s.type==="symbol"&&(this._numSymbolLayers+=m)}_load(s,h){if(h&&aa(this,t.validateStyle(s)))return;this._loaded=!0,this.stylesheet=t.clone$1(s),this._updateMapProjection();for(let y in s.sources)this.addSource(y,s.sources[y],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);let m=o_(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of m){let x=t.createStyleLayer(y);x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Or(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(s){this._spriteRequest=function(h,m,y){let x,T,E,A=t.exported.devicePixelRatio>1?"@2x":"",R=t.getJSON(m.transformRequest(m.normalizeSpriteURL(h,A,".json"),t.ResourceType.SpriteJSON),($,Z)=>{R=null,E||(E=$,x=Z,F())}),q=t.getImage(m.transformRequest(m.normalizeSpriteURL(h,A,".png"),t.ResourceType.SpriteImage),($,Z)=>{q=null,E||(E=$,T=Z,F())});function F(){if(E)y(E);else if(x&&T){let $=t.exported.getImageData(T),Z={};for(let X in x){let{width:H,height:K,x:N,y:W,sdf:Q,pixelRatio:ee,stretchX:he,stretchY:de,content:fe}=x[X],ve=new t.RGBAImage({width:H,height:K});t.RGBAImage.copy($,ve,{x:N,y:W},{x:0,y:0},{width:H,height:K}),Z[X]={data:ve,pixelRatio:ee,sdf:Q,stretchX:he,stretchY:de,content:fe}}y(null,Z)}}return{cancel(){R&&(R.cancel(),R=null),q&&(q.cancel(),q=null)}}}(s,this.map._requestManager,(h,m)=>{if(this._spriteRequest=null,h)this.fire(new t.ErrorEvent(h));else if(m)for(let y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))})}_validateLayer(s){let h=this.getSource(s.source);if(!h)return;let m=s.sourceLayer;m&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(m)===-1)&&this.fire(new t.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){let h=[];for(let m of s){let y=this._layers[m];y.type!=="custom"&&h.push(y.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(let s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&(typeof s.isLayerDraped=="function"?s.isLayerDraped():Cs[s.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;let h=this._changed;if(this._changed){let y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(let T in this._updatedSources){let E=this._updatedSources[T];E==="reload"?this._reloadSource(T):E==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(let T in this._updatedPaintProps)this._layers[T].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}let m={};for(let y in this._sourceCaches){let x=this._sourceCaches[y];m[y]=x.used,x.used=!1}for(let y of this._order){let x=this._layers[y];if(x.recalculate(s,this._availableImages),!x.isHidden(s.zoom)){let E=this._getLayerSourceCache(x);E&&(E.used=!0)}let T=this.map.painter;if(T){let E=x.getProgramIds();if(!E)continue;let A=x.getProgramConfiguration(s.zoom);for(let R of E)T.useProgram(R,A)}}for(let y in m){let x=this._sourceCaches[y];m[y]!==x.used&&x.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let s=Object.keys(this._changedImages);if(s.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),aa(this,t.validateStyle(s)))return!1;(s=t.clone$1(s)).layers=o_(s.layers);let h=function(y,x){if(!y)return[{command:fr.setStyle,args:[x]}];let T=[];try{if(!v(y.version,x.version))return[{command:fr.setStyle,args:[x]}];v(y.center,x.center)||T.push({command:fr.setCenter,args:[x.center]}),v(y.zoom,x.zoom)||T.push({command:fr.setZoom,args:[x.zoom]}),v(y.bearing,x.bearing)||T.push({command:fr.setBearing,args:[x.bearing]}),v(y.pitch,x.pitch)||T.push({command:fr.setPitch,args:[x.pitch]}),v(y.sprite,x.sprite)||T.push({command:fr.setSprite,args:[x.sprite]}),v(y.glyphs,x.glyphs)||T.push({command:fr.setGlyphs,args:[x.glyphs]}),v(y.transition,x.transition)||T.push({command:fr.setTransition,args:[x.transition]}),v(y.light,x.light)||T.push({command:fr.setLight,args:[x.light]}),v(y.fog,x.fog)||T.push({command:fr.setFog,args:[x.fog]}),v(y.projection,x.projection)||T.push({command:fr.setProjection,args:[x.projection]});let E={},A=[];(function(F,$,Z,X){let H;for(H in $=$||{},F=F||{})F.hasOwnProperty(H)&&($.hasOwnProperty(H)||Ll(H,Z,X));for(H in $){if(!$.hasOwnProperty(H))continue;let K=$[H];F.hasOwnProperty(H)?v(F[H],K)||(F[H].type==="geojson"&&K.type==="geojson"&&sc(F,$,H)?Z.push({command:fr.setGeoJSONSourceData,args:[H,K.data]}):Df(H,$,Z,X)):Rf(H,$,Z)}})(y.sources,x.sources,A,E);let R=[];y.layers&&y.layers.forEach(F=>{F.source&&E[F.source]?T.push({command:fr.removeLayer,args:[F.id]}):R.push(F)});let q=y.terrain;q&&E[q.source]&&(T.push({command:fr.setTerrain,args:[void 0]}),q=void 0),T=T.concat(A),v(q,x.terrain)||T.push({command:fr.setTerrain,args:[x.terrain]}),function(F,$,Z){$=$||[];let X=(F=F||[]).map(So),H=$.map(So),K=F.reduce(Lf,{}),N=$.reduce(Lf,{}),W=X.slice(),Q=Object.create(null),ee,he,de,fe,ve,ye,Se;for(ee=0,he=0;ee<X.length;ee++)de=X[ee],N.hasOwnProperty(de)?he++:(Z.push({command:fr.removeLayer,args:[de]}),W.splice(W.indexOf(de,he),1));for(ee=0,he=0;ee<H.length;ee++)de=H[H.length-1-ee],W[W.length-1-ee]!==de&&(K.hasOwnProperty(de)?(Z.push({command:fr.removeLayer,args:[de]}),W.splice(W.lastIndexOf(de,W.length-he),1)):he++,ye=W[W.length-ee],Z.push({command:fr.addLayer,args:[N[de],ye]}),W.splice(W.length-ee,0,de),Q[de]=!0);for(ee=0;ee<H.length;ee++)if(de=H[ee],fe=K[de],ve=N[de],!Q[de]&&!v(fe,ve))if(v(fe.source,ve.source)&&v(fe["source-layer"],ve["source-layer"])&&v(fe.type,ve.type)){for(Se in eo(fe.layout,ve.layout,Z,de,null,fr.setLayoutProperty),eo(fe.paint,ve.paint,Z,de,null,fr.setPaintProperty),v(fe.filter,ve.filter)||Z.push({command:fr.setFilter,args:[de,ve.filter]}),v(fe.minzoom,ve.minzoom)&&v(fe.maxzoom,ve.maxzoom)||Z.push({command:fr.setLayerZoomRange,args:[de,ve.minzoom,ve.maxzoom]}),fe)fe.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?eo(fe[Se],ve[Se],Z,de,Se.slice(6),fr.setPaintProperty):v(fe[Se],ve[Se])||Z.push({command:fr.setLayerProperty,args:[de,Se,ve[Se]]}));for(Se in ve)ve.hasOwnProperty(Se)&&!fe.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?eo(fe[Se],ve[Se],Z,de,Se.slice(6),fr.setPaintProperty):v(fe[Se],ve[Se])||Z.push({command:fr.setLayerProperty,args:[de,Se,ve[Se]]}))}else Z.push({command:fr.removeLayer,args:[de]}),ye=W[W.lastIndexOf(de)+1],Z.push({command:fr.addLayer,args:[ve,ye]})}(R,x.layers,T)}catch(E){console.warn("Unable to compute style diff:",E),T=[{command:fr.setStyle,args:[x]}]}return T}(this.serialize(),s).filter(y=>!(y.command in Z0));if(h.length===0)return!1;let m=h.filter(y=>!(y.command in uc));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return h.forEach(y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)}),this.stylesheet=s,this._updateMapProjection(),!0}addImage(s,h){return this.getImage(s)?this.fire(new t.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s),this._afterImageUpdated(s),this):this.fire(new t.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,h,m={}){if(this._checkLoaded(),this.getSource(s)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(t.validateSource,`sources.${s}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let y=Gt(s,h,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s),source:y.serialize(),sourceId:s}));let x=T=>{let E=(T?"symbol:":"other:")+s,A=this._sourceCaches[E]=new t.SourceCache(E,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[s]=A,A.style=this,A.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();let h=this.getSource(s);if(!h)throw new Error("There is no source with this ID");for(let y in this._layers)if(this._layers[y].source===s)return this.fire(new t.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new t.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));let m=this._getSourceCaches(s);for(let y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getSource(s).setData(h),this._changed=!0}getSource(s){let h=this._getSourceCache(s);return h&&h.getSource()}_getSources(){let s=[];for(let h in this._otherSourceCaches){let m=this._getSourceCache(h);m&&s.push(m.getSource())}return s}addLayer(s,h,m={}){this._checkLoaded();let y=s.id;if(this.getLayer(y))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let x;if(s.type==="custom"){if(aa(this,t.validateCustomStyleLayer(s)))return;x=t.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(y,s.source),s=t.clone$1(s),s=t.extend(s,{source:y})),this._validate(t.validateLayer,`layers.${y}`,s,{arrayIndex:-1},m))return;x=t.createStyleLayer(s),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}let T=h?this._order.indexOf(h):this._order.length;if(h&&T===-1)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=x;let E=this._getLayerSourceCache(x);if(this._removedLayers[y]&&x.source&&E&&x.type!=="custom"){let A=this._removedLayers[y];delete this._removedLayers[y],A.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",E.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new t.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;let m=this._order.indexOf(s);this._order.splice(m,1);let y=h?this._order.indexOf(h):this._order.length;h&&y===-1?this.fire(new t.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();let h=this._layers[s];if(!h)return void this.fire(new t.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);let m=this._order.indexOf(s);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(let h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,m){this._checkLoaded();let y=this.getLayer(s);y?y.minzoom===h&&y.maxzoom===m||(h!=null&&(y.minzoom=h),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new t.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,h,m={}){this._checkLoaded();let y=this.getLayer(s);if(y){if(!v(y.filter,h))return h==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(t.validateFilter,`layers.${y.id}.filter`,h,{layerType:y.type},m)||(y.filter=t.clone$1(h),this._updateLayer(y)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){let h=this.getLayer(s);return h&&t.clone$1(h.filter)}setLayoutProperty(s,h,m,y={}){this._checkLoaded();let x=this.getLayer(s);x?v(x.getLayoutProperty(h),m)||(x.setLayoutProperty(h,m,y),this._updateLayer(x)):this.fire(new t.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,h){let m=this.getLayer(s);if(m)return m.getLayoutProperty(h);this.fire(new t.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,h,m,y={}){this._checkLoaded();let x=this.getLayer(s);x?v(x.getPaintProperty(h),m)||(x.setPaintProperty(h,m,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,h){let m=this.getLayer(s);return m&&m.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();let m=s.source,y=s.sourceLayer,x=this.getSource(m);if(!x)return void this.fire(new t.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));let T=x.type;if(T==="geojson"&&y)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));let E=this._getSourceCaches(m);for(let A of E)A.setFeatureState(y,s.id,h)}removeFeatureState(s,h){this._checkLoaded();let m=s.source,y=this.getSource(m);if(!y)return void this.fire(new t.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));let x=y.type,T=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));let E=this._getSourceCaches(m);for(let A of E)A.removeFeatureState(T,s.id,h)}getFeatureState(s){this._checkLoaded();let h=s.source,m=s.sourceLayer,y=this.getSource(h);if(y){if(y.type!=="vector"||m)return s.id===void 0&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(m,s.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let s={};for(let h in this._sourceCaches){let m=this._sourceCaches[h].getSource();s[m.id]||(s[m.id]=m.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0;let h=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",h.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){let h=T=>this._layers[T].type==="fill-extrusion",m={},y=[];for(let T=this._order.length-1;T>=0;T--){let E=this._order[T];if(h(E)){m[E]=T;for(let A of s){let R=A[E];if(R)for(let q of R)y.push(q)}}}y.sort((T,E)=>E.intersectionZ-T.intersectionZ);let x=[];for(let T=this._order.length-1;T>=0;T--){let E=this._order[T];if(h(E))for(let A=y.length-1;A>=0;A--){let R=y[A].feature;if(m[R.layer.id]<T)break;x.push(R),y.pop()}else for(let A of s){let R=A[E];if(R)for(let q of R)x.push(q.feature)}}return x}queryRenderedFeatures(s,h,m){h&&h.filter&&this._validate(t.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);let y={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let A of h.layers){let R=this._layers[A];if(!R)return this.fire(new t.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];y[R.source]=!0}}let x=[];h.availableImages=this._availableImages;let T=h&&h.layers?h.layers.some(A=>{let R=this.getLayer(A);return R&&R.is3D()}):this.has3DLayers(),E=gt.createFromScreenPoints(s,m);for(let A in this._sourceCaches){let R=this._sourceCaches[A].getSource().id;h.layers&&!y[R]||x.push(Vr(this._sourceCaches[A],this._layers,this._serializedLayers,E,h,m,T,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,R,q,F,$,Z,X){let H={},K=Z.queryRenderedSymbols(F),N=[];for(let W of Object.keys(K).map(Number))N.push(X[W]);N.sort(Di);for(let W of N){let Q=W.featureIndex.lookupSymbolFeatures(K[W.bucketInstanceId],R,W.bucketIndex,W.sourceLayerIndex,$.filter,$.layers,$.availableImages,A);for(let ee in Q){let he=H[ee]=H[ee]||[],de=Q[ee];de.sort((fe,ve)=>{let ye=W.featureSortOrder;if(ye){let Se=ye.indexOf(fe.featureIndex);return ye.indexOf(ve.featureIndex)-Se}return ve.featureIndex-fe.featureIndex});for(let fe of de)he.push(fe)}}for(let W in H)H[W].forEach(Q=>{let ee=Q.feature,he=q(A[W]);if(!he)return;let de=he.getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=de});return H}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,h){h&&h.filter&&this._validate(t.validateFilter,"querySourceFeatures.filter",h.filter,null,h);let m=this._getSourceCaches(s),y=[];for(let x of m)y=y.concat(ii(x,h));return y}addSourceType(s,h,m){return ro.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(ro.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();let m=this.light.getLight(),y=!1;for(let T in s)if(!v(s[T],m[T])){y=!0;break}if(!y)return;let x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(s,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,h=1){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=s;if(h===1){if(typeof m.source=="object"){let y="terrain-dem-src";this.addSource(y,m.source),m=t.clone$1(m),m=t.extend(m,{source:y})}if(this._validate(t.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,h)}else{let y=this.terrain,x=y.get();for(let T of Object.keys(t.spec.terrain))!m.hasOwnProperty(T)&&t.spec.terrain[T].default&&(m[T]=t.spec.terrain[T].default);for(let T in m)if(!v(m[T],x[T])){y.set(m),this.stylesheet.terrain=m;let E=this._setTransitionParameters({duration:0});y.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){let h=this.fog=new Fe(s,this.map.transform);this.stylesheet.fog=s;let m=this._setTransitionParameters({duration:0});h.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog,m=h.get();Object.keys(s).length===0&&h.set(s);for(let y in s)if(!v(s[y],m[y])){h.set(s),this.stylesheet.fog=s;let x=this._setTransitionParameters({duration:0});h.updateTransitions(x);break}}else this._createFog(s);this._markersNeedUpdate=!0}_setTransitionParameters(s){return{now:t.exported.now(),transition:t.extend(s,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let s=this._order.filter(m=>this.isLayerDraped(this._layers[m])),h=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){let m=this.terrain=new di(s,h);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();let y=this._setTransitionParameters({duration:0});m.updateTransitions(y)}_force3DLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,m,y,x={}){return(!x||x.validate!==!1)&&aa(this,s.call(t.validateStyle,t.extend({key:h,style:this.serialize(),value:m,styleSpec:t.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let s in this._layers)this._layers[s].setEventedParent(null);for(let s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){let h=this._getSourceCaches(s);for(let m of h)m.clearTiles()}_reloadSource(s){let h=this._getSourceCaches(s);for(let m of h)m.resume(),m.reload()}_reloadSources(){for(let s of this._getSources())s.reload&&s.reload()}_updateSources(s){for(let h in this._sourceCaches)this._sourceCaches[h].update(s)}_generateCollisionBoxes(){for(let s in this._sourceCaches){let h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,m,y,x=!1){let T=!1,E=!1,A={};for(let R of this._order){let q=this._layers[R];if(q.type!=="symbol")continue;if(!A[q.source]){let $=this._getLayerSourceCache(q);if(!$)continue;A[q.source]=$.getRenderableIds(!0).map(Z=>$.getTileByID(Z)).sort((Z,X)=>X.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(X.tileID)?-1:1))}let F=this.crossTileSymbolIndex.addLayer(q,A[q.source],s.center.lng,s.projection);T=T||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),s.zoom))&&(this.pauseablePlacement=new Uf(s,this._order,x,h,m,y,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),E=!0),T&&this.pauseablePlacement.placement.setStale()),E||T)for(let R of this._order){let q=this._layers[R];q.type==="symbol"&&this.placement.updateLayerOpacities(q,A[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(let s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,m){this.imageManager.getImages(h.icons,m),this._updateTilesForChangedImages();let y=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};y(this._otherSourceCaches[h.source]),y(this._symbolSourceCaches[h.source])}getGlyphs(s,h,m){this.glyphManager.getGlyphs(h.stacks,m)}getResource(s,h,m){return t.makeRequest(h,m)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){let h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){let h=this._getSourceCaches(s);return h.length===0?(this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${s}'`))),!1):h.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ro.getSourceType=function(d){return Nt[d]},ro.setSourceType=function(d,s){Nt[d]=s},ro.registerForPluginStateChange=t.registerForPluginStateChange;var Gf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Ua="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Po=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,$l=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Mo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let cc={},Ps={},Gl=[];Ms(Gf,Gl),Ms(Po,Gl),Ms($l,Gl),Ms(Mo,Gl),cc=dr("",Po),Ps=dr(Mo,$l);let h_=dr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),hc=Gf,Wf=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Zf={background:dr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:dr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:dr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:dr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:dr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:dr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:dr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:dr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:dr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:dr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:dr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:dr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:dr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:dr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:dr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:dr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:dr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:dr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:dr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:dr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:dr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:dr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:dr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:dr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:dr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:dr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ua),skyboxGradient:dr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ua),skyboxCapture:dr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:dr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:dr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ms(d,s){let h=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of h)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let y=m.split(" ");for(let x of y)s.includes(x)||s.push(x)}}function dr(d,s){let h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},x=[...Gl];return Ms(d,x),Ms(s,x),{fragmentSource:d=d.replace(h,(T,E,A,R,q)=>(y[q]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${A} ${R} ${q};
#else
uniform ${A} ${R} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${A} ${R} ${q} = u_${q};
#endif
`)),vertexSource:s=s.replace(h,(T,E,A,R,q)=>{let F=R==="float"?"vec2":"vec4",$=q.match(/color/)?"color":F;return y[q]?E==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${A} ${F} a_${q};
varying ${A} ${R} ${q};
#else
uniform ${A} ${R} u_${q};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${A} ${R} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${$}(a_${q}, u_${q}_t);
#else
    ${A} ${R} ${q} = u_${q};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${A} ${F} a_${q};
#else
uniform ${A} ${R} u_${q};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${A} ${R} ${q} = a_${q};
#else
    ${A} ${R} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${A} ${R} ${q} = unpack_mix_${$}(a_${q}, u_${q}_t);
#else
    ${A} ${R} ${q} = u_${q};
#endif
`}),staticAttributes:m,usedDefines:x}}class H0{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,m,y,x,T,E){this.context=s;let A=this.boundPaintVertexBuffers.length!==y.length;for(let q=0;!A&&q<y.length;q++)this.boundPaintVertexBuffers[q]!==y[q]&&(A=!0);let R=this.boundDynamicVertexBuffers.length!==E.length;for(let q=0;!R&&q<E.length;q++)this.boundDynamicVertexBuffers[q]!==E[q]&&(R=!0);if(!s.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==m||A||R||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(h,m,y,x,T,E);else{s.bindVertexArrayOES.set(this.vao);for(let q of E)q&&q.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(s,h,m,y,x,T){let E,A=s.numAttributes,R=this.context,q=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T;else{E=R.currentNumAttributes||0;for(let F=A;F<E;F++)q.disableVertexAttribArray(F)}h.enableAttributes(q,s),h.bind(),h.setVertexAttribPointers(q,s,x);for(let F of m)F.enableAttributes(q,s),F.bind(),F.setVertexAttribPointers(q,s,x);for(let F of T)F&&(F.enableAttributes(q,s),F.bind(),F.setVertexAttribPointers(q,s,x));y&&y.bind(),R.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hf(d,s){let h=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new t.MercatorCoordinate(0,m/h).toLngLat().lat,new t.MercatorCoordinate(0,(m+1)/h).toLngLat().lat]}function f_(d,s,h,m,y,x,T){let E=d.context,A=E.gl,R=h.fbo;if(!R)return;d.prepareDrawTile();let q=d.useProgram("hillshade");E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());let F=((H,K,N,W)=>{let Q=N.paint.get("hillshade-shadow-color"),ee=N.paint.get("hillshade-highlight-color"),he=N.paint.get("hillshade-accent-color"),de=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(de-=H.transform.angle);let fe=!H.options.moving;return{u_matrix:W||H.transform.calculateProjMatrix(K.tileID.toUnwrapped(),fe),u_image:0,u_latrange:Hf(0,K.tileID),u_light:[N.paint.get("hillshade-exaggeration"),de],u_shadow:Q,u_highlight:ee,u_accent:he}})(d,h,m,d.terrain?s.projMatrix:null);d.prepareDrawProgram(E,q,s.toUnwrapped());let{tileBoundsBuffer:$,tileBoundsIndexBuffer:Z,tileBoundsSegments:X}=d.getTileBoundsBuffers(h);q.draw(E,A.TRIANGLES,y,x,T,t.CullFaceMode.disabled,F,m.id,$,Z,X)}function Xf(d,s,h){if(!s.needsDEMTextureUpload)return;let m=d.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||d.getTileTexture(h.stride);let x=h.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new t.Texture(m,x,y.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function d_(d,s,h,m,y,x){let T=d.context,E=T.gl;if(!s.dem)return;let A=s.dem;if(T.activeTexture.set(E.TEXTURE1),Xf(d,s,A),!s.demTexture)return;s.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);let R=A.dim;T.activeTexture.set(E.TEXTURE0);let q=s.fbo;if(!q){let X=new t.Texture(T,{width:R,height:R,data:null},E.RGBA);X.bind(E.LINEAR,E.CLAMP_TO_EDGE),q=s.fbo=T.createFramebuffer(R,R,!0),q.colorAttachment.set(X.texture)}T.bindFramebuffer.set(q.framebuffer),T.viewport.set([0,0,R,R]);let{tileBoundsBuffer:F,tileBoundsIndexBuffer:$,tileBoundsSegments:Z}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(T,E.TRIANGLES,m,y,x,t.CullFaceMode.disabled,((X,H)=>{let K=H.stride,N=t.create();return t.ortho(N,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(N,N,[0,-t.EXTENT,0]),{u_matrix:N,u_image:1,u_dimension:[K,K],u_zoom:X.overscaledZ,u_unpack:H.unpackVector}})(s.tileID,A),h.id,F,$,Z),s.needsHillshadePrepare=!1}let Kf=d=>({u_matrix:new t.UniformMatrix4f(d),u_image0:new t.Uniform1i(d),u_skirt_height:new t.Uniform1f(d)}),qs=(d,s)=>({u_matrix:d,u_image0:0,u_skirt_height:s}),fc=(d,s,h,m,y,x,T,E,A,R,q,F,$,Z,X)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:h,u_zoom_transition:y,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:E,u_frustum_br:A,u_frustum_bl:R,u_globe_pos:q,u_globe_radius:F,u_viewport:$,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:Z});function Rs(d,s){return d!=null&&s!=null&&!(!d.hasData()||!s.hasData())&&d.demTexture!=null&&s.demTexture!=null&&d.tileID.key!==s.tileID.key}let qo=new class{constructor(){this.operations={}}newMorphing(d,s,h,m,y){if(d in this.operations){let x=this.operations[d];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[d]={startTime:m,phase:0,duration:y,from:s,to:h,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let s=this.operations[d];return{from:s.from,to:s.to,phase:s.phase}}update(d){for(let s in this.operations){let h=this.operations[s];for(h.phase=(d-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,d)){delete this.operations[s];break}}}_nextOp(d,s){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=s,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},ja={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function dc(d){return 6*Math.pow(1.5,22-d)}function p_(d,s){let h=1<<d.z;return!s&&(d.x===0||d.x===h-1)||d.y===0||d.y===h-1}let Wl=d=>({u_matrix:d});function Yf(d,s,h,m,y){if(y>0){let x=t.exported.now(),T=(x-d.timeAdded)/y,E=s?(x-s.timeAdded)/y:-1,A=h.getSource(),R=m.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),q=!s||Math.abs(s.tileID.overscaledZ-R)>Math.abs(d.tileID.overscaledZ-R),F=q&&d.refreshedUponExpiration?1:t.clamp(q?T:1-E,0,1);return d.refreshedUponExpiration&&T>=1&&(d.refreshedUponExpiration=!1),s?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Jf extends t.SourceCache{constructor(s){let h={type:"raster-dem",maxzoom:s.transform.maxZoom},m=new Le(Is(),null),y=Gt("mock-dem",h,m,s.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class pc extends t.SourceCache{constructor(s){let h=Gt("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new Le(Is(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,m){if(s.freezeTileCoverage)return;this.transform=s;let y=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){let E=new t.Tile(T,this._source.tileSize*T.overscaleFactor(),s.tileZoom);E.state="loaded",this._tiles[T.key]=E}return x},{});for(let x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){let h=this.proxyCachedFBO[s];if(h!==void 0){let m=Object.values(h);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class mc extends t.OverscaledTileID{constructor(s,h,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=m}}class Qf extends t.Elevation{constructor(s,h){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[m,y,x]=function(A){let R=new t.StructArrayLayout2i4,q=new t.StructArrayLayout3ui6,F=131;R.reserve(17161),q.reserve(33800);let $=t.EXTENT/128,Z=t.EXTENT+$/2,X=Z+$;for(let K=-$;K<X;K+=$)for(let N=-$;N<X;N+=$){let W=N<0||N>Z||K<0||K>Z?24575:0,Q=t.clamp(Math.round(N),0,t.EXTENT),ee=t.clamp(Math.round(K),0,t.EXTENT);R.emplaceBack(Q+W,ee)}let H=(K,N)=>{let W=N*F+K;q.emplaceBack(W+1,W,W+F),q.emplaceBack(W+F,W+F+1,W+1)};for(let K=1;K<129;K++)for(let N=1;N<129;N++)H(N,K);return[0,129].forEach(K=>{for(let N=0;N<130;N++)H(N,K),H(K,N)}),[R,q,32768]}(),T=s.context;this.gridBuffer=T.createVertexBuffer(m,t.posAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=t.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new pc(h.map),this.orthoMatrix=t.create(),t.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.EXTENT,0,t.EXTENT,0,1);let E=T.gl;this._overlapStencilMode=new t.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Jf(h.map)}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,m){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;let y=s.terrain.properties;this.sourceCache=s.terrain.drapeRenderMode===0?this._mockSourceCache:s._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");let x=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let T=this.getScaledDemTileSize();this.sourceCache.update(h,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),h.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){let s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||s.efficiency!==100&&t.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let y=this.proxyCoords=h.getIds().map(A=>{let R=h.getTileByID(A).tileID;return R.projMatrix=m.calculateProjMatrix(R.toUnwrapped()),R});(function(A,R){let q=R.transform.pointCoordinate(R.transform.getCameraPoint()),F=new t.Point(q.x,q.y);A.sort(($,Z)=>{if(Z.overscaledZ-$.overscaledZ)return Z.overscaledZ-$.overscaledZ;let X=new t.Point($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),H=new t.Point(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),K=F.mult(1<<$.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(X)-K.distSqr(H)})})(y,this.painter),this._previousZoom=m.zoom;let x=this.proxyToSource||{};this.proxyToSource={},y.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};let T=this._style._sourceCaches;for(let A in T){let R=T[A];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,s[A],x),R.usedForTerrain))continue;let q=s[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(q)}this.proxiedCoords[h.id]=y.map(A=>new mc(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();let E={};this._visibleDemTiles=[];for(let A of this.proxyCoords){let R=this.terrainTileForTile[A.key];if(!R)continue;let q=R.tileID.key;q in E||(this._visibleDemTiles.push(R),E[q]=q)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;let m=this._findTileCoveringTileID(h,this.sourceCache);m&&(this.terrainTileForTile[h.key]=m)})}_prepareDEMTextures(){let s=this.painter.context,h=s.gl;for(let m in this.terrainTileForTile){let y=this.terrainTileForTile[m],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),Xf(this.painter,y,x))}}_prepareDemTileUniforms(s,h,m,y){if(!h||h.demTexture==null)return!1;let x=s.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-x.z),E=y||"";return m[`u_dem_tl${E}`]=[x.x*T%1,x.y*T%1],m[`u_dem_scale${E}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){let m=new t.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.Texture(s,m,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0,h=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;let x=y.dem.tree.minimums[0];return x>0&&s++,m+x},0);return s?h/s:0}_updateEmptyDEMTexture(){let s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);let m=this._getLoadedAreaMinimum(),y=new t.RGBAImage({width:1,height:1},new Uint8Array(t.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new t.Texture(s,y,h.RGBA,{premultiply:!1}),x}setupElevationDraw(s,h,m){let y=this.painter.context,x=y.gl,T=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var E;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let A=null,R=null,q=1;if(m&&m.morphing&&this._useVertexMorphing){let F=m.morphing.srcDemTile,$=m.morphing.dstDemTile;q=m.morphing.phase,F&&$&&(this._prepareDemTileUniforms(s,F,T,"_prev")&&(R=F),this._prepareDemTileUniforms(s,$,T)&&(A=$))}if(R&&A?(y.activeTexture.set(x.TEXTURE2),A.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),y.activeTexture.set(x.TEXTURE4),R.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),T.u_dem_lerp=q):(A=this.terrainTileForTile[s.tileID.key],y.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(s,A,T)?A.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),y.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&A){let F=(1<<A.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=F}if(m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),h.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){let F=this.globeUniformValues(this.painter.transform,s.tileID.canonical,m&&m.useDenormalizedUpVectorScale);h.setGlobeUniformValues(y,F)}}globeUniformValues(s,h,m){let y=s.projection;return{u_tile_tl_up:y.upVector(h,0,0),u_tile_tr_up:y.upVector(h,t.EXTENT,0),u_tile_br_up:y.upVector(h,t.EXTENT,t.EXTENT),u_tile_bl_up:y.upVector(h,0,t.EXTENT),u_tile_up_scale:m?t.globeMetersToEcef(1):y.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){let h=this.painter,m=this.painter.context;s.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,x,T,E,A){if(y.transform.projection.name==="globe")(function(R,q,F,$,Z){let X=R.context,H=X.gl,K,N,W=R.options.showTerrainWireframe?2:0,Q=R.transform,ee=t.globeUseCustomAntiAliasing(R,X,Q),he=(Ye,Ee)=>{if(N===Ye)return;let Be=[ja[Ye],"PROJECTION_GLOBE_VIEW"];ee&&Be.push("CUSTOM_ANTIALIASING"),Ee&&Be.push(ja[W]),K=R.useProgram("globeRaster",null,Be),N=Ye},de=R.colorModeForRenderPass(),fe=new t.DepthMode(H.LEQUAL,t.DepthMode.ReadWrite,R.depthRangeFor3D);qo.update(Z);let ve=t.calculateGlobeMercatorMatrix(Q),ye=[t.mercatorXfromLng(Q.center.lng),t.mercatorYfromLat(Q.center.lat)],Se=W?[!1,!0]:[!1],Je=R.globeSharedBuffers,we=[Q.width*t.exported.devicePixelRatio,Q.height*t.exported.devicePixelRatio],ze=Float32Array.from(Q.globeMatrix),Oe={useDenormalizedUpVectorScale:!0};if(Se.forEach(Ye=>{let Ee=R.transform,Be=dc(Ee.zoom)*q.exaggeration();N=-1;let et=Ye?H.LINES:H.TRIANGLES;for(let He of $){let rt=F.getTile(He),Tt=t.StencilMode.disabled,Rt=q.prevTerrainTileForTile[He.key],xt=q.terrainTileForTile[He.key];Rs(Rt,xt)&&qo.newMorphing(He.key,Rt,xt,Z,250),X.activeTexture.set(H.TEXTURE0),rt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let Ot=qo.getMorphValuesForProxy(He.key),Xt=Ot?1:0;Ot&&t.extend$1(Oe,{morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:t.easeCubicInOut(Ot.phase)}});let Wt=t.tileCornersToBounds(He.canonical),wt=t.getLatitudinalLod(Wt.getCenter().lat),mr=t.getGridMatrix(He.canonical,Wt,wt,Ee.worldSize/Ee._pixelsPerMercatorPixel),xr=t.globeNormalizeECEF(t.globeTileBounds(He.canonical)),br=fc(Ee.projMatrix,ze,ve,xr,t.globeToMercatorTransition(Ee.zoom),ye,Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.globeCenterInViewSpace,Ee.globeRadius,we,Be,mr);if(he(Xt,Ye),q.setupElevationDraw(rt,K,Oe),R.prepareDrawProgram(X,K,He.toUnwrapped()),Je){let[wr,ki,Ei]=Ye?Je.getWirefameBuffers(R.context,wt):Je.getGridBuffers(wt,Be!==0);K.draw(X,et,fe,Tt,de,t.CullFaceMode.backCCW,br,"globe_raster",wr,ki,Ei)}}}),Je){let Ye=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ee&&Ye.push("CUSTOM_ANTIALIASING"),K=R.useProgram("globeRaster",null,Ye);for(let Ee of $){let{x:Be,y:et,z:He}=Ee.canonical,rt=et===0,Tt=et===(1<<He)-1,[Rt,xt,Ot,Xt]=Je.getPoleBuffers(He);if(Xt&&(rt||Tt)){let Wt=F.getTile(Ee);X.activeTexture.set(H.TEXTURE0),Wt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let wt=t.globePoleMatrixForTile(He,Be,Q),mr=t.globeNormalizeECEF(t.globeTileBounds(Ee.canonical)),xr=(br,wr)=>br.draw(X,H.TRIANGLES,fe,t.StencilMode.disabled,de,t.CullFaceMode.disabled,fc(Q.projMatrix,wt,wt,mr,0,ye,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,we,0),"globe_pole_raster",wr,Ot,Xt);q.setupElevationDraw(Wt,K,Oe),R.prepareDrawProgram(X,K,Ee.toUnwrapped()),rt&&xr(K,Rt),Tt&&(wt=t.scale(t.create(),wt,[1,-1,1]),xr(K,xt))}}}})(y,x,T,E,A);else{let R=y.context,q=R.gl,F,$,Z=y.options.showTerrainWireframe?2:0,X=(Q,ee)=>{if($===Q)return;let he=[ja[Q]];ee&&he.push(ja[Z]),F=y.useProgram("terrainRaster",null,he),$=Q},H=y.colorModeForRenderPass(),K=new t.DepthMode(q.LEQUAL,t.DepthMode.ReadWrite,y.depthRangeFor3D);qo.update(A);let N=y.transform,W=dc(N.zoom)*x.exaggeration();(Z?[!1,!0]:[!1]).forEach(Q=>{$=-1;let ee=Q?q.LINES:q.TRIANGLES,[he,de]=Q?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(let fe of E){let ve=T.getTile(fe),ye=t.StencilMode.disabled,Se=x.prevTerrainTileForTile[fe.key],Je=x.terrainTileForTile[fe.key];Rs(Se,Je)&&qo.newMorphing(fe.key,Se,Je,A,250),R.activeTexture.set(q.TEXTURE0),ve.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST);let we=qo.getMorphValuesForProxy(fe.key),ze=we?1:0,Oe;we&&(Oe={morphing:{srcDemTile:we.from,dstDemTile:we.to,phase:t.easeCubicInOut(we.phase)}});let Ye=qs(fe.projMatrix,p_(fe.canonical,N.renderWorldCopies)?W/10:W);X(ze,Q),x.setupElevationDraw(ve,F,Oe),y.prepareDrawProgram(R,F,fe.toUnwrapped()),F.draw(R,ee,K,ye,H,t.CullFaceMode.backCCW,Ye,"terrain_raster",x.gridBuffer,he,de)}})}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;let h=this.painter,m=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),E=[],A=h.style.order,R=0;for(let q of x){let F=y.getTileByID(q.proxyTileKey),$=y.proxyCachedFBO[q.key]?y.proxyCachedFBO[q.key][s]:void 0,Z=$!==void 0?y.renderCache[$]:this.pool[R++],X=$!==void 0;if(F.texture=Z.tex,X&&!Z.dirty){E.push(F.tileID);continue}let H;m.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(m.clear({color:t.Color.transparent,stencil:0}),Z.dirty=!1);for(let K=T.start;K<=T.end;++K){let N=h.style._layers[A[K]];if(N.isHidden(h.transform.zoom))continue;let W=h.style._getLayerSourceCache(N),Q=W?this.proxyToSource[q.key][W.id]:[q];if(!Q)continue;let ee=Q;m.viewport.set([0,0,Z.fb.width,Z.fb.height]),H!==(W?W.id:null)&&(this._setupStencil(Z,Q,N,W),H=W?W.id:null),h.renderLayer(h,W,N,ee)}this.renderedToTile?(Z.dirty=!0,E.push(F.tileID)):X||--R,R===5&&(R=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}renderCacheEfficiency(s){let h=s.order.length;if(h===0)return{efficiency:100};let m,y=0,x=0,T=!1;for(let E=0;E<h;++E){let A=s._layers[s.order[E]];this._style.isLayerDraped(A)?(T&&++y,++x):T||(T=!0,m=A.id)}return x===0?{efficiency:100}:{efficiency:100*(1-y/x),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,m){if(!this._visibleDemTiles)return null;let y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let T=x.tileID,E=1<<T.overscaledZ,{x:A,y:R}=T.canonical,q=A/E,F=(A+1)/E,$=R/E,Z=(R+1)/E;return{minx:q,miny:$,maxx:F,maxy:Z,t:x.dem.tree.raycastRoot(q,$,F,Z,s,h,m),tile:x}});y.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(let x of y){if(x.t==null)return null;let T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,h,m);if(T!=null)return T}return null}_createFBO(){let s=this.painter.context,h=s.gl,m=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);let y=new t.Texture(s,{width:m[0],height:m[1],data:null},h.RGBA);y.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=s.createFramebuffer(m[0],m[1],!1);return x.colorAttachment.set(y.texture),x.depthAttachment=new me(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{let h=this._style._layers[s],m=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!m&&h.shouldRedrape():!m&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(let m of this._style._getSources())if(m instanceof st){s=!0;break}if(!s)return;let h={};for(let m=0;m<this._style.order.length;++m){let y=this._style._layers[this._style.order[m]],x=this._style._getLayerSourceCache(y);if(x&&!h[x.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof t.ZoomDependentExpression){h[x.id]=!0;for(let T of this.proxyCoords){let E=this.proxyToSource[T.key][x.id];if(E)for(let A of E)this._clearRenderCacheForTile(x.id,A)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(let m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof it){s=!0;break}if(!s)return;let h={};for(let m=0;m<this._style.order.length;++m){let y=this._style._layers[this._style.order[m]],x=this._style._getLayerSourceCache(y);if(!x||h[x.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;let T=y.paint.get("raster-fade-duration");for(let E of this.proxyCoords){let A=this.proxyToSource[E.key][x.id];if(A)for(let R of A){let q=Yf(x.getTile(R),x.findLoadedParent(R,0),x,this.painter.transform,T);(q.opacity!==1||q.mix!==0)&&this._clearRenderCacheForTile(x.id,R)}}}}_setupDrapedRenderBatches(){let s=this._style.order,h=s.length;if(h===0)return;let m=[],y,x=0,T=this._style._layers[s[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<h;)T=this._style._layers[s[x]];for(;x<h;++x){let E=this._style._layers[s[x]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?y===void 0&&(y=x):y!==void 0&&(m.push({start:y,end:x-1}),y=void 0))}y!==void 0&&m.push({start:y,end:x-1}),this._drapedRenderBatches=m}_setupRenderCache(s){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let E=0;E<T.length;++E){let A=Object.values(T[E]);h.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();let m=this.proxyCoords,y=this._tilesDirty;for(let T=m.length-1;T>=0;T--){let E=m[T];if(h.getTileByID(E.key),h.proxyCachedFBO[E.key]!==void 0){let A=s[E.key],R=this.proxyToSource[E.key],q=0;for(let F in R){let $=R[F],Z=A[F];if(!Z||Z.length!==$.length||$.some((X,H)=>X!==Z[H]||y[F]&&y[F].hasOwnProperty(X.key))){q=-1;break}++q}for(let F in h.proxyCachedFBO[E.key])h.renderCache[h.proxyCachedFBO[E.key][F]].dirty=q<0||q!==Object.values(A).length}}let x=[...this._drapedRenderBatches];x.sort((T,E)=>E.end-E.start-(T.end-T.start));for(let T of x)for(let E of m){if(h.proxyCachedFBO[E.key])continue;let A=h.renderCachePool.pop();A===void 0&&h.renderCache.length<50&&(A=h.renderCache.length,h.renderCache.push(this._createFBO())),A!==void 0&&(h.proxyCachedFBO[E.key]={},h.proxyCachedFBO[E.key][T.start]=A,h.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,T=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let E;if(m.isTileClipped())E=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(s,h){let m=this.painter,y=this.painter.context,x=y.gl;m._tileClippingMaskIDs={},y.setColorMode(t.ColorMode.disabled),y.setDepthMode(t.DepthMode.disabled);let T=m.useProgram("clippingMask");for(let E of s){let A=m._tileClippingMaskIDs[E.key]=--h;T.draw(y,x.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,Wl(E.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){let h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;let m=[s.x,s.y,1,1];t.transformMat4$1(m,m,h.pixelMatrixInverse),t.scale$1(m,m,1/m[3]),m[0]/=h.worldSize,m[1]/=h.worldSize;let y=h._camera.position,x=t.mercatorZfromAltitude(1,h.center.lat),T=[y[0],y[1],y[2]/x,0],E=t.subtract([],m.slice(0,3),T);t.normalize(E,E);let A=this.raycast(T,E,this._exaggeration);return A!==null&&A?(t.scaleAndAdd(T,T,E,A),T[3]=T[2],T[2]*=x,T):null}drawDepth(){let s=this.painter,h=s.context,m=this.proxySourceCache,y=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let T=h.gl,E=h.createFramebuffer(y,x,!0);h.activeTexture.set(T.TEXTURE0);let A=new t.Texture(h,{width:y,height:x,data:null},T.RGBA);A.bind(T.NEAREST,T.CLAMP_TO_EDGE),E.colorAttachment.set(A.texture);let R=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,y,x);E.depthAttachment.set(R),this._depthFBO=E,this._depthTexture=A}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,y,x]),function(T,E,A,R){if(T.transform.projection.name==="globe")return;let q=T.context,F=q.gl;q.clear({depth:1});let $=T.useProgram("terrainDepth"),Z=new t.DepthMode(F.LESS,t.DepthMode.ReadWrite,T.depthRangeFor3D);for(let X of R){let H=A.getTile(X),K=qs(X.projMatrix,0);E.setupElevationDraw(H,$),$.draw(q,F.TRIANGLES,Z,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,K,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(s,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,m){if(s.getSource()instanceof $t)return this._setupProxiedCoordsForImageSource(s,h,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};let y=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let E=0;E<x.length;E++){let A=x[E],R=this._findTileCoveringTileID(A,s);if(R){let q=this._createProxiedId(A,R,m[A.key]&&m[A.key][s.id]);y.push(q),this.proxyToSource[A.key][s.id]=[q]}}let T=!1;for(let E=0;E<h.length;E++){let A=s.getTile(h[E]);if(!A||!A.hasData())continue;let R=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==A.tileID.canonical.z){let q=this.proxyToSource[R.tileID.key][s.id],F=this._createProxiedId(R.tileID,A,m[R.tileID.key]&&m[R.tileID.key][s.id]);q?q.splice(q.length-1,0,F):this.proxyToSource[R.tileID.key][s.id]=[F],y.push(F),T=!0}}this._sourceTilesOverlap[s.id]=T}_setupProxiedCoordsForImageSource(s,h,m){if(!s.getSource().loaded())return;let y=this.proxiedCoords[s.id]=[],x=this.proxyCoords,T=s.getSource(),E=new t.Point(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),A=T.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce((q,F)=>(q.min.x=Math.min(q.min.x,F.x-E.x),q.min.y=Math.min(q.min.y,F.y-E.y),q.max.x=Math.max(q.max.x,F.x-E.x),q.max.y=Math.max(q.max.y,F.y-E.y),q),{min:new t.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(q,F)=>{let $=q.wrap+q.canonical.x/(1<<q.canonical.z),Z=q.canonical.y/(1<<q.canonical.z),X=t.EXTENT/(1<<q.canonical.z),H=F.wrap+F.canonical.x/(1<<F.canonical.z),K=F.canonical.y/(1<<F.canonical.z);return $+X<H+A.min.x||$>H+A.max.x||Z+X<K+A.min.y||Z>K+A.max.y};for(let q=0;q<x.length;q++){let F=x[q];for(let $=0;$<h.length;$++){let Z=s.getTile(h[$]);if(!Z||!Z.hasData()||R(F,Z.tileID))continue;let X=this._createProxiedId(F,Z,m[F.key]&&m[F.key][s.id]),H=this.proxyToSource[F.key][s.id];H?H.push(X):this.proxyToSource[F.key][s.id]=[X],y.push(X)}}}_createProxiedId(s,h,m){let y=this.orthoMatrix;if(m){let x=m.find(T=>T.key===h.tileID.key);if(x)return x}if(h.tileID.key!==s.key){let x=s.canonical.z-h.tileID.canonical.z,T,E,A;y=t.create();let R=h.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(T=t.EXTENT>>x,E=T*((h.tileID.canonical.x<<x)-s.canonical.x+R),A=T*((h.tileID.canonical.y<<x)-s.canonical.y)):(T=t.EXTENT<<-x,E=t.EXTENT*(h.tileID.canonical.x-(s.canonical.x+R<<-x)),A=t.EXTENT*(h.tileID.canonical.y-(s.canonical.y<<-x))),t.ortho(y,0,T,0,T,0,1),t.translate(y,y,[E,A,0])}return new mc(h.tileID,s.key,y)}_findTileCoveringTileID(s,h){let m=h.getTile(s);if(m&&m.hasData())return m;let y=this._findCoveringTileCache[h.id],x=y[s.key];if(m=x?h.getTileByID(x):null,m&&m.hasData()||x===null)return m;let T=m?m.tileID:s,E=T.overscaledZ,A=h.getSource().minzoom,R=[];if(!x){let F=h.getSource().maxzoom;if(s.canonical.z>=F){let $=s.canonical.z-F;h.getSource().reparseOverscaled?(E=Math.max(s.canonical.z+2,h.transform.tileZoom),T=new t.OverscaledTileID(E,s.wrap,F,s.canonical.x>>$,s.canonical.y>>$)):$!==0&&(E=F,T=new t.OverscaledTileID(E,s.wrap,F,s.canonical.x>>$,s.canonical.y>>$))}T.key!==s.key&&(R.push(T.key),m=h.getTile(T))}let q=F=>{R.forEach($=>{y[$]=F}),R.length=0};for(E-=1;E>=A&&(!m||!m.hasData());E--){m&&q(m.tileID.key);let F=T.calculateScaledKey(E);if(m=h.getTileByID(F),m&&m.hasData())break;let $=y[F];if($===null)break;$===void 0?R.push(F):m=h.getTileByID($)}return q(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let s=function(h){let m=0,y=new t.StructArrayLayout2ui4,x=131;for(let T=1;T<129;T++){for(let E=1;E<129;E++)m=T*x+E,y.emplaceBack(m,m+1),y.emplaceBack(m,m+x),y.emplaceBack(m+1,m+x),T===128&&y.emplaceBack(m+x,m+x+1);y.emplaceBack(m+1,m+1+x)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class nr{static cacheKey(s,h,m,y){let x=`${h}${y?y.cacheKey:""}`;for(let T of m)s.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(s,h,m,y,x,T){let E=s.gl;this.program=E.createProgram();let A=function(N){let W=[];for(let Q=0;Q<N.length;Q++){if(N[Q]===null)continue;let ee=N[Q].split(" ");W.push(ee.pop())}return W}(m.staticAttributes),R=y?y.getBinderAttributes():[],q=A.concat(R),F=y?y.defines():[];F=F.concat(T.map(N=>`#define ${N}`));let $=s.isWebGL2?`#version 300 es
`:"",Z=$+F.concat(s.extStandardDerivatives&&$.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Wf):Wf,Wf,hc,h_.fragmentSource,Ps.fragmentSource,m.fragmentSource).join(`
`),X=$+F.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,hc,h_.vertexSource,Ps.vertexSource,cc.vertexSource,m.vertexSource).join(`
`),H=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(H,Z),E.compileShader(H),E.attachShader(this.program,H);let K=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(K,X),E.compileShader(K),E.attachShader(this.program,K),this.attributes={},this.numAttributes=q.length;for(let N=0;N<this.numAttributes;N++)q[N]&&(E.bindAttribLocation(this.program,N,q[N]),this.attributes[q[N]]=N);E.linkProgram(this.program),E.deleteShader(K),E.deleteShader(H),this.fixedUniforms=x(s),this.binderUniforms=y?y.getUniforms(s):[],T.includes("TERRAIN")&&(this.terrainUniforms=(N=>({u_dem:new t.Uniform1i(N),u_dem_prev:new t.Uniform1i(N),u_dem_unpack:new t.Uniform4f(N),u_dem_tl:new t.Uniform2f(N),u_dem_scale:new t.Uniform1f(N),u_dem_tl_prev:new t.Uniform2f(N),u_dem_scale_prev:new t.Uniform1f(N),u_dem_size:new t.Uniform1f(N),u_dem_lerp:new t.Uniform1f(N),u_exaggeration:new t.Uniform1f(N),u_depth:new t.Uniform1i(N),u_depth_size_inv:new t.Uniform2f(N),u_meter_to_dem:new t.Uniform1f(N),u_label_plane_matrix_inv:new t.UniformMatrix4f(N)}))(s)),T.includes("GLOBE")&&(this.globeUniforms=(N=>({u_tile_tl_up:new t.Uniform3f(N),u_tile_tr_up:new t.Uniform3f(N),u_tile_br_up:new t.Uniform3f(N),u_tile_bl_up:new t.Uniform3f(N),u_tile_up_scale:new t.Uniform1f(N)}))(s)),T.includes("FOG")&&(this.fogUniforms=(N=>({u_fog_matrix:new t.UniformMatrix4f(N),u_fog_range:new t.Uniform2f(N),u_fog_color:new t.Uniform4f(N),u_fog_horizon_blend:new t.Uniform1f(N),u_fog_temporal_offset:new t.Uniform1f(N),u_frustum_tl:new t.Uniform3f(N),u_frustum_tr:new t.Uniform3f(N),u_frustum_br:new t.Uniform3f(N),u_frustum_bl:new t.Uniform3f(N),u_globe_pos:new t.Uniform3f(N),u_globe_radius:new t.Uniform1f(N),u_globe_transition:new t.Uniform1f(N),u_is_globe:new t.Uniform1i(N),u_viewport:new t.Uniform2f(N)}))(s))}}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;let m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let y in h)m[y]&&m[y].set(this.program,y,h[y])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;let m=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let y in h)m[y]&&m[y].set(this.program,y,h[y])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;let m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let y in h)m[y].set(this.program,y,h[y])}}draw(s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H){let K=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(m),s.setStencilMode(y),s.setColorMode(x),s.setCullFace(T);for(let W of Object.keys(this.fixedUniforms))this.fixedUniforms[W].set(this.program,W,E[W]);X&&X.setUniforms(this.program,s,this.binderUniforms,$,{zoom:Z});let N={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[h];for(let W of F.get()){let Q=W.vaos||(W.vaos={});(Q[A]||(Q[A]=new H0)).bind(s,this,R,X?X.getPaintVertexBuffers():[],q,W.vertexOffset,H||[]),K.drawElements(h,W.primitiveLength*N,K.UNSIGNED_SHORT,W.primitiveOffset*N*2)}}}function Zl(d,s){let h=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,d.transform.tileZoom)/h,y=m*(s.tileID.canonical.x+s.tileID.wrap*h),x=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ke(s,1,d.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x]}}let m_=t.create(),ed=(d,s,h,m,y,x,T,E,A,R,q)=>{let F=s.style.light,$=F.properties.get("position"),Z=[$.x,$.y,$.z],X=t.create$1();F.properties.get("anchor")==="viewport"&&(t.fromRotation(X,-s.transform.angle),t.transformMat3(Z,Z,X));let H=F.properties.get("color"),K=s.transform,N={u_matrix:d,u_lightpos:Z,u_lightintensity:F.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+h,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:m_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:x};return K.projection.name==="globe"&&(N.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],N.u_zoom_transition=A,N.u_inv_rot_matrix=q,N.u_merc_center=R,N.u_up_dir=K.projection.upVector(new t.CanonicalTileID(0,0,0),R[0]*t.EXTENT,R[1]*t.EXTENT),N.u_height_lift=E),N},__=(d,s,h,m,y,x,T,E,A,R,q,F)=>{let $=ed(d,s,h,m,y,x,T,A,R,q,F),Z={u_height_factor:-Math.pow(2,T.overscaledZ)/E.tileSize/8};return t.extend($,Zl(s,E),Z)},Va=d=>({u_matrix:d}),td=(d,s,h)=>t.extend(Va(d),Zl(s,h)),X0=(d,s)=>({u_matrix:d,u_world:s}),K0=(d,s,h,m)=>t.extend(td(d,s,h),{u_world:m}),Y0=t.create(),rd=(d,s,h,m,y,x)=>{let T=d.transform,E=T.projection.name==="globe",A;if(x.paint.get("circle-pitch-alignment")==="map")if(E){let q=t.globePixelsToTileUnits(T.zoom,s.canonical)*T._pixelsPerMercatorPixel;A=Float32Array.from([q,0,0,q])}else A=T.calculatePixelsToTileUnitsMatrix(h);else A=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);let R={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:d.translatePosMatrix(s.projMatrix,h,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:Y0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){R.u_inv_rot_matrix=m,R.u_merc_center=y,R.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],R.u_zoom_transition=t.globeToMercatorTransition(T.zoom);let q=y[0]*t.EXTENT,F=y[1]*t.EXTENT;R.u_up_dir=T.projection.upVector(new t.CanonicalTileID(0,0,0),q,F)}return R},id=d=>{let s=[];return d.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s},nd=(d,s,h,m)=>{let y=t.EXTENT/h.tileSize;return{u_matrix:d,u_camera_to_center_distance:s.getCameraToCenterDistance(m),u_extrude_scale:[s.pixelsToGLUnits[0]/y,s.pixelsToGLUnits[1]/y]}},_c=(d,s,h=1)=>({u_matrix:d,u_color:s,u_overlay:0,u_overlay_scale:h}),y_=t.create(),g_=(d,s,h,m,y,x,T)=>{let E=d.transform,A=E.projection.name==="globe",R=A?t.globePixelsToTileUnits(E.zoom,s.canonical)*E._pixelsPerMercatorPixel:Ke(h,1,x),q={u_matrix:s.projMatrix,u_extrude_scale:R,u_intensity:T,u_inv_rot_matrix:y_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){q.u_inv_rot_matrix=m,q.u_merc_center=y,q.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],q.u_zoom_transition=t.globeToMercatorTransition(E.zoom);let F=y[0]*t.EXTENT,$=y[1]*t.EXTENT;q.u_up_dir=E.projection.upVector(new t.CanonicalTileID(0,0,0),F,$)}return q},J0=(d,s,h,m,y,x,T)=>{let E=d.transform,A=E.calculatePixelsToTileUnitsMatrix(s);return{u_matrix:od(d,s,h,m),u_pixels_to_tile_units:A,u_device_pixel_ratio:x,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:Xl(h)?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ds(s,d.transform),u_alpha_discard_threshold:0,u_trim_offset:T}},Hl=(d,s,h,m,y)=>{let x=d.transform;return{u_matrix:od(d,s,h,m),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:Ds(s,x),u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ds(d,s){return 1/Ke(d,1,s.tileZoom)}function od(d,s,h,m){return d.translatePosMatrix(m||s.tileID.projMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Xl(d){let s=d.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}let ad=(d,s,h,m,y,x)=>{return{u_matrix:d,u_tl_parent:s,u_scale_parent:h,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(E=y.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(T=y.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:io(y.paint.get("raster-hue-rotate")),u_perspective_transform:x};var T,E};function io(d){d*=Math.PI/180;let s=Math.sin(d),h=Math.cos(d);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}let yc=t.create(),sd=(d,s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H)=>{let K=y.transform,N={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:K.width/K.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+A,u_pitch_with_map:+m,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:yc,u_up_vector:[0,-1,0]};return H.name==="globe"&&(N.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],N.u_zoom_transition=F,N.u_inv_rot_matrix=Z,N.u_merc_center=$,N.u_camera_forward=K._camera.forward(),N.u_ecef_origin=t.globeECEFOrigin(K.globeMatrix,q.toUnwrapped()),N.u_tile_matrix=Float32Array.from(K.globeMatrix),N.u_up_vector=X),N},gc=(d,s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H,K)=>t.extend(sd(d,s,h,m,y,x,T,E,A,R,F,$,Z,X,H,K),{u_gamma_scale:m?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+q}),v_=(d,s,h,m,y,x,T,E,A,R,q,F,$,Z,X,H)=>t.extend(gc(d,s,h,m,y,x,T,E,!0,A,!0,q,F,$,Z,X,H),{u_texsize_icon:R,u_texture_icon:1}),ld=(d,s,h)=>({u_matrix:d,u_opacity:s,u_color:h}),Q0=(d,s,h,m,y)=>t.extend(function(x,T,E){let A=T.imageManager.getPattern(x.toString()),{width:R,height:q}=T.imageManager.getPixelSize(),F=Math.pow(2,E.tileID.overscaledZ),$=E.tileSize*Math.pow(2,T.transform.tileZoom)/F,Z=$*(E.tileID.canonical.x+E.tileID.wrap*F),X=$*E.tileID.canonical.y;return{u_image:0,u_pattern_tl:A.tl,u_pattern_br:A.br,u_texsize:[R,q],u_pattern_size:A.displaySize,u_tile_units_to_pixels:1/Ke(E,1,T.transform.tileZoom),u_pixel_coord_upper:[Z>>16,X>>16],u_pixel_coord_lower:[65535&Z,65535&X]}}(m,h,y),{u_matrix:d,u_opacity:s}),ud={fillExtrusion:d=>({u_matrix:new t.UniformMatrix4f(d),u_lightpos:new t.Uniform3f(d),u_lightintensity:new t.Uniform1f(d),u_lightcolor:new t.Uniform3f(d),u_vertical_gradient:new t.Uniform1f(d),u_opacity:new t.Uniform1f(d),u_edge_radius:new t.Uniform1f(d),u_ao:new t.Uniform2f(d),u_tile_id:new t.Uniform3f(d),u_zoom_transition:new t.Uniform1f(d),u_inv_rot_matrix:new t.UniformMatrix4f(d),u_merc_center:new t.Uniform2f(d),u_up_dir:new t.Uniform3f(d),u_height_lift:new t.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new t.UniformMatrix4f(d),u_lightpos:new t.Uniform3f(d),u_lightintensity:new t.Uniform1f(d),u_lightcolor:new t.Uniform3f(d),u_vertical_gradient:new t.Uniform1f(d),u_height_factor:new t.Uniform1f(d),u_edge_radius:new t.Uniform1f(d),u_ao:new t.Uniform2f(d),u_tile_id:new t.Uniform3f(d),u_zoom_transition:new t.Uniform1f(d),u_inv_rot_matrix:new t.UniformMatrix4f(d),u_merc_center:new t.Uniform2f(d),u_up_dir:new t.Uniform3f(d),u_height_lift:new t.Uniform1f(d),u_image:new t.Uniform1i(d),u_texsize:new t.Uniform2f(d),u_pixel_coord_upper:new t.Uniform2f(d),u_pixel_coord_lower:new t.Uniform2f(d),u_tile_units_to_pixels:new t.Uniform1f(d),u_opacity:new t.Uniform1f(d)}),fill:d=>({u_matrix:new t.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new t.UniformMatrix4f(d),u_image:new t.Uniform1i(d),u_texsize:new t.Uniform2f(d),u_pixel_coord_upper:new t.Uniform2f(d),u_pixel_coord_lower:new t.Uniform2f(d),u_tile_units_to_pixels:new t.Uniform1f(d)}),fillOutline:d=>({u_matrix:new t.UniformMatrix4f(d),u_world:new t.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new t.UniformMatrix4f(d),u_world:new t.Uniform2f(d),u_image:new t.Uniform1i(d),u_texsize:new t.Uniform2f(d),u_pixel_coord_upper:new t.Uniform2f(d),u_pixel_coord_lower:new t.Uniform2f(d),u_tile_units_to_pixels:new t.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new t.Uniform1f(d),u_extrude_scale:new t.UniformMatrix2f(d),u_device_pixel_ratio:new t.Uniform1f(d),u_matrix:new t.UniformMatrix4f(d),u_inv_rot_matrix:new t.UniformMatrix4f(d),u_merc_center:new t.Uniform2f(d),u_tile_id:new t.Uniform3f(d),u_zoom_transition:new t.Uniform1f(d),u_up_dir:new t.Uniform3f(d)}),collisionBox:d=>({u_matrix:new t.UniformMatrix4f(d),u_camera_to_center_distance:new t.Uniform1f(d),u_extrude_scale:new t.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new t.UniformMatrix4f(d),u_inv_matrix:new t.UniformMatrix4f(d),u_camera_to_center_distance:new t.Uniform1f(d),u_viewport_size:new t.Uniform2f(d)}),debug:d=>({u_color:new t.UniformColor(d),u_matrix:new t.UniformMatrix4f(d),u_overlay:new t.Uniform1i(d),u_overlay_scale:new t.Uniform1f(d)}),clippingMask:d=>({u_matrix:new t.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new t.Uniform1f(d),u_intensity:new t.Uniform1f(d),u_matrix:new t.UniformMatrix4f(d),u_inv_rot_matrix:new t.UniformMatrix4f(d),u_merc_center:new t.Uniform2f(d),u_tile_id:new t.Uniform3f(d),u_zoom_transition:new t.Uniform1f(d),u_up_dir:new t.Uniform3f(d)}),heatmapTexture:d=>({u_image:new t.Uniform1i(d),u_color_ramp:new t.Uniform1i(d),u_opacity:new t.Uniform1f(d)}),hillshade:d=>({u_matrix:new t.UniformMatrix4f(d),u_image:new t.Uniform1i(d),u_latrange:new t.Uniform2f(d),u_light:new t.Uniform2f(d),u_shadow:new t.UniformColor(d),u_highlight:new t.UniformColor(d),u_accent:new t.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new t.UniformMatrix4f(d),u_image:new t.Uniform1i(d),u_dimension:new t.Uniform2f(d),u_zoom:new t.Uniform1f(d),u_unpack:new t.Uniform4f(d)}),line:d=>({u_matrix:new t.UniformMatrix4f(d),u_pixels_to_tile_units:new t.UniformMatrix2f(d),u_device_pixel_ratio:new t.Uniform1f(d),u_units_to_pixels:new t.Uniform2f(d),u_dash_image:new t.Uniform1i(d),u_gradient_image:new t.Uniform1i(d),u_image_height:new t.Uniform1f(d),u_texsize:new t.Uniform2f(d),u_tile_units_to_pixels:new t.Uniform1f(d),u_alpha_discard_threshold:new t.Uniform1f(d),u_trim_offset:new t.Uniform2f(d)}),linePattern:d=>({u_matrix:new t.UniformMatrix4f(d),u_texsize:new t.Uniform2f(d),u_pixels_to_tile_units:new t.UniformMatrix2f(d),u_device_pixel_ratio:new t.Uniform1f(d),u_image:new t.Uniform1i(d),u_units_to_pixels:new t.Uniform2f(d),u_tile_units_to_pixels:new t.Uniform1f(d),u_alpha_discard_threshold:new t.Uniform1f(d)}),raster:d=>({u_matrix:new t.UniformMatrix4f(d),u_tl_parent:new t.Uniform2f(d),u_scale_parent:new t.Uniform1f(d),u_fade_t:new t.Uniform1f(d),u_opacity:new t.Uniform1f(d),u_image0:new t.Uniform1i(d),u_image1:new t.Uniform1i(d),u_brightness_low:new t.Uniform1f(d),u_brightness_high:new t.Uniform1f(d),u_saturation_factor:new t.Uniform1f(d),u_contrast_factor:new t.Uniform1f(d),u_spin_weights:new t.Uniform3f(d),u_perspective_transform:new t.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new t.Uniform1i(d),u_is_size_feature_constant:new t.Uniform1i(d),u_size_t:new t.Uniform1f(d),u_size:new t.Uniform1f(d),u_camera_to_center_distance:new t.Uniform1f(d),u_rotate_symbol:new t.Uniform1i(d),u_aspect_ratio:new t.Uniform1f(d),u_fade_change:new t.Uniform1f(d),u_matrix:new t.UniformMatrix4f(d),u_label_plane_matrix:new t.UniformMatrix4f(d),u_coord_matrix:new t.UniformMatrix4f(d),u_is_text:new t.Uniform1i(d),u_pitch_with_map:new t.Uniform1i(d),u_texsize:new t.Uniform2f(d),u_tile_id:new t.Uniform3f(d),u_zoom_transition:new t.Uniform1f(d),u_inv_rot_matrix:new t.UniformMatrix4f(d),u_merc_center:new t.Uniform2f(d),u_camera_forward:new t.Uniform3f(d),u_tile_matrix:new t.UniformMatrix4f(d),u_up_vector:new t.Uniform3f(d),u_ecef_origin:new t.Uniform3f(d),u_texture:new t.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new t.Uniform1i(d),u_is_size_feature_constant:new t.Uniform1i(d),u_size_t:new t.Uniform1f(d),u_size:new t.Uniform1f(d),u_camera_to_center_distance:new t.Uniform1f(d),u_rotate_symbol:new t.Uniform1i(d),u_aspect_ratio:new t.Uniform1f(d),u_fade_change:new t.Uniform1f(d),u_matrix:new t.UniformMatrix4f(d),u_label_plane_matrix:new t.UniformMatrix4f(d),u_coord_matrix:new t.UniformMatrix4f(d),u_is_text:new t.Uniform1i(d),u_pitch_with_map:new t.Uniform1i(d),u_texsize:new t.Uniform2f(d),u_texture:new t.Uniform1i(d),u_gamma_scale:new t.Uniform1f(d),u_device_pixel_ratio:new t.Uniform1f(d),u_tile_id:new t.Uniform3f(d),u_zoom_transition:new t.Uniform1f(d),u_inv_rot_matrix:new t.UniformMatrix4f(d),u_merc_center:new t.Uniform2f(d),u_camera_forward:new t.Uniform3f(d),u_tile_matrix:new t.UniformMatrix4f(d),u_up_vector:new t.Uniform3f(d),u_ecef_origin:new t.Uniform3f(d),u_is_halo:new t.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new t.Uniform1i(d),u_is_size_feature_constant:new t.Uniform1i(d),u_size_t:new t.Uniform1f(d),u_size:new t.Uniform1f(d),u_camera_to_center_distance:new t.Uniform1f(d),u_rotate_symbol:new t.Uniform1i(d),u_aspect_ratio:new t.Uniform1f(d),u_fade_change:new t.Uniform1f(d),u_matrix:new t.UniformMatrix4f(d),u_label_plane_matrix:new t.UniformMatrix4f(d),u_coord_matrix:new t.UniformMatrix4f(d),u_is_text:new t.Uniform1i(d),u_pitch_with_map:new t.Uniform1i(d),u_texsize:new t.Uniform2f(d),u_texsize_icon:new t.Uniform2f(d),u_texture:new t.Uniform1i(d),u_texture_icon:new t.Uniform1i(d),u_gamma_scale:new t.Uniform1f(d),u_device_pixel_ratio:new t.Uniform1f(d),u_is_halo:new t.Uniform1i(d)}),background:d=>({u_matrix:new t.UniformMatrix4f(d),u_opacity:new t.Uniform1f(d),u_color:new t.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new t.UniformMatrix4f(d),u_opacity:new t.Uniform1f(d),u_image:new t.Uniform1i(d),u_pattern_tl:new t.Uniform2f(d),u_pattern_br:new t.Uniform2f(d),u_texsize:new t.Uniform2f(d),u_pattern_size:new t.Uniform2f(d),u_pixel_coord_upper:new t.Uniform2f(d),u_pixel_coord_lower:new t.Uniform2f(d),u_tile_units_to_pixels:new t.Uniform1f(d)}),terrainRaster:Kf,terrainDepth:Kf,skybox:d=>({u_matrix:new t.UniformMatrix4f(d),u_sun_direction:new t.Uniform3f(d),u_cubemap:new t.Uniform1i(d),u_opacity:new t.Uniform1f(d),u_temporal_offset:new t.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new t.UniformMatrix4f(d),u_color_ramp:new t.Uniform1i(d),u_center_direction:new t.Uniform3f(d),u_radius:new t.Uniform1f(d),u_opacity:new t.Uniform1f(d),u_temporal_offset:new t.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new t.UniformMatrix3f(d),u_sun_direction:new t.Uniform3f(d),u_sun_intensity:new t.Uniform1f(d),u_color_tint_r:new t.Uniform4f(d),u_color_tint_m:new t.Uniform4f(d),u_luminance:new t.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new t.UniformMatrix4f(d),u_globe_matrix:new t.UniformMatrix4f(d),u_normalize_matrix:new t.UniformMatrix4f(d),u_merc_matrix:new t.UniformMatrix4f(d),u_zoom_transition:new t.Uniform1f(d),u_merc_center:new t.Uniform2f(d),u_image0:new t.Uniform1i(d),u_grid_matrix:new t.UniformMatrix3f(d),u_skirt_height:new t.Uniform1f(d),u_frustum_tl:new t.Uniform3f(d),u_frustum_tr:new t.Uniform3f(d),u_frustum_br:new t.Uniform3f(d),u_frustum_bl:new t.Uniform3f(d),u_globe_pos:new t.Uniform3f(d),u_globe_radius:new t.Uniform1f(d),u_viewport:new t.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new t.Uniform3f(d),u_frustum_tr:new t.Uniform3f(d),u_frustum_br:new t.Uniform3f(d),u_frustum_bl:new t.Uniform3f(d),u_horizon:new t.Uniform1f(d),u_transition:new t.Uniform1f(d),u_fadeout_range:new t.Uniform1f(d),u_color:new t.Uniform4f(d),u_high_color:new t.Uniform4f(d),u_space_color:new t.Uniform4f(d),u_star_intensity:new t.Uniform1f(d),u_star_density:new t.Uniform1f(d),u_star_size:new t.Uniform1f(d),u_temporal_offset:new t.Uniform1f(d),u_horizon_angle:new t.Uniform1f(d),u_rotation_matrix:new t.UniformMatrix4f(d)})},vc;function Kl(d,s,h,m,y,x,T){let E=d.context,A=E.gl,R=d.transform,q=d.useProgram("collisionBox"),F=[],$=0,Z=0;for(let ee=0;ee<m.length;ee++){let he=m[ee],de=s.getTile(he),fe=de.getBucket(h);if(!fe)continue;let ve=wn(he,fe,R),ye=ve;y[0]===0&&y[1]===0||(ye=d.translatePosMatrix(ve,de,y,x));let Se=T?fe.textCollisionBox:fe.iconCollisionBox,Je=fe.collisionCircleArray;if(Je.length>0){let we=t.create(),ze=ye;t.mul(we,fe.placementInvProjMatrix,R.glCoordMatrix),t.mul(we,we,fe.placementViewportMatrix),F.push({circleArray:Je,circleOffset:Z,transform:ze,invTransform:we,projection:fe.getProjection()}),$+=Je.length/4,Z=$}Se&&(d.terrain&&d.terrain.setupElevationDraw(de,q),q.draw(E,A.LINES,t.DepthMode.disabled,t.StencilMode.disabled,d.colorModeForRenderPass(),t.CullFaceMode.disabled,nd(ye,R,de,fe.getProjection()),h.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,R.zoom,null,[Se.collisionVertexBuffer,Se.collisionVertexBufferExt]))}if(!T||!F.length)return;let X=d.useProgram("collisionCircle"),H=new t.StructArrayLayout2f1f2i16;H.resize(4*$),H._trim();let K=0;for(let ee of F)for(let he=0;he<ee.circleArray.length/4;he++){let de=4*he,fe=ee.circleArray[de+0],ve=ee.circleArray[de+1],ye=ee.circleArray[de+2],Se=ee.circleArray[de+3];H.emplace(K++,fe,ve,ye,Se,0),H.emplace(K++,fe,ve,ye,Se,1),H.emplace(K++,fe,ve,ye,Se,2),H.emplace(K++,fe,ve,ye,Se,3)}(!vc||vc.length<2*$)&&(vc=function(ee){let he=2*ee,de=new t.StructArrayLayout3ui6;de.resize(he),de._trim();for(let fe=0;fe<he;fe++){let ve=6*fe;de.uint16[ve+0]=4*fe+0,de.uint16[ve+1]=4*fe+1,de.uint16[ve+2]=4*fe+2,de.uint16[ve+3]=4*fe+2,de.uint16[ve+4]=4*fe+3,de.uint16[ve+5]=4*fe+0}return de}($));let N=E.createIndexBuffer(vc,!0),W=E.createVertexBuffer(H,t.collisionCircleLayout.members,!0);for(let ee of F){let he={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(Q=R).getCameraToCenterDistance(ee.projection),u_viewport_size:[Q.width,Q.height]};X.draw(E,A.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,d.colorModeForRenderPass(),t.CullFaceMode.disabled,he,h.id,W,N,t.SegmentVector.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,R.zoom)}var Q;W.destroy(),N.destroy()}let x_=t.create();function cd({width:d,height:s,anchor:h,textOffset:m,textScale:y},x){let{horizontalAlign:T,verticalAlign:E}=t.getAnchorAlignment(h),A=-(T-.5)*d,R=-(E-.5)*s,q=t.evaluateVariableOffset(h,m);return new t.Point((A/y+q[0])*x,(R/y+q[1])*x)}function ex(d,s,h,m,y,x,T,E,A,R,q){let F=d.text.placedSymbolArray,$=d.text.dynamicLayoutVertexArray,Z=d.icon.dynamicLayoutVertexArray,X={},H=d.getProjection(),K=Fr(E,H,x),N=x.elevation,W=H.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;$.clear();for(let Q=0;Q<F.length;Q++){let ee=F.get(Q),{tileAnchorX:he,tileAnchorY:de,numGlyphs:fe}=ee,ve=ee.hidden||!ee.crossTileID||d.allowVerticalPlacement&&!ee.placedOrientation?null:m[ee.crossTileID];if(ve){let ye=0,Se=0,Je=0;if(N){let rt=N?N.getAtTileOffset(E,he,de):0,[Tt,Rt,xt]=H.upVector(E.canonical,he,de);ye=rt*Tt*W,Se=rt*Rt*W,Je=rt*xt*W}let[we,ze,Oe,Ye]=wi(ee.projectedAnchorX+ye,ee.projectedAnchorY+Se,ee.projectedAnchorZ+Je,h?K:T),Ee=a_(x.getCameraToCenterDistance(H),Ye),Be=y.evaluateSizeForFeature(d.textSizeData,R,ee)*Ee/t.ONE_EM;h&&(Be*=d.tilePixelRatio/A);let et=cd(ve,Be);h?({x:we,y:ze,z:Oe}=H.projectTilePoint(he+et.x,de+et.y,E.canonical),[we,ze,Oe]=wi(we+ye,ze+Se,Oe+Je,T)):(s&&et._rotate(-x.angle),we+=et.x,ze+=et.y,Oe=0);let He=d.allowVerticalPlacement&&ee.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let rt=0;rt<fe;rt++)t.addDynamicAttributes($,we,ze,Oe,He);q&&ee.associatedIconIndex>=0&&(X[ee.associatedIconIndex]={x:we,y:ze,z:Oe,angle:He})}else jn(fe,$)}if(q){Z.clear();let Q=d.icon.placedSymbolArray;for(let ee=0;ee<Q.length;ee++){let he=Q.get(ee),{numGlyphs:de}=he,fe=X[ee];if(he.hidden||!fe)jn(de,Z);else{let{x:ve,y:ye,z:Se,angle:Je}=fe;for(let we=0;we<de;we++)t.addDynamicAttributes(Z,ve,ye,Se,Je)}}d.icon.dynamicLayoutVertexBuffer.updateData(Z)}d.text.dynamicLayoutVertexBuffer.updateData($)}function hd(d,s,h){return h.iconsInText&&s?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function b_(d,s,h,m,y,x,T,E,A,R,q,F){let $=d.context,Z=$.gl,X=d.transform,H=E==="map",K=A==="map",N=H&&h.layout.get("symbol-placement")!=="point",W=H&&!K&&!N,Q=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,ee=!1,he=d.depthModeForSublayer(0,t.DepthMode.ReadOnly),de=[t.mercatorXfromLng(X.center.lng),t.mercatorYfromLat(X.center.lat)],fe=h.layout.get("text-variable-anchor"),ve=X.projection.name==="globe",ye=[],Se=[0,-1,0],Je=Se;!ve&&!X.mercatorFromTransition||H||(Je=function(we){let ze=we._camera.getWorldToCamera(we.worldSize,1),Oe=t.multiply([],ze,we.globeMatrix);t.invert(Oe,Oe);let Ye=[0,0,0],Ee=[0,1,0,0];return t.transformMat4$1(Ee,Ee,Oe),Ye[0]=Ee[0],Ye[1]=Ee[1],Ye[2]=Ee[2],t.normalize(Ye,Ye),Ye}(X));for(let we of m){let ze=s.getTile(we),Oe=ze.getBucket(h);if(!Oe||Oe.projection.name==="mercator"&&ve)continue;let Ye=y?Oe.text:Oe.icon;if(!Ye||Oe.fullyClipped||!Ye.segments.get().length)continue;let Ee=Ye.programConfigurations.get(h.id),Be=y||Oe.sdfIcons,et=y?Oe.textSizeData:Oe.iconSizeData,He=K||X.pitch!==0,rt=t.evaluateSizeForZoom(et,X.zoom),Tt,Rt,xt,Ot,Xt=[0,0],Wt=null;if(y)Rt=ze.glyphAtlasTexture,xt=Z.LINEAR,Tt=ze.glyphAtlasTexture.size,Oe.iconsInText&&(Xt=ze.imageAtlasTexture.size,Wt=ze.imageAtlasTexture,Ot=He||d.options.rotating||d.options.zooming||et.kind==="composite"||et.kind==="camera"?Z.LINEAR:Z.NEAREST);else{let Lo=h.layout.get("icon-size").constantOr(0)!==1||Oe.iconsNeedLinear;Rt=ze.imageAtlasTexture,xt=Be||d.options.rotating||d.options.zooming||Lo||He?Z.LINEAR:Z.NEAREST,Tt=ze.imageAtlasTexture.size}let wt=Oe.projection.name==="globe",mr=wt?Je:Se,xr=wt?t.globeToMercatorTransition(X.zoom):0,br=Fr(we,Oe.getProjection(),X),wr=X.calculatePixelsToTileUnitsMatrix(ze),ki=Re(br,ze.tileID.canonical,K,H,X,Oe.getProjection(),wr),Ei=d.terrain&&K&&N?t.invert(t.create(),ki):x_,In=ni(br,ze.tileID.canonical,K,H,X,Oe.getProjection(),wr),oo=fe&&Oe.hasTextData(),Nr=h.layout.get("icon-text-fit")!=="none"&&oo&&Oe.hasIconData();if(N){let Lo=X.elevation,la=Lo?Lo.getAtTileOffsetFunc(we,X.center.lat,X.worldSize,Oe.getProjection()):null,Ha=Ao(br,ze.tileID.canonical,K,H,X,Oe.getProjection(),wr);Bf(Oe,br,d,y,Ha,In,K,R,la,we)}let Tr=N||y&&fe||Nr,sr=d.translatePosMatrix(br,ze,x,T),oi=Tr?x_:ki,$i=d.translatePosMatrix(In,ze,x,T,!0),kr=Oe.getProjection().createInversionMatrix(X,we.canonical),Ki=[];d.terrainRenderModeElevated()&&K&&Ki.push("PITCH_WITH_MAP_TERRAIN"),wt&&Ki.push("PROJECTION_GLOBE_VIEW"),Tr&&Ki.push("PROJECTED_POS_ON_VIEWPORT");let Lc=Be&&h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Za;Za=Be?Oe.iconsInText?v_(et.kind,rt,W,K,d,sr,oi,$i,Tt,Xt,we,xr,de,kr,mr,Oe.getProjection()):gc(et.kind,rt,W,K,d,sr,oi,$i,y,Tt,!0,we,xr,de,kr,mr,Oe.getProjection()):sd(et.kind,rt,W,K,d,sr,oi,$i,y,Tt,we,xr,de,kr,mr,Oe.getProjection());let su={program:d.useProgram(hd(Be,y,Oe),Ee,Ki),buffers:Ye,uniformValues:Za,atlasTexture:Rt,atlasTextureIcon:Wt,atlasInterpolation:xt,atlasInterpolationIcon:Ot,isSDF:Be,hasHalo:Lc,tile:ze,labelPlaneMatrixInv:Ei};if(Q&&Oe.canOverlap){ee=!0;let Lo=Ye.segments.get();for(let la of Lo)ye.push({segments:new t.SegmentVector([la]),sortKey:la.sortKey,state:su})}else ye.push({segments:Ye.segments,sortKey:0,state:su})}ee&&ye.sort((we,ze)=>we.sortKey-ze.sortKey);for(let we of ye){let ze=we.state;if(d.terrain&&d.terrain.setupElevationDraw(ze.tile,ze.program,{useDepthForOcclusion:!ve,labelPlaneMatrixInv:ze.labelPlaneMatrixInv}),$.activeTexture.set(Z.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,Z.CLAMP_TO_EDGE),ze.atlasTextureIcon&&($.activeTexture.set(Z.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),ze.isSDF){let Oe=ze.uniformValues;ze.hasHalo&&(Oe.u_is_halo=1,Yl(ze.buffers,we.segments,h,d,ze.program,he,q,F,Oe)),Oe.u_is_halo=0}Yl(ze.buffers,we.segments,h,d,ze.program,he,q,F,ze.uniformValues)}}function Yl(d,s,h,m,y,x,T,E,A){let R=m.context,q=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];y.draw(R,R.gl.TRIANGLES,x,T,E,t.CullFaceMode.disabled,A,h.id,d.layoutVertexBuffer,d.indexBuffer,s,h.paint,m.transform.zoom,d.programConfigurations.get(h.id),q)}function w_(d,s,h,m,y,x,T){let E=d.context.gl,A=h.paint.get("fill-pattern"),R=A&&A.constantOr(1),q,F,$,Z,X;T?(F=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=E.LINES):(F=R?"fillPattern":"fill",q=E.TRIANGLES);for(let H of m){let K=s.getTile(H);if(R&&!K.patternsLoaded())continue;let N=K.getBucket(h);if(!N)continue;d.prepareDrawTile();let W=N.programConfigurations.get(h.id),Q=d.useProgram(F,W);R&&(d.context.activeTexture.set(E.TEXTURE0),K.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),W.updatePaintBuffers());let ee=A.constantOr(null);if(ee&&K.imageAtlas){let de=K.imageAtlas.patternPositions[ee.toString()];de&&W.setConstantPatternPositions(de)}let he=d.translatePosMatrix(H.projMatrix,K,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(T){Z=N.indexBuffer2,X=N.segments2;let de=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];$=F==="fillOutlinePattern"&&R?K0(he,d,K,de):X0(he,de)}else Z=N.indexBuffer,X=N.segments,$=R?td(he,d,K):Va(he);d.prepareDrawProgram(d.context,Q,H.toUnwrapped()),Q.draw(d.context,q,y,d.stencilModeForClipping(H),x,t.CullFaceMode.disabled,$,h.id,N.layoutVertexBuffer,Z,X,h.paint,d.transform.zoom,W)}}function xc(d,s,h,m,y,x,T){let E=d.context,A=E.gl,R=d.transform,q=h.paint.get("fill-extrusion-pattern"),F=q.constantOr(1),$=h.paint.get("fill-extrusion-opacity"),Z=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],X=h.layout.get("fill-extrusion-edge-radius"),H=X>0&&!h.paint.get("fill-extrusion-rounded-roof"),K=H?0:X,N=R.projection.name==="globe"?t.fillExtrusionHeightLift():0,W=R.projection.name==="globe",Q=W?t.globeToMercatorTransition(R.zoom):0,ee=[t.mercatorXfromLng(R.center.lng),t.mercatorYfromLat(R.center.lat)],he=[];W&&he.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&he.push("FAUX_AO"),H&&he.push("ZERO_ROOF_RADIUS");for(let de of m){let fe=s.getTile(de),ve=fe.getBucket(h);if(!ve||ve.projection.name!==R.projection.name)continue;let ye=ve.programConfigurations.get(h.id),Se=d.useProgram(F?"fillExtrusionPattern":"fillExtrusion",ye,he);if(d.terrain){let Be=d.terrain;if(d.style.terrainSetForDrapingOnly())Be.setupElevationDraw(fe,Se,{useMeterToDem:!0});else{if(!ve.enableTerrain)continue;if(Be.setupElevationDraw(fe,Se,{useMeterToDem:!0}),T_(E,s,de,ve,h,Be),!ve.centroidVertexBuffer){let et=Se.attributes.a_centroid_pos;et!==void 0&&A.vertexAttrib2f(et,0,0)}}}F&&(d.context.activeTexture.set(A.TEXTURE0),fe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ye.updatePaintBuffers());let Je=q.constantOr(null);if(Je&&fe.imageAtlas){let Be=fe.imageAtlas.patternPositions[Je.toString()];Be&&ye.setConstantPatternPositions(Be)}let we=d.translatePosMatrix(de.projMatrix,fe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ze=R.projection.createInversionMatrix(R,de.canonical),Oe=h.paint.get("fill-extrusion-vertical-gradient"),Ye=F?__(we,d,Oe,$,Z,K,de,fe,N,Q,ee,ze):ed(we,d,Oe,$,Z,K,de,N,Q,ee,ze);d.prepareDrawProgram(E,Se,de.toUnwrapped());let Ee=[];d.terrain&&Ee.push(ve.centroidVertexBuffer),W&&Ee.push(ve.layoutVertexExtBuffer),Se.draw(E,E.gl.TRIANGLES,y,x,T,t.CullFaceMode.backCCW,Ye,h.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,h.paint,d.transform.zoom,ye,Ee)}}function T_(d,s,h,m,y,x){let T=[N=>{let W=N.canonical.x-1,Q=N.wrap;return W<0&&(W=(1<<N.canonical.z)-1,Q--),new t.OverscaledTileID(N.overscaledZ,Q,N.canonical.z,W,N.canonical.y)},N=>{let W=N.canonical.x+1,Q=N.wrap;return W===1<<N.canonical.z&&(W=0,Q++),new t.OverscaledTileID(N.overscaledZ,Q,N.canonical.z,W,N.canonical.y)},N=>new t.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,(N.canonical.y===0?1<<N.canonical.z:N.canonical.y)-1),N=>new t.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y===(1<<N.canonical.z)-1?0:N.canonical.y+1)],E=N=>{let W=s.getSource().minzoom,Q=he=>{let de=s.getTileByID(he);if(de&&de.hasData())return de.getBucket(y)},ee=[0,-1,1];for(let he of ee){if(N.overscaledZ+he<W)continue;let de=Q(N.calculateScaledKey(N.overscaledZ+he));if(de)return de}},A=[0,0,0],R=(N,W)=>(A[0]=Math.min(N.min.y,W.min.y),A[1]=Math.max(N.max.y,W.max.y),A[2]=t.EXTENT-W.min.x>N.max.x?W.min.x-t.EXTENT:N.max.x,A),q=(N,W)=>(A[0]=Math.min(N.min.x,W.min.x),A[1]=Math.max(N.max.x,W.max.x),A[2]=t.EXTENT-W.min.y>N.max.y?W.min.y-t.EXTENT:N.max.y,A),F=[(N,W)=>R(N,W),(N,W)=>R(W,N),(N,W)=>q(N,W),(N,W)=>q(W,N)],$=new t.Point(0,0),Z,X,H,K=(N,W,Q,ee,he)=>{let de=[[ee?Q:N,ee?N:Q,0],[ee?Q:W,ee?W:Q,0]],fe=he<0?t.EXTENT+he:he,ve=[ee?fe:(N+W)/2,ee?(N+W)/2:fe,0];return Q===0&&he<0||Q!==0&&he>0?x.getForTilePoints(H,[ve],!0,X):de.push(ve),x.getForTilePoints(h,de,!0,Z),Math.max(de[0][2],de[1][2],ve[2])/x.exaggeration()};for(let N=0;N<4;N++){let W=(N<2?1:5)-N,Q=m.borders[N];if(Q.length===0)continue;let ee=H=T[N](h),he=E(ee);if(!(he&&he instanceof t.FillExtrusionBucket&&he.enableTerrain)||m.borderDoneWithNeighborZ[N]===he.canonical.z&&he.borderDoneWithNeighborZ[W]===m.canonical.z||(X=x.findDEMTileFor(ee),!X||!X.dem))continue;if(!Z){let ye=x.findDEMTileFor(h);if(!ye||!ye.dem)return;Z=ye}let de=he.borders[W],fe=0,ve=he.borderDoneWithNeighborZ[W]!==m.canonical.z;if(m.canonical.z===he.canonical.z){for(let ye=0;ye<Q.length;ye++){let Se=m.featuresOnBorder[Q[ye]],Je=Se.borders[N],we;for(;fe<de.length&&(we=he.featuresOnBorder[de[fe]],!(we.borders[W][1]>Je[0]+3));)ve&&he.encodeCentroid(void 0,we,!1),fe++;if(we&&fe<de.length){let ze=fe,Oe=0;for(;!(we.borders[W][0]>Je[1]-3)&&(Oe++,++fe!==de.length);)we=he.featuresOnBorder[de[fe]];if(we=he.featuresOnBorder[de[ze]],Se.intersectsCount()>1||we.intersectsCount()>1||Oe!==1){Oe!==1&&(fe=ze),m.encodeCentroid(void 0,Se,!1),ve&&he.encodeCentroid(void 0,we,!1);continue}let Ye=F[N](Se,we),Ee=N%2?t.EXTENT-1:0;$.x=K(Ye[0],Math.min(t.EXTENT-1,Ye[1]),Ee,N<2,Ye[2]),$.y=0,m.encodeCentroid($,Se,!1),ve&&he.encodeCentroid($,we,!1)}else m.encodeCentroid(void 0,Se,!1)}m.borderDoneWithNeighborZ[N]=he.canonical.z,m.needsCentroidUpdate=!0,ve&&(he.borderDoneWithNeighborZ[W]=m.canonical.z,he.needsCentroidUpdate=!0)}else{for(let ye of Q)m.encodeCentroid(void 0,m.featuresOnBorder[ye],!1);if(ve){for(let ye of de)he.encodeCentroid(void 0,he.featuresOnBorder[ye],!1);he.borderDoneWithNeighborZ[W]=m.canonical.z,he.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[N]=he.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(d)}let Ls=new t.Color(1,0,0,1),tx=new t.Color(0,1,0,1),rx=new t.Color(0,0,1,1),ix=new t.Color(1,0,1,1),nx=new t.Color(0,1,1,1);function ox(d,s,h){let m=d.context,y=d.transform,x=m.gl,T=y.projection.name==="globe",E=T?["PROJECTION_GLOBE_VIEW"]:null,A=h.projMatrix;if(T&&t.globeToMercatorTransition(y.zoom)>0){let Se=t.transitionTileAABBinECEF(h.canonical,y),Je=t.globeDenormalizeECEF(Se);A=t.multiply(new Float32Array(16),y.globeMatrix,Je),t.multiply(A,y.projMatrix,A)}let R=d.useProgram("debug",null,E),q=s.getTileByID(h.key);d.terrain&&d.terrain.setupElevationDraw(q,R);let F=t.DepthMode.disabled,$=t.StencilMode.disabled,Z=d.colorModeForRenderPass(),X="$debug";m.activeTexture.set(x.TEXTURE0),d.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),T?q._makeGlobeTileDebugBuffers(d.context,y):q._makeDebugTileBoundsBuffers(d.context,y.projection);let H=q._tileDebugBuffer||d.debugBuffer,K=q._tileDebugIndexBuffer||d.debugIndexBuffer,N=q._tileDebugSegments||d.debugSegments;R.draw(m,x.LINE_STRIP,F,$,Z,t.CullFaceMode.disabled,_c(A,t.Color.red),X,H,K,N,null,null,null,[q._globeTileDebugBorderBuffer]);let W=q.latestRawTileData,Q=Math.floor((W&&W.byteLength||0)/1024),ee=s.getTile(h).tileSize,he=512/Math.min(ee,512)*(h.overscaledZ/y.zoom)*.5,de=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(de+=` => ${h.overscaledZ}`),de+=` ${Q}kb`,function(Se,Je){Se.initDebugOverlayCanvas();let we=Se.debugOverlayCanvas,ze=Se.context.gl,Oe=Se.debugOverlayCanvas.getContext("2d");Oe.clearRect(0,0,we.width,we.height),Oe.shadowColor="white",Oe.shadowBlur=2,Oe.lineWidth=1.5,Oe.strokeStyle="white",Oe.textBaseline="top",Oe.font="bold 36px Open Sans, sans-serif",Oe.fillText(Je,5,5),Oe.strokeText(Je,5,5),Se.debugOverlayTexture.update(we),Se.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(d,de);let fe=q._tileDebugTextBuffer||d.debugBuffer,ve=q._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,ye=q._tileDebugTextSegments||d.debugSegments;R.draw(m,x.TRIANGLES,F,$,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,_c(A,t.Color.transparent,he),X,fe,ve,ye,null,null,null,[q._globeTileDebugTextBuffer])}function E_(d,s,h,m){ks(d,0,s+h/2,d.transform.width,h,m)}function bc(d,s,h,m){ks(d,s-h/2,0,h,d.transform.height,m)}function ks(d,s,h,m,y,x){let T=d.context,E=T.gl;E.enable(E.SCISSOR_TEST),E.scissor(s*t.exported.devicePixelRatio,h*t.exported.devicePixelRatio,m*t.exported.devicePixelRatio,y*t.exported.devicePixelRatio),T.clear({color:x}),E.disable(E.SCISSOR_TEST)}let S_=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:I_}=S_;function Ro(d,s,h,m){d.emplaceBack(s,h,m)}class wc{constructor(s){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,Ro(this.vertexArray,-1,-1,1),Ro(this.vertexArray,1,-1,1),Ro(this.vertexArray,-1,1,1),Ro(this.vertexArray,1,1,1),Ro(this.vertexArray,-1,-1,-1),Ro(this.vertexArray,1,-1,-1),Ro(this.vertexArray,-1,1,-1),Ro(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,I_),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function En(d,s,h,m,y,x){let T=d.gl,E=s.paint.get("sky-atmosphere-color"),A=s.paint.get("sky-atmosphere-halo-color"),R=s.paint.get("sky-atmosphere-sun-intensity"),q=((F,$,Z,X,H)=>({u_matrix_3f:F,u_sun_direction:$,u_sun_intensity:Z,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(t.fromMat4(t.create$1(),m),y,R,E,A);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),h.draw(d,T.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,q,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}let Jl=t.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class A_{constructor(s){let h=new t.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let m=new t.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,Jl.members),this.indexBuffer=s.createIndexBuffer(m),this.segments=t.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let $a={symbol:function(d,s,h,m,y){if(d.renderPass!=="translucent")return;let x=t.StencilMode.disabled,T=d.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(E,A,R,q,F,$,Z){let X=A.transform,H=F==="map",K=$==="map";for(let N of E){let W=q.getTile(N),Q=W.getBucket(R);if(!Q||!Q.text||!Q.text.segments.get().length)continue;let ee=t.evaluateSizeForZoom(Q.textSizeData,X.zoom),he=Fr(N,Q.getProjection(),X),de=X.calculatePixelsToTileUnitsMatrix(W),fe=Re(he,W.tileID.canonical,K,H,X,Q.getProjection(),de),ve=R.layout.get("icon-text-fit")!=="none"&&Q.hasIconData();if(ee){let ye=Math.pow(2,X.zoom-W.tileID.overscaledZ);ex(Q,H,K,Z,t.symbolSize,X,fe,N,ye,ee,ve)}}}(m,d,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),y),h.paint.get("icon-opacity").constantOr(1)!==0&&b_(d,s,h,m,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),x,T),h.paint.get("text-opacity").constantOr(1)!==0&&b_(d,s,h,m,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),x,T),s.map.showCollisionBoxes&&(Kl(d,s,h,m,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Kl(d,s,h,m,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(d,s,h,m){if(d.renderPass!=="translucent")return;let y=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),E=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;let A=d.context,R=A.gl,q=d.transform,F=d.depthModeForSublayer(0,t.DepthMode.ReadOnly),$=t.StencilMode.disabled,Z=d.colorModeForRenderPass(),X=q.projection.name==="globe",H=[t.mercatorXfromLng(q.center.lng),t.mercatorYfromLat(q.center.lat)],K=[];for(let W=0;W<m.length;W++){let Q=m[W],ee=s.getTile(Q),he=ee.getBucket(h);if(!he||he.projection.name!==q.projection.name)continue;let de=he.programConfigurations.get(h.id),fe=id(h);X&&fe.push("PROJECTION_GLOBE_VIEW");let ve=d.useProgram("circle",de,fe),ye=he.layoutVertexBuffer,Se=he.globeExtVertexBuffer,Je=he.indexBuffer,we=q.projection.createInversionMatrix(q,Q.canonical),ze={programConfiguration:de,program:ve,layoutVertexBuffer:ye,globeExtVertexBuffer:Se,indexBuffer:Je,uniformValues:rd(d,Q,ee,we,H,h),tile:ee};if(E){let Oe=he.segments.get();for(let Ye of Oe)K.push({segments:new t.SegmentVector([Ye]),sortKey:Ye.sortKey,state:ze})}else K.push({segments:he.segments,sortKey:0,state:ze})}E&&K.sort((W,Q)=>W.sortKey-Q.sortKey);let N={useDepthForOcclusion:!X};for(let W of K){let{programConfiguration:Q,program:ee,layoutVertexBuffer:he,globeExtVertexBuffer:de,indexBuffer:fe,uniformValues:ve,tile:ye}=W.state,Se=W.segments;d.terrain&&d.terrain.setupElevationDraw(ye,ee,N),d.prepareDrawProgram(A,ee,ye.tileID.toUnwrapped()),ee.draw(A,R.TRIANGLES,F,$,Z,t.CullFaceMode.disabled,ve,h.id,he,fe,Se,h.paint,q.zoom,Q,[de])}},heatmap:function(d,s,h,m){if(h.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let y=d.context,x=y.gl,T=t.StencilMode.disabled,E=new t.ColorMode([x.ONE,x.ONE],t.Color.transparent,[!0,!0,!0,!0]);(function(Z,X,H,K){let N=Z.gl,W=X.width*K,Q=X.height*K;Z.activeTexture.set(N.TEXTURE1),Z.viewport.set([0,0,W,Q]);let ee=H.heatmapFbo;if(!ee||ee&&(ee.width!==W||ee.height!==Q)){ee&&ee.destroy();let he=N.createTexture();N.bindTexture(N.TEXTURE_2D,he),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),ee=H.heatmapFbo=Z.createFramebuffer(W,Q,!1),function(de,fe,ve,ye,Se,Je){let we=de.gl;we.texImage2D(we.TEXTURE_2D,0,de.isWebGL2&&de.extRenderToTextureHalfFloat?we.RGBA16F:we.RGBA,Se,Je,0,we.RGBA,de.extRenderToTextureHalfFloat?de.isWebGL2?we.HALF_FLOAT:de.extTextureHalfFloat.HALF_FLOAT_OES:we.UNSIGNED_BYTE,null),ye.colorAttachment.set(ve)}(Z,0,he,ee,W,Q)}else N.bindTexture(N.TEXTURE_2D,ee.colorAttachment.get()),Z.bindFramebuffer.set(ee.framebuffer)})(y,d,h,d.transform.projection.name==="globe"?.5:.25),y.clear({color:t.Color.transparent});let A=d.transform,R=A.projection.name==="globe",q=R?["PROJECTION_GLOBE_VIEW"]:null,F=R?t.CullFaceMode.frontCCW:t.CullFaceMode.disabled,$=[t.mercatorXfromLng(A.center.lng),t.mercatorYfromLat(A.center.lat)];for(let Z=0;Z<m.length;Z++){let X=m[Z];if(s.hasRenderableParent(X))continue;let H=s.getTile(X),K=H.getBucket(h);if(!K||K.projection.name!==A.projection.name)continue;let N=K.programConfigurations.get(h.id),W=d.useProgram("heatmap",N,q),{zoom:Q}=d.transform;d.terrain&&d.terrain.setupElevationDraw(H,W),d.prepareDrawProgram(y,W,X.toUnwrapped());let ee=A.projection.createInversionMatrix(A,X.canonical);W.draw(y,x.TRIANGLES,t.DepthMode.disabled,T,E,F,g_(d,X,H,ee,$,Q,h.paint.get("heatmap-intensity")),h.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,h.paint,d.transform.zoom,N,R?[K.globeExtVertexBuffer]:null)}y.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(y,x){let T=y.context,E=T.gl,A=x.heatmapFbo;if(!A)return;T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),T.activeTexture.set(E.TEXTURE1);let R=x.colorRampTexture;R||(R=x.colorRampTexture=new t.Texture(T,x.colorRamp,E.RGBA)),R.bind(E.LINEAR,E.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(T,E.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,y.colorModeForRenderPass(),t.CullFaceMode.disabled,((q,F,$,Z)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,x),x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(d,h))},line:function(d,s,h,m){if(d.renderPass!=="translucent")return;let y=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(y.constantOr(1)===0||x.constantOr(1)===0)return;let T=d.depthModeForSublayer(0,t.DepthMode.ReadOnly),E=d.colorModeForRenderPass(),A=d.terrain&&d.terrain.renderingToTexture?1:t.exported.devicePixelRatio,R=h.paint.get("line-dasharray"),q=R.constantOr(1),F=h.layout.get("line-cap"),$=h.paint.get("line-pattern"),Z=$.constantOr(1),X=h.paint.get("line-gradient"),H=Z?"linePattern":"line",K=d.context,N=K.gl,W=(ee=>{let he=[];Xl(ee)&&he.push("RENDER_LINE_DASH"),ee.paint.get("line-gradient")&&he.push("RENDER_LINE_GRADIENT");let de=ee.paint.get("line-trim-offset");de[0]===0&&de[1]===0||he.push("RENDER_LINE_TRIM_OFFSET");let fe=ee.paint.get("line-pattern").constantOr(1),ve=ee.paint.get("line-opacity").constantOr(1)!==1;return!fe&&ve&&he.push("RENDER_LINE_ALPHA_DISCARD"),he})(h),Q=W.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Q=!1);for(let ee of m){let he=s.getTile(ee);if(Z&&!he.patternsLoaded())continue;let de=he.getBucket(h);if(!de)continue;d.prepareDrawTile();let fe=de.programConfigurations.get(h.id),ve=d.useProgram(H,fe,W),ye=$.constantOr(null);if(ye&&he.imageAtlas){let Be=he.imageAtlas.patternPositions[ye.toString()];Be&&fe.setConstantPatternPositions(Be)}let Se=R.constantOr(null),Je=F.constantOr(null);if(!Z&&Se&&Je&&he.lineAtlas){let Be=he.lineAtlas.getDash(Se,Je);Be&&fe.setConstantPatternPositions(Be)}let[we,ze]=h.paint.get("line-trim-offset");(Je==="round"||Je==="square")&&we!==ze&&(we===0&&(we-=1),ze===1&&(ze+=1));let Oe=d.terrain?ee.projMatrix:null,Ye=Z?Hl(d,he,h,Oe,A):J0(d,he,h,Oe,de.lineClipsArray.length,A,[we,ze]);if(X){let Be=de.gradients[h.id],et=Be.texture;if(h.gradientVersion!==Be.version){let He=256;if(h.stepInterpolant){let rt=s.getSource().maxzoom,Tt=ee.canonical.z===rt?Math.ceil(1<<d.transform.maxZoom-ee.canonical.z):1;He=t.clamp(t.nextPowerOfTwo(de.maxLineLength/t.EXTENT*1024*Tt),256,K.maxTextureSize)}Be.gradient=t.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:He,image:Be.gradient||void 0,clips:de.lineClipsArray}),Be.texture?Be.texture.update(Be.gradient):Be.texture=new t.Texture(K,Be.gradient,N.RGBA),Be.version=h.gradientVersion,et=Be.texture}K.activeTexture.set(N.TEXTURE1),et.bind(h.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}q&&(K.activeTexture.set(N.TEXTURE0),he.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),fe.updatePaintBuffers()),Z&&(K.activeTexture.set(N.TEXTURE0),he.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),fe.updatePaintBuffers()),d.prepareDrawProgram(K,ve,ee.toUnwrapped());let Ee=Be=>{ve.draw(K,N.TRIANGLES,T,Be,E,t.CullFaceMode.disabled,Ye,h.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,h.paint,d.transform.zoom,fe,[de.layoutVertexBuffer2])};if(Q){let Be=d.stencilModeForClipping(ee).ref;Be===0&&d.terrain&&K.clear({stencil:0});let et={func:N.EQUAL,mask:255};Ye.u_alpha_discard_threshold=.8,Ee(new t.StencilMode(et,Be,255,N.KEEP,N.KEEP,N.INVERT)),Ye.u_alpha_discard_threshold=0,Ee(new t.StencilMode(et,Be,255,N.KEEP,N.KEEP,N.KEEP))}else Ee(d.stencilModeForClipping(ee))}Q&&(d.resetStencilClippingMasks(),d.terrain&&K.clear({stencil:0}))},fill:function(d,s,h,m){let y=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let T=d.colorModeForRenderPass(),E=h.paint.get("fill-pattern"),A=d.opaquePassEnabledForLayer()&&!E.constantOr(1)&&y.constantOr(t.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===A){let R=d.depthModeForSublayer(1,d.renderPass==="opaque"?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);w_(d,s,h,m,R,T,!1)}if(d.renderPass==="translucent"&&h.paint.get("fill-antialias")){let R=d.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);w_(d,s,h,m,R,T,!0)}},"fill-extrusion":function(d,s,h,m){let y=h.paint.get("fill-extrusion-opacity");if(y!==0&&d.renderPass==="translucent"){let x=new t.DepthMode(d.context.gl.LEQUAL,t.DepthMode.ReadWrite,d.depthRangeFor3D);if(y!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))xc(d,s,h,m,x,t.StencilMode.disabled,t.ColorMode.disabled),xc(d,s,h,m,x,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{let T=d.colorModeForRenderPass();xc(d,s,h,m,x,t.StencilMode.disabled,T)}}},hillshade:function(d,s,h,m){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;let y=d.context,x=d.depthModeForSublayer(0,t.DepthMode.ReadOnly),T=d.colorModeForRenderPass(),E=d.terrain&&d.terrain.renderingToTexture,[A,R]=d.renderPass!=="translucent"||E?[{},m]:d.stencilConfigForOverlap(m);for(let q of R){let F=s.getTile(q);if(F.needsHillshadePrepare&&d.renderPass==="offscreen")d_(d,F,h,x,t.StencilMode.disabled,T);else if(d.renderPass==="translucent"){let $=E&&d.terrain?d.terrain.stencilModeForRTTOverlap(q):A[q.overscaledZ];f_(d,q,F,h,x,$,T)}}y.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,s,h,m,y,x){if(d.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!m.length)return;let T=d.context,E=T.gl,A=s.getSource(),R=d.useProgram("raster"),q=d.colorModeForRenderPass(),F=d.terrain&&d.terrain.renderingToTexture,[$,Z]=A instanceof $t||F?[{},m]:d.stencilConfigForOverlap(m),X=Z[Z.length-1].overscaledZ,H=!d.options.moving;for(let K of Z){let N=F?t.DepthMode.disabled:d.depthModeForSublayer(K.overscaledZ-X,h.paint.get("raster-opacity")===1?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,E.LESS),W=K.toUnwrapped(),Q=s.getTile(K);if(F&&(!Q||!Q.hasData()))continue;let ee=F?K.projMatrix:d.transform.calculateProjMatrix(W,H),he=d.terrain&&F?d.terrain.stencilModeForRTTOverlap(K):$[K.overscaledZ],de=x?0:h.paint.get("raster-fade-duration");Q.registerFadeDuration(de);let fe=s.findLoadedParent(K,0),ve=Yf(Q,fe,s,d.transform,de),ye,Se;d.terrain&&d.terrain.prepareDrawTile();let Je=h.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;T.activeTexture.set(E.TEXTURE0),Q.texture.bind(Je,E.CLAMP_TO_EDGE),T.activeTexture.set(E.TEXTURE1),fe?(fe.texture.bind(Je,E.CLAMP_TO_EDGE),ye=Math.pow(2,fe.tileID.overscaledZ-Q.tileID.overscaledZ),Se=[Q.tileID.canonical.x*ye%1,Q.tileID.canonical.y*ye%1]):Q.texture.bind(Je,E.CLAMP_TO_EDGE),Q.texture.useMipmap&&T.extTextureFilterAnisotropic&&d.transform.pitch>20&&E.texParameterf(E.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);let we=ad(ee,Se||[0,0],ye||1,ve,h,A instanceof $t?A.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(T,R,W),A instanceof $t)A.boundsBuffer&&A.boundsSegments&&R.draw(T,E.TRIANGLES,N,t.StencilMode.disabled,q,t.CullFaceMode.disabled,we,h.id,A.boundsBuffer,d.quadTriangleIndexBuffer,A.boundsSegments);else{let{tileBoundsBuffer:ze,tileBoundsIndexBuffer:Oe,tileBoundsSegments:Ye}=d.getTileBoundsBuffers(Q);R.draw(T,E.TRIANGLES,N,he,q,t.CullFaceMode.disabled,we,h.id,ze,Oe,Ye)}}d.resetStencilClippingMasks()},background:function(d,s,h,m){let y=h.paint.get("background-color"),x=h.paint.get("background-opacity");if(x===0)return;let T=d.context,E=T.gl,A=d.transform,R=A.tileSize,q=h.paint.get("background-pattern");if(d.isPatternMissing(q))return;let F=!q&&y.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==F)return;let $=t.StencilMode.disabled,Z=d.depthModeForSublayer(0,F==="opaque"?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),X=d.colorModeForRenderPass(),H=d.useProgram(q?"backgroundPattern":"background"),K,N=m;N||(K=d.getBackgroundTiles(),N=Object.values(K).map(W=>W.tileID)),q&&(T.activeTexture.set(E.TEXTURE0),d.imageManager.bind(d.context));for(let W of N){let Q=W.toUnwrapped(),ee=m?W.projMatrix:d.transform.calculateProjMatrix(Q);d.prepareDrawTile();let he=s?s.getTile(W):K?K[W.key]:new t.Tile(W,R,A.zoom,d),de=q?Q0(ee,x,d,q,{tileID:W,tileSize:R}):ld(ee,x,y);d.prepareDrawProgram(T,H,Q);let{tileBoundsBuffer:fe,tileBoundsIndexBuffer:ve,tileBoundsSegments:ye}=d.getTileBoundsBuffers(he);H.draw(T,E.TRIANGLES,Z,$,X,t.CullFaceMode.disabled,de,h.id,fe,ve,ye)}},sky:function(d,s,h){let m=d.transform,y=m.projection.name==="mercator"||m.projection.name==="globe"?1:t.smoothstep(7,8,m.zoom),x=h.paint.get("sky-opacity")*y;if(x===0)return;let T=d.context,E=h.paint.get("sky-type"),A=new t.DepthMode(T.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),R=d.frameCounter/1e3%1;E==="atmosphere"?d.renderPass==="offscreen"?h.needsSkyboxCapture(d)&&(function(q,F,$,Z){let X=q.context,H=X.gl,K=F.skyboxFbo;if(!K){K=F.skyboxFbo=X.createFramebuffer(32,32,!1),F.skyboxGeometry=new wc(X),F.skyboxTexture=X.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,F.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let ee=0;ee<6;++ee)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(K.framebuffer),X.viewport.set([0,0,32,32]);let N=F.getCenter(q,!0),W=q.useProgram("skyboxCapture"),Q=new Float64Array(16);t.identity(Q),t.rotateY(Q,Q,.5*-Math.PI),En(X,F,W,Q,N,0),t.identity(Q),t.rotateY(Q,Q,.5*Math.PI),En(X,F,W,Q,N,1),t.identity(Q),t.rotateX(Q,Q,.5*-Math.PI),En(X,F,W,Q,N,2),t.identity(Q),t.rotateX(Q,Q,.5*Math.PI),En(X,F,W,Q,N,3),t.identity(Q),En(X,F,W,Q,N,4),t.identity(Q),t.rotateY(Q,Q,Math.PI),En(X,F,W,Q,N,5),X.viewport.set([0,0,q.width,q.height])}(d,h),h.markSkyboxValid(d)):d.renderPass==="sky"&&function(q,F,$,Z,X){let H=q.context,K=H.gl,N=q.transform,W=q.useProgram("skybox");H.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,F.skyboxTexture);let Q=((ee,he,de,fe,ve)=>({u_matrix:ee,u_sun_direction:he,u_cubemap:0,u_opacity:fe,u_temporal_offset:ve}))(N.skyboxMatrix,F.getCenter(q,!1),0,Z,X);q.prepareDrawProgram(H,W),W.draw(H,K.TRIANGLES,$,t.StencilMode.disabled,q.colorModeForRenderPass(),t.CullFaceMode.backCW,Q,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,h,A,x,R):E==="gradient"&&d.renderPass==="sky"&&function(q,F,$,Z,X){let H=q.context,K=H.gl,N=q.transform,W=q.useProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new wc(H)),H.activeTexture.set(K.TEXTURE0);let Q=F.colorRampTexture;Q||(Q=F.colorRampTexture=new t.Texture(H,F.colorRamp,K.RGBA)),Q.bind(K.LINEAR,K.CLAMP_TO_EDGE);let ee=((he,de,fe,ve,ye)=>({u_matrix:he,u_color_ramp:0,u_center_direction:de,u_radius:t.degToRad(fe),u_opacity:ve,u_temporal_offset:ye}))(N.skyboxMatrix,F.getCenter(q,!1),F.paint.get("sky-gradient-radius"),Z,X);q.prepareDrawProgram(H,W),W.draw(H,K.TRIANGLES,$,t.StencilMode.disabled,q.colorModeForRenderPass(),t.CullFaceMode.backCW,ee,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,h,A,x,R)},debug:function(d,s,h){for(let m=0;m<h.length;m++)ox(d,s,h[m])},custom:function(d,s,h,m){let y=d.context,x=h.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&h.isLayerDraped()){if(d.renderPass==="offscreen"){let T=x.prerender;if(T){if(d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){let E=d.transform.pointMerc;T.call(x,y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),t.globeToMercatorTransition(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else T.call(x,y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){let E=x.renderToTile;if(E){let A=m[0].canonical,R=new t.MercatorCoordinate(A.x+m[0].wrap*(1<<A.z),A.y,A.z);y.setDepthMode(t.DepthMode.disabled),y.setStencilMode(t.StencilMode.disabled),y.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),E.call(x,y.gl,R),y.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),y.setStencilMode(t.StencilMode.disabled);let T=x.renderingMode==="3d"?new t.DepthMode(d.context.gl.LEQUAL,t.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,t.DepthMode.ReadOnly);if(y.setDepthMode(T),d.transform.projection.name==="globe"){let E=d.transform.pointMerc;x.render(y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),t.globeToMercatorTransition(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else x.render(y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState(),y.bindFramebuffer.set(null)}}else t.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Bs{constructor(s,h,m=!1){this.context=new at(s,m),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(s,h){let m=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qf(this,s));let y=this._terrain;this.transform.elevation=m?y:null,y.update(s,this.transform,h)}_updateFog(s){let h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[m,y]=h.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);let x=m+.78*(y-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,h){if(this.width=s*t.exported.devicePixelRatio,this.height=h*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let m of this.style.order)this.style._layers[m].resize()}setup(){let s=this.context,h=new t.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(t.EXTENT,0),h.emplaceBack(0,t.EXTENT),h.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);let m=new t.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(t.EXTENT,0),m.emplaceBack(0,t.EXTENT),m.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=s.createVertexBuffer(m,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);let y=new t.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);let x=new t.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(t.EXTENT,0,t.EXTENT,0),x.emplaceBack(0,t.EXTENT,0,t.EXTENT),x.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(x,t.boundsAttributes.members),this.mercatorBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);let T=new t.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T);let E=new t.StructArrayLayout1ui2;for(let R of[0,1,3,2,0])E.emplaceBack(R);this.debugIndexBuffer=s.createIndexBuffer(E),this.emptyTexture=new t.Texture(s,new t.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=t.create();let A=this.context.gl;this.stencilClearMode=new t.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(t.window.performance.now()),this.atmosphereBuffer=new A_(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(s,h.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,Wl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,m){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(let A of m)if(this._tileClippingMaskIDs[A.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=h.id;let y=this.context,x=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(t.ColorMode.disabled),y.setDepthMode(t.DepthMode.disabled);let T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let E of m){let A=h.getTile(E),R=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:q,tileBoundsIndexBuffer:F,tileBoundsSegments:$}=this.getTileBoundsBuffers(A);T.draw(y,x.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:x.ALWAYS,mask:0},R,255,x.KEEP,x.KEEP,x.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,Wl(E.projMatrix),"$clipping",q,F,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let s=this.nextStencilID++,h=this.context.gl;return new t.StencilMode({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);let h=this.context.gl;return new t.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){let h=this.context.gl,m=s.sort((T,E)=>E.overscaledZ-T.overscaledZ),y=m[m.length-1].overscaledZ,x=m[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let T={};for(let E=0;E<x;E++)T[E+y]=new t.StencilMode({func:h.GEQUAL,mask:255},E+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[T,m]}return[{[y]:t.StencilMode.disabled},m]}colorModeForRenderPass(){let s=this.context.gl;return this._showOverdrawInspector?new t.ColorMode([s.CONSTANT_COLOR,s.ONE],new t.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(s,h,m){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new t.DepthMode(m||this.context.gl.LEQUAL,h,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();let m=this.style.order,y=this.style._sourceCaches;for(let R in y){let q=y[R];q.used&&q.prepare(this.context)}let x={},T={},E={};for(let R in y){let q=y[R];x[R]=q.getVisibleCoordinates(),T[R]=x[R].slice().reverse(),E[R]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<m.length;R++)if(this.style._layers[m[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.GlobeSharedBuffers(this.context)),!t.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(let R of m){let q=this.style._layers[R],F=s._getLayerSourceCache(q);if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;let $=F?T[F.id]:void 0;(q.type==="custom"||q.isSky()||$&&$.length)&&this.renderLayer(this,F,q,$)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon];let A=this.terrain;if(A&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&A.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){let R=this.style._layers[m[this.currentLayer]],q=s._getLayerSourceCache(R);if(R.isSky())continue;let F=q?T[q.id]:void 0;this._renderTileClippingMasks(R,q,F),this.renderLayer(this,q,R,F)}if(this.style.fog&&this.transform.projection.supportsFog&&function(R,q){let F=R.context,$=F.gl,Z=R.transform,X=new t.DepthMode($.LEQUAL,t.DepthMode.ReadOnly,[0,1]),H=R.useProgram("globeAtmosphere",null,Z.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),K=t.globeToMercatorTransition(Z.zoom),N=q.properties.get("color").toArray01(),W=q.properties.get("high-color").toArray01(),Q=q.properties.get("space-color").toArray01PremultipliedAlpha(),ee=t.identity$1([]);t.rotateY$1(ee,ee,-t.degToRad(Z._center.lng)),t.rotateX$1(ee,ee,t.degToRad(Z._center.lat)),t.rotateZ$1(ee,ee,Z.angle),t.rotateX$1(ee,ee,-Z._pitch);let he=t.fromQuat(new Float32Array(16),ee),de=t.mapValue(q.properties.get("star-intensity"),0,1,0,.25),fe=5e-4,ve=t.mapValue(q.properties.get("horizon-blend"),0,1,fe,.25),ye=t.globeUseCustomAntiAliasing(R,F,Z)&&ve===fe?Z.worldSize/(2*Math.PI*1.025)-1:Z.globeRadius,Se=R.frameCounter/1e3%1,Je=t.length(Z.globeCenterInViewSpace),we=Math.sqrt(Math.pow(Je,2)-Math.pow(ye,2)),ze=Math.acos(we/Je),Oe=((Ee,Be,et,He,rt,Tt,Rt,xt,Ot,Xt,Wt,wt,mr,xr)=>({u_frustum_tl:Ee,u_frustum_tr:Be,u_frustum_br:et,u_frustum_bl:He,u_horizon:rt,u_transition:Tt,u_fadeout_range:Rt,u_color:xt,u_high_color:Ot,u_space_color:Xt,u_star_intensity:Wt,u_star_size:5*t.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:wt,u_horizon_angle:mr,u_rotation_matrix:xr}))(Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.frustumCorners.horizon,K,ve,N,W,Q,de,Se,ze,he);R.prepareDrawProgram(F,H);let Ye=R.atmosphereBuffer;Ye&&H.draw(F,$.TRIANGLES,X,t.StencilMode.disabled,t.ColorMode.alphaBlended,t.CullFaceMode.backCW,Oe,"skybox",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}(this,this.style.fog),this.renderPass="sky",(t.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){let R=this.style._layers[m[this.currentLayer]],q=s._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,q,R,q?T[q.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){let R=this.style._layers[m[this.currentLayer]],q=s._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let F=q?(R.type==="symbol"?E:T)[q.id]:void 0;this._renderTileClippingMasks(R,q,q?x[q.id]:void 0),this.renderLayer(this,q,R,F),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let R=null;t.values(this.style._layers).forEach(q=>{let F=s._getLayerSourceCache(q);F&&!q.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<F.getSource().maxzoom)&&(R=F)}),R&&this.options.showTileBoundaries&&$a.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){let q=R.transform.padding;E_(R,R.transform.height-(q.top||0),3,Ls),E_(R,q.bottom||0,3,tx),bc(R,q.left||0,3,rx),bc(R,R.transform.width-(q.right||0),3,ix);let F=R.transform.centerPoint;(function($,Z,X,H){ks($,Z-1,X-10,2,20,H),ks($,Z-10,X-1,20,2,H)})(R,F.x,R.transform.height-F.y,nx)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,h,m,y){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(m.type)||s.terrain&&m.type==="custom")&&$a[m.type](s,h,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,m=this.gpuTimers[s.id];m||(m=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),m.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let s=this.context.extTimerQuery,h=s.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),s.beginQueryEXT(s.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;let s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){let s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){let s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){let h={};for(let m in s){let y=s[m],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(y.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(y.query),h[m]=T}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,m=0;for(let y of s)m+=h.getQueryObjectEXT(y,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(y);return m}translatePosMatrix(s,h,m,y,x){if(!m[0]&&!m[1])return s;let T=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){let R=Math.sin(T),q=Math.cos(T);m=[m[0]*q-m[1]*R,m[0]*R+m[1]*q]}let E=[x?m[0]:Ke(h,m[0],this.transform.zoom),x?m[1]:Ke(h,m[1],this.transform.zoom),0],A=new Float32Array(16);return t.translate(A,s,E),A}saveTileTexture(s){let h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){let h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){return s===null||s!==void 0&&!this.imageManager.getPattern(s.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){let s=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),this.transform.projection.name==="globe"&&y.push("GLOBE"),h&&y.push("ZERO_EXAGGERATION"),m&&!s&&m.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),s&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(s,h,m){this.cache=this.cache||{};let y=m||[],x=this.currentGlobalDefines().concat(y),T=nr.cacheKey(Zf[s],s,x,h);return this.cache[T]||(this.cache[T]=new nr(this.context,s,Zf[s],h,ud[s],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(s,h,m){if(this.terrain&&this.terrain.renderingToTexture)return;let y=this.style.fog;if(y){let x=y.getOpacity(this.transform.pitch),T=((E,A,R,q,F,$,Z,X,H,K,N)=>{let W=E.transform,Q=A.properties.get("color").toArray01();Q[3]=q;let ee=E.frameCounter/1e3%1;return{u_fog_matrix:R?W.calculateFogTileMatrix(R):E.identityMat,u_fog_range:A.getFovAdjustedRange(W._fov),u_fog_color:Q,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:ee,u_frustum_tl:F,u_frustum_tr:$,u_frustum_br:Z,u_frustum_bl:X,u_globe_pos:H,u_globe_radius:K,u_viewport:N,u_globe_transition:t.globeToMercatorTransition(W.zoom),u_is_globe:+(W.projection.name==="globe")}})(this,y,m,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.exported.devicePixelRatio,this.transform.height*t.exported.devicePixelRatio]);h.setFogUniformValues(s,T)}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){let s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){let s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let s=this._backgroundTiles,h=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(let y of m)h[y.key]=s[y.key]||new t.Tile(y,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Tc{constructor(s=0,h=0,m=0,y=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=m,this.right=y}interpolate(s,h,m){return h.top!=null&&s.top!=null&&(this.top=t.number(s.top,h.top,m)),h.bottom!=null&&s.bottom!=null&&(this.bottom=t.number(s.bottom,h.bottom,m)),h.left!=null&&s.left!=null&&(this.left=t.number(s.left,h.left,m)),h.right!=null&&s.right!=null&&(this.right=t.number(s.right,h.right,m)),this}getCenter(s,h){let m=t.clamp((this.left+s-this.right)/2,0,s),y=t.clamp((this.top+h-this.bottom)/2,0,h);return new t.Point(m,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Tc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ec(d,s){let h=t.getColumn(d,3);t.fromQuat(d,s),t.setColumn(d,3,h)}function or(d,s){let h=t.identity$1([]);return t.rotateZ$1(h,h,-s),t.rotateX$1(h,h,-d),h}function Ql(d,s){let h=[d[0],d[1],0],m=[s[0],s[1],0];if(t.length(h)>=1e-15){let T=t.normalize([],h);t.scale$2(m,T,t.dot(m,T)),s[0]=m[0],s[1]=m[1]}let y=t.cross([],s,d);if(t.len(y)<1e-15)return null;let x=Math.atan2(-y[1],y[0]);return or(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}class O_{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){let h=s instanceof t.MercatorCoordinate?s:new t.MercatorCoordinate(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=t.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;let m=this.position,y=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(s)):0,x=t.MercatorCoordinate.fromLngLat(s,y),T=[x.x-m.x,x.y-m.y,x.z-m.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Ql(T,h)}setPitchBearing(s,h){this.orientation=or(t.degToRad(s),t.degToRad(-h))}}class Sc{constructor(s,h){this._transform=t.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){let s=this.position;return new t.MercatorCoordinate(s[0],s[1],s[2])}get position(){let s=t.getColumn(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&t.setColumn(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||t.identity$1([]),s&&Ec(this._transform,this._orientation)}getPitchBearing(){let s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=or(s,h),Ec(this._transform,this._orientation)}forward(){let s=t.getColumn(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){let s=t.getColumn(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){let s=t.getColumn(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){let m=new Float64Array(16);return t.invert(m,this.getWorldToCamera(s,h)),m}getWorldToCameraPosition(s,h,m){let y=this.position;t.scale$2(y,y,-s);let x=new Float64Array(16);return t.fromScaling(x,[m,m,m]),t.translate(x,x,y),x[10]*=h,x}getWorldToCamera(s,h){let m=new Float64Array(16),y=new Float64Array(4),x=this.position;return t.conjugate(y,this._orientation),t.scale$2(x,x,-s),t.fromQuat(m,y),t.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=h,m[9]*=h,m[10]*=h,m[11]*=h,m}getCameraToClipPerspective(s,h,m,y){let x=new Float64Array(16);return t.perspective(x,s,h,m,y),x}getDistanceToElevation(s,h=!1){let m=s===0?0:t.mercatorZfromAltitude(s,h?t.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(m-this.position[2])/y[2]}clone(){return new Sc([...this.position],[...this.orientation])}}function zs(d,s){let h=Ic(d.projection,d.zoom,d.width,d.height),m=function(x,T,E,A,R){let q=new t.LngLat(E.lng-180*Do,E.lat),F=new t.LngLat(E.lng+180*Do,E.lat),$=x.project(q.lng,q.lat),Z=x.project(F.lng,F.lat),X=-Math.atan2(Z.y-$.y,Z.x-$.x),H=t.MercatorCoordinate.fromLngLat(E);H.y=t.clamp(H.y,-1+Do,1-Do);let K=H.toLngLat(),N=x.project(K.lng,K.lat),W=t.MercatorCoordinate.fromLngLat(K);W.x+=Do;let Q=W.toLngLat(),ee=x.project(Q.lng,Q.lat),he=Ac(ee.x-N.x,ee.y-N.y,X),de=t.MercatorCoordinate.fromLngLat(K);de.y+=Do;let fe=de.toLngLat(),ve=x.project(fe.lng,fe.lat),ye=Ac(ve.x-N.x,ve.y-N.y,X),Se=Math.abs(he.x)/Math.abs(ye.y),Je=t.identity([]);t.rotateZ(Je,Je,-X*(1-(R?0:A)));let we=t.identity([]);return t.scale(we,we,[1,1-(1-Se)*A,1]),we[4]=-ye.x/ye.y*A,t.rotateZ(we,we,X),t.multiply(we,Je,we),we}(d.projection,0,d.center,h,s),y=C_(d);return t.scale(m,m,[y,y,1]),m}function C_(d){let s=d.projection,h=Ic(d.projection,d.zoom,d.width,d.height),m=P_(s,d.center),y=P_(s,t.LngLat.convert(s.center));return Math.pow(2,m*h+(1-h)*y)}function Ic(d,s,h,m,y=1/0){let x=d.range;if(!x)return 0;let T=Math.min(y,Math.max(h,m)),E=Math.log(T/1024)/Math.LN2;return t.smoothstep(x[0]+E,x[1]+E,s)}let Do=1/4e4;function P_(d,s){let h=t.clamp(s.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),m=new t.LngLat(s.lng-180*Do,h),y=new t.LngLat(s.lng+180*Do,h),x=d.project(m.lng,h),T=d.project(y.lng,h),E=t.MercatorCoordinate.fromLngLat(m),A=t.MercatorCoordinate.fromLngLat(y),R=T.x-x.x,q=T.y-x.y,F=A.x-E.x,$=A.y-E.y,Z=Math.sqrt((F*F+$*$)/(R*R+q*q));return Math.log(Z)/Math.LN2}function Ac(d,s,h){let m=Math.cos(h),y=Math.sin(h);return{x:d*m-s*y,y:d*y+s*m}}class Fs{constructor(s,h,m,y,x,T,E){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=m??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Tc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Sc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){let s=new Fs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(s,h=!1){let m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(s||m)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return t.pick(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=t.getProjection(this.projectionOptions);let m=!v(h,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){let s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.getProjection({name:"mercator"});let h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.Point(this.width,this.height)}get bearing(){return t.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){let h=-s*Math.PI/180;var m;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(m=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(y,x,T){var E=x[0],A=x[1],R=x[2],q=x[3],F=Math.sin(T),$=Math.cos(T);y[0]=E*$+R*F,y[1]=A*$+q*F,y[2]=E*-F+R*$,y[3]=A*-F+q*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){let h=t.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=t.degToRad(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){let h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let s=this._elevation;this._centerAltitude=s.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=s.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop(),y=0,x=0;for(let T=0;T<h.length;T++){let E=new t.Point(h[T][0]*this.width,m+h[T][1]*(this.height-m)),A=s.pointCoordinate(E);if(!A)continue;let R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);y+=A[3]*R,x+=R}return x===0?NaN:y/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*h,y=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-m,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude())),m;m=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];let y=t.length(t.sub([],this._camera.position,m));return t.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!t.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){let m=[s.position.x,s.position.y,s.position.z];t.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let s=this._camera.position,h=new O_;return h.position=new t.MercatorCoordinate(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!t.length$1(s))return!1;t.normalize$1(s,s);let h=t.transformQuat([],[0,0,-1],s),m=t.transformQuat([],[0,-1,0],s);if(m[2]<0)return!1;let y=Ql(h,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(s){let h=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;s[2]=t.clamp(s[2],y/m,y/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,m){this._unmodified=!1,this._edgeInsets.interpolate(s,h,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){let h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){let h=[new t.UnwrappedTileID(0,s)];if(this.renderWorldCopies){let m=this.pointCoordinate(new t.Point(0,0)),y=this.pointCoordinate(new t.Point(this.width,0)),x=this.pointCoordinate(new t.Point(this.width,this.height)),T=this.pointCoordinate(new t.Point(0,this.height)),E=Math.floor(Math.min(m.x,y.x,x.x,T.x)),A=Math.floor(Math.max(m.x,y.x,x.x,T.x)),R=1;for(let q=E-R;q<=A+R;q++)q!==0&&h.push(new t.UnwrappedTileID(q,s))}return h}coveringTiles(s){let h=this.coveringZoomLevel(s),m=h,y=this.elevation&&!s.isTerrainDEM,x=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);let T=this.locationCoordinate(this.center),E=this.center.lat,A=1<<h,R=[A*T.x,A*T.y,0],q=this.projection.name==="globe",F=!q,$=t.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,F),Z=q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=A*t.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),K=[A*Z.x,A*Z.y,H*(F?1:X)],N=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),W=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,Q=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ee=s.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?C_(this):1,de=Ee=>{let et=new t.MercatorCoordinate(Ee.x+25e-6,Ee.y,Ee.z),He=new t.MercatorCoordinate(Ee.x,Ee.y+25e-6,Ee.z),rt=Ee.toLngLat(),Tt=et.toLngLat(),Rt=He.toLngLat(),xt=this.locationCoordinate(rt),Ot=this.locationCoordinate(Tt),Xt=this.locationCoordinate(Rt),Wt=Math.hypot(Ot.x-xt.x,Ot.y-xt.y),wt=Math.hypot(Xt.x-xt.x,Xt.y-xt.y);return Math.sqrt(Wt*wt)*he/25e-6},fe=Ee=>{let Be=Q,et=ee;return{aabb:t.tileAABB(this,A,0,0,0,Ee,et,Be,this.projection),zoom:0,x:0,y:0,minZ:et,maxZ:Be,wrap:Ee,fullyVisible:!1}},ve=[],ye=[],Se=h,Je=s.reparseOverscaled?m:h,we=Ee=>Ee*Ee,ze=we((H-this._centerAltitude)*X),Oe=Ee=>{if(!this._elevation||!Ee.tileID||!x)return;let Be=this._elevation.getMinMaxForTile(Ee.tileID),et=Ee.aabb;Be?(et.min[2]=Be.min,et.max[2]=Be.max,et.center[2]=(et.min[2]+et.max[2])/2):(Ee.shouldSplit=Ye(Ee),Ee.shouldSplit||(et.min[2]=et.max[2]=et.center[2]=this._centerAltitude))},Ye=Ee=>{if(Ee.zoom<W)return!0;if(Ee.zoom===Se)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;let Be=Ee.aabb.distanceX(K),et=Ee.aabb.distanceY(K),He=ze,rt=1;if(q){He=we(Ee.aabb.distanceZ(K));let xt=Math.pow(2,Ee.zoom),Ot=t.latFromMercatorY((Ee.y+1)/xt),Xt=t.latFromMercatorY(Ee.y/xt),Wt=Math.min(Math.max(E,Ot),Xt),wt=t.circumferenceAtLatitude(Wt)/t.circumferenceAtLatitude(E);if(rt=Wt===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,wt/this._mercatorScaleRatio),this.zoom<=t.GLOBE_ZOOM_THRESHOLD_MIN&&Ee.zoom===Se-1&&wt>=.9)return!0}else if(y&&(He=we(Ee.aabb.distanceZ(K)*X)),this.projection.isReprojectedInTileSpace&&m<=5){let xt=Math.pow(2,Ee.zoom),Ot=de(new t.MercatorCoordinate((Ee.x+.5)/xt,(Ee.y+.5)/xt));rt=Ot>.85?1:Ot}let Tt=Be*Be+et*et+He,Rt=we((1<<Se-Ee.zoom)*N*rt*((xt,Ot)=>{if(Ot*we(.707)<xt)return 1;let Xt=Math.sqrt(Ot/xt);return Xt/(1.4144271570014144+(Math.pow(1.1,Xt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(He,ze),Tt));return Tt<Rt};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)ve.push(fe(-Ee)),ve.push(fe(Ee));for(ve.push(fe(0));ve.length>0;){let Ee=ve.pop(),Be=Ee.x,et=Ee.y,He=Ee.fullyVisible;if(!He){let rt=Ee.aabb.intersects($);if(rt===0)continue;He=rt===2}if(Ee.zoom!==Se&&Ye(Ee))for(let rt=0;rt<4;rt++){let Tt=(Be<<1)+rt%2,Rt=(et<<1)+(rt>>1),xt={aabb:x?Ee.aabb.quadrant(rt):t.tileAABB(this,A,Ee.zoom+1,Tt,Rt,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:Tt,y:Rt,wrap:Ee.wrap,fullyVisible:He,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};y&&!q&&(xt.tileID=new t.OverscaledTileID(Ee.zoom+1===Se?Je:Ee.zoom+1,Ee.wrap,Ee.zoom+1,Tt,Rt),Oe(xt)),ve.push(xt)}else{let rt=Ee.zoom===Se?Je:Ee.zoom;if(s.minzoom&&s.minzoom>rt)continue;let Tt=R[0]-(.5+Be+(Ee.wrap<<Ee.zoom))*(1<<h-Ee.zoom),Rt=R[1]-.5-et,xt=Ee.tileID?Ee.tileID:new t.OverscaledTileID(rt,Ee.wrap,Ee.zoom,Be,et);ye.push({tileID:xt,distanceSq:Tt*Tt+Rt*Rt})}}if(this.fogCullDistSq){let Ee=this.fogCullDistSq,Be=this.horizonLineFromTop();ye=ye.filter(et=>{let He=[0,0,0,1],rt=[t.EXTENT,t.EXTENT,0,1],Tt=this.calculateFogTileMatrix(et.tileID.toUnwrapped());t.transformMat4$1(He,He,Tt),t.transformMat4$1(rt,rt,Tt);let Rt=t.getAABBPointSquareDist(He,rt);if(Rt===0)return!0;let xt=!1,Ot=this._elevation;if(Ot&&Rt>Ee&&Be!==0){let Xt=this.calculateProjMatrix(et.tileID.toUnwrapped()),Wt;s.isTerrainDEM||(Wt=Ot.getMinMaxForTile(et.tileID)),Wt||(Wt={min:ee,max:Q});let wt=t.furthestTileCorner(this.rotation),mr=[wt[0]*t.EXTENT,wt[1]*t.EXTENT,Wt.max];t.transformMat4(mr,mr,Xt),xt=(1-mr[1])*this.height*.5<Be}return Rt<Ee||xt})}return ye.sort((Ee,Be)=>Ee.distanceSq-Be.distanceSq).map(Ee=>Ee.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){let h=t.clamp(s.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),m=this.projection.project(s.lng,h);return new t.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let m,y,x=this.centerPoint;if(this.projection.name==="globe"){let E=this.worldSize;m=(h.x-x.x)/E,y=(h.y-x.y)/E}else{let E=this.pointCoordinate(h),A=this.pointCoordinate(x);m=E.x-A.x,y=E.y-A.y}let T=this.locationCoordinate(s);this.setLocation(new t.MercatorCoordinate(T.x-m,T.y-y))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){let m=h?t.mercatorZfromAltitude(h,s.lat):void 0,y=this.projection.project(s.lng,s.lat);return new t.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){let m=h??this._centerAltitude,y=[s.x,s.y,0,1],x=[s.x,s.y,1,1];t.transformMat4$1(y,y,this.pixelMatrixInverse),t.transformMat4$1(x,x,this.pixelMatrixInverse);let T=x[3];t.scale$1(y,y,1/y[3]),t.scale$1(x,x,1/T);let E=y[2],A=x[2];return{p0:y,p1:x,t:E===A?0:(m-E)/(A-E)}}screenPointToMercatorRay(s){let h=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return t.transformMat4$1(h,h,this.pixelMatrixInverse),t.transformMat4$1(m,m,this.pixelMatrixInverse),t.scale$1(h,h,1/h[3]),t.scale$1(m,m,1/m[3]),h[2]=t.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,m[2]=t.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,t.scale$1(h,h,1/this.worldSize),t.scale$1(m,m,1/this.worldSize),new t.Ray([h[0],h[1],h[2]],t.normalize([],t.sub([],m,h)))}rayIntersectionCoordinate(s){let{p0:h,p1:m,t:y}=s,x=t.mercatorZfromAltitude(h[2],this._center.lat),T=t.mercatorZfromAltitude(m[2],this._center.lat);return new t.MercatorCoordinate(t.number(h[0],m[0],y)/this.worldSize,t.number(h[1],m[1],y)/this.worldSize,t.number(x,T,y))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let h=this.projection.pointCoordinate3D(this,s.x,s.y);if(h)return new t.MercatorCoordinate(h[0],h[1],h[2]);let m=0,y=this.horizonLineFromTop();if(s.y>y)return this.pointCoordinate(s);let x=.02*y,T=s.clone();for(let E=0;E<10&&y-m>x;E++){T.y=t.number(m,y,.66);let A=this.projection.pointCoordinate3D(this,T.x,T.y);A?(y=T.y,h=A):m=T.y}return h?new t.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(s);let h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){let m=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,y=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return t.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new t.Point(y[0]/y[3],y[1]/y[3]):new t.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:s,left:h}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=this.pointLocation3D(new t.Point(h,s)),T=this.pointLocation3D(new t.Point(y,s)),E=this.pointLocation3D(new t.Point(y,m)),A=this.pointLocation3D(new t.Point(h,m)),R=Math.min(x.lng,T.lng,E.lng,A.lng),q=Math.max(x.lng,T.lng,E.lng,A.lng),F=Math.min(x.lat,T.lat,E.lat,A.lat),$=Math.max(x.lat,T.lat,E.lat,A.lat),Z=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,H=(K,N,W,Q,ee)=>{let he=(K+W)/2,de=(N+Q)/2,fe=new t.Point(he,de),{lng:ve,lat:ye}=this.pointLocation3D(fe),Se=Math.max(0,R-ve,F-ye,ve-q,ye-$);R=Math.min(R,ve),q=Math.max(q,ve),F=Math.min(F,ye),$=Math.max($,ye),(ee<X||Se>Z)&&(H(K,N,he,de,ee+1),H(he,de,W,Q,ee+1))};if(H(h,s,y,s,1),H(y,s,y,m,1),H(y,m,h,m,1),H(h,m,h,s,1),this.projection.name==="globe"){let[K,N]=t.polesInViewport(this);K?($=90,q=180,R=-180):N&&(F=-90,q=180,R=-180)}return new t.LngLatBounds(new t.LngLat(R,F),new t.LngLat(q,$))}_getBoundsRectangular(s,h){let{top:m,left:y}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,E=new t.Point(y,m),A=new t.Point(T,m),R=new t.Point(T,x),q=new t.Point(y,x),F=this.pointCoordinate(E,s),$=this.pointCoordinate(A,s),Z=this.pointCoordinate(R,h),X=this.pointCoordinate(q,h),H=(K,N)=>(N.y-K.y)/(N.x-K.x);return F.y>1&&$.y>=0?F=new t.MercatorCoordinate((1-X.y)/H(X,F)+X.x,1):F.y<0&&$.y<=1&&(F=new t.MercatorCoordinate(-X.y/H(X,F)+X.x,0)),$.y>1&&F.y>=0?$=new t.MercatorCoordinate((1-Z.y)/H(Z,$)+Z.x,1):$.y<0&&F.y<=1&&($=new t.MercatorCoordinate(-Z.y/H(Z,$)+Z.x,0)),new t.LngLatBounds().extend(this.coordinateLocation(F)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){let s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=s.visibleDemTiles.reduce((m,y)=>{if(y.dem){let x=y.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-t.MAX_MERCATOR_LATITUDE,this.maxLat=t.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=t.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=t.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=t.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){let h=s.key,m=this._distanceTileDataCache;if(m[h])return m[h];let y=s.canonical,x=1/this.height,T=this.cameraWorldSize,E=T/this.zoomScale(y.z),A=(y.x+Math.pow(2,y.z)*s.wrap)*E,R=y.y*E,q=this.point;q.x*=T/this.worldSize,q.y*=T/this.worldSize;let F=this.angle,$=Math.sin(-F),Z=-Math.cos(-F);return m[h]={bearing:[$,Z],center:[(q.x-A)*x,(q.y-R)*x],scale:E/t.EXTENT*x},m[h]}calculateFogTileMatrix(s){let h=s.key,m=this._fogTileMatrixCache;if(m[h])return m[h];let y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return t.multiply(y,this.worldToFogMatrix,y),m[h]=new Float32Array(y),m[h]}calculateProjMatrix(s,h=!1){let m=s.key,y=h?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];let x=this.calculatePosMatrix(s,this.worldSize);return t.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,x),y[m]=new Float32Array(x),y[m]}calculatePixelsToTileUnitsMatrix(s){let h=s.tileID.key,m=this._pixelsToTileUnitsCache;if(m[h])return m[h];let y=function(x,T){let{scale:E}=x.tileTransform,A=E*t.EXTENT/(x.tileSize*Math.pow(2,T.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return R=new Float32Array(4),$=(q=T.inverseAdjustmentMatrix)[1],Z=q[2],X=q[3],K=(F=[A,A])[1],R[0]=q[0]*(H=F[0]),R[1]=$*H,R[2]=Z*K,R[3]=X*K,R;var R,q,F,$,Z,X,H,K}(s,this);return m[h]=y,m[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let s=1/this.worldSize,h=t.fromScaling([],[s,s,s]);return t.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let s=this._elevation;this._updateCameraState();let h=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(h),y=this._camera.forward(),x=t.mercatorZfromAltitude(1,this._center.lat);m[2]/=x,y[2]/=x,t.normalize(y,y);let T=s.raycast(m,y,s.exaggeration());if(T){let E=t.scaleAndAdd([],m,y,T),A=new t.MercatorCoordinate(E[0],E[1],t.mercatorZfromAltitude(E[2],t.latFromMercatorY(E[1]))),R=(A.z+t.length([A.x-m[0],A.y-m[1],A.z-m[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;let h=this._elevation,m=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(m),x=h.getAtPointOrZero(new t.MercatorCoordinate(...y)),T=this.pixelsPerMeter/this.worldSize*x,E=this._minimumHeightOverTerrain(),A=y[2]-T;if(A<=E)if(A<0||s){let R=this.locationCoordinate(this._center,this._centerAltitude),q=[y[0],y[1],R.z-y[2]],F=t.length(q);q[2]-=(E-A)/this._pixelsPerMercatorPixel;let $=t.length(q);if($===0)return;t.scale$2(q,q,F/$*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],R.z*this._pixelsPerMercatorPixel-q[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){let $=this.center;return $.lat=t.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&($.lng=t.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}let h=this._unmodified,{x:m,y}=this.point,x=0,T=m,E=y,A=this.width/2,R=this.height/2,q=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(y-R<q&&(E=q+R),y+R>F&&(E=F-R),F-q<this.height&&(x=Math.max(x,this.height/(F-q)),E=(F+q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let $=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,X=this.worldSize/2-($+Z)/2;T=(m+X+this.worldSize)%this.worldSize-X,T-A<$&&(T=$+A),T+A>Z&&(T=Z-A),Z-$<this.width&&(x=Math.max(x,this.width/(Z-$)),T=(Z+$)/2)}T===m&&E===y||(this.center=this.unproject(new t.Point(T,E))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let s=this.centerOffset,h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.mercatorZfromAltitude(1,this.center.lat)/t.mercatorZfromAltitude(1,t.GLOBE_SCALE_MATCH_LATITUDE));let m=Ic(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?h:1,x=this._camera.getWorldToCamera(this.worldSize,y),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-s.x/this.width,T[9]=2*s.y/this.height;let E=t.mul([],T,x);if(this.projection.isReprojectedInTileSpace){let de=this.locationCoordinate(this.center),fe=t.identity([]);t.translate(fe,fe,[de.x*this.worldSize,de.y*this.worldSize,0]),t.multiply(fe,fe,zs(this)),t.translate(fe,fe,[-de.x*this.worldSize,-de.y*this.worldSize,0]),t.multiply(E,E,fe),this.inverseAdjustmentMatrix=function(ve){let ye=zs(ve,!0);return Ve([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=t.scale([],E,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=E,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);let A=t.invert([],T);this.frustumCorners=t.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);let R=new Float32Array(16);t.identity(R),t.scale(R,R,[1,-1,1]),t.rotateX(R,R,this._pitch),t.rotateZ(R,R,this.angle);let q=t.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),F=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-s.x/this.width,q[9]=2*(s.y+F)/this.height,this.skyboxMatrix=t.multiply(R,q,R);let $=this.point,Z=$.x,X=$.y,H=this.width%2/2,K=this.height%2/2,N=Math.cos(this.angle),W=Math.sin(this.angle),Q=Z-Math.round(Z)+N*H+W*K,ee=X-Math.round(X)+N*K+W*H,he=new Float64Array(E);if(t.translate(he,he,[Q>.5?Q-1:Q,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=he,E=t.create(),t.scale(E,E,[this.width/2,-this.height/2,1]),t.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=t.create(),t.scale(E,E,[1,-1,1]),t.translate(E,E,[-1,-1,0]),t.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=t.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=E,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.calculateGlobeMatrix(this);let de=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.transformMat4(de,de,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=E;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,h];t.scale$2(x,x,y),t.scale$2(m,m,-1),t.multiply$2(m,m,x);let T=t.create();t.translate(T,T,m),t.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,y)}_computeCameraPosition(s){let h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*x,y.y/this.worldSize-m[1]*x,s/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],y=s[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(x=Math.min((h-m)/y,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){let s=this._camera.position,h=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),x=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),E=Math.max((s[2]-x)/Math.cos(m),T),A=this._zoomFromMercatorZ(E);t.scaleAndAdd(s,s,h,E),this._pitch=t.clamp(m,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(y,-Math.PI,Math.PI),this._setZoom(t.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){let s=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,m=t.GLOBE_ZOOM_THRESHOLD_MAX,y=0,x=1/0;for(;m-h>1e-6&&m>h;){let T=h+.5*(m-h),E=this.tileSize*Math.pow(2,T),A=this.getCameraToCenterDistance(this.projection,T,E),R=this.scaleZoom(A/(s*this.tileSize)),q=Math.abs(T-R);q<x&&(x=q,y=T),T<R?h=T:m=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){let m=Math.min(s.x,h.x),y=Math.max(s.x,h.x),x=Math.min(s.y,h.y),T=Math.max(s.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let E=[new t.Point(m,x),new t.Point(y,T),new t.Point(m,T),new t.Point(y,x)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(let q of E){let F=this.pointRayIntersection(q);if(F.t<0)return!0;let $=this.rayIntersectionCoordinate(F);if($.x<A||$.y<0||$.x>R||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.Point(0,0),new t.Point(this.width,this.height))}zoomDeltaToMovement(s,h){let m=t.length(t.sub([],this._camera.position,s)),y=this._zoomFromMercatorZ(m)+h;return m-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){let s=function([h,m,y],x){let T=[h,m,y,1];t.transformMat4$1(T,T,x);let E=T[3]=Math.max(T[3],1e-6);return T[0]/=E,T[1]/=E,T[2]/=E,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.Point(s[0],s[1])}{let s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,s))}}getCameraToCenterDistance(s,h=this.zoom,m=this.worldSize){let y=Ic(s,h,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,m,y);return .5/Math.tan(.5*this._fov)*this.height*x}getWorldToCameraMatrix(){let s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.multiply(s,s,this.globeMatrix),s}}function Ns(d,s){let h=!1,m=null,y=()=>{m=null,h&&(d(),m=setTimeout(y,s),h=!1)};return()=>(h=!0,m||y(),m)}class fd{constructor(s){this._hashName=s&&encodeURIComponent(s),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ns(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,t.window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let s=this._map;if(!s)return"";let h=eu(s);if(this._hashName){let m=this._hashName,y=!1,x=t.window.location.hash.slice(1).split("&").map(T=>{let E=T.split("=")[0];return E===m?(y=!0,`${E}=${h}`):T}).filter(T=>T);return y||x.push(`${m}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let s=t.window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(h=m)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){let s=this._map;if(!s)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(m=>isNaN(m))){let m=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:m,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){let s=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,s)}}function eu(d,s){let h=d.getCenter(),m=Math.round(100*d.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),T=Math.round(h.lng*x)/x,E=Math.round(h.lat*x)/x,A=d.getBearing(),R=d.getPitch(),q=s?`/${T}/${E}/${m}`:`${m}/${E}/${T}`;return(A||R)&&(q+="/"+Math.round(10*A)/10),R&&(q+=`/${Math.round(R)}`),q}let tu={linearity:.3,easing:t.bezier(0,0,.3,1)},Oc=t.extend({deceleration:2500,maxSpeed:1400},tu),Cc=t.extend({deceleration:20,maxSpeed:1400},tu),dt=t.extend({deceleration:1e3,maxSpeed:360},tu),Vn=t.extend({deceleration:1e3,maxSpeed:90},tu);class M_{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:s})}_drainInertiaBuffer(){let s=this._inertiaBuffer,h=t.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){let x=iu(h.pan.mag(),m,t.extend({},Oc,s||{}));y.offset=h.pan.mult(x.amount/h.pan.mag()),y.center=this._map.transform.center,ru(y,x)}if(h.zoom){let x=iu(h.zoom,m,Cc);y.zoom=this._map.transform.zoom+x.amount,ru(y,x)}if(h.bearing){let x=iu(h.bearing,m,dt);y.bearing=this._map.transform.bearing+t.clamp(x.amount,-179,179),ru(y,x)}if(h.pitch){let x=iu(h.pitch,m,Vn);y.pitch=this._map.transform.pitch+x.amount,ru(y,x)}if(y.zoom||y.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function ru(d,s){(!d.duration||d.duration<s.duration)&&(d.duration=s.duration,d.easing=s.easing)}function iu(d,s,h){let{maxSpeed:m,linearity:y,deceleration:x}=h,T=t.clamp(d*y/(s/1e3),-m,m),E=Math.abs(T)/(x*y);return{easing:h.easing,duration:1e3*E,amount:T*(E/2)}}class Ti extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m,y={}){let x=mt(h.getCanvasContainer(),m),T=h.unproject(x);super(s,t.extend({point:x,lngLat:T,originalEvent:m},y)),this._defaultPrevented=!1,this.target=h}}class nu extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m){let y=s==="touchend"?m.changedTouches:m.touches,x=Mt(h.getCanvasContainer(),y),T=x.map(A=>h.unproject(A)),E=x.reduce((A,R,q,F)=>A.add(R.div(F.length)),new t.Point(0,0));super(s,{points:x,point:E,lngLats:T,lngLat:h.unproject(E),originalEvent:m}),this._defaultPrevented=!1}}class Pc extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class dd{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Pc(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Ti(s.type,this._map,s))}mouseup(s){this._map.fire(new Ti(s.type,this._map,s))}preclick(s){let h=t.extend({},s);h.type="preclick",this._map.fire(new Ti(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Ti(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Ti(s.type,this._map,s))}mouseover(s){this._map.fire(new Ti(s.type,this._map,s))}mouseout(s){this._map.fire(new Ti(s.type,this._map,s))}touchstart(s){return this._firePreventable(new nu(s.type,this._map,s))}touchmove(s){this._map.fire(new nu(s.type,this._map,s))}touchend(s){this._map.fire(new nu(s.type,this._map,s))}touchcancel(s){this._map.fire(new nu(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mc{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Ti(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ti("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Ti(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class q_{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(Ae(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;let m=h,y=this._startPos,x=this._lastPos;if(!y||!x||x.equals(m)||!this._box&&m.dist(y)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));let T=Math.min(y.x,m.x),E=Math.max(y.x,m.x),A=Math.min(y.y,m.y),R=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${A}px)`,this._box.style.width=E-T+"px",this._box.style.height=R-A+"px")})}mouseupWindow(s,h){if(!this._active)return;let m=this._startPos,y=h;if(m&&s.button===0){if(this.reset(),tt(),m.x!==y.x||m.y!==y.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ke(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new t.Event(s,{originalEvent:h}))}}function qc(d,s){let h={};for(let m=0;m<d.length;m++)h[d[m].identifier]=s[m];return h}class Us{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){let x=new t.Point(0,0);for(let T of y)x._add(T);return x.div(y.length)}(h),this.touches=qc(m,h)))}touchmove(s,h,m){if(this.aborted||!this.centroid)return;let y=qc(m,h);for(let x in this.touches){let T=y[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,h,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){let y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class pd{constructor(s){this.singleTap=new Us(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,m){this.singleTap.touchstart(s,h,m)}touchmove(s,h,m){this.singleTap.touchmove(s,h,m)}touchend(s,h,m){let y=this.singleTap.touchend(s,h,m);if(y){let x=s.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(x&&T||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class ax{constructor(){this._zoomIn=new pd({numTouches:1,numTaps:2}),this._zoomOut=new pd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,m){this._zoomIn.touchstart(s,h,m),this._zoomOut.touchstart(s,h,m)}touchmove(s,h,m){this._zoomIn.touchmove(s,h,m),this._zoomOut.touchmove(s,h,m)}touchend(s,h,m){let y=this._zoomIn.touchend(s,h,m),x=this._zoomOut.touchend(s,h,m);return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let R_={0:1,2:2};class js{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;let m=Kt(s);this._correctButton(s,m)&&(this._lastPoint=h,this._eventButton=m)}mousemoveWindow(s,h){let m=this._lastPoint;if(m){if(s.preventDefault(),this._eventButton!=null&&function(y,x){let T=R_[x];return y.buttons===void 0||(y.buttons&T)!==T}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(m,h)}}mouseupWindow(s){this._lastPoint&&Kt(s)===this._eventButton&&(this._moved&&tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class md extends js{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class _d extends js{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let m=.8*(h.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){s.preventDefault()}}class yd extends js{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let m=-.5*(h.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){s.preventDefault()}}class Rc{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),t.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)}touchstart(s,h,m){return this._calculateTransform(s,h,m)}touchmove(s,h,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!t.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,m)}}touchend(s,h,m){this._calculateTransform(s,h,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,m){m.length>0&&(this._active=!0);let y=qc(m,h),x=new t.Point(0,0),T=new t.Point(0,0),E=0;for(let R in y){let q=y[R],F=this._touches[R];F&&(x._add(q),T._add(q.sub(F)),E++,y[R]=q)}if(this._touches=y,E<this._minTouches||!T.mag())return;let A=T.div(E);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(E),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ou{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,m){return{}}touchstart(s,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,m){let y=this._firstTwoTouches;if(!y)return;s.preventDefault();let[x,T]=y,E=au(m,h,x),A=au(m,h,T);if(!E||!A)return;let R=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],R,s)}touchend(s,h,m){if(!this._firstTwoTouches)return;let[y,x]=this._firstTwoTouches,T=au(m,h,y),E=au(m,h,x);T&&E||(this._active&&tt(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function au(d,s,h){for(let m=0;m<d.length;m++)if(d[m].identifier===h)return s[m]}function gd(d,s){return Math.log(d/s)/Math.LN2}class D_ extends ou{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){let m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(gd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gd(this._distance,m),pinchAround:h}}}function vd(d,s){return 180*d.angleWith(s)/Math.PI}class L_ extends ou{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){let m=this._vector;if(this._vector=s[0].sub(s[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:vd(this._vector,m),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());let h=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;let y=vd(s,m);return Math.abs(y)<h}}function sa(d){return Math.abs(d.y)>Math.abs(d.x)}class k_ extends ou{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,sa(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,m){let y=this._lastPoints;if(!y)return;let x=s[0].sub(y[0]),T=s[1].sub(y[1]);return this._map._cooperativeGestures&&!t.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,m.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(s,h,m){if(this._valid!==void 0)return this._valid;let y=s.mag()>=2,x=h.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;let T=s.y>0==h.y>0;return sa(s)&&sa(h)&&T}}let B_={panStep:100,bearingStep:15,pitchStep:10};class sx{constructor(){let s=B_;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,m=0,y=0,x=0,T=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),T=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:E=>{let A=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:z_,zoom:h?Math.round(A)+h*(s.shiftKey?2:1):A,bearing:E.getBearing()+m*this._bearingStep,pitch:E.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:E.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function z_(d){return d*(2-d)}let xd=4.000244140625;class F_{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||t.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,m=t.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,h!==0&&h%xd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=mt(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>xd?this._wheelZoomRate:this._defaultZoomRate,R=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&R!==0&&(R=1/R);let q=h(),F=Math.pow(2,q),$=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom($*R))),this._type==="wheel"&&(this._startZoom=q,this._easing=this._smoothOutEasing(200)),this._delta=0}let m=typeof this._targetZoom=="number"?this._targetZoom:h(),y=this._startZoom,x=this._easing,T,E=!1;if(this._type==="wheel"&&y&&x){let A=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),R=x(A);T=t.number(y,m,R),A<1?this._frameId||(this._frameId=!0):E=!0}else T=m,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:T-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=t.ease;if(this._prevEase){let m=this._prevEase,y=(t.exported.now()-m.start)/m.duration,x=m.easing(y+.01)-m.easing(y),T=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-T*T);h=t.bezier(T,E,.25,1)}return this._prevEase={start:t.exported.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class N_{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Li{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lx{constructor(){this._tap=new pd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=h[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,h,m))}touchmove(s,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;let y=h[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,h,m)}touchend(s,h,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(s,h,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class U_{constructor(s,h,m){this._el=s,this._mousePan=h,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ux{constructor(s,h,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cx{constructor(s,h,m,y){this._el=s,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Sn=d=>d.zoom||d.drag||d.pitch||d.rotate;class j_ extends t.Event{}class hx{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){let m=t.sub([],h,s);this.radius=t.length(m[2]<0?t.div([],m,this.constants):[m[0],m[1],0])}projectRay(s){t.div(s,s,this.constants),t.normalize(s,s),t.mul$1(s,s,this.constants);let h=t.scale$2([],s,this.radius);if(h[2]>0){let m=t.scale$2([],[0,0,1],t.dot(h,[0,0,1])),y=t.scale$2([],t.normalize([],[h[0],h[1],0]),this.radius),x=t.add([],h,t.scale$2([],t.sub([],t.add([],y,m),h),2));h[0]=x[0],h[1]=x[1]}return h}}function $n(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class no{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new M_(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new hx,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),t.bindAll(["handleEvent","handleWindowEvent"],this);let m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[t.window,"blur",void 0]];for(let[y,x,T]of this._listeners)y.addEventListener(x,y===t.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(let[s,h,m]of this._listeners)s.removeEventListener(h,s===t.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(s){let h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new dd(h,s));let y=h.boxZoom=new q_(h,s);this._add("boxZoom",y);let x=new ax,T=new Li;h.doubleClickZoom=new N_(T,x),this._add("tapZoom",x),this._add("clickZoom",T);let E=new lx;this._add("tapDragZoom",E);let A=h.touchPitch=new k_(h);this._add("touchPitch",A);let R=new _d(s),q=new yd(s);h.dragRotate=new ux(s,R,q),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);let F=new md(s),$=new Rc(h,s);h.dragPan=new U_(m,F,$),this._add("mousePan",F),this._add("touchPan",$,["touchZoom","touchRotate"]);let Z=new L_,X=new D_;h.touchZoomRotate=new cx(m,X,Z,E),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Mc(h));let H=h.scrollZoom=new F_(h,this);this._add("scrollZoom",H,["mousePan"]);let K=h.keyboard=new sx;this._add("keyboard",K);for(let N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[N]&&h[N].enable(s[N])}_add(s,h,m){this._handlers.push({handlerName:s,handler:h,allowed:m}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(let{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Sn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,m){for(let y in s)if(y!==m&&(!h||h.indexOf(y)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){let h=[];for(let m of s)this._el.contains(m.target)&&h.push(m);return h}handleEvent(s,h){this._updatingCamera=!0;let m=s.type==="renderFrame",y=m?void 0:s,x={needsRenderFrame:!1},T={},E={},A=s.touches?this._getMapTouches(s.touches):void 0,R=A?Mt(this._el,A):m?void 0:mt(this._el,s);for(let{handlerName:$,handler:Z,allowed:X}of this._handlers){if(!Z.isEnabled())continue;let H;this._blockedByActive(E,X,$)?Z.reset():Z[h||s.type]&&(H=Z[h||s.type](s,R,A),this.mergeHandlerResult(x,T,H,$,y),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||Z.isActive())&&(E[$]=Z)}let q={};for(let $ in this._previousActiveHandlers)E[$]||(q[$]=y);this._previousActiveHandlers=E,(Object.keys(q).length||$n(x))&&(this._changes.push([x,T,q]),this._triggerRenderFrame()),(Object.keys(E).length||$n(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=x;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(s,h,m,y,x){if(!m)return;t.extend(s,m);let T={handlerName:y,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(h.zoom=T),m.panDelta!==void 0&&(h.drag=T),m.pitchDelta!==void 0&&(h.pitch=T),m.bearingDelta!==void 0&&(h.rotate=T)}_applyChanges(){let s={},h={},m={};for(let[y,x,T]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new t.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(s.around=y.around),y.aroundCoord!==void 0&&(s.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),t.extend(h,x),t.extend(m,T);this._updateMapTransform(s,h,m),this._changes=[]}_updateMapTransform(s,h,m){let y=this._map,x=y.transform,T=W=>[W.x,W.y,W.z];if((W=>{let Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!$n(s)){let W=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",W!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&y._stop(!0),!$n(s))return void this._fireEvents(h,m,!0);let{panDelta:E,zoomDelta:A,bearingDelta:R,pitchDelta:q,around:F,aroundCoord:$,pinchAround:Z}=s;x._isCameraConstrained&&(A>0&&(A=0),x._isCameraConstrained=!1),Z!==void 0&&(F=Z),(A||(W=>h[W]&&!this._eventsInProgress[W])("drag"))&&F&&(this._dragOrigin=T(x.pointCoordinate3D(F)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),F=F||y.transform.centerPoint,R&&(x.bearing+=R),q&&(x.pitch+=q),x._updateCameraState();let X=[0,0,0];if(E)if(x.projection.name==="mercator"){let W=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F).dir),Q=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F.sub(E)).dir);X[0]=Q[0]-W[0],X[1]=Q[1]-W[1]}else{let W=x.pointCoordinate(F);if(x.projection.name==="globe"){E=E.rotate(-x.angle);let Q=x._pixelsPerMercatorPixel/x.worldSize;X[0]=-E.x*t.mercatorScale(t.latFromMercatorY(W.y))*Q,X[1]=-E.y*t.mercatorScale(x.center.lat)*Q}else{let Q=x.pointCoordinate(F.sub(E));W&&Q&&(X[0]=Q.x-W.x,X[1]=Q.y-W.y)}}let H=x.zoom,K=[0,0,0];if(A){let W=T($||x.pointCoordinate3D(F)),Q={dir:t.normalize([],t.sub([],W,x._camera.position))};if(Q.dir[2]<0){let ee=x.zoomDeltaToMovement(W,A);t.scale$2(K,Q.dir,ee)}}let N=t.add(X,X,K);x._translateCameraConstrained(N),A&&Math.abs(x.zoom-H)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,m,!0)}_fireEvents(s,h,m){let y=Sn(this._eventsInProgress),x=Sn(s),T={};for(let q in s){let{originalEvent:F}=s[q];this._eventsInProgress[q]||(T[`${q}start`]=F),this._eventsInProgress[q]=s[q]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(let q in T)this._fireEvent(q,T[q]);x&&this._fireEvent("move",x.originalEvent);for(let q in s){let{originalEvent:F}=s[q];this._fireEvent(q,F)}let E={},A;for(let q in this._eventsInProgress){let{handlerName:F,originalEvent:$}=this._eventsInProgress[q];this._handlersById[F].isActive()||(delete this._eventsInProgress[q],A=h[F]||$,E[`${q}end`]=A)}for(let q in E)this._fireEvent(q,E[q]);let R=Sn(this._eventsInProgress);if(m&&(y||x)&&!R){this._updatingCamera=!0;let q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;q?(F(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:A})):(this._map.fire(new t.Event("moveend",{originalEvent:A})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new t.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new j_("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Ga="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Dc extends t.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,m){return s=t.Point.convert(s).mult(-1),this.panTo(this.transform.center,t.extend({offset:s},h),m)}panTo(s,h,m){return this.easeTo(t.extend({center:s},h),m)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,m){return this.easeTo(t.extend({zoom:s},h),m)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,m){return this.easeTo(t.extend({bearing:s},h),m)}resetNorth(s,h){return this.rotateTo(0,t.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=t.LngLatBounds.convert(s);let m=h&&h.bearing||0,y=h&&h.pitch||0,x=s.getNorthWest(),T=s.getSouthEast();return this._cameraForBounds(this.transform,x,T,m,y,h)}_extendCameraOptions(s){let h={top:0,bottom:0,right:0,left:0};if(typeof(s=t.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){let m=s.padding;s.padding={top:m,bottom:m,right:m,left:m}}return s.padding=t.extend(h,s.padding),s}_minimumAABBFrustumDistance(s,h){let m=h.max[0]-h.min[0],y=h.max[1]-h.min[1];return m/y>s.aspect?m/(2*Math.tan(.5*s.fovX)*s.aspect):y/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,m,y,x,T){let E=s.clone(),A=this._extendCameraOptions(T);E.bearing=y,E.pitch=x;let R=t.LngLat.convert(h),q=t.LngLat.convert(m),F=.5*(R.lat+q.lat),$=.5*(R.lng+q.lng),Z=t.latLngToECEF(F,$),X=t.normalize([],Z),H=t.normalize([],t.cross([],X,[0,1,0])),K=t.cross([],H,X),N=[H[0],H[1],H[2],0,K[0],K[1],K[2],0,X[0],X[1],X[2],0,0,0,0,1],W=[Z,t.latLngToECEF(R.lat,R.lng),t.latLngToECEF(q.lat,R.lng),t.latLngToECEF(q.lat,q.lng),t.latLngToECEF(R.lat,q.lng),t.latLngToECEF(F,R.lng),t.latLngToECEF(F,q.lng),t.latLngToECEF(R.lat,$),t.latLngToECEF(q.lat,$)],Q=t.Aabb.fromPoints(W.map(He=>[t.dot(H,He),t.dot(K,He),t.dot(X,He)])),ee=t.transformMat4([],Q.center,N);t.squaredLength(ee)===0&&t.set(ee,0,0,1),t.normalize(ee,ee),t.scale$2(ee,ee,t.GLOBE_RADIUS),E.center=t.ecefToLatLng(ee);let he=E.getWorldToCameraMatrix(),de=t.invert(new Float64Array(16),he);Q=t.Aabb.applyTransform(Q,t.multiply([],he,N)),t.transformMat4(ee,ee,he);let fe=.5*(Q.max[2]-Q.min[2]),ve=this._minimumAABBFrustumDistance(E,Q),ye=t.scale$2([],[0,0,1],fe),Se=t.add(ye,ee,ye),Je=ve+(E.pitch===0?0:t.distance(ee,Se)),we=E.globeCenterInViewSpace,ze=t.sub([],ee,[we[0],we[1],we[2]]);t.normalize(ze,ze),t.scale$2(ze,ze,Je);let Oe=t.add([],ee,ze);t.transformMat4(Oe,Oe,de);let Ye=t.earthRadius/t.GLOBE_RADIUS,Ee=t.length(Oe),Be=t.mercatorZfromAltitude(Math.max(Ee*Ye-t.earthRadius,Number.EPSILON),0),et=Math.min(E.zoomFromMercatorZAdjusted(Be),A.maxZoom);return et>.5*(t.GLOBE_ZOOM_THRESHOLD_MIN+t.GLOBE_ZOOM_THRESHOLD_MAX)?(E.setProjection({name:"mercator"}),E.zoom=et,this._cameraForBounds(E,h,m,y,x,T)):{center:E.center,zoom:et,bearing:y,pitch:x}}queryTerrainElevation(s,h){let m=this.transform.elevation;return m?(h=t.extend({},{exaggerated:!0},h),m.getAtPoint(t.MercatorCoordinate.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,m,y,x,T){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,m,y,x,T);let E=s.clone(),A=this._extendCameraOptions(T),R=E.padding;E.bearing=y,E.pitch=x;let q=t.LngLat.convert(h),F=t.LngLat.convert(m),$=new t.LngLat(q.lng,F.lat),Z=new t.LngLat(F.lng,q.lat),X=E.project(q),H=E.project(F),K=this.queryTerrainElevation(q),N=this.queryTerrainElevation(F),W=this.queryTerrainElevation($),Q=this.queryTerrainElevation(Z),ee=[[X.x,X.y,Math.min(K||0,N||0,W||0,Q||0)],[H.x,H.y,Math.max(K||0,N||0,W||0,Q||0)]],he=t.Aabb.fromPoints(ee),de=E.getWorldToCameraMatrix(),fe=t.invert(new Float64Array(16),de);he=t.Aabb.applyTransform(he,de);let ve=t.sub([],he.max,he.min),ye=R.left||0,Se=R.right||0,Je=R.bottom||0,we=R.top||0,{left:ze,right:Oe,top:Ye,bottom:Ee}=A.padding,Be=.5*(ye+Se),et=.5*(we+Je),He=Math.min(E.scaleZoom(E.scale*Math.min((E.width-(ye+Se+ze+Oe))/ve[0],(E.height-(Je+we+Ee+Ye))/ve[1])),A.maxZoom),rt=E.scale/E.zoomScale(He);he=new t.Aabb([he.min[0]-(ze+Be)*rt,he.min[1]-(Ee+et)*rt,he.min[2]],[he.max[0]+(Oe+Be)*rt,he.max[1]+(Ye+et)*rt,he.max[2]]);let Tt=.5*ve[2],Rt=this._minimumAABBFrustumDistance(E,he),xt=[0,0,1,0];t.transformMat4$1(xt,xt,de),t.normalize$2(xt,xt);let Ot=t.scale$2([],xt,Rt+Tt),Xt=t.add([],he.center,Ot),Wt=(typeof A.offset.x=="number"&&typeof A.offset.y=="number"?new t.Point(A.offset.x,A.offset.y):t.Point.convert(A.offset)).rotate(-t.degToRad(y));he.center[0]-=Wt.x*rt,he.center[1]+=Wt.y*rt,t.transformMat4(he.center,he.center,fe),t.transformMat4(Xt,Xt,fe);let wt=[he.center[0],he.center[1],Xt[2]*E.pixelsPerMeter];t.scale$2(wt,wt,1/E.worldSize);let mr=t.lngFromMercatorX(wt[0]),xr=t.latFromMercatorY(wt[1]),br=Math.min(E._zoomFromMercatorZ(wt[2]),A.maxZoom),wr=new t.LngLat(mr,xr);return E.mercatorFromTransition&&br<.5*(t.GLOBE_ZOOM_THRESHOLD_MIN+t.GLOBE_ZOOM_THRESHOLD_MAX)?(E.setProjection({name:"globe"}),E.zoom=br,this._cameraForBounds(E,h,m,y,x,T)):{center:wr,zoom:br,bearing:y,pitch:x}}fitBounds(s,h,m){let y=this.cameraForBounds(s,h);return this._fitInternal(y,h,m)}fitScreenCoordinates(s,h,m,y,x){let T=t.Point.convert(s),E=t.Point.convert(h),A=new t.Point(Math.min(T.x,E.x),Math.min(T.y,E.y)),R=new t.Point(Math.max(T.x,E.x),Math.max(T.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,E))return this;let q=this.transform.pointLocation3D(A),F=this.transform.pointLocation3D(R),$=this.transform.pointLocation3D(new t.Point(A.x,R.y)),Z=this.transform.pointLocation3D(new t.Point(R.x,A.y)),X=[Math.min(q.lng,F.lng,$.lng,Z.lng),Math.min(q.lat,F.lat,$.lat,Z.lat)],H=[Math.max(q.lng,F.lng,$.lng,Z.lng),Math.max(q.lat,F.lat,$.lat,Z.lat)],K=y&&y.pitch?y.pitch:this.getPitch(),N=this._cameraForBounds(this.transform,X,H,m,K,y);return this._fitInternal(N,y,x)}_fitInternal(s,h,m){return s?(delete(h=t.extend(s,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(s,h){this.stop();let m=s.preloadOnly?this.transform.clone():this.transform,y=!1,x=!1,T=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(y=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=t.LngLat.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(x=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(T=!0,m.pitch=+s.pitch),s.padding==null||m.isPaddingEqual(s.padding)||(m.padding=s.padding),s.preloadOnly?(this._preloadTiles(m),this):(this.fire(new t.Event("movestart",h)).fire(new t.Event("move",h)),y&&this.fire(new t.Event("zoomstart",h)).fire(new t.Event("zoom",h)).fire(new t.Event("zoomend",h)),x&&this.fire(new t.Event("rotatestart",h)).fire(new t.Event("rotate",h)).fire(new t.Event("rotateend",h)),T&&this.fire(new t.Event("pitchstart",h)).fire(new t.Event("pitch",h)).fire(new t.Event("pitchend",h)),this.fire(new t.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.warnOnce(Ga),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){let m=this.transform;if(!m.projection.supportsFreeCamera)return t.warnOnce(Ga),this;this.stop();let y=m.zoom,x=m.pitch,T=m.bearing;m.setFreeCameraOptions(s);let E=y!==m.zoom,A=x!==m.pitch,R=T!==m.bearing;return this.fire(new t.Event("movestart",h)).fire(new t.Event("move",h)),E&&this.fire(new t.Event("zoomstart",h)).fire(new t.Event("zoom",h)).fire(new t.Event("zoomend",h)),R&&this.fire(new t.Event("rotatestart",h)).fire(new t.Event("rotate",h)).fire(new t.Event("rotateend",h)),A&&this.fire(new t.Event("pitchstart",h)).fire(new t.Event("pitch",h)).fire(new t.Event("pitchend",h)),this.fire(new t.Event("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=t.extend({offset:[0,0],duration:500,easing:t.ease},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);let m=this.transform,y=this.getZoom(),x=this.getBearing(),T=this.getPitch(),E=this.getPadding(),A="zoom"in s?+s.zoom:y,R="bearing"in s?this._normalizeBearing(s.bearing,x):x,q="pitch"in s?+s.pitch:T,F="padding"in s?s.padding:m.padding,$=t.Point.convert(s.offset),Z,X,H;if(m.projection.name==="globe"){let ye=t.MercatorCoordinate.fromLngLat(m.center),Se=$.rotate(-m.angle);ye.x+=Se.x/m.worldSize,ye.y+=Se.y/m.worldSize;let Je=ye.toLngLat(),we=t.LngLat.convert(s.center||Je);this._normalizeCenter(we),Z=m.centerPoint.add(Se),X=new t.Point(ye.x,ye.y).mult(m.worldSize),H=new t.Point(t.mercatorXfromLng(we.lng),t.mercatorYfromLat(we.lat)).mult(m.worldSize).sub(X)}else{Z=m.centerPoint.add($);let ye=m.pointLocation(Z),Se=t.LngLat.convert(s.center||ye);this._normalizeCenter(Se),X=m.project(ye),H=m.project(Se).sub(X)}let K=m.zoomScale(A-y),N,W;s.around&&(N=t.LngLat.convert(s.around),W=m.locationPoint(N));let Q=this._zooming||A!==y,ee=this._rotating||x!==R,he=this._pitching||q!==T,de=!m.isPaddingEqual(F),fe=ye=>Se=>{if(Q&&(ye.zoom=t.number(y,A,Se)),ee&&(ye.bearing=t.number(x,R,Se)),he&&(ye.pitch=t.number(T,q,Se)),de&&(ye.interpolatePadding(E,F,Se),Z=ye.centerPoint.add($)),N)ye.setLocationAtPoint(N,W);else{let Je=ye.zoomScale(ye.zoom-y),we=A>y?Math.min(2,K):Math.max(.5,K),ze=Math.pow(we,1-Se),Oe=ye.unproject(X.add(H.mult(Se*ze)).mult(Je));ye.setLocationAtPoint(ye.renderWorldCopies?Oe.wrap():Oe,Z)}return s.preloadOnly||this._fireMoveEvents(h),ye};if(s.preloadOnly){let ye=this._emulate(fe,s.duration,m);return this._preloadTiles(ye),this}let ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=ee,this._pitching=he,this._padding=de,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,ve),this._ease(fe(m),ye=>{m.recenterOnTerrain(),this._afterEase(h,ye)},s),this}_prepareEase(s,h,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||m.moving||this.fire(new t.Event("movestart",s)),this._zooming&&!m.zooming&&this.fire(new t.Event("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new t.Event("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new t.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new t.Event("move",s)),this._zooming&&this.fire(new t.Event("zoom",s)),this._rotating&&this.fire(new t.Event("rotate",s)),this._pitching&&this.fire(new t.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let m=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new t.Event("zoomend",s)),y&&this.fire(new t.Event("rotateend",s)),x&&this.fire(new t.Event("pitchend",s)),this.fire(new t.Event("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){let He=t.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,h)}this.stop(),s=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},s);let m=this.transform,y=this.getZoom(),x=this.getBearing(),T=this.getPitch(),E=this.getPadding(),A="zoom"in s?t.clamp(+s.zoom,m.minZoom,m.maxZoom):y,R="bearing"in s?this._normalizeBearing(s.bearing,x):x,q="pitch"in s?+s.pitch:T,F="padding"in s?s.padding:m.padding,$=m.zoomScale(A-y),Z=t.Point.convert(s.offset),X=m.centerPoint.add(Z),H=m.pointLocation(X),K=t.LngLat.convert(s.center||H);this._normalizeCenter(K);let N=m.project(H),W=m.project(K).sub(N),Q=s.curve,ee=Math.max(m.width,m.height),he=ee/$,de=W.mag();if("minZoom"in s){let He=t.clamp(Math.min(s.minZoom,y,A),m.minZoom,m.maxZoom),rt=ee/m.zoomScale(He-y);Q=Math.sqrt(rt/de*2)}let fe=Q*Q;function ve(He){let rt=(he*he-ee*ee+(He?-1:1)*fe*fe*de*de)/(2*(He?he:ee)*fe*de);return Math.log(Math.sqrt(rt*rt+1)-rt)}function ye(He){return(Math.exp(He)-Math.exp(-He))/2}function Se(He){return(Math.exp(He)+Math.exp(-He))/2}let Je=ve(0),we=function(He){return Se(Je)/Se(Je+Q*He)},ze=function(He){return ee*((Se(Je)*(ye(rt=Je+Q*He)/Se(rt))-ye(Je))/fe)/de;var rt},Oe=(ve(1)-Je)/Q;if(Math.abs(de)<1e-6||!isFinite(Oe)){if(Math.abs(ee-he)<1e-6)return this.easeTo(s,h);let He=he<ee?-1:1;Oe=Math.abs(Math.log(he/ee))/Q,ze=function(){return 0},we=function(rt){return Math.exp(He*Q*rt)}}s.duration="duration"in s?+s.duration:1e3*Oe/("screenSpeed"in s?+s.screenSpeed/Q:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);let Ye=x!==R,Ee=q!==T,Be=!m.isPaddingEqual(F),et=He=>rt=>{let Tt=rt*Oe,Rt=1/we(Tt);He.zoom=rt===1?A:y+He.scaleZoom(Rt),Ye&&(He.bearing=t.number(x,R,rt)),Ee&&(He.pitch=t.number(T,q,rt)),Be&&(He.interpolatePadding(E,F,rt),X=He.centerPoint.add(Z));let xt=rt===1?K:He.unproject(N.add(W.mult(ze(Tt))).mult(Rt));return He.setLocationAtPoint(He.renderWorldCopies?xt.wrap():xt,X),He._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),He};if(s.preloadOnly){let He=this._emulate(et,s.duration,m);return this._preloadTiles(He),this}return this._zooming=!0,this._rotating=Ye,this._pitching=Ee,this._padding=Be,this._prepareEase(h,!1),this._ease(et(m),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,h)}if(!s){let m=this.handlers;m&&m.stop(!1)}return this}_ease(s,h,m){m.animate===!1||m.duration===0?(s(1),h()):(this._easeStart=t.exported.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let s=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=t.wrap(s,-180,180);let m=Math.abs(s-h);return Math.abs(s-360-h)<m&&(s-=360),Math.abs(s+360-h)<m&&(s+=360),s}_normalizeCenter(s){let h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;let m=s.lng-h.center.lng;s.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&t.exported.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,m){let y=Math.ceil(15*h/1e3),x=[],T=s(m.clone());for(let E=0;E<=y;E++){let A=T(E/y);x.push(A.clone())}return x}}class yt{constructor(s={}){this.options=s,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){let h=this.options&&this.options.compact;return this._map=s,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z("button","mapboxgl-ctrl-attrib-button",this._container),z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){let m=this._map._getUIString(`AttributionControl.${h}`);s.setAttribute("aria-label",m),s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(s){let m=h.reduce((y,x,T)=>(x.value&&(y+=`${x.key}=${x.value}${T<h.length-1?"&":""}`),y),"?");s.href=`${t.config.FEEDBACK_URL}/${m}#${eu(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){let y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}let h=this._map.style._sourceCaches;for(let y in h){let x=h[y];if(x.used){let T=x.getSource();T.attribution&&s.indexOf(T.attribution)<0&&s.push(T.attribution)}}s.sort((y,x)=>y.length-x.length),s=s.filter((y,x)=>{for(let T=x+1;T<s.length;T++)if(s[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));let m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class bd{constructor(){t.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=z("div","mapboxgl-ctrl");let h=z("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(let h in s){let m=s[h].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){let s=this._container.children;if(s.length){let h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class wd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){let h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){let h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(let y of m)if(y.id===s)return void(y.cancelled=!0)}run(s=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let m of h)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Vs(d,s,h){if(d=new t.LngLat(d.lng,d.lat),s){let m=new t.LngLat(d.lng-360,d.lat),y=new t.LngLat(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-h.center.lng)/360),T=h.locationPoint(d).distSqr(s),E=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(m).distSqr(s)<T&&(E||Math.abs(m.lng-h.center.lng)<x)?d=m:h.locationPoint(y).distSqr(s)<T&&(E||Math.abs(y.lng-h.center.lng)<x)&&(d=y)}for(;Math.abs(d.lng-h.center.lng)>180;){let m=h.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;d.lng>h.center.lng?d.lng-=360:d.lng+=360}return d}let Wa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ht extends t.Evented{constructor(s,h){if(super(),(s instanceof t.window.HTMLElement||h)&&(s=t.extend({element:s},h)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=t.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=z("div");let y=41,x=27,T=B("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),E=B("radialGradient",{id:"shadowGradient"},B("defs",{},T));B("stop",{offset:"10%","stop-opacity":.4},E),B("stop",{offset:"100%","stop-opacity":.05},E),B("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),B("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),B("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),B("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=t.Point.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});let m=this._element.classList;for(let y in Wa)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){let s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=t.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){let y=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){let h=s.code,m=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(s){let h=s.originalEvent.target,m=this._element;this._popup&&(h===m||m.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let s=this._map,h=this._pos;if(!s||!h)return!1;let m=s.unproject(h),y=s.getFreeCameraOptions();if(!y.position)return!1;let x=y.position.toLngLat();return x.distanceTo(m)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let s=this._map;if(!s)return;let h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();let m=s.unproject(h),y;s._showingGlobe()&&t.isLngLatBehindGlobe(s.transform,this._lngLat)?y=0:(y=1-s._queryFogOpacity(m),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let s=this._pos;if(!s||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Wa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let s=this._pos,h=this._map,m=this.getPitchAlignment();if(!h||!s||m!=="map")return"";if(!h._showingGlobe()){let A=h.getPitch();return A?`rotateX(${A}deg)`:""}let y=t.radToDeg(t.globeTiltAtLngLat(h.transform,this._lngLat)),x=s.sub(t.globeCenterToScreenPoint(h.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";let E=y/T;return`rotateX(${-x.y*E}deg) rotateY(${x.x*E}deg)`}_calculateZTransform(){let s=this._pos,h=this._map;if(!h||!s)return"";let m=0,y=this.getRotationAlignment();if(y==="map")if(h._showingGlobe()){let x=h.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=h.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);m=t.radToDeg(Math.atan2(T.y,T.x))-90}else m=-h.getBearing();else if(y==="horizon"){let x=t.smoothstep(4,6,h.getZoom()),T=t.globeCenterToScreenPoint(h.transform);T.y+=x*h.transform.height;let E=s.sub(T),A=t.radToDeg(Math.atan2(E.y,E.x));m=(A>90?A-270:A+90)*(1-x)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(s){t.window.cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Vs(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),s===!0?this._updateFrameId=t.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=t.Point.convert(s),this._update(),this}_onMove(s){let h=this._map;if(!h)return;let m=this._pointerdownPos,y=this._positionDelta;if(m&&y){if(!this._isDragging){let x=this._clickTolerance||h._clickTolerance;if(s.point.dist(m)<x)return;this._isDragging=!0}this._pos=s.point.sub(y),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(s){let h=this._map,m=this._pos;h&&m&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(m),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;let h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Td={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},fx=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function V_(d=new t.Point(0,0),s="bottom"){if(typeof d=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(s){case"top":return new t.Point(0,d);case"top-left":return new t.Point(h,h);case"top-right":return new t.Point(-h,h);case"bottom":return new t.Point(0,-d);case"bottom-left":return new t.Point(h,-h);case"bottom-right":return new t.Point(-h,-h);case"left":return new t.Point(d,0);case"right":return new t.Point(-d,0)}return new t.Point(0,0)}return d instanceof t.Point||Array.isArray(d)?t.Point.convert(d):t.Point.convert(d[s]||[0,0])}class Ed{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;let h=t.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,m){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+m}}let $_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},G_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},dx={showCompass:!0,showZoom:!0,visualizePitch:!1};class px{constructor(s,h,m=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new _d({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new yd({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),Ae()}move(s,h){let m=this.map,y=this.mouseRotate.mousemoveWindow(s,h),x=y&&y.bearingDelta;if(x&&m.setBearing(m.getBearing()+x),this.mousePitch){let T=this.mousePitch.mousemoveWindow(s,h),E=T&&T.pitchDelta;E&&m.setPitch(m.getPitch()+E)}}off(){let s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ke(),t.window.removeEventListener("mousemove",this.mousemove),t.window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(t.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),mt(this.element,s)),t.window.addEventListener("mousemove",this.mousemove),t.window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,mt(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Mt(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Mt(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Sd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Id={maxWidth:100,unit:"metric"},Ad={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},$s={version:t.version,supported:S,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends Dc{constructor(d){if(t.LivePerformanceUtils.mark(t.PerformanceMarkers.create),(d=t.extend({},G_,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&t.isSafariWithAntialiasingBug(t.window)&&(d.antialias=!1,t.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fs(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new wd,this._domRenderTaskQueue=new wd,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.uniqueId(),this._locale=t.extend({},$_,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ed(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new t.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=t.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof t.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&t.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),t.window!==void 0&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1),t.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new no(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new fd(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,t.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new yt({customAttribution:d.customAttribution})),this._logoControl=new bd,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new t.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new t.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(d,s){if(s===void 0&&(s=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=d.onAdd(this);this._controls.push(d);let m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let s=this._controls.indexOf(d);return s>-1&&this._controls.splice(s,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let s=!this._moving;return s&&this.fire(new t.Event("movestart",d)).fire(new t.Event("move",d)),this.fire(new t.Event("resize",d)),s&&this.fire(new t.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(t.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?t.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(s=>s==="auto"?t.window.navigator.language:s):d}setLanguage(d){let s=this._parseLanguage(d);if(!this.style||s===this._language)return this;this._language=s,this.style._reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let d=this.transform,s=d.projection.name,h;s==="globe"&&d.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),h=!0):s==="mercator"&&d.zoom<t.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,s){return this._updateProjection(d||s||{name:"mercator"})}_updateProjection(d){let s;if(s=d.name==="globe"&&this.transform.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),s){this.painter.clearBackgroundTiles();for(let h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(t.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(t.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,s,h){if(d==="mouseenter"||d==="mouseover"){let m=!1,y=T=>{let E=s.filter(R=>this.getLayer(R)),A=E.length?this.queryRenderedFeatures(T.point,{layers:E}):[];A.length?m||(m=!0,h.call(this,new Ti(d,this,T.originalEvent,{features:A}))):m=!1},x=()=>{m=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:y,mouseout:x}}}if(d==="mouseleave"||d==="mouseout"){let m=!1,y=T=>{let E=s.filter(A=>this.getLayer(A));(E.length?this.queryRenderedFeatures(T.point,{layers:E}):[]).length?m=!0:m&&(m=!1,h.call(this,new Ti(d,this,T.originalEvent)))},x=T=>{m&&(m=!1,h.call(this,new Ti(d,this,T.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:y,mouseout:x}}}{let m=y=>{let x=s.filter(E=>this.getLayer(E)),T=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];T.length&&(y.features=T,h.call(this,y),delete y.features)};return{layers:new Set(s),listener:h,delegates:{[d]:m}}}}on(d,s,h){if(h===void 0)return super.on(d,s);Array.isArray(s)||(s=[s]);let m=this._createDelegatedListener(d,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(let y in m.delegates)this.on(y,m.delegates[y]);return this}once(d,s,h){if(h===void 0)return super.once(d,s);Array.isArray(s)||(s=[s]);let m=this._createDelegatedListener(d,s,h);for(let y in m.delegates)this.once(y,m.delegates[y]);return this}off(d,s,h){if(h===void 0)return super.off(d,s);s=new Set(Array.isArray(s)?s:[s]);let m=(x,T)=>{if(x.size!==T.size)return!1;for(let E of x)if(!T.has(E))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[d]:void 0;return y&&(x=>{for(let T=0;T<x.length;T++){let E=x[T];if(E.listener===h&&m(E.layers,s)){for(let A in E.delegates)this.off(A,E.delegates[A]);return x.splice(T,1),this}}})(y),this}queryRenderedFeatures(d,s){return this.style?(s!==void 0||d===void 0||d instanceof t.Point||Array.isArray(d)||(s=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(d,s){return this.style.querySourceFeatures(d,s)}isPointOnSurface(d){let{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&t.warnOnce(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.Point.convert(d))}setStyle(d,s){return(s=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(d,s))}_getUIString(d){let s=this._locale[d];if(s==null)throw new Error(`Missing UI string '${d}'`);return s}_updateStyle(d,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new ro(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,s){if(typeof d=="string"){let h=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(h,t.ResourceType.Style);t.getJSON(m,(y,x)=>{y?this.fire(new t.ErrorEvent(y)):x&&this._updateDiff(x,s)})}else typeof d=="object"&&this._updateDiff(d,s)}_updateDiff(d,s){try{this.style.setState(d)&&this._update(!0)}catch(h){t.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(d,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.warnOnce("There is no style added to the map."),!1)}addSource(d,s){return this._lazyInitEmptyStyle(),this.style.addSource(d,s),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){let d=this.style&&this.style._sourceCaches;for(let s in d){let h=d[s]._tiles;for(let m in h){let y=h[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(d,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(d,s,h)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,s,{pixelRatio:h=1,sdf:m=!1,stretchX:y,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),s instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&s instanceof t.window.ImageBitmap){let{width:E,height:A,data:R}=t.exported.getImageData(s);this.style.addImage(d,{data:new t.RGBAImage({width:E,height:A},R),pixelRatio:h,stretchX:y,stretchY:x,content:T,sdf:m,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:E,height:A}=s,R=s;this.style.addImage(d,{data:new t.RGBAImage({width:E,height:A},new Uint8Array(R.data)),pixelRatio:h,stretchX:y,stretchY:x,content:T,sdf:m,version:0,userImage:R}),R.onAdd&&R.onAdd(this,d)}}updateImage(d,s){let h=this.style.getImage(d);if(!h)return void this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let m=s instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&s instanceof t.window.ImageBitmap?t.exported.getImageData(s):s,{width:y,height:x}=m;y!==void 0&&x!==void 0?y===h.data.width&&x===h.data.height?(h.data.replace(m.data,!(s instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&s instanceof t.window.ImageBitmap)),this.style.updateImage(d,h)):this.fire(new t.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`))):this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,s){t.getImage(this._requestManager.transformRequest(d,t.ResourceType.Image),(h,m)=>{s(h,m instanceof t.window.HTMLImageElement?t.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,s){return this._lazyInitEmptyStyle(),this.style.addLayer(d,s),this._update(!0)}moveLayer(d,s){return this.style.moveLayer(d,s),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,s,h){return this.style.setLayerZoomRange(d,s,h),this._update(!0)}setFilter(d,s,h={}){return this.style.setFilter(d,s,h),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,s,h,m={}){return this.style.setPaintProperty(d,s,h,m),this._update(!0)}getPaintProperty(d,s){return this.style.getPaintProperty(d,s)}setLayoutProperty(d,s,h,m={}){return this.style.setLayoutProperty(d,s,h,m),this._update(!0)}getLayoutProperty(d,s){return this.style.getLayoutProperty(d,s)}setLight(d,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(d),this.transform):0}setFeatureState(d,s){return this.style.setFeatureState(d,s),this._update()}removeFeatureState(d,s){return this.style.removeFeatureState(d,s),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300,h,m,y,x=this._container;for(;x&&(!m||!y);){let T=t.window.getComputedStyle(x).transform;T&&T!=="none"&&(h=T.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(m=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(y=h[3])),x=x.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=y?Math.abs(s/y):s}_detectMissingCSS(){t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=z("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let s=this._canvasContainer=z("div","mapboxgl-canvas-container",d);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=z("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=z("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=z("div",`mapboxgl-ctrl-${y}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,s){let h=t.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(d),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${s}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){let s=this._markers.indexOf(d);s!==-1&&this._markers.splice(s,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){let s=this._popups.indexOf(d);s!==-1&&this._popups.splice(s,1)}_setupPainter(){let d=t.extend({},S.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._useWebGL2&&this._canvas.getContext("webgl2",d),h=s||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);h?(this._useWebGL2&&!s&&t.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),t.storeAuthState(h,!0),this.painter=new Bs(h,this.transform,!!s),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.exported$1.testSupport(h)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let s,h=this.painter.context.extTimerQuery,m=t.exported.now();if(this.listens("gpu-timing-frame")&&(s=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],t.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],t.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let E=this.transform.zoom,A=this.transform.pitch,R=t.exported.now(),q=new t.EvaluationParameters(E,{now:R,fadeDuration:y,pitch:A,transition:this.style.getTransition()});this.style.update(q)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){let E=t.exported.now()-m;h.endQueryEXT(h.TIME_ELAPSED_EXT,s),setTimeout(()=>{let A=h.getQueryObjectEXT(s,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(s),this.fire(new t.Event("gpu-timing-frame",{cpuTime:E,gpuTime:A})),t.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:A}})},50)}if(this.listens("gpu-timing-layer")){let E=this.painter.collectGpuTimers();setTimeout(()=>{let A=this.painter.queryGpuTimers(E);this.fire(new t.Event("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){let E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let A=this.painter.queryGpuTimeDeferredRender(E);this.fire(new t.Event("gpu-timing-deferred-render",{gpuTime:A}))},50)}let T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{let E=!this.isMoving()&&this.loaded();if(E&&(x=this._updateAverageElevation(m,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let A=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,t.LivePerformanceUtils.mark(t.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&t.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(let s of this._markers)d&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(let s of this._popups)!d||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(d,s=!1){let h=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((s||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let m=this.transform.averageElevation,y=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;let T=Math.abs(m-y);if(T>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(y),h(y);this._averageElevation.easeTo(y,d,300)}else if(T>1e-4)return this._averageElevation.jumpTo(y),h(y)}return!!this._averageElevation.isEasing(d)&&h(this._averageElevation.getValue(d))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===t.AUTH_ERR_MSG||d.status===401)){let s=this.painter.context.gl;t.storeAuthState(s,!1),this._logoControl instanceof bd&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());let h=this.painter.context.gl,m=h.createFramebuffer();function y(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,m),this._canvasPixelComparison(y(d),s.canvasCopies.map(y),s.timeStamps)}_canvasPixelComparison(d,s,h){let m=h[1]-h[0],y=d.length/4;for(let x=0;x<s.length;x++){let T=s[x],E=0;for(let A=0;A<T.length;A+=4)T[A]===d[A]&&T[A+1]===d[A+1]&&T[A+2]===d[A+2]&&T[A+3]===d[A+3]&&(E+=1);m+=(h[x+2]-h[x+1])*(1-E/y)}return m}remove(){this._hash&&this._hash.remove();for(let s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),t.window!==void 0&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1),t.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=t.exported.frame(s=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(d){let s=this.style?Object.values(this.style._sourceCaches):[];return t.asyncAll(s,(h,m)=>h._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){t.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,s){t.setCacheLimits(d,s)}get version(){return t.version}},NavigationControl:class{constructor(d){this.options=t.extend({},dx,d),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let s=d.getZoom(),h=s===d.getMaxZoom(),m=s===d.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new px(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,s){let h=z("button",d,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(d,s){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${s}`);d.setAttribute("aria-label",h),d.firstElementChild&&d.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends t.Evented{constructor(d){super(),this.options=t.extend({geolocation:t.window.navigator.geolocation},Sd,d),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ns(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){let s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,d(h)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):t.window.navigator.permissions!==void 0?t.window.navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(d){let s=this._map.getMaxBounds(),h=d.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",d)),this._finish()}}_updateCamera(d){let s=new t.LngLat(d.coords.longitude,d.coords.latitude),h=d.coords.accuracy,m=this._map.getBearing(),y=t.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),y,{geolocateSource:!0})}_updateMarker(d){if(d){let s=new t.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map.transform,s=t.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=z("button","mapboxgl-ctrl-geolocate",this._container),z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{let s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z("div","mapboxgl-user-location"),this._dotElement.appendChild(z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ht({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ht({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{t.window.addEventListener("ondeviceorientationabsolute"in t.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};t.window.DeviceMotionEvent!==void 0&&typeof t.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.window.removeEventListener("deviceorientation",this._onDeviceOrientation),t.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yt,ScaleControl:class{constructor(d){this.options=t.extend({},Id,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),t.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let d=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,m=s._containerWidth/2-d/2,y=s.unproject([m,h]),x=s.unproject([m+d,h]),T=y.distanceTo(x);if(this.options.unit==="imperial"){let E=3.2808*T;E>5280?this._setScale(d,E/5280,"mile"):this._setScale(d,E,"foot")}else this.options.unit==="nautical"?this._setScale(d,T/1852,"nautical-mile"):T>=1e3?this._setScale(d,T/1e3,"kilometer"):this._setScale(d,T,"meter")}_setScale(d,s,h){this._map._requestDomTask(()=>{let m=function(x){let T=Math.pow(10,`${Math.floor(x)}`.length-1),E=x/T;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(A){let R=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*R)/R}(E),T*E}(s),y=m/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(m):`${m}&nbsp;${Ad[h]}`,this._container.style.width=d*y+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof t.window.HTMLElement?this._container=d.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);z("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(d){super(),this.options=t.extend(Object.create(Td),d),t.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=t.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();let s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(t.window.document.createTextNode(d))}setHTML(d){let s=t.window.document.createDocumentFragment(),h=t.window.document.createElement("body"),m;for(h.innerHTML=d;m=h.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=z("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(d),this.options.closeButton){let h=this._closeButton=z("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let s;return this._classList.delete(d)?s=!1:(this._classList.add(d),s=!0),this._updateClassList(),s}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let s=this._map,h=this._container,m=this._pos;if(!s||!h||!m)return"bottom";let y=h.offsetWidth,x=h.offsetHeight,T=m.x<y/2,E=m.x>s.transform.width-y/2;if(m.y+d<x)return T?"top-left":E?"top-right":"top";if(m.y>s.transform.height-x){if(T)return"bottom-left";if(E)return"bottom-right"}return T?"left":E?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),d.className=s.join(" ")}_update(d){let s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let m=this._container;if(m||(m=this._container=z("div","mapboxgl-popup",s.getContainer()),this._tip=z("div","mapboxgl-popup-tip",m),m.appendChild(h)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vs(this._lngLat,this._pos,s.transform)),!this._trackPointer||d){let y=this._pos=this._trackPointer&&d?d:s.project(this._lngLat),x=V_(this.options.offset),T=this._anchor=this._getAnchor(x.y),E=V_(this.options.offset,T),A=y.add(E).round();s._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Wa[T]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&s._showingGlobe()){let y=t.isLngLatBehindGlobe(s.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(fx);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:ht,Style:ro,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:O_,Evented:t.Evented,config:t.config,prewarm:function(){Is().acquire(Qn)},clearPrewarmedResources:function(){let d=Vi;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Qn),Vi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(d){t.config.ACCESS_TOKEN=d},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(d){t.config.API_URL=d},get workerCount(){return bi.workerCount},set workerCount(d){bi.workerCount=d},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){t.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){t.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return $s});var c=l;return c})});var KK=P(()=>{});var _Y=P((brt,mY)=>{var fA=typeof Map=="function"&&Map.prototype,iA=Object.getOwnPropertyDescriptor&&fA?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,$0=fA&&iA&&typeof iA.get=="function"?iA.get:null,YK=fA&&Map.prototype.forEach,dA=typeof Set=="function"&&Set.prototype,nA=Object.getOwnPropertyDescriptor&&dA?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,G0=dA&&nA&&typeof nA.get=="function"?nA.get:null,JK=dA&&Set.prototype.forEach,A4e=typeof WeakMap=="function"&&WeakMap.prototype,i_=A4e?WeakMap.prototype.has:null,O4e=typeof WeakSet=="function"&&WeakSet.prototype,n_=O4e?WeakSet.prototype.has:null,C4e=typeof WeakRef=="function"&&WeakRef.prototype,QK=C4e?WeakRef.prototype.deref:null,P4e=Boolean.prototype.valueOf,M4e=Object.prototype.toString,q4e=Function.prototype.toString,R4e=String.prototype.match,pA=String.prototype.slice,Ol=String.prototype.replace,D4e=String.prototype.toUpperCase,eY=String.prototype.toLowerCase,uY=RegExp.prototype.test,tY=Array.prototype.concat,qa=Array.prototype.join,L4e=Array.prototype.slice,rY=Math.floor,sA=typeof BigInt=="function"?BigInt.prototype.valueOf:null,oA=Object.getOwnPropertySymbols,lA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Mf=typeof Symbol=="function"&&typeof Symbol.iterator=="object",an=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Mf||!0)?Symbol.toStringTag:null,cY=Object.prototype.propertyIsEnumerable,iY=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(a){return a.__proto__}:null);function nY(a,i){if(a===1/0||a===-1/0||a!==a||a&&a>-1e3&&a<1e3||uY.call(/e/,i))return i;var l=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof a=="number"){var o=a<0?-rY(-a):rY(a);if(o!==a){var c=String(o),t=pA.call(i,c.length+1);return Ol.call(c,l,"$&_")+"."+Ol.call(Ol.call(t,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ol.call(i,l,"$&_")}var uA=KK(),oY=uA.custom,aY=fY(oY)?oY:null;mY.exports=function a(i,l,o,c){var t=l||{};if(Al(t,"quoteStyle")&&t.quoteStyle!=="single"&&t.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Al(t,"maxStringLength")&&(typeof t.maxStringLength=="number"?t.maxStringLength<0&&t.maxStringLength!==1/0:t.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var v=Al(t,"customInspect")?t.customInspect:!0;if(typeof v!="boolean"&&v!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Al(t,"indent")&&t.indent!==null&&t.indent!=="	"&&!(parseInt(t.indent,10)===t.indent&&t.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Al(t,"numericSeparator")&&typeof t.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var S=t.numericSeparator;if(typeof i>"u")return"undefined";if(i===null)return"null";if(typeof i=="boolean")return i?"true":"false";if(typeof i=="string")return pY(i,t);if(typeof i=="number"){if(i===0)return 1/0/i>0?"0":"-0";var C=String(i);return S?nY(i,C):C}if(typeof i=="bigint"){var D=String(i)+"n";return S?nY(i,D):D}var z=typeof t.depth>"u"?5:t.depth;if(typeof o>"u"&&(o=0),o>=z&&z>0&&typeof i=="object")return cA(i)?"[Array]":"[Object]";var B=Q4e(t,o);if(typeof c>"u")c=[];else if(dY(c,i)>=0)return"[Circular]";function ne(di,xi,qe){if(xi&&(c=L4e.call(c),c.push(xi)),qe){var Ne={depth:t.depth};return Al(t,"quoteStyle")&&(Ne.quoteStyle=t.quoteStyle),a(di,Ne,o+1,c)}return a(di,t,o+1,c)}if(typeof i=="function"&&!sY(i)){var pe=$4e(i),$e=V0(i,ne);return"[Function"+(pe?": "+pe:" (anonymous)")+"]"+($e.length>0?" { "+qa.call($e,", ")+" }":"")}if(fY(i)){var Ae=Mf?Ol.call(String(i),/^(Symbol\(.*\))_[^)]*$/,"$1"):lA.call(i);return typeof i=="object"&&!Mf?r_(Ae):Ae}if(K4e(i)){for(var ke="<"+eY.call(String(i.nodeName)),Ge=i.attributes||[],tt=0;tt<Ge.length;tt++)ke+=" "+Ge[tt].name+"="+hY(k4e(Ge[tt].value),"double",t);return ke+=">",i.childNodes&&i.childNodes.length&&(ke+="..."),ke+="</"+eY.call(String(i.nodeName))+">",ke}if(cA(i)){if(i.length===0)return"[]";var mt=V0(i,ne);return B&&!J4e(mt)?"["+hA(mt,B)+"]":"[ "+qa.call(mt,", ")+" ]"}if(z4e(i)){var Mt=V0(i,ne);return!("cause"in Error.prototype)&&"cause"in i&&!cY.call(i,"cause")?"{ ["+String(i)+"] "+qa.call(tY.call("[cause]: "+ne(i.cause),Mt),", ")+" }":Mt.length===0?"["+String(i)+"]":"{ ["+String(i)+"] "+qa.call(Mt,", ")+" }"}if(typeof i=="object"&&v){if(aY&&typeof i[aY]=="function"&&uA)return uA(i,{depth:z-o});if(v!=="symbol"&&typeof i.inspect=="function")return i.inspect()}if(G4e(i)){var Kt=[];return YK&&YK.call(i,function(di,xi){Kt.push(ne(xi,i,!0)+" => "+ne(di,i))}),lY("Map",$0.call(i),Kt,B)}if(H4e(i)){var At=[];return JK&&JK.call(i,function(di){At.push(ne(di,i))}),lY("Set",G0.call(i),At,B)}if(W4e(i))return aA("WeakMap");if(X4e(i))return aA("WeakSet");if(Z4e(i))return aA("WeakRef");if(N4e(i))return r_(ne(Number(i)));if(j4e(i))return r_(ne(sA.call(i)));if(U4e(i))return r_(P4e.call(i));if(F4e(i))return r_(ne(String(i)));if(typeof window<"u"&&i===window)return"{ [object Window] }";if(i===globalThis)return"{ [object globalThis] }";if(!B4e(i)&&!sY(i)){var Ve=V0(i,ne),er=iY?iY(i)===Object.prototype:i instanceof Object||i.constructor===Object,Dt=i instanceof Object?"":"null prototype",Pt=!er&&an&&Object(i)===i&&an in i?pA.call(Cl(i),8,-1):Dt?"Object":"",Or=er||typeof i.constructor!="function"?"":i.constructor.name?i.constructor.name+" ":"",vr=Or+(Pt||Dt?"["+qa.call(tY.call([],Pt||[],Dt||[]),": ")+"] ":"");return Ve.length===0?vr+"{}":B?vr+"{"+hA(Ve,B)+"}":vr+"{ "+qa.call(Ve,", ")+" }"}return String(i)};function hY(a,i,l){var o=(l.quoteStyle||i)==="double"?'"':"'";return o+a+o}function k4e(a){return Ol.call(String(a),/"/g,"&quot;")}function cA(a){return Cl(a)==="[object Array]"&&(!an||!(typeof a=="object"&&an in a))}function B4e(a){return Cl(a)==="[object Date]"&&(!an||!(typeof a=="object"&&an in a))}function sY(a){return Cl(a)==="[object RegExp]"&&(!an||!(typeof a=="object"&&an in a))}function z4e(a){return Cl(a)==="[object Error]"&&(!an||!(typeof a=="object"&&an in a))}function F4e(a){return Cl(a)==="[object String]"&&(!an||!(typeof a=="object"&&an in a))}function N4e(a){return Cl(a)==="[object Number]"&&(!an||!(typeof a=="object"&&an in a))}function U4e(a){return Cl(a)==="[object Boolean]"&&(!an||!(typeof a=="object"&&an in a))}function fY(a){if(Mf)return a&&typeof a=="object"&&a instanceof Symbol;if(typeof a=="symbol")return!0;if(!a||typeof a!="object"||!lA)return!1;try{return lA.call(a),!0}catch{}return!1}function j4e(a){if(!a||typeof a!="object"||!sA)return!1;try{return sA.call(a),!0}catch{}return!1}var V4e=Object.prototype.hasOwnProperty||function(a){return a in this};function Al(a,i){return V4e.call(a,i)}function Cl(a){return M4e.call(a)}function $4e(a){if(a.name)return a.name;var i=R4e.call(q4e.call(a),/^function\s*([\w$]+)/);return i?i[1]:null}function dY(a,i){if(a.indexOf)return a.indexOf(i);for(var l=0,o=a.length;l<o;l++)if(a[l]===i)return l;return-1}function G4e(a){if(!$0||!a||typeof a!="object")return!1;try{$0.call(a);try{G0.call(a)}catch{return!0}return a instanceof Map}catch{}return!1}function W4e(a){if(!i_||!a||typeof a!="object")return!1;try{i_.call(a,i_);try{n_.call(a,n_)}catch{return!0}return a instanceof WeakMap}catch{}return!1}function Z4e(a){if(!QK||!a||typeof a!="object")return!1;try{return QK.call(a),!0}catch{}return!1}function H4e(a){if(!G0||!a||typeof a!="object")return!1;try{G0.call(a);try{$0.call(a)}catch{return!0}return a instanceof Set}catch{}return!1}function X4e(a){if(!n_||!a||typeof a!="object")return!1;try{n_.call(a,n_);try{i_.call(a,i_)}catch{return!0}return a instanceof WeakSet}catch{}return!1}function K4e(a){return!a||typeof a!="object"?!1:typeof HTMLElement<"u"&&a instanceof HTMLElement?!0:typeof a.nodeName=="string"&&typeof a.getAttribute=="function"}function pY(a,i){if(a.length>i.maxStringLength){var l=a.length-i.maxStringLength,o="... "+l+" more character"+(l>1?"s":"");return pY(pA.call(a,0,i.maxStringLength),i)+o}var c=Ol.call(Ol.call(a,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Y4e);return hY(c,"single",i)}function Y4e(a){var i=a.charCodeAt(0),l={8:"b",9:"t",10:"n",12:"f",13:"r"}[i];return l?"\\"+l:"\\x"+(i<16?"0":"")+D4e.call(i.toString(16))}function r_(a){return"Object("+a+")"}function aA(a){return a+" { ? }"}function lY(a,i,l,o){var c=o?hA(l,o):qa.call(l,", ");return a+" ("+i+") {"+c+"}"}function J4e(a){for(var i=0;i<a.length;i++)if(dY(a[i],`
`)>=0)return!1;return!0}function Q4e(a,i){var l;if(a.indent==="	")l="	";else if(typeof a.indent=="number"&&a.indent>0)l=qa.call(Array(a.indent+1)," ");else return null;return{base:l,prev:qa.call(Array(i+1),l)}}function hA(a,i){if(a.length===0)return"";var l=`
`+i.prev+i.base;return l+qa.call(a,","+l)+`
`+i.prev}function V0(a,i){var l=cA(a),o=[];if(l){o.length=a.length;for(var c=0;c<a.length;c++)o[c]=Al(a,c)?i(a[c],a):""}var t=typeof oA=="function"?oA(a):[],v;if(Mf){v={};for(var S=0;S<t.length;S++)v["$"+t[S]]=t[S]}for(var C in a)Al(a,C)&&(l&&String(Number(C))===C&&C<a.length||Mf&&v["$"+C]instanceof Symbol||(uY.call(/[^\w$]/,C)?o.push(i(C,a)+": "+i(a[C],a)):o.push(C+": "+i(a[C],a))));if(typeof oA=="function")for(var D=0;D<t.length;D++)cY.call(a,t[D])&&o.push("["+i(t[D])+"]: "+i(a[t[D]],a));return o}});var Lrt=rn(e7(),1),krt=rn(t7(),1),xY=rn(Q2(),1);var A0,zr,y7,Hke,Yu,f7,g7,eI,Xke,Fm={},iI=[],Kke=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,nI=Array.isArray;function wl(a,i){for(var l in i)a[l]=i[l];return a}function v7(a){var i=a.parentNode;i&&i.removeChild(a)}function Yke(a,i,l){var o,c,t,v={};for(t in i)t=="key"?o=i[t]:t=="ref"?c=i[t]:v[t]=i[t];if(arguments.length>2&&(v.children=arguments.length>3?A0.call(arguments,2):l),typeof a=="function"&&a.defaultProps!=null)for(t in a.defaultProps)v[t]===void 0&&(v[t]=a.defaultProps[t]);return S0(a,v,o,c,null)}function S0(a,i,l,o,c){var t={type:a,props:i,key:l,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:c??++y7,__i:-1,__u:0};return c==null&&zr.vnode!=null&&zr.vnode(t),t}function x7(){return{current:null}}function df(a){return a.children}function hf(a,i){this.props=a,this.context=i}function ff(a,i){if(i==null)return a.__?ff(a.__,a.__i+1):null;for(var l;i<a.__k.length;i++)if((l=a.__k[i])!=null&&l.__e!=null)return l.__e;return typeof a.type=="function"?ff(a):null}function Jke(a,i,l){var o,c=a.__v,t=c.__e,v=a.__P;if(v)return(o=wl({},c)).__v=c.__v+1,zr.vnode&&zr.vnode(o),oI(v,o,c,a.__n,v.ownerSVGElement!==void 0,32&c.__u?[t]:null,i,t??ff(c),!!(32&c.__u),l),o.__v=c.__v,o.__.__k[o.__i]=o,o.__d=void 0,o.__e!=t&&b7(o),o}function b7(a){var i,l;if((a=a.__)!=null&&a.__c!=null){for(a.__e=a.__c.base=null,i=0;i<a.__k.length;i++)if((l=a.__k[i])!=null&&l.__e!=null){a.__e=a.__c.base=l.__e;break}return b7(a)}}function d7(a){(!a.__d&&(a.__d=!0)&&Yu.push(a)&&!I0.__r++||f7!==zr.debounceRendering)&&((f7=zr.debounceRendering)||g7)(I0)}function I0(){var a,i,l,o=[],c=[];for(Yu.sort(eI);a=Yu.shift();)a.__d&&(l=Yu.length,i=Jke(a,o,c)||i,l===0||Yu.length>l?(tI(o,i,c),c.length=o.length=0,i=void 0,Yu.sort(eI)):i&&zr.__c&&zr.__c(i,iI));i&&tI(o,i,c),I0.__r=0}function w7(a,i,l,o,c,t,v,S,C,D,z){var B,ne,pe,$e,Ae,ke=o&&o.__k||iI,Ge=i.length;for(l.__d=C,Qke(l,i,ke),C=l.__d,B=0;B<Ge;B++)(pe=l.__k[B])!=null&&typeof pe!="boolean"&&typeof pe!="function"&&(ne=pe.__i===-1?Fm:ke[pe.__i]||Fm,pe.__i=B,oI(a,pe,ne,c,t,v,S,C,D,z),$e=pe.__e,pe.ref&&ne.ref!=pe.ref&&(ne.ref&&aI(ne.ref,null,pe),z.push(pe.ref,pe.__c||$e,pe)),Ae==null&&$e!=null&&(Ae=$e),65536&pe.__u||ne.__k===pe.__k?C=T7(pe,C,a):typeof pe.type=="function"&&pe.__d!==void 0?C=pe.__d:$e&&(C=$e.nextSibling),pe.__d=void 0,pe.__u&=-196609);l.__d=C,l.__e=Ae}function Qke(a,i,l){var o,c,t,v,S,C=i.length,D=l.length,z=D,B=0;for(a.__k=[],o=0;o<C;o++)v=o+B,(c=a.__k[o]=(c=i[o])==null||typeof c=="boolean"||typeof c=="function"?null:typeof c=="string"||typeof c=="number"||typeof c=="bigint"||c.constructor==String?S0(null,c,null,null,null):nI(c)?S0(df,{children:c},null,null,null):c.constructor===void 0&&c.__b>0?S0(c.type,c.props,c.key,c.ref?c.ref:null,c.__v):c)!=null?(c.__=a,c.__b=a.__b+1,S=eBe(c,l,v,z),c.__i=S,t=null,S!==-1&&(z--,(t=l[S])&&(t.__u|=131072)),t==null||t.__v===null?(S==-1&&B--,typeof c.type!="function"&&(c.__u|=65536)):S!==v&&(S===v+1?B++:S>v?z>C-v?B+=S-v:B--:S<v?S==v-1&&(B=S-v):B=0,S!==o+B&&(c.__u|=65536))):(t=l[v])&&t.key==null&&t.__e&&!(131072&t.__u)&&(t.__e==a.__d&&(a.__d=ff(t)),rI(t,t,!1),l[v]=null,z--);if(z)for(o=0;o<D;o++)(t=l[o])!=null&&!(131072&t.__u)&&(t.__e==a.__d&&(a.__d=ff(t)),rI(t,t))}function T7(a,i,l){var o,c;if(typeof a.type=="function"){for(o=a.__k,c=0;o&&c<o.length;c++)o[c]&&(o[c].__=a,i=T7(o[c],i,l));return i}a.__e!=i&&(l.insertBefore(a.__e,i||null),i=a.__e);do i=i&&i.nextSibling;while(i!=null&&i.nodeType===8);return i}function eBe(a,i,l,o){var c=a.key,t=a.type,v=l-1,S=l+1,C=i[l];if(C===null||C&&c==C.key&&t===C.type&&!(131072&C.__u))return l;if(o>(C!=null&&!(131072&C.__u)?1:0))for(;v>=0||S<i.length;){if(v>=0){if((C=i[v])&&!(131072&C.__u)&&c==C.key&&t===C.type)return v;v--}if(S<i.length){if((C=i[S])&&!(131072&C.__u)&&c==C.key&&t===C.type)return S;S++}}return-1}function p7(a,i,l){i[0]==="-"?a.setProperty(i,l??""):a[i]=l==null?"":typeof l!="number"||Kke.test(i)?l:l+"px"}function E0(a,i,l,o,c){var t;e:if(i==="style")if(typeof l=="string")a.style.cssText=l;else{if(typeof o=="string"&&(a.style.cssText=o=""),o)for(i in o)l&&i in l||p7(a.style,i,"");if(l)for(i in l)o&&l[i]===o[i]||p7(a.style,i,l[i])}else if(i[0]==="o"&&i[1]==="n")t=i!==(i=i.replace(/(PointerCapture)$|Capture$/i,"$1")),i=i.toLowerCase()in a?i.toLowerCase().slice(2):i.slice(2),a.l||(a.l={}),a.l[i+t]=l,l?o?l.u=o.u:(l.u=Date.now(),a.addEventListener(i,t?_7:m7,t)):a.removeEventListener(i,t?_7:m7,t);else{if(c)i=i.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(i!=="width"&&i!=="height"&&i!=="href"&&i!=="list"&&i!=="form"&&i!=="tabIndex"&&i!=="download"&&i!=="rowSpan"&&i!=="colSpan"&&i!=="role"&&i in a)try{a[i]=l??"";break e}catch{}typeof l=="function"||(l==null||l===!1&&i[4]!=="-"?a.removeAttribute(i):a.setAttribute(i,l))}}function m7(a){if(this.l){var i=this.l[a.type+!1];if(a.t){if(a.t<=i.u)return}else a.t=Date.now();return i(zr.event?zr.event(a):a)}}function _7(a){if(this.l)return this.l[a.type+!0](zr.event?zr.event(a):a)}function oI(a,i,l,o,c,t,v,S,C,D){var z,B,ne,pe,$e,Ae,ke,Ge,tt,mt,Mt,Kt,At,Ve,er,Dt=i.type;if(i.constructor!==void 0)return null;128&l.__u&&(C=!!(32&l.__u),t=[S=i.__e=l.__e]),(z=zr.__b)&&z(i);e:if(typeof Dt=="function")try{if(Ge=i.props,tt=(z=Dt.contextType)&&o[z.__c],mt=z?tt?tt.props.value:z.__:o,l.__c?ke=(B=i.__c=l.__c).__=B.__E:("prototype"in Dt&&Dt.prototype.render?i.__c=B=new Dt(Ge,mt):(i.__c=B=new hf(Ge,mt),B.constructor=Dt,B.render=rBe),tt&&tt.sub(B),B.props=Ge,B.state||(B.state={}),B.context=mt,B.__n=o,ne=B.__d=!0,B.__h=[],B._sb=[]),B.__s==null&&(B.__s=B.state),Dt.getDerivedStateFromProps!=null&&(B.__s==B.state&&(B.__s=wl({},B.__s)),wl(B.__s,Dt.getDerivedStateFromProps(Ge,B.__s))),pe=B.props,$e=B.state,B.__v=i,ne)Dt.getDerivedStateFromProps==null&&B.componentWillMount!=null&&B.componentWillMount(),B.componentDidMount!=null&&B.__h.push(B.componentDidMount);else{if(Dt.getDerivedStateFromProps==null&&Ge!==pe&&B.componentWillReceiveProps!=null&&B.componentWillReceiveProps(Ge,mt),!B.__e&&(B.shouldComponentUpdate!=null&&B.shouldComponentUpdate(Ge,B.__s,mt)===!1||i.__v===l.__v)){for(i.__v!==l.__v&&(B.props=Ge,B.state=B.__s,B.__d=!1),i.__e=l.__e,i.__k=l.__k,i.__k.forEach(function(Pt){Pt&&(Pt.__=i)}),Mt=0;Mt<B._sb.length;Mt++)B.__h.push(B._sb[Mt]);B._sb=[],B.__h.length&&v.push(B);break e}B.componentWillUpdate!=null&&B.componentWillUpdate(Ge,B.__s,mt),B.componentDidUpdate!=null&&B.__h.push(function(){B.componentDidUpdate(pe,$e,Ae)})}if(B.context=mt,B.props=Ge,B.__P=a,B.__e=!1,Kt=zr.__r,At=0,"prototype"in Dt&&Dt.prototype.render){for(B.state=B.__s,B.__d=!1,Kt&&Kt(i),z=B.render(B.props,B.state,B.context),Ve=0;Ve<B._sb.length;Ve++)B.__h.push(B._sb[Ve]);B._sb=[]}else do B.__d=!1,Kt&&Kt(i),z=B.render(B.props,B.state,B.context),B.state=B.__s;while(B.__d&&++At<25);B.state=B.__s,B.getChildContext!=null&&(o=wl(wl({},o),B.getChildContext())),ne||B.getSnapshotBeforeUpdate==null||(Ae=B.getSnapshotBeforeUpdate(pe,$e)),w7(a,nI(er=z!=null&&z.type===df&&z.key==null?z.props.children:z)?er:[er],i,l,o,c,t,v,S,C,D),B.base=i.__e,i.__u&=-161,B.__h.length&&v.push(B),ke&&(B.__E=B.__=null)}catch(Pt){i.__v=null,C||t!=null?(i.__e=S,i.__u|=C?160:32,t[t.indexOf(S)]=null):(i.__e=l.__e,i.__k=l.__k),zr.__e(Pt,i,l)}else t==null&&i.__v===l.__v?(i.__k=l.__k,i.__e=l.__e):i.__e=tBe(l.__e,i,l,o,c,t,v,C,D);(z=zr.diffed)&&z(i)}function tI(a,i,l){for(var o=0;o<l.length;o++)aI(l[o],l[++o],l[++o]);zr.__c&&zr.__c(i,a),a.some(function(c){try{a=c.__h,c.__h=[],a.some(function(t){t.call(c)})}catch(t){zr.__e(t,c.__v)}})}function tBe(a,i,l,o,c,t,v,S,C){var D,z,B,ne,pe,$e,Ae,ke=l.props,Ge=i.props,tt=i.type;if(tt==="svg"&&(c=!0),t!=null){for(D=0;D<t.length;D++)if((pe=t[D])&&"setAttribute"in pe==!!tt&&(tt?pe.localName===tt:pe.nodeType===3)){a=pe,t[D]=null;break}}if(a==null){if(tt===null)return document.createTextNode(Ge);a=c?document.createElementNS("http://www.w3.org/2000/svg",tt):document.createElement(tt,Ge.is&&Ge),t=null,S=!1}if(tt===null)ke===Ge||S&&a.data===Ge||(a.data=Ge);else{if(t=t&&A0.call(a.childNodes),ke=l.props||Fm,!S&&t!=null)for(ke={},D=0;D<a.attributes.length;D++)ke[(pe=a.attributes[D]).name]=pe.value;for(D in ke)pe=ke[D],D=="children"||(D=="dangerouslySetInnerHTML"?B=pe:D==="key"||D in Ge||E0(a,D,null,pe,c));for(D in Ge)pe=Ge[D],D=="children"?ne=pe:D=="dangerouslySetInnerHTML"?z=pe:D=="value"?$e=pe:D=="checked"?Ae=pe:D==="key"||S&&typeof pe!="function"||ke[D]===pe||E0(a,D,pe,ke[D],c);if(z)S||B&&(z.__html===B.__html||z.__html===a.innerHTML)||(a.innerHTML=z.__html),i.__k=[];else if(B&&(a.innerHTML=""),w7(a,nI(ne)?ne:[ne],i,l,o,c&&tt!=="foreignObject",t,v,t?t[0]:l.__k&&ff(l,0),S,C),t!=null)for(D=t.length;D--;)t[D]!=null&&v7(t[D]);S||(D="value",$e!==void 0&&($e!==a[D]||tt==="progress"&&!$e||tt==="option"&&$e!==ke[D])&&E0(a,D,$e,ke[D],!1),D="checked",Ae!==void 0&&Ae!==a[D]&&E0(a,D,Ae,ke[D],!1))}return a}function aI(a,i,l){try{typeof a=="function"?a(i):a.current=i}catch(o){zr.__e(o,l)}}function rI(a,i,l){var o,c;if(zr.unmount&&zr.unmount(a),(o=a.ref)&&(o.current&&o.current!==a.__e||aI(o,null,i)),(o=a.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(t){zr.__e(t,i)}o.base=o.__P=null,a.__c=void 0}if(o=a.__k)for(c=0;c<o.length;c++)o[c]&&rI(o[c],i,l||typeof a.type!="function");l||a.__e==null||v7(a.__e),a.__=a.__e=a.__d=void 0}function rBe(a,i,l){return this.constructor(a,l)}function E7(a,i,l){var o,c,t,v;zr.__&&zr.__(a,i),c=(o=typeof l=="function")?null:l&&l.__k||i.__k,t=[],v=[],oI(i,a=(!o&&l||i).__k=Yke(df,null,[a]),c||Fm,Fm,i.ownerSVGElement!==void 0,!o&&l?[l]:c?null:i.firstChild?A0.call(i.childNodes):null,t,!o&&l?l:c?c.__e:i.firstChild,o,v),a.__d=void 0,tI(t,a,v)}A0=iI.slice,zr={__e:function(a,i,l,o){for(var c,t,v;i=i.__;)if((c=i.__c)&&!c.__)try{if((t=c.constructor)&&t.getDerivedStateFromError!=null&&(c.setState(t.getDerivedStateFromError(a)),v=c.__d),c.componentDidCatch!=null&&(c.componentDidCatch(a,o||{}),v=c.__d),v)return c.__E=c}catch(S){a=S}throw a}},y7=0,Hke=function(a){return a!=null&&a.constructor==null},hf.prototype.setState=function(a,i){var l;l=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=wl({},this.state),typeof a=="function"&&(a=a(wl({},l),this.props)),a&&wl(l,a),a!=null&&this.__v&&(i&&this._sb.push(i),d7(this))},hf.prototype.forceUpdate=function(a){this.__v&&(this.__e=!0,a&&this.__h.push(a),d7(this))},hf.prototype.render=df,Yu=[],g7=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,eI=function(a,i){return a.__v.__b-i.__v.__b},I0.__r=0,Xke=0;var iBe=(a,i)=>{a.view="log",i.on("view:set",l=>{l!==a.view&&(a.view=l,i.emit(i.STATE_CHANGE))})},S7=iBe;var OH=rn(lI(),1),CH=rn(iZ(),1),PH=rn(oZ(),1),{Buffer:G3e}=IZ(),{FeedMessage:W3e}=LI(),Z3e=5*1024*1024,AH=["application/octet-stream","application/x-protobuf","application/grtfeed"],H3e=(a,i)=>{a.feedUrl=null,a.feedSyncStopped=!1,a.feedSyncInterval=30,a.feedSyncing=!1,a.feedError=null,a.feedRawData=null,a.feedData=null;let l=null,o=async v=>{let S=v.headers.get("content-type"),C=S?(0,CH.parse)(S):{};if(C.type&&!AH.includes(C.type)){let ne=new Error(`invalid content-type \`${C.type}\`, only ${AH.join(", ")} are supported`);throw ne.response=v,ne}let D=v.headers.get("content-length");if(D&&parseInt(D)>Z3e){let ne=new Error("response is too large");throw ne.response=v,ne}let z=G3e.from(await v.arrayBuffer()),B=W3e.decode(z);if(!B||!B.header||!Array.isArray(B.entity)){let ne=new Error("couldn't parse feed");throw ne.rawFeed=z,ne.response=v,ne}a.feedError=null,a.feedRawData=z,a.feedData=B,i.emit("feed:data-change"),i.emit(i.STATE_CHANGE)},c=v=>{a.feedSyncing=v,i.emit(i.STATE_CHANGE)},t=(0,OH.default)(()=>{l=(0,PH.default)(a.feedUrl,{interval:a.feedSyncInterval*1e3}),l.on("fetch",()=>c(!0)),l.on("fetch-done",()=>c(!1)),l.on("change",v=>{o(v).catch(S=>{a.feedError=S,i.emit(i.STATE_CHANGE)})}),l.on("error",v=>{a.feedError=v,i.emit(i.STATE_CHANGE)}),a.feedSyncStopped&&l.stop()},300);i.on("feed:set-url",v=>{v!==a.feedUrl&&(l&&(l.stop(),l=null),a.feedUrl=v,a.feedSyncing=!1,a.feedRawData=null,a.feedData=null,v!==null&&t(),i.emit("feed:data-change"),i.emit(i.STATE_CHANGE))}),i.on("feed:sync",()=>{l&&l.refetch()}),i.on("feed:stop-sync",()=>{a.feedSyncStopped=!0,l&&l.stop(),i.emit(i.STATE_CHANGE)}),i.on("feed:start-sync",()=>{a.feedSyncStopped=!1,l&&l.start(),i.emit(i.STATE_CHANGE)}),i.on("feed:set-sync-interval",v=>{v=Math.max(v,1),v!==a.feedSyncInterval&&(l&&(l.stop(),l=null),a.feedSyncInterval=v,a.feedUrl!==null&&t(),i.emit(i.STATE_CHANGE))})},MH=H3e;var X3e=(a,i)=>{a.feedLog=[],i.on("feed:data-change",()=>{if(!a.feedData){a.feedLog=[];return}let l=Date.now()/1e3|0,o=a.feedData.header||{},c=(a.feedData.entity||[]).filter(t=>!!t.trip_update).flatMap(t=>(t.trip_update.stop_time_update||[]).map(v=>({entityId:t.id,timestamp:t.trip_update.timestamp||o.timestamp||null,routeId:t.trip_update.trip.route_id,directionId:t.trip_update.trip.direction_id,tripId:t.trip_update.trip.trip_id,vehicleId:t.trip_update.vehicle.id,vehicleLabel:t.trip_update.vehicle.label,stopId:v.stop_id,tArrival:v.arrival.time,delay:v.arrival.delay}))).filter(({tArrival:t})=>t&&t>=l).sort((t,v)=>{let S=t.tArrival-l,C=v.tArrival-l,D=typeof t.delay=="number"?t.delay:0,z=typeof v.delay=="number"?v.delay:0;return S/30===C/30?Math.abs(z)-Math.abs(D):S-C});a.feedLog=c})},qH=X3e;var Km=rn(DH(),1),kH=rn(hI(),1);function LH(a){return a.split(/(%[0-9A-Fa-f]{2})/g).map(function(i){return/%[0-9A-Fa-f]/.test(i)||(i=encodeURI(i).replace(/%5B/g,"[").replace(/%5D/g,"]")),i}).join("")}function bf(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(i){return"%"+i.charCodeAt(0).toString(16).toUpperCase()})}function Xm(a,i,l){return i=a==="+"||a==="#"?LH(i):bf(i),l?bf(l)+"="+i:i}function xf(a){return a!=null}function kI(a){return a===";"||a==="&"||a==="?"}function Y3e(a,i,l,o){var c=a[l],t=[];if(xf(c)&&c!=="")if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")c=c.toString(),o&&o!=="*"&&(c=c.substring(0,parseInt(o,10))),t.push(Xm(i,c,kI(i)?l:null));else if(o==="*")Array.isArray(c)?c.filter(xf).forEach(function(S){t.push(Xm(i,S,kI(i)?l:null))}):Object.keys(c).forEach(function(S){xf(c[S])&&t.push(Xm(i,c[S],S))});else{var v=[];Array.isArray(c)?c.filter(xf).forEach(function(S){v.push(Xm(i,S))}):Object.keys(c).forEach(function(S){xf(c[S])&&(v.push(bf(S)),v.push(Xm(i,c[S].toString())))}),kI(i)?t.push(bf(l)+"="+v.join(",")):v.length!==0&&t.push(v.join(","))}else i===";"?xf(c)&&t.push(bf(l)):c===""&&(i==="&"||i==="?")?t.push(bf(l)+"="):c===""&&t.push("");return t}function BI(a){var i=["+","#",".","/",";","?","&"];return{expand:function(l){return a.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(o,c,t){if(c){var v=null,S=[];if(i.indexOf(c.charAt(0))!==-1&&(v=c.charAt(0),c=c.substr(1)),c.split(/,/g).forEach(function(D){var z=/([^:\*]*)(?::(\d+)|(\*))?/.exec(D);S.push.apply(S,Y3e(l,v,z[1],z[2]||z[3]))}),v&&v!=="+"){var C=",";return v==="?"?C="&":v!=="#"&&(C=v),(S.length!==0?v:"")+S.join(C)}else return S.join(",")}else return LH(t)})}}}var{Request:J3e,fetch:Q3e}=(0,kH.default)(),eze=(a,i)=>Object.prototype.hasOwnProperty.call(a,i),tze=(a,i)=>{let l=a?.entity;return Array.isArray(l)?l.some(o=>o.vehicle?.vehicle?.id===i):!1},rze=(a,i)=>{let l=a?.entity;if(Array.isArray(l))return l.some(o=>o.vehicle?.trip?.trip_id===i||o.trip_update?.trip?.trip_id===i)},ize=(a,i)=>{let l=async(Ae,ke={})=>{let Ge=new J3e(Ae,{mode:"cors",redirect:"follow",headers:{accept:"application/json"},...ke}),tt=await Q3e(Ge);if(!tt.ok){let mt=new Error(`${tt.url}: ${tt.status} ${tt.statusText}`);throw mt.req=Ge,mt.res=tt,mt}return await tt.json()};a.shapeIdsByTripIdUrl="/shape-ids-by-trip-id.json",i.on("shape-ids-by-trip-id-url:set",Ae=>{a.shapeIdsByTripIdUrl!==Ae&&(a.shapeIdsByTripIdUrl=Ae,v(),i.emit(i.STATE_CHANGE))});let o=new Km.default,c=async()=>(o=new Km.default,console.debug(`fetching shape IDs from ${a.shapeIdsByTripIdUrl}`),await l(a.shapeIdsByTripIdUrl,{signal:o.signal})),t={},v=()=>{o.abort(),c().then(Ae=>{t=Ae,$e()}).catch(Ae=>{console.error("failed to fetch shape IDs",Ae)})};a.shapeUrl="/shapes/{shape_id}.geo.json";let S=BI(a.shapeUrl);i.on("shape-url:set",Ae=>{a.shapeUrl!==Ae&&(a.shapeUrl=Ae,S=BI(a.shapeUrl),$e(),i.emit(i.STATE_CHANGE))}),a.focusedVehicleId=null,a.focusedVehiclePosition=null;let C=!1,D=()=>{if(a.focusedVehicleId===null)return;let Ae=tze(a.feedData,a.focusedVehicleId);if(C&&!Ae)a.focusedVehicleId=null,a.focusedVehiclePosition=null,i.emit(i.STATE_CHANGE);else if(!C&&Ae){let ke=a.focusedVehicleId,tt=(a.feedData?.entity||[]).find(mt=>mt.vehicle?.vehicle?.id===ke);tt?a.focusedVehiclePosition={type:"Feature",properties:{vehicleId:ke},geometry:{type:"Point",coordinates:[tt.vehicle.position.longitude,tt.vehicle.position.latitude]}}:a.focusedVehiclePosition=null,i.emit(i.STATE_CHANGE)}};i.on("feed:data-change",D),i.on("focus-vehicle-id",Ae=>{Ae!==a.focusedVehicleId&&(a.focusedVehicleId=Ae,a.focusedVehiclePosition=null,D(),i.emit(i.STATE_CHANGE))}),a.focusedTripId=null,a.focusedTripShape=null;let z=!1,B=()=>{if(a.focusedTripId===null)return;let Ae=rze(a.feedData,a.focusedTripId);z&&!Ae&&(a.focusedTripId=null,a.focusedTripShape=null,i.emit(i.STATE_CHANGE))};i.on("feed:data-change",B);let ne=new Km.default,pe=async(Ae,ke)=>{ne=new Km.default;let Ge=S.expand({shape_id:Ae});console.debug(`fetching shape ${Ae} for trip ${ke} from ${Ge}`);let tt=Date.now(),mt=await l(Ge,{signal:ne.signal});return console.debug(`fetched shape ${Ae} in ${Date.now()-tt}ms`),mt},$e=()=>{let Ae=a.focusedTripId;if(Ae!==null&&(ne.abort(),Ae!==null&&eze(t,Ae))){let ke=t[Ae];pe(ke,Ae).then(Ge=>{a.focusedTripShape=Ge,i.emit(i.STATE_CHANGE)}).catch(Ge=>{console.error(`failed to fetch shape ${ke} for trip ${Ae}`,Ge)})}};i.on("focus-trip-id",Ae=>{Ae!==a.focusedTripId&&(a.focusedTripId=Ae,a.focusedTripShape=null,B(),$e(),i.emit(i.STATE_CHANGE))})},BH=ize;var MK=rn(UI(),1),qK=rn(lI(),1),RK=rn(_K(),1);var KI={};tee(KI,{exclude:()=>WUe,extract:()=>HI,parse:()=>XI,parseUrl:()=>IK,pick:()=>OK,stringify:()=>SK,stringifyUrl:()=>AK});var vK="%[a-f0-9]{2}",yK=new RegExp("("+vK+")|([^%]+?)","gi"),gK=new RegExp("("+vK+")+","gi");function GI(a,i){try{return[decodeURIComponent(a.join(""))]}catch{}if(a.length===1)return a;i=i||1;let l=a.slice(0,i),o=a.slice(i);return Array.prototype.concat.call([],GI(l),GI(o))}function FUe(a){try{return decodeURIComponent(a)}catch{let i=a.match(yK)||[];for(let l=1;l<i.length;l++)a=GI(i,l).join(""),i=a.match(yK)||[];return a}}function NUe(a){let i={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},l=gK.exec(a);for(;l;){try{i[l[0]]=decodeURIComponent(l[0])}catch{let c=FUe(l[0]);c!==l[0]&&(i[l[0]]=c)}l=gK.exec(a)}i["%C2"]="\uFFFD";let o=Object.keys(i);for(let c of o)a=a.replace(new RegExp(c,"g"),i[c]);return a}function WI(a){if(typeof a!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof a+"`");try{return decodeURIComponent(a)}catch{return NUe(a)}}function N0(a,i){if(!(typeof a=="string"&&typeof i=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(a===""||i==="")return[];let l=a.indexOf(i);return l===-1?[]:[a.slice(0,l),a.slice(l+i.length)]}function xK(a,i){let l={};if(Array.isArray(i))for(let o of i){let c=Object.getOwnPropertyDescriptor(a,o);c?.enumerable&&Object.defineProperty(l,o,c)}else for(let o of Reflect.ownKeys(a)){let c=Object.getOwnPropertyDescriptor(a,o);if(c.enumerable){let t=a[o];i(o,t,a)&&Object.defineProperty(l,o,c)}}return l}var UUe=a=>a==null,jUe=a=>encodeURIComponent(a).replace(/[!'()*]/g,i=>`%${i.charCodeAt(0).toString(16).toUpperCase()}`),ZI=Symbol("encodeFragmentIdentifier");function VUe(a){switch(a.arrayFormat){case"index":return i=>(l,o)=>{let c=l.length;return o===void 0||a.skipNull&&o===null||a.skipEmptyString&&o===""?l:o===null?[...l,[Oi(i,a),"[",c,"]"].join("")]:[...l,[Oi(i,a),"[",Oi(c,a),"]=",Oi(o,a)].join("")]};case"bracket":return i=>(l,o)=>o===void 0||a.skipNull&&o===null||a.skipEmptyString&&o===""?l:o===null?[...l,[Oi(i,a),"[]"].join("")]:[...l,[Oi(i,a),"[]=",Oi(o,a)].join("")];case"colon-list-separator":return i=>(l,o)=>o===void 0||a.skipNull&&o===null||a.skipEmptyString&&o===""?l:o===null?[...l,[Oi(i,a),":list="].join("")]:[...l,[Oi(i,a),":list=",Oi(o,a)].join("")];case"comma":case"separator":case"bracket-separator":{let i=a.arrayFormat==="bracket-separator"?"[]=":"=";return l=>(o,c)=>c===void 0||a.skipNull&&c===null||a.skipEmptyString&&c===""?o:(c=c===null?"":c,o.length===0?[[Oi(l,a),i,Oi(c,a)].join("")]:[[o,Oi(c,a)].join(a.arrayFormatSeparator)])}default:return i=>(l,o)=>o===void 0||a.skipNull&&o===null||a.skipEmptyString&&o===""?l:o===null?[...l,Oi(i,a)]:[...l,[Oi(i,a),"=",Oi(o,a)].join("")]}}function $Ue(a){let i;switch(a.arrayFormat){case"index":return(l,o,c)=>{if(i=/\[(\d*)]$/.exec(l),l=l.replace(/\[\d*]$/,""),!i){c[l]=o;return}c[l]===void 0&&(c[l]={}),c[l][i[1]]=o};case"bracket":return(l,o,c)=>{if(i=/(\[])$/.exec(l),l=l.replace(/\[]$/,""),!i){c[l]=o;return}if(c[l]===void 0){c[l]=[o];return}c[l]=[...c[l],o]};case"colon-list-separator":return(l,o,c)=>{if(i=/(:list)$/.exec(l),l=l.replace(/:list$/,""),!i){c[l]=o;return}if(c[l]===void 0){c[l]=[o];return}c[l]=[...c[l],o]};case"comma":case"separator":return(l,o,c)=>{let t=typeof o=="string"&&o.includes(a.arrayFormatSeparator),v=typeof o=="string"&&!t&&xs(o,a).includes(a.arrayFormatSeparator);o=v?xs(o,a):o;let S=t||v?o.split(a.arrayFormatSeparator).map(C=>xs(C,a)):o===null?o:xs(o,a);c[l]=S};case"bracket-separator":return(l,o,c)=>{let t=/(\[])$/.test(l);if(l=l.replace(/\[]$/,""),!t){c[l]=o&&xs(o,a);return}let v=o===null?[]:o.split(a.arrayFormatSeparator).map(S=>xs(S,a));if(c[l]===void 0){c[l]=v;return}c[l]=[...c[l],...v]};default:return(l,o,c)=>{if(c[l]===void 0){c[l]=o;return}c[l]=[...[c[l]].flat(),o]}}}function wK(a){if(typeof a!="string"||a.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function Oi(a,i){return i.encode?i.strict?jUe(a):encodeURIComponent(a):a}function xs(a,i){return i.decode?WI(a):a}function TK(a){return Array.isArray(a)?a.sort():typeof a=="object"?TK(Object.keys(a)).sort((i,l)=>Number(i)-Number(l)).map(i=>a[i]):a}function EK(a){let i=a.indexOf("#");return i!==-1&&(a=a.slice(0,i)),a}function GUe(a){let i="",l=a.indexOf("#");return l!==-1&&(i=a.slice(l)),i}function bK(a,i){return i.parseNumbers&&!Number.isNaN(Number(a))&&typeof a=="string"&&a.trim()!==""?a=Number(a):i.parseBooleans&&a!==null&&(a.toLowerCase()==="true"||a.toLowerCase()==="false")&&(a=a.toLowerCase()==="true"),a}function HI(a){a=EK(a);let i=a.indexOf("?");return i===-1?"":a.slice(i+1)}function XI(a,i){i={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...i},wK(i.arrayFormatSeparator);let l=$Ue(i),o=Object.create(null);if(typeof a!="string"||(a=a.trim().replace(/^[?#&]/,""),!a))return o;for(let c of a.split("&")){if(c==="")continue;let t=i.decode?c.replace(/\+/g," "):c,[v,S]=N0(t,"=");v===void 0&&(v=t),S=S===void 0?null:["comma","separator","bracket-separator"].includes(i.arrayFormat)?S:xs(S,i),l(xs(v,i),S,o)}for(let[c,t]of Object.entries(o))if(typeof t=="object"&&t!==null)for(let[v,S]of Object.entries(t))t[v]=bK(S,i);else o[c]=bK(t,i);return i.sort===!1?o:(i.sort===!0?Object.keys(o).sort():Object.keys(o).sort(i.sort)).reduce((c,t)=>{let v=o[t];return c[t]=v&&typeof v=="object"&&!Array.isArray(v)?TK(v):v,c},Object.create(null))}function SK(a,i){if(!a)return"";i={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...i},wK(i.arrayFormatSeparator);let l=v=>i.skipNull&&UUe(a[v])||i.skipEmptyString&&a[v]==="",o=VUe(i),c={};for(let[v,S]of Object.entries(a))l(v)||(c[v]=S);let t=Object.keys(c);return i.sort!==!1&&t.sort(i.sort),t.map(v=>{let S=a[v];return S===void 0?"":S===null?Oi(v,i):Array.isArray(S)?S.length===0&&i.arrayFormat==="bracket-separator"?Oi(v,i)+"[]":S.reduce(o(v),[]).join("&"):Oi(v,i)+"="+Oi(S,i)}).filter(v=>v.length>0).join("&")}function IK(a,i){i={decode:!0,...i};let[l,o]=N0(a,"#");return l===void 0&&(l=a),{url:l?.split("?")?.[0]??"",query:XI(HI(a),i),...i&&i.parseFragmentIdentifier&&o?{fragmentIdentifier:xs(o,i)}:{}}}function AK(a,i){i={encode:!0,strict:!0,[ZI]:!0,...i};let l=EK(a.url).split("?")[0]||"",o=HI(a.url),c={...XI(o,{sort:!1}),...a.query},t=SK(c,i);t&&(t=`?${t}`);let v=GUe(a.url);if(a.fragmentIdentifier){let S=new URL(l);S.hash=a.fragmentIdentifier,v=i[ZI]?S.hash:`#${a.fragmentIdentifier}`}return`${l}${t}${v}`}function OK(a,i,l){l={parseFragmentIdentifier:!0,[ZI]:!1,...l};let{url:o,query:c,fragmentIdentifier:t}=IK(a,l);return AK({url:o,query:xK(c,i),fragmentIdentifier:t},l)}function WUe(a,i,l){let o=Array.isArray(i)?c=>!i.includes(c):(c,t)=>!i(c,t);return OK(a,o,l)}var CK=KI;var{parse:ZUe,stringify:HUe}=CK,PK=(0,MK.default)(ZUe),If=a=>a,XUe=a=>a==="true",KUe=a=>parseInt(a),DK={feedUrl:{decode:If,apply:(a,i)=>i.emit("feed:set-url",a)},feedSyncStopped:{decode:XUe,apply:(a,i)=>{i.emit(`feed:${a?"stop":"start"}-sync`)}},feedSyncInterval:{decode:KUe,apply:(a,i)=>{i.emit("feed:set-sync-interval",a)}},view:{decode:If,apply:(a,i)=>i.emit("view:set",a)},shapeIdsByTripIdUrl:{decode:If,apply:(a,i)=>i.emit("shape-ids-by-trip-id-url:set",a)},shapeUrl:{decode:If,apply:(a,i)=>i.emit("shape-url:set",a)},focusedTripId:{decode:If,apply:(a,i)=>i.emit("focus-trip-id",a)},focusedVehicleId:{decode:If,apply:(a,i)=>i.emit("focus-vehicle-id",a)}},YI=a=>(0,RK.default)(a,Object.keys(DK)),YUe=(a,i)=>{let l=t=>{for(let[v,S]of Object.entries(t)){let{decode:C,apply:D}=DK[v];D(C(S),i)}i.emit(i.STATE_CHANGE)};window.addEventListener("popstate",t=>{let v=YI(t.state||{});l(v)});let o=(0,qK.default)(()=>{let t=YI(a),v={...PK(location.search.slice(1)),...t},S="?"+HUe(v);S!==location.search&&history.replaceState(t,"_",S)},500,{leading:!0});i.on(i.STATE_CHANGE,o);let c=YI(PK(location.search.slice(1)));setTimeout(l,1,c)},LK=YUe;var kK={private:!0,name:"gtfs-rt-inspector",description:"Web app to inspect & analyze any GTFS Realtime feed.",version:"1.0.0",keywords:["gtfs","realtime","gtfs-rt","public transport","transit"],author:"Jannis R <mail@jannisr.de>",homepage:"https://github.com/derhuerst/gtfs-rt-inspector",repository:"derhuerst/gtfs-rt-inspector",bugs:"https://github.com/derhuerst/gtfs-rt-inspector/issues",license:"ISC",type:"module",engines:{node:">=14"},scripts:{lint:"eslint --ignore-path .gitignore .","build:copy":`cp assets/* $(node -p 'require.resolve("mapbox-gl/dist/mapbox-gl.css")') dist/`,"build:bundle":"esbuild --loader:.js=jsx --jsx-import-source=preact --jsx=automatic --define:process.env.MAPBOX_TOKEN=\\'$MAPBOX_TOKEN\\' --define:global=globalThis --bundle --minify --outfile=dist/main.js --sourcemap --target=chrome96,firefox91,safari14 index.js",build:"npm run build:copy && npm run build:bundle","build:watch":"esbuild --loader:.js=jsx --jsx-import-source=preact --jsx=automatic --define:process.env.MAPBOX_TOKEN=\\'$MAPBOX_TOKEN\\' --define:global=globalThis --bundle --minify --outfile=dist/main.js --sourcemap --target=chrome96,firefox91,safari14 --watch index.js"},dependencies:{"abort-controller":"^3.0.0",buffer:"^6.0.3","content-type":"^1.0.4","core-js":"^3.17.2",events:"^3.2.0","fetch-periodic-sync":"^1.1.2","fetch-ponyfill":"^7.1.0","gtfs-rt-bindings":"^4.0.1",lodash:"^4.17.20","mapbox-gl":"^2.1.1",ms:"^2.1.3","object-inspect":"^1.11.0",preact:"^10.5.7","query-string":"^8.2.0","regenerator-runtime":"^0.14.1","url-template":"^3.1.0"},devDependencies:{esbuild:"^0.20.0",eslint:"^8.12.0"},browserslist:["defaults"]};var QUe=0,Vet=Array.isArray;function re(a,i,l,o,c,t){var v,S,C={};for(S in i)S=="ref"?v=i[S]:C[S]=i[S];var D={type:a,props:C,key:l,ref:v,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--QUe,__i:-1,__u:0,__source:c,__self:t};if(typeof a=="function"&&(v=a.defaultProps))for(S in v)C[S]===void 0&&(C[S]=v[S]);return zr.vnode&&zr.vnode(D),D}var e4e=({state:a,emit:i})=>{let l=(D,z)=>{let B=ne=>{ne.metaKey||ne.ctrlKey||(ne.preventDefault(),i("view:set",D))};return re("li",{class:z?"active":null,children:re("a",{href:"?view="+D,onClick:B,children:D})})},o=re("ul",{class:"nav",children:[l("log",a.view==="log"),l("inspector",a.view==="inspector"),l("map",a.view==="map"),re("li",{children:re("a",{href:kK.homepage,target:"_parent",title:name+" homepage",children:"?"})})]}),c=D=>{i("feed:set-url",D.target.value)},t=()=>{i("feed:sync")},v=()=>{a.feedSyncStopped?i("feed:start-sync"):i("feed:stop-sync")},S=D=>{let z=parseInt(D.target.value);i("feed:set-sync-interval",z)},C=re("div",{class:"feed",children:[re("input",{onInput:c,value:a.feedUrl}),re("input",{class:"interval",type:"number",min:"1",step:"10",onChange:S,value:a.feedSyncInterval}),re("button",{class:a.feedSyncing?"sync syncing":"sync",onClick:t,disabled:!a.feedUrl||!!a.feedSyncing,children:re("span",{children:"\u21BB"})}),re("button",{onClick:v,disabled:!a.feedUrl,children:a.feedSyncStopped?"\u25B6\uFE0F":"\u23F8"})]});return re("div",{class:"bar",children:[re("div",{class:"logo",children:"\u{1F682}\u{1F50D}"}),o,C]})},BK=e4e;var FK=rn(JI(),1),j0=a=>typeof a!="number"?"?":a===0?"0s":(0,FK.default)(a*1e3);var NK=a=>new Date(a*1e3).toISOString(),a4e=a=>{let{entityId:i,timestamp:l,routeId:o,directionId:c,tripId:t,vehicleId:v,vehicleLabel:S,stopId:C,tArrival:D,delay:z}=a;return re("tr",{id:"entity-"+i,children:[re("td",{children:re("code",{children:i})}),re("td",{children:NK(l)}),re("td",{children:re("code",{children:o})}),re("td",{children:re("code",{children:c})}),re("td",{children:re("code",{children:t})}),re("td",{children:re("code",{children:v})}),re("td",{children:re("code",{children:S})}),re("td",{children:re("code",{children:C})}),re("td",{children:NK(D)}),re("td",{children:j0(z)})]})},s4e=({state:a,emit:i})=>{let l=a.feedLog.length,o=a.feedLog.slice(0,1e3);return re("div",{class:"log",children:[re("p",{children:["Showing ",o.length,l>o.length?" out of "+l:null," ",re("code",{children:"StopTimeUpdate"}),"s."]}),re("table",{children:[re("thead",{children:[re("tr",{children:[re("th",{rowspan:"2",children:re("code",{children:re("abbr",{title:"entity.id",children:"e_id"})})}),re("th",{rowspan:"2",children:re("abbr",{title:"stop_time_update[].timestamp or feed timestamp",children:re("code",{children:"t"})})}),re("th",{colspan:"2",children:re("code",{children:"trip"})}),re("th",{colspan:"3",children:re("code",{children:"vehicle"})}),re("th",{colspan:"3",children:re("code",{children:"stop_time_update"})})]}),re("tr",{children:[re("th",{children:re("code",{children:"route_id"})}),re("th",{children:re("code",{children:re("abbr",{title:"trip.direction_id",children:"dir_id"})})}),re("th",{children:re("code",{children:"trip_id"})}),re("th",{children:re("code",{children:"id"})}),re("th",{children:re("code",{children:"label"})}),re("th",{children:re("code",{children:"stop_id"})}),re("th",{children:re("code",{children:re("abbr",{title:"stop_time_update[].arrival.time",children:"arr"})})}),re("th",{children:re("code",{children:re("abbr",{title:"stop_time_update[].arrival.delay",children:"delay"})})})]})]}),re("tbody",{children:o.map(a4e)})]})]})},UK=s4e;var Pf=rn(LI(),1),ltt=rn(JI(),1);var jK=a=>typeof a!="string"||!a?"?":re("code",{children:re("abbr",{title:a,children:[a.slice(4,6),"-",a.slice(6,8)]})}),VK=a=>typeof a!="string"||!a?"?":re("code",{children:a}),{SCHEDULED:l4e,SKIPPED:u4e,NO_DATA:c4e}=Pf.TripUpdate.StopTimeUpdate.ScheduleRelationship,h4e=a=>a===l4e?re("code",{children:re("abbr",{title:"SCHEDULED",children:"SCHED"})}):a===u4e?re("code",{children:re("abbr",{title:"SKIPPED",children:"SKIP"})}):a===c4e?re("code",{children:re("abbr",{title:"NO_DATA",children:"NO_DATA"})}):"?",{INCOMING_AT:f4e,STOPPED_AT:d4e,IN_TRANSIT_TO:p4e}=Pf.VehiclePosition.VehicleStopStatus,m4e=a=>a===f4e?re("code",{children:re("abbr",{title:"INCOMING_AT",children:"INC_AT"})}):a===d4e?re("code",{children:re("abbr",{title:"STOPPED_AT",children:"STOP_AT"})}):a===p4e?re("code",{children:re("abbr",{title:"IN_TRANSIT_TO",children:"IN_TR_TO"})}):"?",_4e=a=>{if(!a)return"?";let i=[typeof a.latitude=="number"?a.latitude:"?",typeof a.longitude=="number"?a.longitude:"?"].join(" | "),l=typeof a.latitude=="number"?re("code",{children:a.latitude.toFixed(3)}):"?",o=typeof a.longitude=="number"?re("code",{children:a.longitude.toFixed(3)}):"?";return re("abbr",{title:i,children:[l," ",o]})},{RUNNING_SMOOTHLY:htt,STOP_AND_GO:ftt,CONGESTION:dtt,SEVERE_CONGESTION:ptt}=Pf.VehiclePosition.CongestionLevel,y4e=a=>a===1?re("code",{children:re("abbr",{title:"RUNNING_SMOOTHLY",children:"SMOOTH"})}):a===2?re("code",{children:re("abbr",{title:"STOP_AND_GO",children:"STOP_GO"})}):a===3?re("code",{children:re("abbr",{title:"CONGESTION",children:"CONG"})}):a===4?re("code",{children:re("abbr",{title:"SEVERE_CONGESTION",children:"SEV_CONG"})}):"?",{EMPTY:mtt,MANY_SEATS_AVAILABLE:_tt,FEW_SEATS_AVAILABLE:ytt,STANDING_ROOM_ONLY:gtt,CRUSHED_STANDING_ROOM_ONLY:vtt,FULL:xtt,NOT_ACCEPTING_PASSENGERS:btt}=Pf.VehiclePosition.OccupancyStatus,g4e=a=>a===0?re("code",{children:re("abbr",{title:"EMPTY",children:"EMPTY"})}):a===1?re("code",{children:re("abbr",{title:"MANY_SEATS_AVAILABLE",children:"MANY_SEATS"})}):a===2?re("code",{children:re("abbr",{title:"FEW_SEATS_AVAILABLE",children:"FEW_SEATS"})}):a===3?re("code",{children:re("abbr",{title:"STANDING_ROOM_ONLY",children:"STANDING"})}):a===4?re("code",{children:re("abbr",{title:"CRUSHED_STANDING_ROOM_ONLY",children:"CRUSHED"})}):a===5?re("code",{children:re("abbr",{title:"FULL",children:"FULL"})}):a===6?re("code",{children:re("abbr",{title:"NOT_ACCEPTING_PASSENGERS",children:"NOT_ACCEPT"})}):"?",v4e=(a,i,l)=>re("a",{href:"#",onClick:c=>{l("focus-vehicle-id",a),l("focus-trip-id",i.trip.trip_id),l("view:set","map"),c.preventDefault()},alt:"show vehicle on the map",children:re("code",{children:a})}),x4e=(a,i)=>{let l=a.trip_update.trip||{},o=a.trip_update.vehicle||{};return re("tr",{id:"entity-"+a.id,children:[re("td",{children:re("code",{children:a.id})}),re("td",{children:re("code",{children:l.route_id})}),re("td",{children:re("code",{children:l.direction_id})}),re("td",{children:re("code",{children:l.trip_id})}),re("td",{children:jK(l.start_date)}),re("td",{children:VK(l.start_time)}),re("td",{children:h4e(l.schedule_relationship)}),re("td",{children:re("code",{children:o.id})}),re("td",{children:re("code",{children:o.label})}),re("td",{children:re("code",{children:o.license_plate})}),re("td",{children:j0(a.trip_update.delay)})]})},b4e=(a,i)=>{let l=a.entity.filter(o=>!!o.trip_update);return re("div",{children:[re("h2",{children:[re("code",{children:"TripUpdate"}),"s (",l.length,")"]}),re("table",{class:"trip-updates",children:[re("thead",{children:[re("tr",{children:[re("th",{rowspan:"2",children:re("code",{children:re("abbr",{title:"entity_id",children:"e_id"})})}),re("th",{colspan:"5",children:re("code",{children:"trip"})}),re("th",{rowspan:"2",children:re("code",{children:re("abbr",{title:"schedule_relationship",children:"s_rel"})})}),re("th",{colspan:"3",children:re("code",{children:"vehicle"})}),re("th",{rowspan:"2",children:re("code",{children:"delay"})})]}),re("tr",{children:[re("th",{children:re("code",{children:"route_id"})}),re("th",{children:re("code",{children:re("abbr",{title:"direction_id",children:"dir_id"})})}),re("th",{children:re("code",{children:"trip_id"})}),re("th",{children:re("code",{children:re("abbr",{title:"start_date",children:"st_date"})})}),re("th",{children:re("code",{children:re("abbr",{title:"start_time",children:"st_time"})})}),re("th",{children:re("code",{children:"id"})}),re("th",{children:re("code",{children:"label"})}),re("th",{children:re("abbr",{title:"license_plate",children:re("code",{children:"lic_pl"})})})]})]}),re("tbody",{children:l.map(x4e)})]})]})},w4e=(a,i)=>{let l=a.vehicle.trip||{},o=a.vehicle.vehicle||{};return re("tr",{id:"entity-"+a.id,children:[re("td",{children:re("code",{children:a.id})}),re("td",{children:re("code",{children:l.route_id})}),re("td",{children:re("code",{children:l.direction_id})}),re("td",{children:re("code",{children:l.trip_id})}),re("td",{children:jK(l.start_date)}),re("td",{children:VK(l.start_time)}),re("td",{children:v4e(o.id,a.vehicle,i)}),re("td",{children:re("code",{children:o.label})}),re("td",{children:re("code",{children:o.license_plate})}),re("td",{children:re("code",{children:a.vehicle.current_stop_sequence})}),re("td",{children:re("code",{children:a.vehicle.stop_id})}),re("td",{children:m4e(a.vehicle.current_status)}),re("td",{children:_4e(a.vehicle.position)}),re("td",{children:y4e(a.vehicle.congestion_level)}),re("td",{children:g4e(a.vehicle.occupancy_status)})]})},T4e=(a,i)=>{let l=a.entity.filter(o=>!!o.vehicle);return re("div",{children:[re("h2",{children:[re("code",{children:"VehiclePosition"}),"s (",l.length,")"]}),re("table",{class:"vehicle-positions",children:[re("thead",{children:[re("tr",{children:[re("th",{rowspan:"2",children:re("code",{children:re("abbr",{title:"entity_id",children:"e_id"})})}),re("th",{colspan:"5",children:re("code",{children:"trip"})}),re("th",{colspan:"3",children:re("code",{children:"vehicle"})}),re("th",{rowspan:"2",children:re("code",{children:re("abbr",{title:"current_stop_sequence",children:"st_seq"})})}),re("th",{rowspan:"2",children:re("code",{children:"stop_id"})}),re("th",{rowspan:"2",children:re("code",{children:re("abbr",{title:"current_status",children:"status"})})}),re("th",{rowspan:"2",children:re("code",{children:"position"})}),re("th",{rowspan:"2",children:re("code",{children:re("abbr",{title:"congestion_level",children:"cong_lvl"})})}),re("th",{rowspan:"2",children:re("code",{children:re("abbr",{title:"occupancy_status",children:"occu"})})})]}),re("tr",{children:[re("th",{children:re("code",{children:"route_id"})}),re("th",{children:re("code",{children:re("abbr",{title:"direction_id",children:"dir_id"})})}),re("th",{children:re("code",{children:"trip_id"})}),re("th",{children:re("code",{children:re("abbr",{title:"start_date",children:"st_date"})})}),re("th",{children:re("code",{children:re("abbr",{title:"start_time",children:"st_time"})})}),re("th",{children:re("code",{children:"id"})}),re("th",{children:re("code",{children:"label"})}),re("th",{children:re("abbr",{title:"license_plate",children:re("code",{children:"lic_plate"})})})]})]}),re("tbody",{children:l.map(o=>w4e(o,i))})]})]})},E4e=({state:a,emit:i})=>{let l=a.feedData;return!Array.isArray(l.entity)||l.entity.length===0?re("p",{children:["The feed has no ",re("code",{children:"FeedEntity"}),"s."]}):re("div",{class:"inspector",children:[b4e(l,i),T4e(l,i)]})},QI=E4e;var t_=rn(GK(),1);var WK="/mapbox-gl.css",S4e="/arrow.png",ZK=["case",["!=",["get","delay"],null],["interpolate",["linear"],["get","delay"],0,["to-color","#2ecc71"],90,["to-color","#eebb00"],210,["to-color","#ee2200"]],"#e0e0e0"],HK={base:.3,stops:[[9,.3],[15,.8]]};t_.default.accessToken="pk.eyJ1IjoiZGVyaHVlcnN0IiwiYSI6ImNrajRuNnB3cjVyMWEycXFqMmh4dWUxZjMifQ.VVjBdXpzJVGbGc4u2n8Fog";setTimeout(()=>{t_.default.prewarm()},100);var I4e=()=>{if(Array.from(document.head.querySelectorAll('link[rel="stylesheet"]')).find(l=>l.getAttribute("href")===WK))return;console.debug("dynamically inserting Mapbox GL CSS <link>");let i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("href",WK),document.head.appendChild(i)},rA=class extends hf{constructor(){super(),this.ref=x7()}updateVehiclePositions(){let{feedData:i}=this.props.state,o=(i.entity||[]).filter(S=>S.vehicle&&S.vehicle.position);if(o.length===0)return;let c=this.map.getSource("vehicle-positions");if(!c)return;c.setData({type:"FeatureCollection",features:o.map(S=>({type:"Feature",properties:{vehicleId:S.vehicle.vehicle?.id,trip_id:S.vehicle.trip?.trip_id,delay:S.vehicle.delay},geometry:{type:"Point",coordinates:[S.vehicle.position.longitude,S.vehicle.position.latitude]}}))});let t=[o[0].vehicle.position.longitude,o[0].vehicle.position.latitude],v=new t_.default.LngLatBounds(t,t);for(let S of o)v.extend([S.vehicle.position.longitude,S.vehicle.position.latitude]);this.map.fitBounds(v,{padding:50})}updateFocusedTripShape(){let{focusedTripShape:i}=this.props.state,l=this.map.getSource("focused-trip-shape");l&&(i===null?l.setData({type:"FeatureCollection",features:[]}):l.setData(i))}updateFocusedVehiclePosition(){let{focusedVehiclePosition:i}=this.props.state,l=this.map.getSource("focused-vehicle-position");l&&(i===null?l.setData({type:"FeatureCollection",features:[]}):l.setData(i))}updateMap(){this.map&&(this.updateVehiclePositions(),this.updateFocusedTripShape(),this.updateFocusedVehiclePosition())}componentDidMount(){let{emit:i}=this.props;I4e(),this.map=new t_.default.Map({container:this.ref.current,style:"mapbox://styles/mapbox/dark-v10",center:[-74.5,40],zoom:9}),this.map.once("load",()=>{this.map.addSource("vehicle-positions",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"vehicle-positions",source:"vehicle-positions",type:"circle",paint:{"circle-radius":{base:1.5,stops:[[1,1],[20,35]]},"circle-color":ZK}}),this.map.on("mouseenter","vehicle-positions",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","vehicle-positions",()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click","vehicle-positions",o=>{let c=o.features[0]?.properties.vehicleId||null;i("focus-vehicle-id",c);let t=o.features[0]?.properties.trip_id||null;i("focus-trip-id",t)}),this.map.addSource("focused-trip-shape",{type:"geojson",data:null}),this.map.addLayer({id:"focused-trip-shape",source:"focused-trip-shape",type:"line",paint:{"line-width":{base:1,stops:[[1,.6],[20,4]]},"line-color":"#44a8eb","line-opacity":HK}});let l=this.map;l.loadImage(S4e,(o,c)=>{if(o){console.error("failed to load trip shape arrow",o);return}l.addImage("focused-trip-shape-arrow",c),l.addLayer({id:"focused-trip-shape-arrows",type:"symbol",source:"focused-trip-shape",paint:{"icon-opacity":HK},layout:{"symbol-placement":"line","icon-ignore-placement":!0,"icon-image":"focused-trip-shape-arrow","icon-size":.15}})}),this.map.addSource("focused-vehicle-position",{type:"geojson",data:null}),this.map.addLayer({id:"focused-vehicle-position",source:"focused-vehicle-position",type:"circle",paint:{"circle-radius":{base:5,stops:[[1,5],[20,100]]},"circle-color":ZK}}),this.updateMap()})}componentDidUpdate(){this.updateMap()}componentWillUnmount(){this.map&&(this.map.remove(),this.map=null)}render(){return re("div",{class:"map",ref:this.ref})}},XK=rA;var yY=rn(_Y(),1);var e5e=({state:a,emit:i})=>{let l=a.feedError,o=("	"+l.stack.replace(/\n/g,`	
`)).trim();return re("div",{class:"error",children:[re("h2",{children:re("code",{children:"failed to fetch the feed"})}),re("pre",{children:re("code",{children:(0,yY.default)(l)+`
`+o})})]})},gY=e5e;var t5e=({state:a,emit:i})=>{let l={log:UK,inspector:QI,map:XK}[a.view]||QI;return re("div",{class:"app",children:[re(BK,{state:a,emit:i}),re("div",{class:"view",children:a.feedData?re(l,{state:a,emit:i}):a.feedError?re(gY,{state:a,emit:i}):null})]})},vY=t5e;var qf={},Ra=new xY.default;Ra.STATE_CHANGE=Symbol("state change");var r5e=Ra.emit.bind(Ra);S7(qf,Ra);MH(qf,Ra);qH(qf,Ra);BH(qf,Ra);LK(qf,Ra);var bY=()=>{E7(re(vY,{state:qf,emit:r5e}),document.body)};Ra.on(Ra.STATE_CHANGE,bY);bY();})();
/*! Bundled license information:

content-type/index.js:
  (*!
   * content-type
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

mapbox-gl/dist/mapbox-gl.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/
//# sourceMappingURL=main.js.map
